var Zb=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var c4=Zb((h4,Gb)=>{function _0(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in e)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(e,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function S0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k0={exports:{}},sc={},R0={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Us=Symbol.for("react.element"),e2=Symbol.for("react.portal"),t2=Symbol.for("react.fragment"),n2=Symbol.for("react.strict_mode"),r2=Symbol.for("react.profiler"),o2=Symbol.for("react.provider"),i2=Symbol.for("react.context"),a2=Symbol.for("react.forward_ref"),s2=Symbol.for("react.suspense"),u2=Symbol.for("react.memo"),l2=Symbol.for("react.lazy"),Hv=Symbol.iterator;function c2(e){return e===null||typeof e!="object"?null:(e=Hv&&e[Hv]||e["@@iterator"],typeof e=="function"?e:null)}var I0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T0=Object.assign,D0={};function wa(e,t,n){this.props=e,this.context=t,this.refs=D0,this.updater=n||I0}wa.prototype.isReactComponent={};wa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};wa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function N0(){}N0.prototype=wa.prototype;function Rh(e,t,n){this.props=e,this.context=t,this.refs=D0,this.updater=n||I0}var Ih=Rh.prototype=new N0;Ih.constructor=Rh;T0(Ih,wa.prototype);Ih.isPureReactComponent=!0;var Gv=Array.isArray,P0=Object.prototype.hasOwnProperty,Th={current:null},A0={key:!0,ref:!0,__self:!0,__source:!0};function F0(e,t,n){var r,o={},i=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)P0.call(t,r)&&!A0.hasOwnProperty(r)&&(o[r]=t[r]);var s=arguments.length-2;if(s===1)o.children=n;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)o[r]===void 0&&(o[r]=s[r]);return{$$typeof:Us,type:e,key:i,ref:a,props:o,_owner:Th.current}}function f2(e,t){return{$$typeof:Us,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Dh(e){return typeof e=="object"&&e!==null&&e.$$typeof===Us}function d2(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Kv=/\/+/g;function Yc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?d2(""+e.key):t.toString(36)}function Xu(e,t,n,r,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Us:case e2:a=!0}}if(a)return a=e,o=o(a),e=r===""?"."+Yc(a,0):r,Gv(o)?(n="",e!=null&&(n=e.replace(Kv,"$&/")+"/"),Xu(o,t,n,"",function(l){return l})):o!=null&&(Dh(o)&&(o=f2(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(Kv,"$&/")+"/")+e)),t.push(o)),1;if(a=0,r=r===""?".":r+":",Gv(e))for(var s=0;s<e.length;s++){i=e[s];var u=r+Yc(i,s);a+=Xu(i,t,n,u,o)}else if(u=c2(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=r+Yc(i,s++),a+=Xu(i,t,n,u,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function gu(e,t,n){if(e==null)return e;var r=[],o=0;return Xu(e,r,"","",function(i){return t.call(n,i,o++)}),r}function h2(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var tn={current:null},Yu={transition:null},p2={ReactCurrentDispatcher:tn,ReactCurrentBatchConfig:Yu,ReactCurrentOwner:Th};function M0(){throw Error("act(...) is not supported in production builds of React.")}Pe.Children={map:gu,forEach:function(e,t,n){gu(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return gu(e,function(){t++}),t},toArray:function(e){return gu(e,function(t){return t})||[]},only:function(e){if(!Dh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Pe.Component=wa;Pe.Fragment=t2;Pe.Profiler=r2;Pe.PureComponent=Rh;Pe.StrictMode=n2;Pe.Suspense=s2;Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=p2;Pe.act=M0;Pe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=T0({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Th.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)P0.call(t,u)&&!A0.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:Us,type:e.type,key:o,ref:i,props:r,_owner:a}};Pe.createContext=function(e){return e={$$typeof:i2,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:o2,_context:e},e.Consumer=e};Pe.createElement=F0;Pe.createFactory=function(e){var t=F0.bind(null,e);return t.type=e,t};Pe.createRef=function(){return{current:null}};Pe.forwardRef=function(e){return{$$typeof:a2,render:e}};Pe.isValidElement=Dh;Pe.lazy=function(e){return{$$typeof:l2,_payload:{_status:-1,_result:e},_init:h2}};Pe.memo=function(e,t){return{$$typeof:u2,type:e,compare:t===void 0?null:t}};Pe.startTransition=function(e){var t=Yu.transition;Yu.transition={};try{e()}finally{Yu.transition=t}};Pe.unstable_act=M0;Pe.useCallback=function(e,t){return tn.current.useCallback(e,t)};Pe.useContext=function(e){return tn.current.useContext(e)};Pe.useDebugValue=function(){};Pe.useDeferredValue=function(e){return tn.current.useDeferredValue(e)};Pe.useEffect=function(e,t){return tn.current.useEffect(e,t)};Pe.useId=function(){return tn.current.useId()};Pe.useImperativeHandle=function(e,t,n){return tn.current.useImperativeHandle(e,t,n)};Pe.useInsertionEffect=function(e,t){return tn.current.useInsertionEffect(e,t)};Pe.useLayoutEffect=function(e,t){return tn.current.useLayoutEffect(e,t)};Pe.useMemo=function(e,t){return tn.current.useMemo(e,t)};Pe.useReducer=function(e,t,n){return tn.current.useReducer(e,t,n)};Pe.useRef=function(e){return tn.current.useRef(e)};Pe.useState=function(e){return tn.current.useState(e)};Pe.useSyncExternalStore=function(e,t,n){return tn.current.useSyncExternalStore(e,t,n)};Pe.useTransition=function(){return tn.current.useTransition()};Pe.version="18.3.1";R0.exports=Pe;var F=R0.exports;const mt=S0(F),v2=_0({__proto__:null,default:mt},[F]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m2=F,g2=Symbol.for("react.element"),y2=Symbol.for("react.fragment"),x2=Object.prototype.hasOwnProperty,w2=m2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b2={key:!0,ref:!0,__self:!0,__source:!0};function O0(e,t,n){var r,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)x2.call(t,r)&&!b2.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:g2,type:e,key:i,ref:a,props:o,_owner:w2.current}}sc.Fragment=y2;sc.jsx=O0;sc.jsxs=O0;k0.exports=sc;var J=k0.exports,L0={exports:{}},Rn={},B0={exports:{}},W0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(N,O){var B=N.length;N.push(O);e:for(;0<B;){var q=B-1>>>1,Q=N[q];if(0<o(Q,O))N[q]=O,N[B]=Q,B=q;else break e}}function n(N){return N.length===0?null:N[0]}function r(N){if(N.length===0)return null;var O=N[0],B=N.pop();if(B!==O){N[0]=B;e:for(var q=0,Q=N.length,ne=Q>>>1;q<ne;){var re=2*(q+1)-1,ve=N[re],me=re+1,xe=N[me];if(0>o(ve,B))me<Q&&0>o(xe,ve)?(N[q]=xe,N[me]=B,q=me):(N[q]=ve,N[re]=B,q=re);else if(me<Q&&0>o(xe,B))N[q]=xe,N[me]=B,q=me;else break e}}return O}function o(N,O){var B=N.sortIndex-O.sortIndex;return B!==0?B:N.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,f=null,d=3,h=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(N){for(var O=n(l);O!==null;){if(O.callback===null)r(l);else if(O.startTime<=N)r(l),O.sortIndex=O.expirationTime,t(u,O);else break;O=n(l)}}function w(N){if(m=!1,x(N),!p)if(n(u)!==null)p=!0,K(b);else{var O=n(l);O!==null&&G(w,O.startTime-N)}}function b(N,O){p=!1,m&&(m=!1,v(E),E=-1),h=!0;var B=d;try{for(x(O),f=n(u);f!==null&&(!(f.expirationTime>O)||N&&!T());){var q=f.callback;if(typeof q=="function"){f.callback=null,d=f.priorityLevel;var Q=q(f.expirationTime<=O);O=e.unstable_now(),typeof Q=="function"?f.callback=Q:f===n(u)&&r(u),x(O)}else r(u);f=n(u)}if(f!==null)var ne=!0;else{var re=n(l);re!==null&&G(w,re.startTime-O),ne=!1}return ne}finally{f=null,d=B,h=!1}}var C=!1,S=null,E=-1,k=5,_=-1;function T(){return!(e.unstable_now()-_<k)}function D(){if(S!==null){var N=e.unstable_now();_=N;var O=!0;try{O=S(!0,N)}finally{O?z():(C=!1,S=null)}}else C=!1}var z;if(typeof y=="function")z=function(){y(D)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,V=W.port2;W.port1.onmessage=D,z=function(){V.postMessage(null)}}else z=function(){g(D,0)};function K(N){S=N,C||(C=!0,z())}function G(N,O){E=g(function(){N(e.unstable_now())},O)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(N){N.callback=null},e.unstable_continueExecution=function(){p||h||(p=!0,K(b))},e.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<N?Math.floor(1e3/N):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(N){switch(d){case 1:case 2:case 3:var O=3;break;default:O=d}var B=d;d=O;try{return N()}finally{d=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(N,O){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var B=d;d=N;try{return O()}finally{d=B}},e.unstable_scheduleCallback=function(N,O,B){var q=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?q+B:q):B=q,N){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=B+Q,N={id:c++,callback:O,priorityLevel:N,startTime:B,expirationTime:Q,sortIndex:-1},B>q?(N.sortIndex=B,t(l,N),n(u)===null&&N===n(l)&&(m?(v(E),E=-1):m=!0,G(w,B-q))):(N.sortIndex=Q,t(u,N),p||h||(p=!0,K(b))),N},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(N){var O=d;return function(){var B=d;d=O;try{return N.apply(this,arguments)}finally{d=B}}}})(W0);B0.exports=W0;var E2=B0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C2=F,kn=E2;function Z(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $0=new Set,hs={};function yi(e,t){ua(e,t),ua(e+"Capture",t)}function ua(e,t){for(hs[e]=t,e=0;e<t.length;e++)$0.add(t[e])}var zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rd=Object.prototype.hasOwnProperty,_2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qv={},Xv={};function S2(e){return rd.call(Xv,e)?!0:rd.call(qv,e)?!1:_2.test(e)?Xv[e]=!0:(qv[e]=!0,!1)}function k2(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function R2(e,t,n,r){if(t===null||typeof t>"u"||k2(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function nn(e,t,n,r,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Wt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Wt[e]=new nn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Wt[t]=new nn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Wt[e]=new nn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Wt[e]=new nn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Wt[e]=new nn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Wt[e]=new nn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Wt[e]=new nn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Wt[e]=new nn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Wt[e]=new nn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Nh=/[\-:]([a-z])/g;function Ph(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Nh,Ph);Wt[t]=new nn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Nh,Ph);Wt[t]=new nn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Nh,Ph);Wt[t]=new nn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Wt[e]=new nn(e,1,!1,e.toLowerCase(),null,!1,!1)});Wt.xlinkHref=new nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Wt[e]=new nn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ah(e,t,n,r){var o=Wt.hasOwnProperty(t)?Wt[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(R2(t,n,o,r)&&(n=null),r||o===null?S2(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Kr=C2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yu=Symbol.for("react.element"),Oi=Symbol.for("react.portal"),Li=Symbol.for("react.fragment"),Fh=Symbol.for("react.strict_mode"),od=Symbol.for("react.profiler"),z0=Symbol.for("react.provider"),U0=Symbol.for("react.context"),Mh=Symbol.for("react.forward_ref"),id=Symbol.for("react.suspense"),ad=Symbol.for("react.suspense_list"),Oh=Symbol.for("react.memo"),uo=Symbol.for("react.lazy"),j0=Symbol.for("react.offscreen"),Yv=Symbol.iterator;function Pa(e){return e===null||typeof e!="object"?null:(e=Yv&&e[Yv]||e["@@iterator"],typeof e=="function"?e:null)}var at=Object.assign,Qc;function Ka(e){if(Qc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Qc=t&&t[1]||""}return`
`+Qc+e}var Jc=!1;function Zc(e,t){if(!e||Jc)return"";Jc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var o=l.stack.split(`
`),i=r.stack.split(`
`),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(a!==1||s!==1)do if(a--,s--,0>s||o[a]!==i[s]){var u=`
`+o[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=a&&0<=s);break}}}finally{Jc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ka(e):""}function I2(e){switch(e.tag){case 5:return Ka(e.type);case 16:return Ka("Lazy");case 13:return Ka("Suspense");case 19:return Ka("SuspenseList");case 0:case 2:case 15:return e=Zc(e.type,!1),e;case 11:return e=Zc(e.type.render,!1),e;case 1:return e=Zc(e.type,!0),e;default:return""}}function sd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Li:return"Fragment";case Oi:return"Portal";case od:return"Profiler";case Fh:return"StrictMode";case id:return"Suspense";case ad:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case U0:return(e.displayName||"Context")+".Consumer";case z0:return(e._context.displayName||"Context")+".Provider";case Mh:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Oh:return t=e.displayName||null,t!==null?t:sd(e.type)||"Memo";case uo:t=e._payload,e=e._init;try{return sd(e(t))}catch{}}return null}function T2(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sd(t);case 8:return t===Fh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Do(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function V0(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function D2(e){var t=V0(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xu(e){e._valueTracker||(e._valueTracker=D2(e))}function H0(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=V0(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function ll(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ud(e,t){var n=t.checked;return at({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Qv(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Do(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function G0(e,t){t=t.checked,t!=null&&Ah(e,"checked",t,!1)}function ld(e,t){G0(e,t);var n=Do(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?cd(e,t.type,n):t.hasOwnProperty("defaultValue")&&cd(e,t.type,Do(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Jv(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function cd(e,t,n){(t!=="number"||ll(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var qa=Array.isArray;function Xi(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Do(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function fd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Z(91));return at({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Zv(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Z(92));if(qa(n)){if(1<n.length)throw Error(Z(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Do(n)}}function K0(e,t){var n=Do(t.value),r=Do(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function em(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function q0(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?q0(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var wu,X0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(wu=wu||document.createElement("div"),wu.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=wu.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ps(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var es={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},N2=["Webkit","ms","Moz","O"];Object.keys(es).forEach(function(e){N2.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),es[t]=es[e]})});function Y0(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||es.hasOwnProperty(e)&&es[e]?(""+t).trim():t+"px"}function Q0(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=Y0(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var P2=at({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hd(e,t){if(t){if(P2[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Z(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Z(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Z(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Z(62))}}function pd(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vd=null;function Lh(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var md=null,Yi=null,Qi=null;function tm(e){if(e=Hs(e)){if(typeof md!="function")throw Error(Z(280));var t=e.stateNode;t&&(t=dc(t),md(e.stateNode,e.type,t))}}function J0(e){Yi?Qi?Qi.push(e):Qi=[e]:Yi=e}function Z0(){if(Yi){var e=Yi,t=Qi;if(Qi=Yi=null,tm(e),t)for(e=0;e<t.length;e++)tm(t[e])}}function ey(e,t){return e(t)}function ty(){}var ef=!1;function ny(e,t,n){if(ef)return e(t,n);ef=!0;try{return ey(e,t,n)}finally{ef=!1,(Yi!==null||Qi!==null)&&(ty(),Z0())}}function vs(e,t){var n=e.stateNode;if(n===null)return null;var r=dc(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Z(231,t,typeof n));return n}var gd=!1;if(zr)try{var Aa={};Object.defineProperty(Aa,"passive",{get:function(){gd=!0}}),window.addEventListener("test",Aa,Aa),window.removeEventListener("test",Aa,Aa)}catch{gd=!1}function A2(e,t,n,r,o,i,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var ts=!1,cl=null,fl=!1,yd=null,F2={onError:function(e){ts=!0,cl=e}};function M2(e,t,n,r,o,i,a,s,u){ts=!1,cl=null,A2.apply(F2,arguments)}function O2(e,t,n,r,o,i,a,s,u){if(M2.apply(this,arguments),ts){if(ts){var l=cl;ts=!1,cl=null}else throw Error(Z(198));fl||(fl=!0,yd=l)}}function xi(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function ry(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function nm(e){if(xi(e)!==e)throw Error(Z(188))}function L2(e){var t=e.alternate;if(!t){if(t=xi(e),t===null)throw Error(Z(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return nm(o),e;if(i===r)return nm(o),t;i=i.sibling}throw Error(Z(188))}if(n.return!==r.return)n=o,r=i;else{for(var a=!1,s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a){for(s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a)throw Error(Z(189))}}if(n.alternate!==r)throw Error(Z(190))}if(n.tag!==3)throw Error(Z(188));return n.stateNode.current===n?e:t}function oy(e){return e=L2(e),e!==null?iy(e):null}function iy(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=iy(e);if(t!==null)return t;e=e.sibling}return null}var ay=kn.unstable_scheduleCallback,rm=kn.unstable_cancelCallback,B2=kn.unstable_shouldYield,W2=kn.unstable_requestPaint,dt=kn.unstable_now,$2=kn.unstable_getCurrentPriorityLevel,Bh=kn.unstable_ImmediatePriority,sy=kn.unstable_UserBlockingPriority,dl=kn.unstable_NormalPriority,z2=kn.unstable_LowPriority,uy=kn.unstable_IdlePriority,uc=null,xr=null;function U2(e){if(xr&&typeof xr.onCommitFiberRoot=="function")try{xr.onCommitFiberRoot(uc,e,void 0,(e.current.flags&128)===128)}catch{}}var tr=Math.clz32?Math.clz32:H2,j2=Math.log,V2=Math.LN2;function H2(e){return e>>>=0,e===0?32:31-(j2(e)/V2|0)|0}var bu=64,Eu=4194304;function Xa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function hl(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var s=a&~o;s!==0?r=Xa(s):(i&=a,i!==0&&(r=Xa(i)))}else a=n&~o,a!==0?r=Xa(a):i!==0&&(r=Xa(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-tr(t),o=1<<n,r|=e[n],t&=~o;return r}function G2(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function K2(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-tr(i),s=1<<a,u=o[a];u===-1?(!(s&n)||s&r)&&(o[a]=G2(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}function xd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ly(){var e=bu;return bu<<=1,!(bu&4194240)&&(bu=64),e}function tf(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function js(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-tr(t),e[t]=n}function q2(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-tr(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}function Wh(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-tr(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var Ve=0;function cy(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var fy,$h,dy,hy,py,wd=!1,Cu=[],xo=null,wo=null,bo=null,ms=new Map,gs=new Map,co=[],X2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function om(e,t){switch(e){case"focusin":case"focusout":xo=null;break;case"dragenter":case"dragleave":wo=null;break;case"mouseover":case"mouseout":bo=null;break;case"pointerover":case"pointerout":ms.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gs.delete(t.pointerId)}}function Fa(e,t,n,r,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Hs(t),t!==null&&$h(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Y2(e,t,n,r,o){switch(t){case"focusin":return xo=Fa(xo,e,t,n,r,o),!0;case"dragenter":return wo=Fa(wo,e,t,n,r,o),!0;case"mouseover":return bo=Fa(bo,e,t,n,r,o),!0;case"pointerover":var i=o.pointerId;return ms.set(i,Fa(ms.get(i)||null,e,t,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,gs.set(i,Fa(gs.get(i)||null,e,t,n,r,o)),!0}return!1}function vy(e){var t=Zo(e.target);if(t!==null){var n=xi(t);if(n!==null){if(t=n.tag,t===13){if(t=ry(n),t!==null){e.blockedOn=t,py(e.priority,function(){dy(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Qu(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=bd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);vd=r,n.target.dispatchEvent(r),vd=null}else return t=Hs(n),t!==null&&$h(t),e.blockedOn=n,!1;t.shift()}return!0}function im(e,t,n){Qu(e)&&n.delete(t)}function Q2(){wd=!1,xo!==null&&Qu(xo)&&(xo=null),wo!==null&&Qu(wo)&&(wo=null),bo!==null&&Qu(bo)&&(bo=null),ms.forEach(im),gs.forEach(im)}function Ma(e,t){e.blockedOn===t&&(e.blockedOn=null,wd||(wd=!0,kn.unstable_scheduleCallback(kn.unstable_NormalPriority,Q2)))}function ys(e){function t(o){return Ma(o,e)}if(0<Cu.length){Ma(Cu[0],e);for(var n=1;n<Cu.length;n++){var r=Cu[n];r.blockedOn===e&&(r.blockedOn=null)}}for(xo!==null&&Ma(xo,e),wo!==null&&Ma(wo,e),bo!==null&&Ma(bo,e),ms.forEach(t),gs.forEach(t),n=0;n<co.length;n++)r=co[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<co.length&&(n=co[0],n.blockedOn===null);)vy(n),n.blockedOn===null&&co.shift()}var Ji=Kr.ReactCurrentBatchConfig,pl=!0;function J2(e,t,n,r){var o=Ve,i=Ji.transition;Ji.transition=null;try{Ve=1,zh(e,t,n,r)}finally{Ve=o,Ji.transition=i}}function Z2(e,t,n,r){var o=Ve,i=Ji.transition;Ji.transition=null;try{Ve=4,zh(e,t,n,r)}finally{Ve=o,Ji.transition=i}}function zh(e,t,n,r){if(pl){var o=bd(e,t,n,r);if(o===null)df(e,t,r,vl,n),om(e,r);else if(Y2(o,e,t,n,r))r.stopPropagation();else if(om(e,r),t&4&&-1<X2.indexOf(e)){for(;o!==null;){var i=Hs(o);if(i!==null&&fy(i),i=bd(e,t,n,r),i===null&&df(e,t,r,vl,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else df(e,t,r,null,n)}}var vl=null;function bd(e,t,n,r){if(vl=null,e=Lh(r),e=Zo(e),e!==null)if(t=xi(e),t===null)e=null;else if(n=t.tag,n===13){if(e=ry(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return vl=e,null}function my(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($2()){case Bh:return 1;case sy:return 4;case dl:case z2:return 16;case uy:return 536870912;default:return 16}default:return 16}}var ho=null,Uh=null,Ju=null;function gy(){if(Ju)return Ju;var e,t=Uh,n=t.length,r,o="value"in ho?ho.value:ho.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(r=1;r<=a&&t[n-r]===o[i-r];r++);return Ju=o.slice(e,1<r?1-r:void 0)}function Zu(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function _u(){return!0}function am(){return!1}function In(e){function t(n,r,o,i,a){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(n=e[s],this[s]=n?n(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?_u:am,this.isPropagationStopped=am,this}return at(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=_u)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=_u)},persist:function(){},isPersistent:_u}),t}var ba={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jh=In(ba),Vs=at({},ba,{view:0,detail:0}),eE=In(Vs),nf,rf,Oa,lc=at({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Oa&&(Oa&&e.type==="mousemove"?(nf=e.screenX-Oa.screenX,rf=e.screenY-Oa.screenY):rf=nf=0,Oa=e),nf)},movementY:function(e){return"movementY"in e?e.movementY:rf}}),sm=In(lc),tE=at({},lc,{dataTransfer:0}),nE=In(tE),rE=at({},Vs,{relatedTarget:0}),of=In(rE),oE=at({},ba,{animationName:0,elapsedTime:0,pseudoElement:0}),iE=In(oE),aE=at({},ba,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sE=In(aE),uE=at({},ba,{data:0}),um=In(uE),lE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dE(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=fE[e])?!!t[e]:!1}function Vh(){return dE}var hE=at({},Vs,{key:function(e){if(e.key){var t=lE[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zu(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?cE[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vh,charCode:function(e){return e.type==="keypress"?Zu(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zu(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),pE=In(hE),vE=at({},lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lm=In(vE),mE=at({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vh}),gE=In(mE),yE=at({},ba,{propertyName:0,elapsedTime:0,pseudoElement:0}),xE=In(yE),wE=at({},lc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),bE=In(wE),EE=[9,13,27,32],Hh=zr&&"CompositionEvent"in window,ns=null;zr&&"documentMode"in document&&(ns=document.documentMode);var CE=zr&&"TextEvent"in window&&!ns,yy=zr&&(!Hh||ns&&8<ns&&11>=ns),cm=" ",fm=!1;function xy(e,t){switch(e){case"keyup":return EE.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wy(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Bi=!1;function _E(e,t){switch(e){case"compositionend":return wy(t);case"keypress":return t.which!==32?null:(fm=!0,cm);case"textInput":return e=t.data,e===cm&&fm?null:e;default:return null}}function SE(e,t){if(Bi)return e==="compositionend"||!Hh&&xy(e,t)?(e=gy(),Ju=Uh=ho=null,Bi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return yy&&t.locale!=="ko"?null:t.data;default:return null}}var kE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!kE[e.type]:t==="textarea"}function by(e,t,n,r){J0(r),t=ml(t,"onChange"),0<t.length&&(n=new jh("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var rs=null,xs=null;function RE(e){Py(e,0)}function cc(e){var t=zi(e);if(H0(t))return e}function IE(e,t){if(e==="change")return t}var Ey=!1;if(zr){var af;if(zr){var sf="oninput"in document;if(!sf){var hm=document.createElement("div");hm.setAttribute("oninput","return;"),sf=typeof hm.oninput=="function"}af=sf}else af=!1;Ey=af&&(!document.documentMode||9<document.documentMode)}function pm(){rs&&(rs.detachEvent("onpropertychange",Cy),xs=rs=null)}function Cy(e){if(e.propertyName==="value"&&cc(xs)){var t=[];by(t,xs,e,Lh(e)),ny(RE,t)}}function TE(e,t,n){e==="focusin"?(pm(),rs=t,xs=n,rs.attachEvent("onpropertychange",Cy)):e==="focusout"&&pm()}function DE(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return cc(xs)}function NE(e,t){if(e==="click")return cc(t)}function PE(e,t){if(e==="input"||e==="change")return cc(t)}function AE(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var or=typeof Object.is=="function"?Object.is:AE;function ws(e,t){if(or(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!rd.call(t,o)||!or(e[o],t[o]))return!1}return!0}function vm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mm(e,t){var n=vm(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=vm(n)}}function _y(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?_y(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Sy(){for(var e=window,t=ll();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=ll(e.document)}return t}function Gh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function FE(e){var t=Sy(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&_y(n.ownerDocument.documentElement,n)){if(r!==null&&Gh(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!e.extend&&i>r&&(o=r,r=i,i=o),o=mm(n,i);var a=mm(n,r);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ME=zr&&"documentMode"in document&&11>=document.documentMode,Wi=null,Ed=null,os=null,Cd=!1;function gm(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Cd||Wi==null||Wi!==ll(r)||(r=Wi,"selectionStart"in r&&Gh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),os&&ws(os,r)||(os=r,r=ml(Ed,"onSelect"),0<r.length&&(t=new jh("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Wi)))}function Su(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var $i={animationend:Su("Animation","AnimationEnd"),animationiteration:Su("Animation","AnimationIteration"),animationstart:Su("Animation","AnimationStart"),transitionend:Su("Transition","TransitionEnd")},uf={},ky={};zr&&(ky=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function fc(e){if(uf[e])return uf[e];if(!$i[e])return e;var t=$i[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ky)return uf[e]=t[n];return e}var Ry=fc("animationend"),Iy=fc("animationiteration"),Ty=fc("animationstart"),Dy=fc("transitionend"),Ny=new Map,ym="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ao(e,t){Ny.set(e,t),yi(t,[e])}for(var lf=0;lf<ym.length;lf++){var cf=ym[lf],OE=cf.toLowerCase(),LE=cf[0].toUpperCase()+cf.slice(1);Ao(OE,"on"+LE)}Ao(Ry,"onAnimationEnd");Ao(Iy,"onAnimationIteration");Ao(Ty,"onAnimationStart");Ao("dblclick","onDoubleClick");Ao("focusin","onFocus");Ao("focusout","onBlur");Ao(Dy,"onTransitionEnd");ua("onMouseEnter",["mouseout","mouseover"]);ua("onMouseLeave",["mouseout","mouseover"]);ua("onPointerEnter",["pointerout","pointerover"]);ua("onPointerLeave",["pointerout","pointerover"]);yi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yi("onBeforeInput",["compositionend","keypress","textInput","paste"]);yi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ya="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ya));function xm(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,O2(r,t,void 0,e),e.currentTarget=null}function Py(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&o.isPropagationStopped())break e;xm(o,s,l),i=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&o.isPropagationStopped())break e;xm(o,s,l),i=u}}}if(fl)throw e=yd,fl=!1,yd=null,e}function Qe(e,t){var n=t[Id];n===void 0&&(n=t[Id]=new Set);var r=e+"__bubble";n.has(r)||(Ay(t,e,2,!1),n.add(r))}function ff(e,t,n){var r=0;t&&(r|=4),Ay(n,e,r,t)}var ku="_reactListening"+Math.random().toString(36).slice(2);function bs(e){if(!e[ku]){e[ku]=!0,$0.forEach(function(n){n!=="selectionchange"&&(BE.has(n)||ff(n,!1,e),ff(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ku]||(t[ku]=!0,ff("selectionchange",!1,t))}}function Ay(e,t,n,r){switch(my(t)){case 1:var o=J2;break;case 4:o=Z2;break;default:o=zh}n=o.bind(null,t,n,e),o=void 0,!gd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function df(e,t,n,r,o){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;a=a.return}for(;s!==null;){if(a=Zo(s),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}s=s.parentNode}}r=r.return}ny(function(){var l=i,c=Lh(n),f=[];e:{var d=Ny.get(e);if(d!==void 0){var h=jh,p=e;switch(e){case"keypress":if(Zu(n)===0)break e;case"keydown":case"keyup":h=pE;break;case"focusin":p="focus",h=of;break;case"focusout":p="blur",h=of;break;case"beforeblur":case"afterblur":h=of;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=sm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=nE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=gE;break;case Ry:case Iy:case Ty:h=iE;break;case Dy:h=xE;break;case"scroll":h=eE;break;case"wheel":h=bE;break;case"copy":case"cut":case"paste":h=sE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=lm}var m=(t&4)!==0,g=!m&&e==="scroll",v=m?d!==null?d+"Capture":null:d;m=[];for(var y=l,x;y!==null;){x=y;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=vs(y,v),w!=null&&m.push(Es(y,w,x)))),g)break;y=y.return}0<m.length&&(d=new h(d,p,null,n,c),f.push({event:d,listeners:m}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",d&&n!==vd&&(p=n.relatedTarget||n.fromElement)&&(Zo(p)||p[Ur]))break e;if((h||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,h?(p=n.relatedTarget||n.toElement,h=l,p=p?Zo(p):null,p!==null&&(g=xi(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=l),h!==p)){if(m=sm,w="onMouseLeave",v="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(m=lm,w="onPointerLeave",v="onPointerEnter",y="pointer"),g=h==null?d:zi(h),x=p==null?d:zi(p),d=new m(w,y+"leave",h,n,c),d.target=g,d.relatedTarget=x,w=null,Zo(c)===l&&(m=new m(v,y+"enter",p,n,c),m.target=x,m.relatedTarget=g,w=m),g=w,h&&p)t:{for(m=h,v=p,y=0,x=m;x;x=ki(x))y++;for(x=0,w=v;w;w=ki(w))x++;for(;0<y-x;)m=ki(m),y--;for(;0<x-y;)v=ki(v),x--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=ki(m),v=ki(v)}m=null}else m=null;h!==null&&wm(f,d,h,m,!1),p!==null&&g!==null&&wm(f,g,p,m,!0)}}e:{if(d=l?zi(l):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var b=IE;else if(dm(d))if(Ey)b=PE;else{b=DE;var C=TE}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(b=NE);if(b&&(b=b(e,l))){by(f,b,n,c);break e}C&&C(e,d,l),e==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&cd(d,"number",d.value)}switch(C=l?zi(l):window,e){case"focusin":(dm(C)||C.contentEditable==="true")&&(Wi=C,Ed=l,os=null);break;case"focusout":os=Ed=Wi=null;break;case"mousedown":Cd=!0;break;case"contextmenu":case"mouseup":case"dragend":Cd=!1,gm(f,n,c);break;case"selectionchange":if(ME)break;case"keydown":case"keyup":gm(f,n,c)}var S;if(Hh)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Bi?xy(e,n)&&(E="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(yy&&n.locale!=="ko"&&(Bi||E!=="onCompositionStart"?E==="onCompositionEnd"&&Bi&&(S=gy()):(ho=c,Uh="value"in ho?ho.value:ho.textContent,Bi=!0)),C=ml(l,E),0<C.length&&(E=new um(E,e,null,n,c),f.push({event:E,listeners:C}),S?E.data=S:(S=wy(n),S!==null&&(E.data=S)))),(S=CE?_E(e,n):SE(e,n))&&(l=ml(l,"onBeforeInput"),0<l.length&&(c=new um("onBeforeInput","beforeinput",null,n,c),f.push({event:c,listeners:l}),c.data=S))}Py(f,t)})}function Es(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ml(e,t){for(var n=t+"Capture",r=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=vs(e,n),i!=null&&r.unshift(Es(e,i,o)),i=vs(e,t),i!=null&&r.push(Es(e,i,o))),e=e.return}return r}function ki(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wm(e,t,n,r,o){for(var i=t._reactName,a=[];n!==null&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,o?(u=vs(n,i),u!=null&&a.unshift(Es(n,u,s))):o||(u=vs(n,i),u!=null&&a.push(Es(n,u,s)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var WE=/\r\n?/g,$E=/\u0000|\uFFFD/g;function bm(e){return(typeof e=="string"?e:""+e).replace(WE,`
`).replace($E,"")}function Ru(e,t,n){if(t=bm(t),bm(e)!==t&&n)throw Error(Z(425))}function gl(){}var _d=null,Sd=null;function kd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Rd=typeof setTimeout=="function"?setTimeout:void 0,zE=typeof clearTimeout=="function"?clearTimeout:void 0,Em=typeof Promise=="function"?Promise:void 0,UE=typeof queueMicrotask=="function"?queueMicrotask:typeof Em<"u"?function(e){return Em.resolve(null).then(e).catch(jE)}:Rd;function jE(e){setTimeout(function(){throw e})}function hf(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){e.removeChild(o),ys(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);ys(t)}function Eo(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Cm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ea=Math.random().toString(36).slice(2),vr="__reactFiber$"+Ea,Cs="__reactProps$"+Ea,Ur="__reactContainer$"+Ea,Id="__reactEvents$"+Ea,VE="__reactListeners$"+Ea,HE="__reactHandles$"+Ea;function Zo(e){var t=e[vr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ur]||n[vr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Cm(e);e!==null;){if(n=e[vr])return n;e=Cm(e)}return t}e=n,n=e.parentNode}return null}function Hs(e){return e=e[vr]||e[Ur],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function zi(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Z(33))}function dc(e){return e[Cs]||null}var Td=[],Ui=-1;function Fo(e){return{current:e}}function Ze(e){0>Ui||(e.current=Td[Ui],Td[Ui]=null,Ui--)}function qe(e,t){Ui++,Td[Ui]=e.current,e.current=t}var No={},Xt=Fo(No),un=Fo(!1),ci=No;function la(e,t){var n=e.type.contextTypes;if(!n)return No;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function ln(e){return e=e.childContextTypes,e!=null}function yl(){Ze(un),Ze(Xt)}function _m(e,t,n){if(Xt.current!==No)throw Error(Z(168));qe(Xt,t),qe(un,n)}function Fy(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(Z(108,T2(e)||"Unknown",o));return at({},n,r)}function xl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||No,ci=Xt.current,qe(Xt,e),qe(un,un.current),!0}function Sm(e,t,n){var r=e.stateNode;if(!r)throw Error(Z(169));n?(e=Fy(e,t,ci),r.__reactInternalMemoizedMergedChildContext=e,Ze(un),Ze(Xt),qe(Xt,e)):Ze(un),qe(un,n)}var Mr=null,hc=!1,pf=!1;function My(e){Mr===null?Mr=[e]:Mr.push(e)}function GE(e){hc=!0,My(e)}function Mo(){if(!pf&&Mr!==null){pf=!0;var e=0,t=Ve;try{var n=Mr;for(Ve=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Mr=null,hc=!1}catch(o){throw Mr!==null&&(Mr=Mr.slice(e+1)),ay(Bh,Mo),o}finally{Ve=t,pf=!1}}return null}var ji=[],Vi=0,wl=null,bl=0,An=[],Fn=0,fi=null,Lr=1,Br="";function Vo(e,t){ji[Vi++]=bl,ji[Vi++]=wl,wl=e,bl=t}function Oy(e,t,n){An[Fn++]=Lr,An[Fn++]=Br,An[Fn++]=fi,fi=e;var r=Lr;e=Br;var o=32-tr(r)-1;r&=~(1<<o),n+=1;var i=32-tr(t)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,Lr=1<<32-tr(t)+o|n<<o|r,Br=i+e}else Lr=1<<i|n<<o|r,Br=e}function Kh(e){e.return!==null&&(Vo(e,1),Oy(e,1,0))}function qh(e){for(;e===wl;)wl=ji[--Vi],ji[Vi]=null,bl=ji[--Vi],ji[Vi]=null;for(;e===fi;)fi=An[--Fn],An[Fn]=null,Br=An[--Fn],An[Fn]=null,Lr=An[--Fn],An[Fn]=null}var _n=null,wn=null,et=!1,Jn=null;function Ly(e,t){var n=Bn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function km(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,_n=e,wn=Eo(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,_n=e,wn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=fi!==null?{id:Lr,overflow:Br}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Bn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,_n=e,wn=null,!0):!1;default:return!1}}function Dd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Nd(e){if(et){var t=wn;if(t){var n=t;if(!km(e,t)){if(Dd(e))throw Error(Z(418));t=Eo(n.nextSibling);var r=_n;t&&km(e,t)?Ly(r,n):(e.flags=e.flags&-4097|2,et=!1,_n=e)}}else{if(Dd(e))throw Error(Z(418));e.flags=e.flags&-4097|2,et=!1,_n=e}}}function Rm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;_n=e}function Iu(e){if(e!==_n)return!1;if(!et)return Rm(e),et=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!kd(e.type,e.memoizedProps)),t&&(t=wn)){if(Dd(e))throw By(),Error(Z(418));for(;t;)Ly(e,t),t=Eo(t.nextSibling)}if(Rm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Z(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){wn=Eo(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}wn=null}}else wn=_n?Eo(e.stateNode.nextSibling):null;return!0}function By(){for(var e=wn;e;)e=Eo(e.nextSibling)}function ca(){wn=_n=null,et=!1}function Xh(e){Jn===null?Jn=[e]:Jn.push(e)}var KE=Kr.ReactCurrentBatchConfig;function La(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Z(309));var r=n.stateNode}if(!r)throw Error(Z(147,e));var o=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var s=o.refs;a===null?delete s[i]:s[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(Z(284));if(!n._owner)throw Error(Z(290,e))}return e}function Tu(e,t){throw e=Object.prototype.toString.call(t),Error(Z(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Im(e){var t=e._init;return t(e._payload)}function Wy(e){function t(v,y){if(e){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function n(v,y){if(!e)return null;for(;y!==null;)t(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function o(v,y){return v=ko(v,y),v.index=0,v.sibling=null,v}function i(v,y,x){return v.index=x,e?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function a(v){return e&&v.alternate===null&&(v.flags|=2),v}function s(v,y,x,w){return y===null||y.tag!==6?(y=bf(x,v.mode,w),y.return=v,y):(y=o(y,x),y.return=v,y)}function u(v,y,x,w){var b=x.type;return b===Li?c(v,y,x.props.children,w,x.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===uo&&Im(b)===y.type)?(w=o(y,x.props),w.ref=La(v,y,x),w.return=v,w):(w=al(x.type,x.key,x.props,null,v.mode,w),w.ref=La(v,y,x),w.return=v,w)}function l(v,y,x,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=Ef(x,v.mode,w),y.return=v,y):(y=o(y,x.children||[]),y.return=v,y)}function c(v,y,x,w,b){return y===null||y.tag!==7?(y=si(x,v.mode,w,b),y.return=v,y):(y=o(y,x),y.return=v,y)}function f(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=bf(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case yu:return x=al(y.type,y.key,y.props,null,v.mode,x),x.ref=La(v,null,y),x.return=v,x;case Oi:return y=Ef(y,v.mode,x),y.return=v,y;case uo:var w=y._init;return f(v,w(y._payload),x)}if(qa(y)||Pa(y))return y=si(y,v.mode,x,null),y.return=v,y;Tu(v,y)}return null}function d(v,y,x,w){var b=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return b!==null?null:s(v,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case yu:return x.key===b?u(v,y,x,w):null;case Oi:return x.key===b?l(v,y,x,w):null;case uo:return b=x._init,d(v,y,b(x._payload),w)}if(qa(x)||Pa(x))return b!==null?null:c(v,y,x,w,null);Tu(v,x)}return null}function h(v,y,x,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,s(y,v,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case yu:return v=v.get(w.key===null?x:w.key)||null,u(y,v,w,b);case Oi:return v=v.get(w.key===null?x:w.key)||null,l(y,v,w,b);case uo:var C=w._init;return h(v,y,x,C(w._payload),b)}if(qa(w)||Pa(w))return v=v.get(x)||null,c(y,v,w,b,null);Tu(y,w)}return null}function p(v,y,x,w){for(var b=null,C=null,S=y,E=y=0,k=null;S!==null&&E<x.length;E++){S.index>E?(k=S,S=null):k=S.sibling;var _=d(v,S,x[E],w);if(_===null){S===null&&(S=k);break}e&&S&&_.alternate===null&&t(v,S),y=i(_,y,E),C===null?b=_:C.sibling=_,C=_,S=k}if(E===x.length)return n(v,S),et&&Vo(v,E),b;if(S===null){for(;E<x.length;E++)S=f(v,x[E],w),S!==null&&(y=i(S,y,E),C===null?b=S:C.sibling=S,C=S);return et&&Vo(v,E),b}for(S=r(v,S);E<x.length;E++)k=h(S,v,E,x[E],w),k!==null&&(e&&k.alternate!==null&&S.delete(k.key===null?E:k.key),y=i(k,y,E),C===null?b=k:C.sibling=k,C=k);return e&&S.forEach(function(T){return t(v,T)}),et&&Vo(v,E),b}function m(v,y,x,w){var b=Pa(x);if(typeof b!="function")throw Error(Z(150));if(x=b.call(x),x==null)throw Error(Z(151));for(var C=b=null,S=y,E=y=0,k=null,_=x.next();S!==null&&!_.done;E++,_=x.next()){S.index>E?(k=S,S=null):k=S.sibling;var T=d(v,S,_.value,w);if(T===null){S===null&&(S=k);break}e&&S&&T.alternate===null&&t(v,S),y=i(T,y,E),C===null?b=T:C.sibling=T,C=T,S=k}if(_.done)return n(v,S),et&&Vo(v,E),b;if(S===null){for(;!_.done;E++,_=x.next())_=f(v,_.value,w),_!==null&&(y=i(_,y,E),C===null?b=_:C.sibling=_,C=_);return et&&Vo(v,E),b}for(S=r(v,S);!_.done;E++,_=x.next())_=h(S,v,E,_.value,w),_!==null&&(e&&_.alternate!==null&&S.delete(_.key===null?E:_.key),y=i(_,y,E),C===null?b=_:C.sibling=_,C=_);return e&&S.forEach(function(D){return t(v,D)}),et&&Vo(v,E),b}function g(v,y,x,w){if(typeof x=="object"&&x!==null&&x.type===Li&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case yu:e:{for(var b=x.key,C=y;C!==null;){if(C.key===b){if(b=x.type,b===Li){if(C.tag===7){n(v,C.sibling),y=o(C,x.props.children),y.return=v,v=y;break e}}else if(C.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===uo&&Im(b)===C.type){n(v,C.sibling),y=o(C,x.props),y.ref=La(v,C,x),y.return=v,v=y;break e}n(v,C);break}else t(v,C);C=C.sibling}x.type===Li?(y=si(x.props.children,v.mode,w,x.key),y.return=v,v=y):(w=al(x.type,x.key,x.props,null,v.mode,w),w.ref=La(v,y,x),w.return=v,v=w)}return a(v);case Oi:e:{for(C=x.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){n(v,y.sibling),y=o(y,x.children||[]),y.return=v,v=y;break e}else{n(v,y);break}else t(v,y);y=y.sibling}y=Ef(x,v.mode,w),y.return=v,v=y}return a(v);case uo:return C=x._init,g(v,y,C(x._payload),w)}if(qa(x))return p(v,y,x,w);if(Pa(x))return m(v,y,x,w);Tu(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(n(v,y.sibling),y=o(y,x),y.return=v,v=y):(n(v,y),y=bf(x,v.mode,w),y.return=v,v=y),a(v)):n(v,y)}return g}var fa=Wy(!0),$y=Wy(!1),El=Fo(null),Cl=null,Hi=null,Yh=null;function Qh(){Yh=Hi=Cl=null}function Jh(e){var t=El.current;Ze(El),e._currentValue=t}function Pd(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Zi(e,t){Cl=e,Yh=Hi=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(sn=!0),e.firstContext=null)}function zn(e){var t=e._currentValue;if(Yh!==e)if(e={context:e,memoizedValue:t,next:null},Hi===null){if(Cl===null)throw Error(Z(308));Hi=e,Cl.dependencies={lanes:0,firstContext:e}}else Hi=Hi.next=e;return t}var ei=null;function Zh(e){ei===null?ei=[e]:ei.push(e)}function zy(e,t,n,r){var o=t.interleaved;return o===null?(n.next=n,Zh(t)):(n.next=o.next,o.next=n),t.interleaved=n,jr(e,r)}function jr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var lo=!1;function ep(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uy(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Wr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Co(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Le&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,jr(e,n)}return o=r.interleaved,o===null?(t.next=t,Zh(r)):(t.next=o.next,o.next=t),r.interleaved=t,jr(e,n)}function el(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Wh(e,n)}}function Tm(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function _l(e,t,n,r){var o=e.updateQueue;lo=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?i=l:a.next=l,a=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(i!==null){var f=o.baseState;a=0,c=l=u=null,s=i;do{var d=s.lane,h=s.eventTime;if((r&d)===d){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(d=t,h=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){f=p.call(h,f,d);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(h,f,d):p,d==null)break e;f=at({},f,d);break e;case 2:lo=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,d=o.effects,d===null?o.effects=[s]:d.push(s))}else h={eventTime:h,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=f):c=c.next=h,a|=d;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;d=s,s=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(!0);if(c===null&&(u=f),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);hi|=a,e.lanes=a,e.memoizedState=f}}function Dm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(Z(191,o));o.call(r)}}}var Gs={},wr=Fo(Gs),_s=Fo(Gs),Ss=Fo(Gs);function ti(e){if(e===Gs)throw Error(Z(174));return e}function tp(e,t){switch(qe(Ss,t),qe(_s,e),qe(wr,Gs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dd(t,e)}Ze(wr),qe(wr,t)}function da(){Ze(wr),Ze(_s),Ze(Ss)}function jy(e){ti(Ss.current);var t=ti(wr.current),n=dd(t,e.type);t!==n&&(qe(_s,e),qe(wr,n))}function np(e){_s.current===e&&(Ze(wr),Ze(_s))}var nt=Fo(0);function Sl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vf=[];function rp(){for(var e=0;e<vf.length;e++)vf[e]._workInProgressVersionPrimary=null;vf.length=0}var tl=Kr.ReactCurrentDispatcher,mf=Kr.ReactCurrentBatchConfig,di=0,it=null,wt=null,Dt=null,kl=!1,is=!1,ks=0,qE=0;function zt(){throw Error(Z(321))}function op(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function ip(e,t,n,r,o,i){if(di=i,it=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,tl.current=e===null||e.memoizedState===null?JE:ZE,e=n(r,o),is){i=0;do{if(is=!1,ks=0,25<=i)throw Error(Z(301));i+=1,Dt=wt=null,t.updateQueue=null,tl.current=eC,e=n(r,o)}while(is)}if(tl.current=Rl,t=wt!==null&&wt.next!==null,di=0,Dt=wt=it=null,kl=!1,t)throw Error(Z(300));return e}function ap(){var e=ks!==0;return ks=0,e}function dr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?it.memoizedState=Dt=e:Dt=Dt.next=e,Dt}function Un(){if(wt===null){var e=it.alternate;e=e!==null?e.memoizedState:null}else e=wt.next;var t=Dt===null?it.memoizedState:Dt.next;if(t!==null)Dt=t,wt=e;else{if(e===null)throw Error(Z(310));wt=e,e={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Dt===null?it.memoizedState=Dt=e:Dt=Dt.next=e}return Dt}function Rs(e,t){return typeof t=="function"?t(e):t}function gf(e){var t=Un(),n=t.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=e;var r=wt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var s=a=null,u=null,l=i;do{var c=l.lane;if((di&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=f,a=r):u=u.next=f,it.lanes|=c,hi|=c}l=l.next}while(l!==null&&l!==i);u===null?a=r:u.next=s,or(r,t.memoizedState)||(sn=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){o=e;do i=o.lane,it.lanes|=i,hi|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function yf(e){var t=Un(),n=t.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);or(i,t.memoizedState)||(sn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Vy(){}function Hy(e,t){var n=it,r=Un(),o=t(),i=!or(r.memoizedState,o);if(i&&(r.memoizedState=o,sn=!0),r=r.queue,sp(qy.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||Dt!==null&&Dt.memoizedState.tag&1){if(n.flags|=2048,Is(9,Ky.bind(null,n,r,o,t),void 0,null),Nt===null)throw Error(Z(349));di&30||Gy(n,t,o)}return o}function Gy(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=it.updateQueue,t===null?(t={lastEffect:null,stores:null},it.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ky(e,t,n,r){t.value=n,t.getSnapshot=r,Xy(t)&&Yy(e)}function qy(e,t,n){return n(function(){Xy(t)&&Yy(e)})}function Xy(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch{return!0}}function Yy(e){var t=jr(e,1);t!==null&&nr(t,e,1,-1)}function Nm(e){var t=dr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:e},t.queue=e,e=e.dispatch=QE.bind(null,it,e),[t.memoizedState,e]}function Is(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=it.updateQueue,t===null?(t={lastEffect:null,stores:null},it.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Qy(){return Un().memoizedState}function nl(e,t,n,r){var o=dr();it.flags|=e,o.memoizedState=Is(1|t,n,void 0,r===void 0?null:r)}function pc(e,t,n,r){var o=Un();r=r===void 0?null:r;var i=void 0;if(wt!==null){var a=wt.memoizedState;if(i=a.destroy,r!==null&&op(r,a.deps)){o.memoizedState=Is(t,n,i,r);return}}it.flags|=e,o.memoizedState=Is(1|t,n,i,r)}function Pm(e,t){return nl(8390656,8,e,t)}function sp(e,t){return pc(2048,8,e,t)}function Jy(e,t){return pc(4,2,e,t)}function Zy(e,t){return pc(4,4,e,t)}function e1(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function t1(e,t,n){return n=n!=null?n.concat([e]):null,pc(4,4,e1.bind(null,t,e),n)}function up(){}function n1(e,t){var n=Un();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&op(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function r1(e,t){var n=Un();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&op(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function o1(e,t,n){return di&21?(or(n,t)||(n=ly(),it.lanes|=n,hi|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,sn=!0),e.memoizedState=n)}function XE(e,t){var n=Ve;Ve=n!==0&&4>n?n:4,e(!0);var r=mf.transition;mf.transition={};try{e(!1),t()}finally{Ve=n,mf.transition=r}}function i1(){return Un().memoizedState}function YE(e,t,n){var r=So(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},a1(e))s1(t,n);else if(n=zy(e,t,n,r),n!==null){var o=en();nr(n,e,r,o),u1(n,t,r)}}function QE(e,t,n){var r=So(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(a1(e))s1(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,or(s,a)){var u=t.interleaved;u===null?(o.next=o,Zh(t)):(o.next=u.next,u.next=o),t.interleaved=o;return}}catch{}finally{}n=zy(e,t,o,r),n!==null&&(o=en(),nr(n,e,r,o),u1(n,t,r))}}function a1(e){var t=e.alternate;return e===it||t!==null&&t===it}function s1(e,t){is=kl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function u1(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Wh(e,n)}}var Rl={readContext:zn,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},JE={readContext:zn,useCallback:function(e,t){return dr().memoizedState=[e,t===void 0?null:t],e},useContext:zn,useEffect:Pm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,nl(4194308,4,e1.bind(null,t,e),n)},useLayoutEffect:function(e,t){return nl(4194308,4,e,t)},useInsertionEffect:function(e,t){return nl(4,2,e,t)},useMemo:function(e,t){var n=dr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=dr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=YE.bind(null,it,e),[r.memoizedState,e]},useRef:function(e){var t=dr();return e={current:e},t.memoizedState=e},useState:Nm,useDebugValue:up,useDeferredValue:function(e){return dr().memoizedState=e},useTransition:function(){var e=Nm(!1),t=e[0];return e=XE.bind(null,e[1]),dr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=it,o=dr();if(et){if(n===void 0)throw Error(Z(407));n=n()}else{if(n=t(),Nt===null)throw Error(Z(349));di&30||Gy(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Pm(qy.bind(null,r,i,e),[e]),r.flags|=2048,Is(9,Ky.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=dr(),t=Nt.identifierPrefix;if(et){var n=Br,r=Lr;n=(r&~(1<<32-tr(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=ks++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=qE++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ZE={readContext:zn,useCallback:n1,useContext:zn,useEffect:sp,useImperativeHandle:t1,useInsertionEffect:Jy,useLayoutEffect:Zy,useMemo:r1,useReducer:gf,useRef:Qy,useState:function(){return gf(Rs)},useDebugValue:up,useDeferredValue:function(e){var t=Un();return o1(t,wt.memoizedState,e)},useTransition:function(){var e=gf(Rs)[0],t=Un().memoizedState;return[e,t]},useMutableSource:Vy,useSyncExternalStore:Hy,useId:i1,unstable_isNewReconciler:!1},eC={readContext:zn,useCallback:n1,useContext:zn,useEffect:sp,useImperativeHandle:t1,useInsertionEffect:Jy,useLayoutEffect:Zy,useMemo:r1,useReducer:yf,useRef:Qy,useState:function(){return yf(Rs)},useDebugValue:up,useDeferredValue:function(e){var t=Un();return wt===null?t.memoizedState=e:o1(t,wt.memoizedState,e)},useTransition:function(){var e=yf(Rs)[0],t=Un().memoizedState;return[e,t]},useMutableSource:Vy,useSyncExternalStore:Hy,useId:i1,unstable_isNewReconciler:!1};function Xn(e,t){if(e&&e.defaultProps){t=at({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Ad(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:at({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var vc={isMounted:function(e){return(e=e._reactInternals)?xi(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=en(),o=So(e),i=Wr(r,o);i.payload=t,n!=null&&(i.callback=n),t=Co(e,i,o),t!==null&&(nr(t,e,o,r),el(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=en(),o=So(e),i=Wr(r,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=Co(e,i,o),t!==null&&(nr(t,e,o,r),el(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=en(),r=So(e),o=Wr(n,r);o.tag=2,t!=null&&(o.callback=t),t=Co(e,o,r),t!==null&&(nr(t,e,r,n),el(t,e,r))}};function Am(e,t,n,r,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,a):t.prototype&&t.prototype.isPureReactComponent?!ws(n,r)||!ws(o,i):!0}function l1(e,t,n){var r=!1,o=No,i=t.contextType;return typeof i=="object"&&i!==null?i=zn(i):(o=ln(t)?ci:Xt.current,r=t.contextTypes,i=(r=r!=null)?la(e,o):No),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=vc,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Fm(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&vc.enqueueReplaceState(t,t.state,null)}function Fd(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},ep(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=zn(i):(i=ln(t)?ci:Xt.current,o.context=la(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Ad(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&vc.enqueueReplaceState(o,o.state,null),_l(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function ha(e,t){try{var n="",r=t;do n+=I2(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function xf(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Md(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var tC=typeof WeakMap=="function"?WeakMap:Map;function c1(e,t,n){n=Wr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Tl||(Tl=!0,Hd=r),Md(e,t)},n}function f1(e,t,n){n=Wr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){Md(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Md(e,t),typeof r!="function"&&(_o===null?_o=new Set([this]):_o.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function Mm(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new tC;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=vC.bind(null,e,t,n),t.then(e,e))}function Om(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Lm(e,t,n,r,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Wr(-1,1),t.tag=2,Co(n,t,1))),n.lanes|=1),e)}var nC=Kr.ReactCurrentOwner,sn=!1;function Jt(e,t,n,r){t.child=e===null?$y(t,null,n,r):fa(t,e.child,n,r)}function Bm(e,t,n,r,o){n=n.render;var i=t.ref;return Zi(t,o),r=ip(e,t,n,r,i,o),n=ap(),e!==null&&!sn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vr(e,t,o)):(et&&n&&Kh(t),t.flags|=1,Jt(e,t,r,o),t.child)}function Wm(e,t,n,r,o){if(e===null){var i=n.type;return typeof i=="function"&&!mp(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,d1(e,t,i,r,o)):(e=al(n.type,null,r,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ws,n(a,r)&&e.ref===t.ref)return Vr(e,t,o)}return t.flags|=1,e=ko(i,r),e.ref=t.ref,e.return=t,t.child=e}function d1(e,t,n,r,o){if(e!==null){var i=e.memoizedProps;if(ws(i,r)&&e.ref===t.ref)if(sn=!1,t.pendingProps=r=i,(e.lanes&o)!==0)e.flags&131072&&(sn=!0);else return t.lanes=e.lanes,Vr(e,t,o)}return Od(e,t,n,r,o)}function h1(e,t,n){var r=t.pendingProps,o=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},qe(Ki,mn),mn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,qe(Ki,mn),mn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,qe(Ki,mn),mn|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,qe(Ki,mn),mn|=r;return Jt(e,t,o,n),t.child}function p1(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Od(e,t,n,r,o){var i=ln(n)?ci:Xt.current;return i=la(t,i),Zi(t,o),n=ip(e,t,n,r,i,o),r=ap(),e!==null&&!sn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vr(e,t,o)):(et&&r&&Kh(t),t.flags|=1,Jt(e,t,n,o),t.child)}function $m(e,t,n,r,o){if(ln(n)){var i=!0;xl(t)}else i=!1;if(Zi(t,o),t.stateNode===null)rl(e,t),l1(t,n,r),Fd(t,n,r,o),r=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,l=n.contextType;typeof l=="object"&&l!==null?l=zn(l):(l=ln(n)?ci:Xt.current,l=la(t,l));var c=n.getDerivedStateFromProps,f=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&Fm(t,a,r,l),lo=!1;var d=t.memoizedState;a.state=d,_l(t,r,a,o),u=t.memoizedState,s!==r||d!==u||un.current||lo?(typeof c=="function"&&(Ad(t,n,c,r),u=t.memoizedState),(s=lo||Am(t,n,s,r,d,u,l))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Uy(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Xn(t.type,s),a.props=l,f=t.pendingProps,d=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=zn(u):(u=ln(n)?ci:Xt.current,u=la(t,u));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==f||d!==u)&&Fm(t,a,r,u),lo=!1,d=t.memoizedState,a.state=d,_l(t,r,a,o);var p=t.memoizedState;s!==f||d!==p||un.current||lo?(typeof h=="function"&&(Ad(t,n,h,r),p=t.memoizedState),(l=lo||Am(t,n,l,r,d,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,u)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ld(e,t,n,r,i,o)}function Ld(e,t,n,r,o,i){p1(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return o&&Sm(t,n,!1),Vr(e,t,i);r=t.stateNode,nC.current=t;var s=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=fa(t,e.child,null,i),t.child=fa(t,null,s,i)):Jt(e,t,s,i),t.memoizedState=r.state,o&&Sm(t,n,!0),t.child}function v1(e){var t=e.stateNode;t.pendingContext?_m(e,t.pendingContext,t.pendingContext!==t.context):t.context&&_m(e,t.context,!1),tp(e,t.containerInfo)}function zm(e,t,n,r,o){return ca(),Xh(o),t.flags|=256,Jt(e,t,n,r),t.child}var Bd={dehydrated:null,treeContext:null,retryLane:0};function Wd(e){return{baseLanes:e,cachePool:null,transitions:null}}function m1(e,t,n){var r=t.pendingProps,o=nt.current,i=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),qe(nt,o&1),e===null)return Nd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,i?(r=t.mode,i=t.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=yc(a,r,0,null),e=si(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Wd(n),t.memoizedState=Bd,e):lp(t,a));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return rC(e,t,a,r,s,o,n);if(i){i=r.fallback,a=t.mode,o=e.child,s=o.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=ko(o,u),r.subtreeFlags=o.subtreeFlags&14680064),s!==null?i=ko(s,i):(i=si(i,a,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,a=e.child.memoizedState,a=a===null?Wd(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=Bd,r}return i=e.child,e=i.sibling,r=ko(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function lp(e,t){return t=yc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Du(e,t,n,r){return r!==null&&Xh(r),fa(t,e.child,null,n),e=lp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function rC(e,t,n,r,o,i,a){if(n)return t.flags&256?(t.flags&=-257,r=xf(Error(Z(422))),Du(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=yc({mode:"visible",children:r.children},o,0,null),i=si(i,o,a,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&fa(t,e.child,null,a),t.child.memoizedState=Wd(a),t.memoizedState=Bd,i);if(!(t.mode&1))return Du(e,t,a,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var s=r.dgst;return r=s,i=Error(Z(419)),r=xf(i,r,void 0),Du(e,t,a,r)}if(s=(a&e.childLanes)!==0,sn||s){if(r=Nt,r!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,jr(e,o),nr(r,e,o,-1))}return vp(),r=xf(Error(Z(421))),Du(e,t,a,r)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=mC.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,wn=Eo(o.nextSibling),_n=t,et=!0,Jn=null,e!==null&&(An[Fn++]=Lr,An[Fn++]=Br,An[Fn++]=fi,Lr=e.id,Br=e.overflow,fi=t),t=lp(t,r.children),t.flags|=4096,t)}function Um(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Pd(e.return,t,n)}function wf(e,t,n,r,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function g1(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(Jt(e,t,r.children,n),r=nt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Um(e,n,t);else if(e.tag===19)Um(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(qe(nt,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&Sl(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),wf(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Sl(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}wf(t,!0,n,null,i);break;case"together":wf(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function rl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),hi|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Z(153));if(t.child!==null){for(e=t.child,n=ko(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ko(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function oC(e,t,n){switch(t.tag){case 3:v1(t),ca();break;case 5:jy(t);break;case 1:ln(t.type)&&xl(t);break;case 4:tp(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;qe(El,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(qe(nt,nt.current&1),t.flags|=128,null):n&t.child.childLanes?m1(e,t,n):(qe(nt,nt.current&1),e=Vr(e,t,n),e!==null?e.sibling:null);qe(nt,nt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return g1(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),qe(nt,nt.current),r)break;return null;case 22:case 23:return t.lanes=0,h1(e,t,n)}return Vr(e,t,n)}var y1,$d,x1,w1;y1=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$d=function(){};x1=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,ti(wr.current);var i=null;switch(n){case"input":o=ud(e,o),r=ud(e,r),i=[];break;case"select":o=at({},o,{value:void 0}),r=at({},r,{value:void 0}),i=[];break;case"textarea":o=fd(e,o),r=fd(e,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=gl)}hd(n,r);var a;n=null;for(l in o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&o[l]!=null)if(l==="style"){var s=o[l];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(hs.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in r){var u=r[l];if(s=o!=null?o[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(hs.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Qe("scroll",e),i||s===u||(i=[])):(i=i||[]).push(l,u))}n&&(i=i||[]).push("style",n);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};w1=function(e,t,n,r){n!==r&&(t.flags|=4)};function Ba(e,t){if(!et)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ut(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function iC(e,t,n){var r=t.pendingProps;switch(qh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(t),null;case 1:return ln(t.type)&&yl(),Ut(t),null;case 3:return r=t.stateNode,da(),Ze(un),Ze(Xt),rp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Iu(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Jn!==null&&(qd(Jn),Jn=null))),$d(e,t),Ut(t),null;case 5:np(t);var o=ti(Ss.current);if(n=t.type,e!==null&&t.stateNode!=null)x1(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Z(166));return Ut(t),null}if(e=ti(wr.current),Iu(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[vr]=t,r[Cs]=i,e=(t.mode&1)!==0,n){case"dialog":Qe("cancel",r),Qe("close",r);break;case"iframe":case"object":case"embed":Qe("load",r);break;case"video":case"audio":for(o=0;o<Ya.length;o++)Qe(Ya[o],r);break;case"source":Qe("error",r);break;case"img":case"image":case"link":Qe("error",r),Qe("load",r);break;case"details":Qe("toggle",r);break;case"input":Qv(r,i),Qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Qe("invalid",r);break;case"textarea":Zv(r,i),Qe("invalid",r)}hd(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];a==="children"?typeof s=="string"?r.textContent!==s&&(i.suppressHydrationWarning!==!0&&Ru(r.textContent,s,e),o=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&Ru(r.textContent,s,e),o=["children",""+s]):hs.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Qe("scroll",r)}switch(n){case"input":xu(r),Jv(r,i,!0);break;case"textarea":xu(r),em(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=gl)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=q0(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(n,{is:r.is}):(e=a.createElement(n),n==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,n),e[vr]=t,e[Cs]=r,y1(e,t,!1,!1),t.stateNode=e;e:{switch(a=pd(n,r),n){case"dialog":Qe("cancel",e),Qe("close",e),o=r;break;case"iframe":case"object":case"embed":Qe("load",e),o=r;break;case"video":case"audio":for(o=0;o<Ya.length;o++)Qe(Ya[o],e);o=r;break;case"source":Qe("error",e),o=r;break;case"img":case"image":case"link":Qe("error",e),Qe("load",e),o=r;break;case"details":Qe("toggle",e),o=r;break;case"input":Qv(e,r),o=ud(e,r),Qe("invalid",e);break;case"option":o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=at({},r,{value:void 0}),Qe("invalid",e);break;case"textarea":Zv(e,r),o=fd(e,r),Qe("invalid",e);break;default:o=r}hd(n,o),s=o;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?Q0(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&X0(e,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&ps(e,u):typeof u=="number"&&ps(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(hs.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Qe("scroll",e):u!=null&&Ah(e,i,u,a))}switch(n){case"input":xu(e),Jv(e,r,!1);break;case"textarea":xu(e),em(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Do(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Xi(e,!!r.multiple,i,!1):r.defaultValue!=null&&Xi(e,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=gl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ut(t),null;case 6:if(e&&t.stateNode!=null)w1(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Z(166));if(n=ti(Ss.current),ti(wr.current),Iu(t)){if(r=t.stateNode,n=t.memoizedProps,r[vr]=t,(i=r.nodeValue!==n)&&(e=_n,e!==null))switch(e.tag){case 3:Ru(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ru(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[vr]=t,t.stateNode=r}return Ut(t),null;case 13:if(Ze(nt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(et&&wn!==null&&t.mode&1&&!(t.flags&128))By(),ca(),t.flags|=98560,i=!1;else if(i=Iu(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(Z(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Z(317));i[vr]=t}else ca(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ut(t),i=!1}else Jn!==null&&(qd(Jn),Jn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||nt.current&1?bt===0&&(bt=3):vp())),t.updateQueue!==null&&(t.flags|=4),Ut(t),null);case 4:return da(),$d(e,t),e===null&&bs(t.stateNode.containerInfo),Ut(t),null;case 10:return Jh(t.type._context),Ut(t),null;case 17:return ln(t.type)&&yl(),Ut(t),null;case 19:if(Ze(nt),i=t.memoizedState,i===null)return Ut(t),null;if(r=(t.flags&128)!==0,a=i.rendering,a===null)if(r)Ba(i,!1);else{if(bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Sl(e),a!==null){for(t.flags|=128,Ba(i,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return qe(nt,nt.current&1|2),t.child}e=e.sibling}i.tail!==null&&dt()>pa&&(t.flags|=128,r=!0,Ba(i,!1),t.lanes=4194304)}else{if(!r)if(e=Sl(a),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ba(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!et)return Ut(t),null}else 2*dt()-i.renderingStartTime>pa&&n!==1073741824&&(t.flags|=128,r=!0,Ba(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=dt(),t.sibling=null,n=nt.current,qe(nt,r?n&1|2:n&1),t):(Ut(t),null);case 22:case 23:return pp(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?mn&1073741824&&(Ut(t),t.subtreeFlags&6&&(t.flags|=8192)):Ut(t),null;case 24:return null;case 25:return null}throw Error(Z(156,t.tag))}function aC(e,t){switch(qh(t),t.tag){case 1:return ln(t.type)&&yl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return da(),Ze(un),Ze(Xt),rp(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return np(t),null;case 13:if(Ze(nt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Z(340));ca()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ze(nt),null;case 4:return da(),null;case 10:return Jh(t.type._context),null;case 22:case 23:return pp(),null;case 24:return null;default:return null}}var Nu=!1,Vt=!1,sC=typeof WeakSet=="function"?WeakSet:Set,ae=null;function Gi(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ft(e,t,r)}else n.current=null}function zd(e,t,n){try{n()}catch(r){ft(e,t,r)}}var jm=!1;function uC(e,t){if(_d=pl,e=Sy(),Gh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,s=-1,u=-1,l=0,c=0,f=e,d=null;t:for(;;){for(var h;f!==n||o!==0&&f.nodeType!==3||(s=a+o),f!==i||r!==0&&f.nodeType!==3||(u=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(h=f.firstChild)!==null;)d=f,f=h;for(;;){if(f===e)break t;if(d===n&&++l===o&&(s=a),d===i&&++c===r&&(u=a),(h=f.nextSibling)!==null)break;f=d,d=f.parentNode}f=h}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Sd={focusedElem:e,selectionRange:n},pl=!1,ae=t;ae!==null;)if(t=ae,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ae=e;else for(;ae!==null;){t=ae;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:Xn(t.type,m),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(w){ft(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,ae=e;break}ae=t.return}return p=jm,jm=!1,p}function as(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&zd(t,n,i)}o=o.next}while(o!==r)}}function mc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Ud(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function b1(e){var t=e.alternate;t!==null&&(e.alternate=null,b1(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[vr],delete t[Cs],delete t[Id],delete t[VE],delete t[HE])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function E1(e){return e.tag===5||e.tag===3||e.tag===4}function Vm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||E1(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function jd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=gl));else if(r!==4&&(e=e.child,e!==null))for(jd(e,t,n),e=e.sibling;e!==null;)jd(e,t,n),e=e.sibling}function Vd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Vd(e,t,n),e=e.sibling;e!==null;)Vd(e,t,n),e=e.sibling}var Ft=null,Yn=!1;function oo(e,t,n){for(n=n.child;n!==null;)C1(e,t,n),n=n.sibling}function C1(e,t,n){if(xr&&typeof xr.onCommitFiberUnmount=="function")try{xr.onCommitFiberUnmount(uc,n)}catch{}switch(n.tag){case 5:Vt||Gi(n,t);case 6:var r=Ft,o=Yn;Ft=null,oo(e,t,n),Ft=r,Yn=o,Ft!==null&&(Yn?(e=Ft,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Ft.removeChild(n.stateNode));break;case 18:Ft!==null&&(Yn?(e=Ft,n=n.stateNode,e.nodeType===8?hf(e.parentNode,n):e.nodeType===1&&hf(e,n),ys(e)):hf(Ft,n.stateNode));break;case 4:r=Ft,o=Yn,Ft=n.stateNode.containerInfo,Yn=!0,oo(e,t,n),Ft=r,Yn=o;break;case 0:case 11:case 14:case 15:if(!Vt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&zd(n,t,a),o=o.next}while(o!==r)}oo(e,t,n);break;case 1:if(!Vt&&(Gi(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){ft(n,t,s)}oo(e,t,n);break;case 21:oo(e,t,n);break;case 22:n.mode&1?(Vt=(r=Vt)||n.memoizedState!==null,oo(e,t,n),Vt=r):oo(e,t,n);break;default:oo(e,t,n)}}function Hm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new sC),t.forEach(function(r){var o=gC.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}function qn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:Ft=s.stateNode,Yn=!1;break e;case 3:Ft=s.stateNode.containerInfo,Yn=!0;break e;case 4:Ft=s.stateNode.containerInfo,Yn=!0;break e}s=s.return}if(Ft===null)throw Error(Z(160));C1(i,a,o),Ft=null,Yn=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(l){ft(o,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)_1(t,e),t=t.sibling}function _1(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(qn(t,e),cr(e),r&4){try{as(3,e,e.return),mc(3,e)}catch(m){ft(e,e.return,m)}try{as(5,e,e.return)}catch(m){ft(e,e.return,m)}}break;case 1:qn(t,e),cr(e),r&512&&n!==null&&Gi(n,n.return);break;case 5:if(qn(t,e),cr(e),r&512&&n!==null&&Gi(n,n.return),e.flags&32){var o=e.stateNode;try{ps(o,"")}catch(m){ft(e,e.return,m)}}if(r&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&G0(o,i),pd(s,a);var l=pd(s,i);for(a=0;a<u.length;a+=2){var c=u[a],f=u[a+1];c==="style"?Q0(o,f):c==="dangerouslySetInnerHTML"?X0(o,f):c==="children"?ps(o,f):Ah(o,c,f,l)}switch(s){case"input":ld(o,i);break;case"textarea":K0(o,i);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?Xi(o,!!i.multiple,h,!1):d!==!!i.multiple&&(i.defaultValue!=null?Xi(o,!!i.multiple,i.defaultValue,!0):Xi(o,!!i.multiple,i.multiple?[]:"",!1))}o[Cs]=i}catch(m){ft(e,e.return,m)}}break;case 6:if(qn(t,e),cr(e),r&4){if(e.stateNode===null)throw Error(Z(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(m){ft(e,e.return,m)}}break;case 3:if(qn(t,e),cr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ys(t.containerInfo)}catch(m){ft(e,e.return,m)}break;case 4:qn(t,e),cr(e);break;case 13:qn(t,e),cr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(dp=dt())),r&4&&Hm(e);break;case 22:if(c=n!==null&&n.memoizedState!==null,e.mode&1?(Vt=(l=Vt)||c,qn(t,e),Vt=l):qn(t,e),cr(e),r&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(ae=e,c=e.child;c!==null;){for(f=ae=c;ae!==null;){switch(d=ae,h=d.child,d.tag){case 0:case 11:case 14:case 15:as(4,d,d.return);break;case 1:Gi(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){r=d,n=d.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){ft(r,n,m)}}break;case 5:Gi(d,d.return);break;case 22:if(d.memoizedState!==null){Km(f);continue}}h!==null?(h.return=d,ae=h):Km(f)}c=c.sibling}e:for(c=null,f=e;;){if(f.tag===5){if(c===null){c=f;try{o=f.stateNode,l?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=f.stateNode,u=f.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=Y0("display",a))}catch(m){ft(e,e.return,m)}}}else if(f.tag===6){if(c===null)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(m){ft(e,e.return,m)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;c===f&&(c=null),f=f.return}c===f&&(c=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:qn(t,e),cr(e),r&4&&Hm(e);break;case 21:break;default:qn(t,e),cr(e)}}function cr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(E1(n)){var r=n;break e}n=n.return}throw Error(Z(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(ps(o,""),r.flags&=-33);var i=Vm(e);Vd(e,i,o);break;case 3:case 4:var a=r.stateNode.containerInfo,s=Vm(e);jd(e,s,a);break;default:throw Error(Z(161))}}catch(u){ft(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function lC(e,t,n){ae=e,S1(e)}function S1(e,t,n){for(var r=(e.mode&1)!==0;ae!==null;){var o=ae,i=o.child;if(o.tag===22&&r){var a=o.memoizedState!==null||Nu;if(!a){var s=o.alternate,u=s!==null&&s.memoizedState!==null||Vt;s=Nu;var l=Vt;if(Nu=a,(Vt=u)&&!l)for(ae=o;ae!==null;)a=ae,u=a.child,a.tag===22&&a.memoizedState!==null?qm(o):u!==null?(u.return=a,ae=u):qm(o);for(;i!==null;)ae=i,S1(i),i=i.sibling;ae=o,Nu=s,Vt=l}Gm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,ae=i):Gm(e)}}function Gm(e){for(;ae!==null;){var t=ae;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Vt||mc(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Vt)if(n===null)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:Xn(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Dm(t,i,r);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Dm(t,a,n)}break;case 5:var s=t.stateNode;if(n===null&&t.flags&4){n=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var f=c.dehydrated;f!==null&&ys(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}Vt||t.flags&512&&Ud(t)}catch(d){ft(t,t.return,d)}}if(t===e){ae=null;break}if(n=t.sibling,n!==null){n.return=t.return,ae=n;break}ae=t.return}}function Km(e){for(;ae!==null;){var t=ae;if(t===e){ae=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ae=n;break}ae=t.return}}function qm(e){for(;ae!==null;){var t=ae;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{mc(4,t)}catch(u){ft(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(u){ft(t,o,u)}}var i=t.return;try{Ud(t)}catch(u){ft(t,i,u)}break;case 5:var a=t.return;try{Ud(t)}catch(u){ft(t,a,u)}}}catch(u){ft(t,t.return,u)}if(t===e){ae=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ae=s;break}ae=t.return}}var cC=Math.ceil,Il=Kr.ReactCurrentDispatcher,cp=Kr.ReactCurrentOwner,$n=Kr.ReactCurrentBatchConfig,Le=0,Nt=null,gt=null,Bt=0,mn=0,Ki=Fo(0),bt=0,Ts=null,hi=0,gc=0,fp=0,ss=null,rn=null,dp=0,pa=1/0,Fr=null,Tl=!1,Hd=null,_o=null,Pu=!1,po=null,Dl=0,us=0,Gd=null,ol=-1,il=0;function en(){return Le&6?dt():ol!==-1?ol:ol=dt()}function So(e){return e.mode&1?Le&2&&Bt!==0?Bt&-Bt:KE.transition!==null?(il===0&&(il=ly()),il):(e=Ve,e!==0||(e=window.event,e=e===void 0?16:my(e.type)),e):1}function nr(e,t,n,r){if(50<us)throw us=0,Gd=null,Error(Z(185));js(e,n,r),(!(Le&2)||e!==Nt)&&(e===Nt&&(!(Le&2)&&(gc|=n),bt===4&&fo(e,Bt)),cn(e,r),n===1&&Le===0&&!(t.mode&1)&&(pa=dt()+500,hc&&Mo()))}function cn(e,t){var n=e.callbackNode;K2(e,t);var r=hl(e,e===Nt?Bt:0);if(r===0)n!==null&&rm(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&rm(n),t===1)e.tag===0?GE(Xm.bind(null,e)):My(Xm.bind(null,e)),UE(function(){!(Le&6)&&Mo()}),n=null;else{switch(cy(r)){case 1:n=Bh;break;case 4:n=sy;break;case 16:n=dl;break;case 536870912:n=uy;break;default:n=dl}n=A1(n,k1.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function k1(e,t){if(ol=-1,il=0,Le&6)throw Error(Z(327));var n=e.callbackNode;if(ea()&&e.callbackNode!==n)return null;var r=hl(e,e===Nt?Bt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Nl(e,r);else{t=r;var o=Le;Le|=2;var i=I1();(Nt!==e||Bt!==t)&&(Fr=null,pa=dt()+500,ai(e,t));do try{hC();break}catch(s){R1(e,s)}while(!0);Qh(),Il.current=i,Le=o,gt!==null?t=0:(Nt=null,Bt=0,t=bt)}if(t!==0){if(t===2&&(o=xd(e),o!==0&&(r=o,t=Kd(e,o))),t===1)throw n=Ts,ai(e,0),fo(e,r),cn(e,dt()),n;if(t===6)fo(e,r);else{if(o=e.current.alternate,!(r&30)&&!fC(o)&&(t=Nl(e,r),t===2&&(i=xd(e),i!==0&&(r=i,t=Kd(e,i))),t===1))throw n=Ts,ai(e,0),fo(e,r),cn(e,dt()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(Z(345));case 2:Ho(e,rn,Fr);break;case 3:if(fo(e,r),(r&130023424)===r&&(t=dp+500-dt(),10<t)){if(hl(e,0)!==0)break;if(o=e.suspendedLanes,(o&r)!==r){en(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Rd(Ho.bind(null,e,rn,Fr),t);break}Ho(e,rn,Fr);break;case 4:if(fo(e,r),(r&4194240)===r)break;for(t=e.eventTimes,o=-1;0<r;){var a=31-tr(r);i=1<<a,a=t[a],a>o&&(o=a),r&=~i}if(r=o,r=dt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*cC(r/1960))-r,10<r){e.timeoutHandle=Rd(Ho.bind(null,e,rn,Fr),r);break}Ho(e,rn,Fr);break;case 5:Ho(e,rn,Fr);break;default:throw Error(Z(329))}}}return cn(e,dt()),e.callbackNode===n?k1.bind(null,e):null}function Kd(e,t){var n=ss;return e.current.memoizedState.isDehydrated&&(ai(e,t).flags|=256),e=Nl(e,t),e!==2&&(t=rn,rn=n,t!==null&&qd(t)),e}function qd(e){rn===null?rn=e:rn.push.apply(rn,e)}function fC(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!or(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function fo(e,t){for(t&=~fp,t&=~gc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-tr(t),r=1<<n;e[n]=-1,t&=~r}}function Xm(e){if(Le&6)throw Error(Z(327));ea();var t=hl(e,0);if(!(t&1))return cn(e,dt()),null;var n=Nl(e,t);if(e.tag!==0&&n===2){var r=xd(e);r!==0&&(t=r,n=Kd(e,r))}if(n===1)throw n=Ts,ai(e,0),fo(e,t),cn(e,dt()),n;if(n===6)throw Error(Z(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ho(e,rn,Fr),cn(e,dt()),null}function hp(e,t){var n=Le;Le|=1;try{return e(t)}finally{Le=n,Le===0&&(pa=dt()+500,hc&&Mo())}}function pi(e){po!==null&&po.tag===0&&!(Le&6)&&ea();var t=Le;Le|=1;var n=$n.transition,r=Ve;try{if($n.transition=null,Ve=1,e)return e()}finally{Ve=r,$n.transition=n,Le=t,!(Le&6)&&Mo()}}function pp(){mn=Ki.current,Ze(Ki)}function ai(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,zE(n)),gt!==null)for(n=gt.return;n!==null;){var r=n;switch(qh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&yl();break;case 3:da(),Ze(un),Ze(Xt),rp();break;case 5:np(r);break;case 4:da();break;case 13:Ze(nt);break;case 19:Ze(nt);break;case 10:Jh(r.type._context);break;case 22:case 23:pp()}n=n.return}if(Nt=e,gt=e=ko(e.current,null),Bt=mn=t,bt=0,Ts=null,fp=gc=hi=0,rn=ss=null,ei!==null){for(t=0;t<ei.length;t++)if(n=ei[t],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,r.next=a}n.pending=r}ei=null}return e}function R1(e,t){do{var n=gt;try{if(Qh(),tl.current=Rl,kl){for(var r=it.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}kl=!1}if(di=0,Dt=wt=it=null,is=!1,ks=0,cp.current=null,n===null||n.return===null){bt=1,Ts=t,gt=null;break}e:{var i=e,a=n.return,s=n,u=t;if(t=Bt,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,f=c.tag;if(!(c.mode&1)&&(f===0||f===11||f===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=Om(a);if(h!==null){h.flags&=-257,Lm(h,a,s,i,t),h.mode&1&&Mm(i,l,t),t=h,u=l;var p=t.updateQueue;if(p===null){var m=new Set;m.add(u),t.updateQueue=m}else p.add(u);break e}else{if(!(t&1)){Mm(i,l,t),vp();break e}u=Error(Z(426))}}else if(et&&s.mode&1){var g=Om(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Lm(g,a,s,i,t),Xh(ha(u,s));break e}}i=u=ha(u,s),bt!==4&&(bt=2),ss===null?ss=[i]:ss.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var v=c1(i,u,t);Tm(i,v);break e;case 1:s=u;var y=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(_o===null||!_o.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t;var w=f1(i,s,t);Tm(i,w);break e}}i=i.return}while(i!==null)}D1(n)}catch(b){t=b,gt===n&&n!==null&&(gt=n=n.return);continue}break}while(!0)}function I1(){var e=Il.current;return Il.current=Rl,e===null?Rl:e}function vp(){(bt===0||bt===3||bt===2)&&(bt=4),Nt===null||!(hi&268435455)&&!(gc&268435455)||fo(Nt,Bt)}function Nl(e,t){var n=Le;Le|=2;var r=I1();(Nt!==e||Bt!==t)&&(Fr=null,ai(e,t));do try{dC();break}catch(o){R1(e,o)}while(!0);if(Qh(),Le=n,Il.current=r,gt!==null)throw Error(Z(261));return Nt=null,Bt=0,bt}function dC(){for(;gt!==null;)T1(gt)}function hC(){for(;gt!==null&&!B2();)T1(gt)}function T1(e){var t=P1(e.alternate,e,mn);e.memoizedProps=e.pendingProps,t===null?D1(e):gt=t,cp.current=null}function D1(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=aC(n,t),n!==null){n.flags&=32767,gt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{bt=6,gt=null;return}}else if(n=iC(n,t,mn),n!==null){gt=n;return}if(t=t.sibling,t!==null){gt=t;return}gt=t=e}while(t!==null);bt===0&&(bt=5)}function Ho(e,t,n){var r=Ve,o=$n.transition;try{$n.transition=null,Ve=1,pC(e,t,n,r)}finally{$n.transition=o,Ve=r}return null}function pC(e,t,n,r){do ea();while(po!==null);if(Le&6)throw Error(Z(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Z(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(q2(e,i),e===Nt&&(gt=Nt=null,Bt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Pu||(Pu=!0,A1(dl,function(){return ea(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=$n.transition,$n.transition=null;var a=Ve;Ve=1;var s=Le;Le|=4,cp.current=null,uC(e,n),_1(n,e),FE(Sd),pl=!!_d,Sd=_d=null,e.current=n,lC(n),W2(),Le=s,Ve=a,$n.transition=i}else e.current=n;if(Pu&&(Pu=!1,po=e,Dl=o),i=e.pendingLanes,i===0&&(_o=null),U2(n.stateNode),cn(e,dt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Tl)throw Tl=!1,e=Hd,Hd=null,e;return Dl&1&&e.tag!==0&&ea(),i=e.pendingLanes,i&1?e===Gd?us++:(us=0,Gd=e):us=0,Mo(),null}function ea(){if(po!==null){var e=cy(Dl),t=$n.transition,n=Ve;try{if($n.transition=null,Ve=16>e?16:e,po===null)var r=!1;else{if(e=po,po=null,Dl=0,Le&6)throw Error(Z(331));var o=Le;for(Le|=4,ae=e.current;ae!==null;){var i=ae,a=i.child;if(ae.flags&16){var s=i.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(ae=l;ae!==null;){var c=ae;switch(c.tag){case 0:case 11:case 15:as(8,c,i)}var f=c.child;if(f!==null)f.return=c,ae=f;else for(;ae!==null;){c=ae;var d=c.sibling,h=c.return;if(b1(c),c===l){ae=null;break}if(d!==null){d.return=h,ae=d;break}ae=h}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}ae=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ae=a;else e:for(;ae!==null;){if(i=ae,i.flags&2048)switch(i.tag){case 0:case 11:case 15:as(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,ae=v;break e}ae=i.return}}var y=e.current;for(ae=y;ae!==null;){a=ae;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,ae=x;else e:for(a=y;ae!==null;){if(s=ae,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:mc(9,s)}}catch(b){ft(s,s.return,b)}if(s===a){ae=null;break e}var w=s.sibling;if(w!==null){w.return=s.return,ae=w;break e}ae=s.return}}if(Le=o,Mo(),xr&&typeof xr.onPostCommitFiberRoot=="function")try{xr.onPostCommitFiberRoot(uc,e)}catch{}r=!0}return r}finally{Ve=n,$n.transition=t}}return!1}function Ym(e,t,n){t=ha(n,t),t=c1(e,t,1),e=Co(e,t,1),t=en(),e!==null&&(js(e,1,t),cn(e,t))}function ft(e,t,n){if(e.tag===3)Ym(e,e,n);else for(;t!==null;){if(t.tag===3){Ym(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(_o===null||!_o.has(r))){e=ha(n,e),e=f1(t,e,1),t=Co(t,e,1),e=en(),t!==null&&(js(t,1,e),cn(t,e));break}}t=t.return}}function vC(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=en(),e.pingedLanes|=e.suspendedLanes&n,Nt===e&&(Bt&n)===n&&(bt===4||bt===3&&(Bt&130023424)===Bt&&500>dt()-dp?ai(e,0):fp|=n),cn(e,t)}function N1(e,t){t===0&&(e.mode&1?(t=Eu,Eu<<=1,!(Eu&130023424)&&(Eu=4194304)):t=1);var n=en();e=jr(e,t),e!==null&&(js(e,t,n),cn(e,n))}function mC(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),N1(e,n)}function gC(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(t),N1(e,n)}var P1;P1=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||un.current)sn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return sn=!1,oC(e,t,n);sn=!!(e.flags&131072)}else sn=!1,et&&t.flags&1048576&&Oy(t,bl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;rl(e,t),e=t.pendingProps;var o=la(t,Xt.current);Zi(t,n),o=ip(null,t,r,e,o,n);var i=ap();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ln(r)?(i=!0,xl(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,ep(t),o.updater=vc,t.stateNode=o,o._reactInternals=t,Fd(t,r,e,n),t=Ld(null,t,r,!0,i,n)):(t.tag=0,et&&i&&Kh(t),Jt(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(rl(e,t),e=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=xC(r),e=Xn(r,e),o){case 0:t=Od(null,t,r,e,n);break e;case 1:t=$m(null,t,r,e,n);break e;case 11:t=Bm(null,t,r,e,n);break e;case 14:t=Wm(null,t,r,Xn(r.type,e),n);break e}throw Error(Z(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Xn(r,o),Od(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Xn(r,o),$m(e,t,r,o,n);case 3:e:{if(v1(t),e===null)throw Error(Z(387));r=t.pendingProps,i=t.memoizedState,o=i.element,Uy(e,t),_l(t,r,null,n);var a=t.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=ha(Error(Z(423)),t),t=zm(e,t,r,n,o);break e}else if(r!==o){o=ha(Error(Z(424)),t),t=zm(e,t,r,n,o);break e}else for(wn=Eo(t.stateNode.containerInfo.firstChild),_n=t,et=!0,Jn=null,n=$y(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ca(),r===o){t=Vr(e,t,n);break e}Jt(e,t,r,n)}t=t.child}return t;case 5:return jy(t),e===null&&Nd(t),r=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,kd(r,o)?a=null:i!==null&&kd(r,i)&&(t.flags|=32),p1(e,t),Jt(e,t,a,n),t.child;case 6:return e===null&&Nd(t),null;case 13:return m1(e,t,n);case 4:return tp(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=fa(t,null,r,n):Jt(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Xn(r,o),Bm(e,t,r,o,n);case 7:return Jt(e,t,t.pendingProps,n),t.child;case 8:return Jt(e,t,t.pendingProps.children,n),t.child;case 12:return Jt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,qe(El,r._currentValue),r._currentValue=a,i!==null)if(or(i.value,a)){if(i.children===o.children&&!un.current){t=Vr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){a=i.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=Wr(-1,n&-n),u.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),Pd(i.return,n,t),s.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Z(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),Pd(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Jt(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Zi(t,n),o=zn(o),r=r(o),t.flags|=1,Jt(e,t,r,n),t.child;case 14:return r=t.type,o=Xn(r,t.pendingProps),o=Xn(r.type,o),Wm(e,t,r,o,n);case 15:return d1(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Xn(r,o),rl(e,t),t.tag=1,ln(r)?(e=!0,xl(t)):e=!1,Zi(t,n),l1(t,r,o),Fd(t,r,o,n),Ld(null,t,r,!0,e,n);case 19:return g1(e,t,n);case 22:return h1(e,t,n)}throw Error(Z(156,t.tag))};function A1(e,t){return ay(e,t)}function yC(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bn(e,t,n,r){return new yC(e,t,n,r)}function mp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function xC(e){if(typeof e=="function")return mp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Mh)return 11;if(e===Oh)return 14}return 2}function ko(e,t){var n=e.alternate;return n===null?(n=Bn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function al(e,t,n,r,o,i){var a=2;if(r=e,typeof e=="function")mp(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Li:return si(n.children,o,i,t);case Fh:a=8,o|=8;break;case od:return e=Bn(12,n,t,o|2),e.elementType=od,e.lanes=i,e;case id:return e=Bn(13,n,t,o),e.elementType=id,e.lanes=i,e;case ad:return e=Bn(19,n,t,o),e.elementType=ad,e.lanes=i,e;case j0:return yc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case z0:a=10;break e;case U0:a=9;break e;case Mh:a=11;break e;case Oh:a=14;break e;case uo:a=16,r=null;break e}throw Error(Z(130,e==null?e:typeof e,""))}return t=Bn(a,n,t,o),t.elementType=e,t.type=r,t.lanes=i,t}function si(e,t,n,r){return e=Bn(7,e,r,t),e.lanes=n,e}function yc(e,t,n,r){return e=Bn(22,e,r,t),e.elementType=j0,e.lanes=n,e.stateNode={isHidden:!1},e}function bf(e,t,n){return e=Bn(6,e,null,t),e.lanes=n,e}function Ef(e,t,n){return t=Bn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function wC(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tf(0),this.expirationTimes=tf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tf(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function gp(e,t,n,r,o,i,a,s,u){return e=new wC(e,t,n,s,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Bn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ep(i),e}function bC(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oi,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function F1(e){if(!e)return No;e=e._reactInternals;e:{if(xi(e)!==e||e.tag!==1)throw Error(Z(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ln(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Z(171))}if(e.tag===1){var n=e.type;if(ln(n))return Fy(e,n,t)}return t}function M1(e,t,n,r,o,i,a,s,u){return e=gp(n,r,!0,e,o,i,a,s,u),e.context=F1(null),n=e.current,r=en(),o=So(n),i=Wr(r,o),i.callback=t??null,Co(n,i,o),e.current.lanes=o,js(e,o,r),cn(e,r),e}function xc(e,t,n,r){var o=t.current,i=en(),a=So(o);return n=F1(n),t.context===null?t.context=n:t.pendingContext=n,t=Wr(i,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Co(o,t,a),e!==null&&(nr(e,o,a,i),el(e,o,a)),a}function Pl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Qm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function yp(e,t){Qm(e,t),(e=e.alternate)&&Qm(e,t)}function EC(){return null}var O1=typeof reportError=="function"?reportError:function(e){console.error(e)};function xp(e){this._internalRoot=e}wc.prototype.render=xp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Z(409));xc(e,t,null,null)};wc.prototype.unmount=xp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;pi(function(){xc(null,e,null,null)}),t[Ur]=null}};function wc(e){this._internalRoot=e}wc.prototype.unstable_scheduleHydration=function(e){if(e){var t=hy();e={blockedOn:null,target:e,priority:t};for(var n=0;n<co.length&&t!==0&&t<co[n].priority;n++);co.splice(n,0,e),n===0&&vy(e)}};function wp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function bc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Jm(){}function CC(e,t,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var l=Pl(a);i.call(l)}}var a=M1(t,r,e,0,null,!1,!1,"",Jm);return e._reactRootContainer=a,e[Ur]=a.current,bs(e.nodeType===8?e.parentNode:e),pi(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof r=="function"){var s=r;r=function(){var l=Pl(u);s.call(l)}}var u=gp(e,0,!1,null,null,!1,!1,"",Jm);return e._reactRootContainer=u,e[Ur]=u.current,bs(e.nodeType===8?e.parentNode:e),pi(function(){xc(t,u,n,r)}),u}function Ec(e,t,n,r,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var s=o;o=function(){var u=Pl(a);s.call(u)}}xc(t,a,e,o)}else a=CC(n,t,e,o,r);return Pl(a)}fy=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Xa(t.pendingLanes);n!==0&&(Wh(t,n|1),cn(t,dt()),!(Le&6)&&(pa=dt()+500,Mo()))}break;case 13:pi(function(){var r=jr(e,1);if(r!==null){var o=en();nr(r,e,1,o)}}),yp(e,1)}};$h=function(e){if(e.tag===13){var t=jr(e,134217728);if(t!==null){var n=en();nr(t,e,134217728,n)}yp(e,134217728)}};dy=function(e){if(e.tag===13){var t=So(e),n=jr(e,t);if(n!==null){var r=en();nr(n,e,t,r)}yp(e,t)}};hy=function(){return Ve};py=function(e,t){var n=Ve;try{return Ve=e,t()}finally{Ve=n}};md=function(e,t,n){switch(t){case"input":if(ld(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=dc(r);if(!o)throw Error(Z(90));H0(r),ld(r,o)}}}break;case"textarea":K0(e,n);break;case"select":t=n.value,t!=null&&Xi(e,!!n.multiple,t,!1)}};ey=hp;ty=pi;var _C={usingClientEntryPoint:!1,Events:[Hs,zi,dc,J0,Z0,hp]},Wa={findFiberByHostInstance:Zo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SC={bundleType:Wa.bundleType,version:Wa.version,rendererPackageName:Wa.rendererPackageName,rendererConfig:Wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Kr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=oy(e),e===null?null:e.stateNode},findFiberByHostInstance:Wa.findFiberByHostInstance||EC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Au.isDisabled&&Au.supportsFiber)try{uc=Au.inject(SC),xr=Au}catch{}}Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_C;Rn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!wp(t))throw Error(Z(200));return bC(e,t,null,n)};Rn.createRoot=function(e,t){if(!wp(e))throw Error(Z(299));var n=!1,r="",o=O1;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=gp(e,1,!1,null,null,n,!1,r,o),e[Ur]=t.current,bs(e.nodeType===8?e.parentNode:e),new xp(t)};Rn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Z(188)):(e=Object.keys(e).join(","),Error(Z(268,e)));return e=oy(t),e=e===null?null:e.stateNode,e};Rn.flushSync=function(e){return pi(e)};Rn.hydrate=function(e,t,n){if(!bc(t))throw Error(Z(200));return Ec(null,e,t,!0,n)};Rn.hydrateRoot=function(e,t,n){if(!wp(e))throw Error(Z(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",a=O1;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=M1(t,null,e,1,n??null,o,!1,i,a),e[Ur]=t.current,bs(e),r)for(e=0;e<r.length;e++)n=r[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new wc(t)};Rn.render=function(e,t,n){if(!bc(t))throw Error(Z(200));return Ec(null,e,t,!1,n)};Rn.unmountComponentAtNode=function(e){if(!bc(e))throw Error(Z(40));return e._reactRootContainer?(pi(function(){Ec(null,null,e,!1,function(){e._reactRootContainer=null,e[Ur]=null})}),!0):!1};Rn.unstable_batchedUpdates=hp;Rn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!bc(n))throw Error(Z(200));if(e==null||e._reactInternals===void 0)throw Error(Z(38));return Ec(e,t,n,!1,r)};Rn.version="18.3.1-next-f1338f8080-20240426";function L1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(L1)}catch(e){console.error(e)}}L1(),L0.exports=Rn;var Cc=L0.exports;const kC=S0(Cc),RC=_0({__proto__:null,default:kC},[Cc]);var B1,Zm=Cc;B1=Zm.createRoot,Zm.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tt(){return tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tt.apply(this,arguments)}var vt;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(vt||(vt={}));const eg="popstate";function IC(e){e===void 0&&(e={});function t(r,o){let{pathname:i,search:a,hash:s}=r.location;return Ds("",{pathname:i,search:a,hash:s},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:vi(o)}return DC(t,n,null,e)}function ke(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function va(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function TC(){return Math.random().toString(36).substr(2,8)}function tg(e,t){return{usr:e.state,key:e.key,idx:t}}function Ds(e,t,n,r){return n===void 0&&(n=null),tt({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Oo(t):t,{state:n,key:t&&t.key||r||TC()})}function vi(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Oo(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function DC(e,t,n,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:i=!1}=r,a=o.history,s=vt.Pop,u=null,l=c();l==null&&(l=0,a.replaceState(tt({},a.state,{idx:l}),""));function c(){return(a.state||{idx:null}).idx}function f(){s=vt.Pop;let g=c(),v=g==null?null:g-l;l=g,u&&u({action:s,location:m.location,delta:v})}function d(g,v){s=vt.Push;let y=Ds(m.location,g,v);l=c()+1;let x=tg(y,l),w=m.createHref(y);try{a.pushState(x,"",w)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;o.location.assign(w)}i&&u&&u({action:s,location:m.location,delta:1})}function h(g,v){s=vt.Replace;let y=Ds(m.location,g,v);l=c();let x=tg(y,l),w=m.createHref(y);a.replaceState(x,"",w),i&&u&&u({action:s,location:m.location,delta:0})}function p(g){let v=o.location.origin!=="null"?o.location.origin:o.location.href,y=typeof g=="string"?g:vi(g);return y=y.replace(/ $/,"%20"),ke(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let m={get action(){return s},get location(){return e(o,a)},listen(g){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(eg,f),u=g,()=>{o.removeEventListener(eg,f),u=null}},createHref(g){return t(o,g)},createURL:p,encodeLocation(g){let v=p(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:h,go(g){return a.go(g)}};return m}var He;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(He||(He={}));const NC=new Set(["lazy","caseSensitive","path","id","index","children"]);function PC(e){return e.index===!0}function Ns(e,t,n,r){return n===void 0&&(n=[]),r===void 0&&(r={}),e.map((o,i)=>{let a=[...n,String(i)],s=typeof o.id=="string"?o.id:a.join("-");if(ke(o.index!==!0||!o.children,"Cannot specify children on an index route"),ke(!r[s],'Found a route id collision on id "'+s+`".  Route id's must be globally unique within Data Router usages`),PC(o)){let u=tt({},o,t(o),{id:s});return r[s]=u,u}else{let u=tt({},o,t(o),{id:s,children:void 0});return r[s]=u,o.children&&(u.children=Ns(o.children,t,a,r)),u}})}function Qo(e,t,n){return n===void 0&&(n="/"),sl(e,t,n,!1)}function sl(e,t,n,r){let o=typeof t=="string"?Oo(t):t,i=Ca(o.pathname||"/",n);if(i==null)return null;let a=W1(e);FC(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let l=HC(i);s=jC(a[u],l,r)}return s}function AC(e,t){let{route:n,pathname:r,params:o}=e;return{id:n.id,pathname:r,params:o,data:t[n.id],handle:n.handle}}function W1(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let o=(i,a,s)=>{let u={relativePath:s===void 0?i.path||"":s,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(ke(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=$r([r,u.relativePath]),c=n.concat(u);i.children&&i.children.length>0&&(ke(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),W1(i.children,t,c,l)),!(i.path==null&&!i.index)&&t.push({path:l,score:zC(l,i.index),routesMeta:c})};return e.forEach((i,a)=>{var s;if(i.path===""||!((s=i.path)!=null&&s.includes("?")))o(i,a);else for(let u of $1(i.path))o(i,a,u)}),t}function $1(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return o?[i,""]:[i];let a=$1(r.join("/")),s=[];return s.push(...a.map(u=>u===""?i:[i,u].join("/"))),o&&s.push(...a),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function FC(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:UC(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const MC=/^:[\w-]+$/,OC=3,LC=2,BC=1,WC=10,$C=-2,ng=e=>e==="*";function zC(e,t){let n=e.split("/"),r=n.length;return n.some(ng)&&(r+=$C),t&&(r+=LC),n.filter(o=>!ng(o)).reduce((o,i)=>o+(MC.test(i)?OC:i===""?BC:WC),r)}function UC(e,t){return e.length===t.length&&e.slice(0,-1).every((r,o)=>r===t[o])?e[e.length-1]-t[t.length-1]:0}function jC(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,o={},i="/",a=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=i==="/"?t:t.slice(i.length)||"/",f=rg({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),d=u.route;if(!f&&l&&n&&!r[r.length-1].route.index&&(f=rg({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!f)return null;Object.assign(o,f.params),a.push({params:o,pathname:$r([i,f.pathname]),pathnameBase:qC($r([i,f.pathnameBase])),route:d}),f.pathnameBase!=="/"&&(i=$r([i,f.pathnameBase]))}return a}function rg(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=VC(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let i=o[0],a=i.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((l,c,f)=>{let{paramName:d,isOptional:h}=c;if(d==="*"){let m=s[f]||"";a=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=s[f];return h&&!p?l[d]=void 0:l[d]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:i,pathnameBase:a,pattern:e}}function VC(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),va(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function HC(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return va(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ca(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function GC(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:o=""}=typeof e=="string"?Oo(e):e;return{pathname:n?n.startsWith("/")?n:KC(n,t):t,search:XC(r),hash:YC(o)}}function KC(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function Cf(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function z1(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function _c(e,t){let n=z1(e);return t?n.map((r,o)=>o===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Sc(e,t,n,r){r===void 0&&(r=!1);let o;typeof e=="string"?o=Oo(e):(o=tt({},e),ke(!o.pathname||!o.pathname.includes("?"),Cf("?","pathname","search",o)),ke(!o.pathname||!o.pathname.includes("#"),Cf("#","pathname","hash",o)),ke(!o.search||!o.search.includes("#"),Cf("#","search","hash",o)));let i=e===""||o.pathname==="",a=i?"/":o.pathname,s;if(a==null)s=n;else{let f=t.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),f-=1;o.pathname=d.join("/")}s=f>=0?t[f]:"/"}let u=GC(o,s),l=a&&a!=="/"&&a.endsWith("/"),c=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const $r=e=>e.join("/").replace(/\/\/+/g,"/"),qC=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),XC=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,YC=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;class Al{constructor(t,n,r,o){o===void 0&&(o=!1),this.status=t,this.statusText=n||"",this.internal=o,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function kc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const U1=["post","put","patch","delete"],QC=new Set(U1),JC=["get",...U1],ZC=new Set(JC),e_=new Set([301,302,303,307,308]),t_=new Set([307,308]),_f={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},n_={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},$a={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},bp=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,r_=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),j1="remix-router-transitions";function o_(e){const t=e.window?e.window:typeof window<"u"?window:void 0,n=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u",r=!n;ke(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let o;if(e.mapRouteProperties)o=e.mapRouteProperties;else if(e.detectErrorBoundary){let A=e.detectErrorBoundary;o=L=>({hasErrorBoundary:A(L)})}else o=r_;let i={},a=Ns(e.routes,o,void 0,i),s,u=e.basename||"/",l=e.unstable_dataStrategy||c_,c=e.unstable_patchRoutesOnNavigation,f=tt({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},e.future),d=null,h=new Set,p=1e3,m=new Set,g=null,v=null,y=null,x=e.hydrationData!=null,w=Qo(a,e.history.location,u),b=null;if(w==null&&!c){let A=Qt(404,{pathname:e.history.location.pathname}),{matches:L,route:U}=dg(a);w=L,b={[U.id]:A}}w&&!e.hydrationData&&fu(w,a,e.history.location.pathname).active&&(w=null);let C;if(w)if(w.some(A=>A.route.lazy))C=!1;else if(!w.some(A=>A.route.loader))C=!0;else if(f.v7_partialHydration){let A=e.hydrationData?e.hydrationData.loaderData:null,L=e.hydrationData?e.hydrationData.errors:null,U=Y=>Y.route.loader?typeof Y.route.loader=="function"&&Y.route.loader.hydrate===!0?!1:A&&A[Y.route.id]!==void 0||L&&L[Y.route.id]!==void 0:!0;if(L){let Y=w.findIndex(ie=>L[ie.route.id]!==void 0);C=w.slice(0,Y+1).every(U)}else C=w.every(U)}else C=e.hydrationData!=null;else if(C=!1,w=[],f.v7_partialHydration){let A=fu(null,a,e.history.location.pathname);A.active&&A.matches&&(w=A.matches)}let S,E={historyAction:e.history.action,location:e.history.location,matches:w,initialized:C,navigation:_f,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||b,fetchers:new Map,blockers:new Map},k=vt.Pop,_=!1,T,D=!1,z=new Map,W=null,V=!1,K=!1,G=[],N=new Set,O=new Map,B=0,q=-1,Q=new Map,ne=new Set,re=new Map,ve=new Map,me=new Set,xe=new Map,_e=new Map,Ae=new Map,Ge;function De(){if(d=e.history.listen(A=>{let{action:L,location:U,delta:Y}=A;if(Ge){Ge(),Ge=void 0;return}va(_e.size===0||Y!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ie=$v({currentLocation:E.location,nextLocation:U,historyAction:L});if(ie&&Y!=null){let ge=new Promise(be=>{Ge=be});e.history.go(Y*-1),lu(ie,{state:"blocked",location:U,proceed(){lu(ie,{state:"proceeding",proceed:void 0,reset:void 0,location:U}),ge.then(()=>e.history.go(Y))},reset(){let be=new Map(E.blockers);be.set(ie,$a),Ie({blockers:be})}});return}return Rt(L,U)}),n){S_(t,z);let A=()=>k_(t,z);t.addEventListener("pagehide",A),W=()=>t.removeEventListener("pagehide",A)}return E.initialized||Rt(vt.Pop,E.location,{initialHydration:!0}),S}function $e(){d&&d(),W&&W(),h.clear(),T&&T.abort(),E.fetchers.forEach((A,L)=>no(L)),E.blockers.forEach((A,L)=>Wv(L))}function Me(A){return h.add(A),()=>h.delete(A)}function Ie(A,L){L===void 0&&(L={}),E=tt({},E,A);let U=[],Y=[];f.v7_fetcherPersist&&E.fetchers.forEach((ie,ge)=>{ie.state==="idle"&&(me.has(ge)?Y.push(ge):U.push(ge))}),[...h].forEach(ie=>ie(E,{deletedFetchers:Y,unstable_viewTransitionOpts:L.viewTransitionOpts,unstable_flushSync:L.flushSync===!0})),f.v7_fetcherPersist&&(U.forEach(ie=>E.fetchers.delete(ie)),Y.forEach(ie=>no(ie)))}function ze(A,L,U){var Y,ie;let{flushSync:ge}=U===void 0?{}:U,be=E.actionData!=null&&E.navigation.formMethod!=null&&Qn(E.navigation.formMethod)&&E.navigation.state==="loading"&&((Y=A.state)==null?void 0:Y._isRedirect)!==!0,ee;L.actionData?Object.keys(L.actionData).length>0?ee=L.actionData:ee=null:be?ee=E.actionData:ee=null;let ye=L.loaderData?cg(E.loaderData,L.loaderData,L.matches||[],L.errors):E.loaderData,he=E.blockers;he.size>0&&(he=new Map(he),he.forEach((je,Ye)=>he.set(Ye,$a)));let pe=_===!0||E.navigation.formMethod!=null&&Qn(E.navigation.formMethod)&&((ie=A.state)==null?void 0:ie._isRedirect)!==!0;s&&(a=s,s=void 0),V||k===vt.Pop||(k===vt.Push?e.history.push(A,A.state):k===vt.Replace&&e.history.replace(A,A.state));let Be;if(k===vt.Pop){let je=z.get(E.location.pathname);je&&je.has(A.pathname)?Be={currentLocation:E.location,nextLocation:A}:z.has(A.pathname)&&(Be={currentLocation:A,nextLocation:E.location})}else if(D){let je=z.get(E.location.pathname);je?je.add(A.pathname):(je=new Set([A.pathname]),z.set(E.location.pathname,je)),Be={currentLocation:E.location,nextLocation:A}}Ie(tt({},L,{actionData:ee,loaderData:ye,historyAction:k,location:A,initialized:!0,navigation:_f,revalidation:"idle",restoreScrollPosition:Uv(A,L.matches||E.matches),preventScrollReset:pe,blockers:he}),{viewTransitionOpts:Be,flushSync:ge===!0}),k=vt.Pop,_=!1,D=!1,V=!1,K=!1,G=[]}async function Ke(A,L){if(typeof A=="number"){e.history.go(A);return}let U=Xd(E.location,E.matches,u,f.v7_prependBasename,A,f.v7_relativeSplatPath,L==null?void 0:L.fromRouteId,L==null?void 0:L.relative),{path:Y,submission:ie,error:ge}=og(f.v7_normalizeFormMethod,!1,U,L),be=E.location,ee=Ds(E.location,Y,L&&L.state);ee=tt({},ee,e.history.encodeLocation(ee));let ye=L&&L.replace!=null?L.replace:void 0,he=vt.Push;ye===!0?he=vt.Replace:ye===!1||ie!=null&&Qn(ie.formMethod)&&ie.formAction===E.location.pathname+E.location.search&&(he=vt.Replace);let pe=L&&"preventScrollReset"in L?L.preventScrollReset===!0:void 0,Be=(L&&L.unstable_flushSync)===!0,je=$v({currentLocation:be,nextLocation:ee,historyAction:he});if(je){lu(je,{state:"blocked",location:ee,proceed(){lu(je,{state:"proceeding",proceed:void 0,reset:void 0,location:ee}),Ke(A,L)},reset(){let Ye=new Map(E.blockers);Ye.set(je,$a),Ie({blockers:Ye})}});return}return await Rt(he,ee,{submission:ie,pendingError:ge,preventScrollReset:pe,replace:L&&L.replace,enableViewTransition:L&&L.unstable_viewTransition,flushSync:Be})}function Tn(){if(Uo(),Ie({revalidation:"loading"}),E.navigation.state!=="submitting"){if(E.navigation.state==="idle"){Rt(E.historyAction,E.location,{startUninterruptedRevalidation:!0});return}Rt(k||E.historyAction,E.navigation.location,{overrideNavigation:E.navigation,enableViewTransition:D===!0})}}async function Rt(A,L,U){T&&T.abort(),T=null,k=A,V=(U&&U.startUninterruptedRevalidation)===!0,Xb(E.location,E.matches),_=(U&&U.preventScrollReset)===!0,D=(U&&U.enableViewTransition)===!0;let Y=s||a,ie=U&&U.overrideNavigation,ge=Qo(Y,L,u),be=(U&&U.flushSync)===!0,ee=fu(ge,Y,L.pathname);if(ee.active&&ee.matches&&(ge=ee.matches),!ge){let{error:Oe,notFoundMatches:It,route:pt}=qc(L.pathname);ze(L,{matches:It,loaderData:{},errors:{[pt.id]:Oe}},{flushSync:be});return}if(E.initialized&&!K&&m_(E.location,L)&&!(U&&U.submission&&Qn(U.submission.formMethod))){ze(L,{matches:ge},{flushSync:be});return}T=new AbortController;let ye=Ri(e.history,L,T.signal,U&&U.submission),he;if(U&&U.pendingError)he=[qi(ge).route.id,{type:He.error,error:U.pendingError}];else if(U&&U.submission&&Qn(U.submission.formMethod)){let Oe=await Yt(ye,L,U.submission,ge,ee.active,{replace:U.replace,flushSync:be});if(Oe.shortCircuited)return;if(Oe.pendingActionResult){let[It,pt]=Oe.pendingActionResult;if(gn(pt)&&kc(pt.error)&&pt.error.status===404){T=null,ze(L,{matches:Oe.matches,loaderData:{},errors:{[It]:pt.error}});return}}ge=Oe.matches||ge,he=Oe.pendingActionResult,ie=Sf(L,U.submission),be=!1,ee.active=!1,ye=Ri(e.history,ye.url,ye.signal)}let{shortCircuited:pe,matches:Be,loaderData:je,errors:Ye}=await eo(ye,L,ge,ee.active,ie,U&&U.submission,U&&U.fetcherSubmission,U&&U.replace,U&&U.initialHydration===!0,be,he);pe||(T=null,ze(L,tt({matches:Be||ge},fg(he),{loaderData:je,errors:Ye})))}async function Yt(A,L,U,Y,ie,ge){ge===void 0&&(ge={}),Uo();let be=C_(L,U);if(Ie({navigation:be},{flushSync:ge.flushSync===!0}),ie){let he=await du(Y,L.pathname,A.signal);if(he.type==="aborted")return{shortCircuited:!0};if(he.type==="error"){let{boundaryId:pe,error:Be}=cu(L.pathname,he);return{matches:he.partialMatches,pendingActionResult:[pe,{type:He.error,error:Be}]}}else if(he.matches)Y=he.matches;else{let{notFoundMatches:pe,error:Be,route:je}=qc(L.pathname);return{matches:pe,pendingActionResult:[je.id,{type:He.error,error:Be}]}}}let ee,ye=Qa(Y,L);if(!ye.route.action&&!ye.route.lazy)ee={type:He.error,error:Qt(405,{method:A.method,pathname:L.pathname,routeId:ye.route.id})};else if(ee=(await Nn("action",E,A,[ye],Y,null))[ye.route.id],A.signal.aborted)return{shortCircuited:!0};if(ni(ee)){let he;return ge&&ge.replace!=null?he=ge.replace:he=sg(ee.response.headers.get("Location"),new URL(A.url),u)===E.location.pathname+E.location.search,await Gn(A,ee,!0,{submission:U,replace:he}),{shortCircuited:!0}}if(vo(ee))throw Qt(400,{type:"defer-action"});if(gn(ee)){let he=qi(Y,ye.route.id);return(ge&&ge.replace)!==!0&&(k=vt.Push),{matches:Y,pendingActionResult:[he.route.id,ee]}}return{matches:Y,pendingActionResult:[ye.route.id,ee]}}async function eo(A,L,U,Y,ie,ge,be,ee,ye,he,pe){let Be=ie||Sf(L,ge),je=ge||be||pg(Be),Ye=!V&&(!f.v7_partialHydration||!ye);if(Y){if(Ye){let ut=Dn(pe);Ie(tt({navigation:Be},ut!==void 0?{actionData:ut}:{}),{flushSync:he})}let Re=await du(U,L.pathname,A.signal);if(Re.type==="aborted")return{shortCircuited:!0};if(Re.type==="error"){let{boundaryId:ut,error:vn}=cu(L.pathname,Re);return{matches:Re.partialMatches,loaderData:{},errors:{[ut]:vn}}}else if(Re.matches)U=Re.matches;else{let{error:ut,notFoundMatches:vn,route:lt}=qc(L.pathname);return{matches:vn,loaderData:{},errors:{[lt.id]:ut}}}}let Oe=s||a,[It,pt]=ig(e.history,E,U,je,L,f.v7_partialHydration&&ye===!0,f.v7_skipActionErrorRevalidation,K,G,N,me,re,ne,Oe,u,pe);if(Xc(Re=>!(U&&U.some(ut=>ut.route.id===Re))||It&&It.some(ut=>ut.route.id===Re)),q=++B,It.length===0&&pt.length===0){let Re=Lv();return ze(L,tt({matches:U,loaderData:{},errors:pe&&gn(pe[1])?{[pe[0]]:pe[1].error}:null},fg(pe),Re?{fetchers:new Map(E.fetchers)}:{}),{flushSync:he}),{shortCircuited:!0}}if(Ye){let Re={};if(!Y){Re.navigation=Be;let ut=Dn(pe);ut!==void 0&&(Re.actionData=ut)}pt.length>0&&(Re.fetchers=ur(pt)),Ie(Re,{flushSync:he})}pt.forEach(Re=>{O.has(Re.key)&&Pn(Re.key),Re.controller&&O.set(Re.key,Re.controller)});let Na=()=>pt.forEach(Re=>Pn(Re.key));T&&T.signal.addEventListener("abort",Na);let{loaderResults:Tr,fetcherResults:Si}=await pn(E,U,It,pt,A);if(A.signal.aborted)return{shortCircuited:!0};T&&T.signal.removeEventListener("abort",Na),pt.forEach(Re=>O.delete(Re.key));let ro=Fu(Tr);if(ro)return await Gn(A,ro.result,!0,{replace:ee}),{shortCircuited:!0};if(ro=Fu(Si),ro)return ne.add(ro.key),await Gn(A,ro.result,!0,{replace:ee}),{shortCircuited:!0};let{loaderData:hu,errors:Dr}=lg(E,U,It,Tr,pe,pt,Si,xe);xe.forEach((Re,ut)=>{Re.subscribe(vn=>{(vn||Re.done)&&xe.delete(ut)})}),f.v7_partialHydration&&ye&&E.errors&&Object.entries(E.errors).filter(Re=>{let[ut]=Re;return!It.some(vn=>vn.route.id===ut)}).forEach(Re=>{let[ut,vn]=Re;Dr=Object.assign(Dr||{},{[ut]:vn})});let pu=Lv(),vu=Bv(q),mu=pu||vu||pt.length>0;return tt({matches:U,loaderData:hu,errors:Dr},mu?{fetchers:new Map(E.fetchers)}:{})}function Dn(A){if(A&&!gn(A[1]))return{[A[0]]:A[1].data};if(E.actionData)return Object.keys(E.actionData).length===0?null:E.actionData}function ur(A){return A.forEach(L=>{let U=E.fetchers.get(L.key),Y=za(void 0,U?U.data:void 0);E.fetchers.set(L.key,Y)}),new Map(E.fetchers)}function Vn(A,L,U,Y){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");O.has(A)&&Pn(A);let ie=(Y&&Y.unstable_flushSync)===!0,ge=s||a,be=Xd(E.location,E.matches,u,f.v7_prependBasename,U,f.v7_relativeSplatPath,L,Y==null?void 0:Y.relative),ee=Qo(ge,be,u),ye=fu(ee,ge,be);if(ye.active&&ye.matches&&(ee=ye.matches),!ee){Kn(A,L,Qt(404,{pathname:be}),{flushSync:ie});return}let{path:he,submission:pe,error:Be}=og(f.v7_normalizeFormMethod,!0,be,Y);if(Be){Kn(A,L,Be,{flushSync:ie});return}let je=Qa(ee,he);if(_=(Y&&Y.preventScrollReset)===!0,pe&&Qn(pe.formMethod)){to(A,L,he,je,ee,ye.active,ie,pe);return}re.set(A,{routeId:L,path:he}),Hn(A,L,he,je,ee,ye.active,ie,pe)}async function to(A,L,U,Y,ie,ge,be,ee){Uo(),re.delete(A);function ye(lt){if(!lt.route.action&&!lt.route.lazy){let Nr=Qt(405,{method:ee.formMethod,pathname:U,routeId:L});return Kn(A,L,Nr,{flushSync:be}),!0}return!1}if(!ge&&ye(Y))return;let he=E.fetchers.get(A);lr(A,__(ee,he),{flushSync:be});let pe=new AbortController,Be=Ri(e.history,U,pe.signal,ee);if(ge){let lt=await du(ie,U,Be.signal);if(lt.type==="aborted")return;if(lt.type==="error"){let{error:Nr}=cu(U,lt);Kn(A,L,Nr,{flushSync:be});return}else if(lt.matches){if(ie=lt.matches,Y=Qa(ie,U),ye(Y))return}else{Kn(A,L,Qt(404,{pathname:U}),{flushSync:be});return}}O.set(A,pe);let je=B,Oe=(await Nn("action",E,Be,[Y],ie,A))[Y.route.id];if(Be.signal.aborted){O.get(A)===pe&&O.delete(A);return}if(f.v7_fetcherPersist&&me.has(A)){if(ni(Oe)||gn(Oe)){lr(A,so(void 0));return}}else{if(ni(Oe))if(O.delete(A),q>je){lr(A,so(void 0));return}else return ne.add(A),lr(A,za(ee)),Gn(Be,Oe,!1,{fetcherSubmission:ee});if(gn(Oe)){Kn(A,L,Oe.error);return}}if(vo(Oe))throw Qt(400,{type:"defer-action"});let It=E.navigation.location||E.location,pt=Ri(e.history,It,pe.signal),Na=s||a,Tr=E.navigation.state!=="idle"?Qo(Na,E.navigation.location,u):E.matches;ke(Tr,"Didn't find any matches after fetcher action");let Si=++B;Q.set(A,Si);let ro=za(ee,Oe.data);E.fetchers.set(A,ro);let[hu,Dr]=ig(e.history,E,Tr,ee,It,!1,f.v7_skipActionErrorRevalidation,K,G,N,me,re,ne,Na,u,[Y.route.id,Oe]);Dr.filter(lt=>lt.key!==A).forEach(lt=>{let Nr=lt.key,Vv=E.fetchers.get(Nr),Jb=za(void 0,Vv?Vv.data:void 0);E.fetchers.set(Nr,Jb),O.has(Nr)&&Pn(Nr),lt.controller&&O.set(Nr,lt.controller)}),Ie({fetchers:new Map(E.fetchers)});let pu=()=>Dr.forEach(lt=>Pn(lt.key));pe.signal.addEventListener("abort",pu);let{loaderResults:vu,fetcherResults:mu}=await pn(E,Tr,hu,Dr,pt);if(pe.signal.aborted)return;pe.signal.removeEventListener("abort",pu),Q.delete(A),O.delete(A),Dr.forEach(lt=>O.delete(lt.key));let Re=Fu(vu);if(Re)return Gn(pt,Re.result,!1);if(Re=Fu(mu),Re)return ne.add(Re.key),Gn(pt,Re.result,!1);let{loaderData:ut,errors:vn}=lg(E,Tr,hu,vu,void 0,Dr,mu,xe);if(E.fetchers.has(A)){let lt=so(Oe.data);E.fetchers.set(A,lt)}Bv(Si),E.navigation.state==="loading"&&Si>q?(ke(k,"Expected pending action"),T&&T.abort(),ze(E.navigation.location,{matches:Tr,loaderData:ut,errors:vn,fetchers:new Map(E.fetchers)})):(Ie({errors:vn,loaderData:cg(E.loaderData,ut,Tr,vn),fetchers:new Map(E.fetchers)}),K=!1)}async function Hn(A,L,U,Y,ie,ge,be,ee){let ye=E.fetchers.get(A);lr(A,za(ee,ye?ye.data:void 0),{flushSync:be});let he=new AbortController,pe=Ri(e.history,U,he.signal);if(ge){let Oe=await du(ie,U,pe.signal);if(Oe.type==="aborted")return;if(Oe.type==="error"){let{error:It}=cu(U,Oe);Kn(A,L,It,{flushSync:be});return}else if(Oe.matches)ie=Oe.matches,Y=Qa(ie,U);else{Kn(A,L,Qt(404,{pathname:U}),{flushSync:be});return}}O.set(A,he);let Be=B,Ye=(await Nn("loader",E,pe,[Y],ie,A))[Y.route.id];if(vo(Ye)&&(Ye=await Ep(Ye,pe.signal,!0)||Ye),O.get(A)===he&&O.delete(A),!pe.signal.aborted){if(me.has(A)){lr(A,so(void 0));return}if(ni(Ye))if(q>Be){lr(A,so(void 0));return}else{ne.add(A),await Gn(pe,Ye,!1);return}if(gn(Ye)){Kn(A,L,Ye.error);return}ke(!vo(Ye),"Unhandled fetcher deferred data"),lr(A,so(Ye.data))}}async function Gn(A,L,U,Y){let{submission:ie,fetcherSubmission:ge,replace:be}=Y===void 0?{}:Y;L.response.headers.has("X-Remix-Revalidate")&&(K=!0);let ee=L.response.headers.get("Location");ke(ee,"Expected a Location header on the redirect Response"),ee=sg(ee,new URL(A.url),u);let ye=Ds(E.location,ee,{_isRedirect:!0});if(n){let Oe=!1;if(L.response.headers.has("X-Remix-Reload-Document"))Oe=!0;else if(bp.test(ee)){const It=e.history.createURL(ee);Oe=It.origin!==t.location.origin||Ca(It.pathname,u)==null}if(Oe){be?t.location.replace(ee):t.location.assign(ee);return}}T=null;let he=be===!0||L.response.headers.has("X-Remix-Replace")?vt.Replace:vt.Push,{formMethod:pe,formAction:Be,formEncType:je}=E.navigation;!ie&&!ge&&pe&&Be&&je&&(ie=pg(E.navigation));let Ye=ie||ge;if(t_.has(L.response.status)&&Ye&&Qn(Ye.formMethod))await Rt(he,ye,{submission:tt({},Ye,{formAction:ee}),preventScrollReset:_,enableViewTransition:U?D:void 0});else{let Oe=Sf(ye,ie);await Rt(he,ye,{overrideNavigation:Oe,fetcherSubmission:ge,preventScrollReset:_,enableViewTransition:U?D:void 0})}}async function Nn(A,L,U,Y,ie,ge){let be,ee={};try{be=await f_(l,A,L,U,Y,ie,ge,i,o)}catch(ye){return Y.forEach(he=>{ee[he.route.id]={type:He.error,error:ye}}),ee}for(let[ye,he]of Object.entries(be))if(y_(he)){let pe=he.result;ee[ye]={type:He.redirect,response:p_(pe,U,ye,ie,u,f.v7_relativeSplatPath)}}else ee[ye]=await h_(he);return ee}async function pn(A,L,U,Y,ie){let ge=A.matches,be=Nn("loader",A,ie,U,L,null),ee=Promise.all(Y.map(async pe=>{if(pe.matches&&pe.match&&pe.controller){let je=(await Nn("loader",A,Ri(e.history,pe.path,pe.controller.signal),[pe.match],pe.matches,pe.key))[pe.match.route.id];return{[pe.key]:je}}else return Promise.resolve({[pe.key]:{type:He.error,error:Qt(404,{pathname:pe.path})}})})),ye=await be,he=(await ee).reduce((pe,Be)=>Object.assign(pe,Be),{});return await Promise.all([b_(L,ye,ie.signal,ge,A.loaderData),E_(L,he,Y)]),{loaderResults:ye,fetcherResults:he}}function Uo(){K=!0,G.push(...Xc()),re.forEach((A,L)=>{O.has(L)&&(N.add(L),Pn(L))})}function lr(A,L,U){U===void 0&&(U={}),E.fetchers.set(A,L),Ie({fetchers:new Map(E.fetchers)},{flushSync:(U&&U.flushSync)===!0})}function Kn(A,L,U,Y){Y===void 0&&(Y={});let ie=qi(E.matches,L);no(A),Ie({errors:{[ie.route.id]:U},fetchers:new Map(E.fetchers)},{flushSync:(Y&&Y.flushSync)===!0})}function uu(A){return f.v7_fetcherPersist&&(ve.set(A,(ve.get(A)||0)+1),me.has(A)&&me.delete(A)),E.fetchers.get(A)||n_}function no(A){let L=E.fetchers.get(A);O.has(A)&&!(L&&L.state==="loading"&&Q.has(A))&&Pn(A),re.delete(A),Q.delete(A),ne.delete(A),me.delete(A),N.delete(A),E.fetchers.delete(A)}function Da(A){if(f.v7_fetcherPersist){let L=(ve.get(A)||0)-1;L<=0?(ve.delete(A),me.add(A)):ve.set(A,L)}else no(A);Ie({fetchers:new Map(E.fetchers)})}function Pn(A){let L=O.get(A);ke(L,"Expected fetch controller: "+A),L.abort(),O.delete(A)}function Ov(A){for(let L of A){let U=uu(L),Y=so(U.data);E.fetchers.set(L,Y)}}function Lv(){let A=[],L=!1;for(let U of ne){let Y=E.fetchers.get(U);ke(Y,"Expected fetcher: "+U),Y.state==="loading"&&(ne.delete(U),A.push(U),L=!0)}return Ov(A),L}function Bv(A){let L=[];for(let[U,Y]of Q)if(Y<A){let ie=E.fetchers.get(U);ke(ie,"Expected fetcher: "+U),ie.state==="loading"&&(Pn(U),Q.delete(U),L.push(U))}return Ov(L),L.length>0}function Kb(A,L){let U=E.blockers.get(A)||$a;return _e.get(A)!==L&&_e.set(A,L),U}function Wv(A){E.blockers.delete(A),_e.delete(A)}function lu(A,L){let U=E.blockers.get(A)||$a;ke(U.state==="unblocked"&&L.state==="blocked"||U.state==="blocked"&&L.state==="blocked"||U.state==="blocked"&&L.state==="proceeding"||U.state==="blocked"&&L.state==="unblocked"||U.state==="proceeding"&&L.state==="unblocked","Invalid blocker state transition: "+U.state+" -> "+L.state);let Y=new Map(E.blockers);Y.set(A,L),Ie({blockers:Y})}function $v(A){let{currentLocation:L,nextLocation:U,historyAction:Y}=A;if(_e.size===0)return;_e.size>1&&va(!1,"A router only supports one blocker at a time");let ie=Array.from(_e.entries()),[ge,be]=ie[ie.length-1],ee=E.blockers.get(ge);if(!(ee&&ee.state==="proceeding")&&be({currentLocation:L,nextLocation:U,historyAction:Y}))return ge}function qc(A){let L=Qt(404,{pathname:A}),U=s||a,{matches:Y,route:ie}=dg(U);return Xc(),{notFoundMatches:Y,route:ie,error:L}}function cu(A,L){return{boundaryId:qi(L.partialMatches).route.id,error:Qt(400,{type:"route-discovery",pathname:A,message:L.error!=null&&"message"in L.error?L.error:String(L.error)})}}function Xc(A){let L=[];return xe.forEach((U,Y)=>{(!A||A(Y))&&(U.cancel(),L.push(Y),xe.delete(Y))}),L}function qb(A,L,U){if(g=A,y=L,v=U||null,!x&&E.navigation===_f){x=!0;let Y=Uv(E.location,E.matches);Y!=null&&Ie({restoreScrollPosition:Y})}return()=>{g=null,y=null,v=null}}function zv(A,L){return v&&v(A,L.map(Y=>AC(Y,E.loaderData)))||A.key}function Xb(A,L){if(g&&y){let U=zv(A,L);g[U]=y()}}function Uv(A,L){if(g){let U=zv(A,L),Y=g[U];if(typeof Y=="number")return Y}return null}function fu(A,L,U){if(c){if(m.has(U))return{active:!1,matches:A};if(A){if(Object.keys(A[0].params).length>0)return{active:!0,matches:sl(L,U,u,!0)}}else return{active:!0,matches:sl(L,U,u,!0)||[]}}return{active:!1,matches:null}}async function du(A,L,U){let Y=A;for(;;){let ie=s==null,ge=s||a;try{await u_(c,L,Y,ge,i,o,Ae,U)}catch(ye){return{type:"error",error:ye,partialMatches:Y}}finally{ie&&(a=[...a])}if(U.aborted)return{type:"aborted"};let be=Qo(ge,L,u);if(be)return jv(L,m),{type:"success",matches:be};let ee=sl(ge,L,u,!0);if(!ee||Y.length===ee.length&&Y.every((ye,he)=>ye.route.id===ee[he].route.id))return jv(L,m),{type:"success",matches:null};Y=ee}}function jv(A,L){if(L.size>=p){let U=L.values().next().value;L.delete(U)}L.add(A)}function Yb(A){i={},s=Ns(A,o,void 0,i)}function Qb(A,L){let U=s==null;H1(A,L,s||a,i,o),U&&(a=[...a],Ie({}))}return S={get basename(){return u},get future(){return f},get state(){return E},get routes(){return a},get window(){return t},initialize:De,subscribe:Me,enableScrollRestoration:qb,navigate:Ke,fetch:Vn,revalidate:Tn,createHref:A=>e.history.createHref(A),encodeLocation:A=>e.history.encodeLocation(A),getFetcher:uu,deleteFetcher:Da,dispose:$e,getBlocker:Kb,deleteBlocker:Wv,patchRoutes:Qb,_internalFetchControllers:O,_internalActiveDeferreds:xe,_internalSetRoutes:Yb},S}function i_(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Xd(e,t,n,r,o,i,a,s){let u,l;if(a){u=[];for(let f of t)if(u.push(f),f.route.id===a){l=f;break}}else u=t,l=t[t.length-1];let c=Sc(o||".",_c(u,i),Ca(e.pathname,n)||e.pathname,s==="path");return o==null&&(c.search=e.search,c.hash=e.hash),(o==null||o===""||o===".")&&l&&l.route.index&&!Cp(c.search)&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r&&n!=="/"&&(c.pathname=c.pathname==="/"?n:$r([n,c.pathname])),vi(c)}function og(e,t,n,r){if(!r||!i_(r))return{path:n};if(r.formMethod&&!w_(r.formMethod))return{path:n,error:Qt(405,{method:r.formMethod})};let o=()=>({path:n,error:Qt(400,{type:"invalid-body"})}),i=r.formMethod||"get",a=e?i.toUpperCase():i.toLowerCase(),s=G1(n);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Qn(a))return o();let d=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((h,p)=>{let[m,g]=p;return""+h+m+"="+g+`
`},""):String(r.body);return{path:n,submission:{formMethod:a,formAction:s,formEncType:r.formEncType,formData:void 0,json:void 0,text:d}}}else if(r.formEncType==="application/json"){if(!Qn(a))return o();try{let d=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:n,submission:{formMethod:a,formAction:s,formEncType:r.formEncType,formData:void 0,json:d,text:void 0}}}catch{return o()}}}ke(typeof FormData=="function","FormData is not available in this environment");let u,l;if(r.formData)u=Yd(r.formData),l=r.formData;else if(r.body instanceof FormData)u=Yd(r.body),l=r.body;else if(r.body instanceof URLSearchParams)u=r.body,l=ug(u);else if(r.body==null)u=new URLSearchParams,l=new FormData;else try{u=new URLSearchParams(r.body),l=ug(u)}catch{return o()}let c={formMethod:a,formAction:s,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:l,json:void 0,text:void 0};if(Qn(c.formMethod))return{path:n,submission:c};let f=Oo(n);return t&&f.search&&Cp(f.search)&&u.append("index",""),f.search="?"+u,{path:vi(f),submission:c}}function a_(e,t){let n=e;if(t){let r=e.findIndex(o=>o.route.id===t);r>=0&&(n=e.slice(0,r))}return n}function ig(e,t,n,r,o,i,a,s,u,l,c,f,d,h,p,m){let g=m?gn(m[1])?m[1].error:m[1].data:void 0,v=e.createURL(t.location),y=e.createURL(o),x=m&&gn(m[1])?m[0]:void 0,w=x?a_(n,x):n,b=m?m[1].statusCode:void 0,C=a&&b&&b>=400,S=w.filter((k,_)=>{let{route:T}=k;if(T.lazy)return!0;if(T.loader==null)return!1;if(i)return typeof T.loader!="function"||T.loader.hydrate?!0:t.loaderData[T.id]===void 0&&(!t.errors||t.errors[T.id]===void 0);if(s_(t.loaderData,t.matches[_],k)||u.some(W=>W===k.route.id))return!0;let D=t.matches[_],z=k;return ag(k,tt({currentUrl:v,currentParams:D.params,nextUrl:y,nextParams:z.params},r,{actionResult:g,actionStatus:b,defaultShouldRevalidate:C?!1:s||v.pathname+v.search===y.pathname+y.search||v.search!==y.search||V1(D,z)}))}),E=[];return f.forEach((k,_)=>{if(i||!n.some(V=>V.route.id===k.routeId)||c.has(_))return;let T=Qo(h,k.path,p);if(!T){E.push({key:_,routeId:k.routeId,path:k.path,matches:null,match:null,controller:null});return}let D=t.fetchers.get(_),z=Qa(T,k.path),W=!1;d.has(_)?W=!1:l.has(_)?(l.delete(_),W=!0):D&&D.state!=="idle"&&D.data===void 0?W=s:W=ag(z,tt({currentUrl:v,currentParams:t.matches[t.matches.length-1].params,nextUrl:y,nextParams:n[n.length-1].params},r,{actionResult:g,actionStatus:b,defaultShouldRevalidate:C?!1:s})),W&&E.push({key:_,routeId:k.routeId,path:k.path,matches:T,match:z,controller:new AbortController})}),[S,E]}function s_(e,t,n){let r=!t||n.route.id!==t.route.id,o=e[n.route.id]===void 0;return r||o}function V1(e,t){let n=e.route.path;return e.pathname!==t.pathname||n!=null&&n.endsWith("*")&&e.params["*"]!==t.params["*"]}function ag(e,t){if(e.route.shouldRevalidate){let n=e.route.shouldRevalidate(t);if(typeof n=="boolean")return n}return t.defaultShouldRevalidate}async function u_(e,t,n,r,o,i,a,s){let u=[t,...n.map(l=>l.route.id)].join("-");try{let l=a.get(u);l||(l=e({path:t,matches:n,patch:(c,f)=>{s.aborted||H1(c,f,r,o,i)}}),a.set(u,l)),l&&g_(l)&&await l}finally{a.delete(u)}}function H1(e,t,n,r,o){if(e){var i;let a=r[e];ke(a,"No route found to patch children into: routeId = "+e);let s=Ns(t,o,[e,"patch",String(((i=a.children)==null?void 0:i.length)||"0")],r);a.children?a.children.push(...s):a.children=s}else{let a=Ns(t,o,["patch",String(n.length||"0")],r);n.push(...a)}}async function l_(e,t,n){if(!e.lazy)return;let r=await e.lazy();if(!e.lazy)return;let o=n[e.id];ke(o,"No route found in manifest");let i={};for(let a in r){let u=o[a]!==void 0&&a!=="hasErrorBoundary";va(!u,'Route "'+o.id+'" has a static property "'+a+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+a+'" will be ignored.')),!u&&!NC.has(a)&&(i[a]=r[a])}Object.assign(o,i),Object.assign(o,tt({},t(o),{lazy:void 0}))}async function c_(e){let{matches:t}=e,n=t.filter(o=>o.shouldLoad);return(await Promise.all(n.map(o=>o.resolve()))).reduce((o,i,a)=>Object.assign(o,{[n[a].route.id]:i}),{})}async function f_(e,t,n,r,o,i,a,s,u,l){let c=i.map(h=>h.route.lazy?l_(h.route,u,s):void 0),f=i.map((h,p)=>{let m=c[p],g=o.some(y=>y.route.id===h.route.id);return tt({},h,{shouldLoad:g,resolve:async y=>(y&&r.method==="GET"&&(h.route.lazy||h.route.loader)&&(g=!0),g?d_(t,r,h,m,y,l):Promise.resolve({type:He.data,result:void 0}))})}),d=await e({matches:f,request:r,params:i[0].params,fetcherKey:a,context:l});try{await Promise.all(c)}catch{}return d}async function d_(e,t,n,r,o,i){let a,s,u=l=>{let c,f=new Promise((p,m)=>c=m);s=()=>c(),t.signal.addEventListener("abort",s);let d=p=>typeof l!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+e+'" [routeId: '+n.route.id+"]"))):l({request:t,params:n.params,context:i},...p!==void 0?[p]:[]),h=(async()=>{try{return{type:"data",result:await(o?o(m=>d(m)):d())}}catch(p){return{type:"error",result:p}}})();return Promise.race([h,f])};try{let l=n.route[e];if(r)if(l){let c,[f]=await Promise.all([u(l).catch(d=>{c=d}),r]);if(c!==void 0)throw c;a=f}else if(await r,l=n.route[e],l)a=await u(l);else if(e==="action"){let c=new URL(t.url),f=c.pathname+c.search;throw Qt(405,{method:t.method,pathname:f,routeId:n.route.id})}else return{type:He.data,result:void 0};else if(l)a=await u(l);else{let c=new URL(t.url),f=c.pathname+c.search;throw Qt(404,{pathname:f})}ke(a.result!==void 0,"You defined "+(e==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+e+"` ")+"function. Please return a value or `null`.")}catch(l){return{type:He.error,result:l}}finally{s&&t.signal.removeEventListener("abort",s)}return a}async function h_(e){let{result:t,type:n}=e;if(K1(t)){let l;try{let c=t.headers.get("Content-Type");c&&/\bapplication\/json\b/.test(c)?t.body==null?l=null:l=await t.json():l=await t.text()}catch(c){return{type:He.error,error:c}}return n===He.error?{type:He.error,error:new Al(t.status,t.statusText,l),statusCode:t.status,headers:t.headers}:{type:He.data,data:l,statusCode:t.status,headers:t.headers}}if(n===He.error){if(hg(t)){var r;if(t.data instanceof Error){var o;return{type:He.error,error:t.data,statusCode:(o=t.init)==null?void 0:o.status}}t=new Al(((r=t.init)==null?void 0:r.status)||500,void 0,t.data)}return{type:He.error,error:t,statusCode:kc(t)?t.status:void 0}}if(x_(t)){var i,a;return{type:He.deferred,deferredData:t,statusCode:(i=t.init)==null?void 0:i.status,headers:((a=t.init)==null?void 0:a.headers)&&new Headers(t.init.headers)}}if(hg(t)){var s,u;return{type:He.data,data:t.data,statusCode:(s=t.init)==null?void 0:s.status,headers:(u=t.init)!=null&&u.headers?new Headers(t.init.headers):void 0}}return{type:He.data,data:t}}function p_(e,t,n,r,o,i){let a=e.headers.get("Location");if(ke(a,"Redirects returned/thrown from loaders/actions must have a Location header"),!bp.test(a)){let s=r.slice(0,r.findIndex(u=>u.route.id===n)+1);a=Xd(new URL(t.url),s,o,!0,a,i),e.headers.set("Location",a)}return e}function sg(e,t,n){if(bp.test(e)){let r=e,o=r.startsWith("//")?new URL(t.protocol+r):new URL(r),i=Ca(o.pathname,n)!=null;if(o.origin===t.origin&&i)return o.pathname+o.search+o.hash}return e}function Ri(e,t,n,r){let o=e.createURL(G1(t)).toString(),i={signal:n};if(r&&Qn(r.formMethod)){let{formMethod:a,formEncType:s}=r;i.method=a.toUpperCase(),s==="application/json"?(i.headers=new Headers({"Content-Type":s}),i.body=JSON.stringify(r.json)):s==="text/plain"?i.body=r.text:s==="application/x-www-form-urlencoded"&&r.formData?i.body=Yd(r.formData):i.body=r.formData}return new Request(o,i)}function Yd(e){let t=new URLSearchParams;for(let[n,r]of e.entries())t.append(n,typeof r=="string"?r:r.name);return t}function ug(e){let t=new FormData;for(let[n,r]of e.entries())t.append(n,r);return t}function v_(e,t,n,r,o){let i={},a=null,s,u=!1,l={},c=n&&gn(n[1])?n[1].error:void 0;return e.forEach(f=>{if(!(f.route.id in t))return;let d=f.route.id,h=t[d];if(ke(!ni(h),"Cannot handle redirect results in processLoaderData"),gn(h)){let p=h.error;c!==void 0&&(p=c,c=void 0),a=a||{};{let m=qi(e,d);a[m.route.id]==null&&(a[m.route.id]=p)}i[d]=void 0,u||(u=!0,s=kc(h.error)?h.error.status:500),h.headers&&(l[d]=h.headers)}else vo(h)?(r.set(d,h.deferredData),i[d]=h.deferredData.data,h.statusCode!=null&&h.statusCode!==200&&!u&&(s=h.statusCode),h.headers&&(l[d]=h.headers)):(i[d]=h.data,h.statusCode&&h.statusCode!==200&&!u&&(s=h.statusCode),h.headers&&(l[d]=h.headers))}),c!==void 0&&n&&(a={[n[0]]:c},i[n[0]]=void 0),{loaderData:i,errors:a,statusCode:s||200,loaderHeaders:l}}function lg(e,t,n,r,o,i,a,s){let{loaderData:u,errors:l}=v_(t,r,o,s);return i.forEach(c=>{let{key:f,match:d,controller:h}=c,p=a[f];if(ke(p,"Did not find corresponding fetcher result"),!(h&&h.signal.aborted))if(gn(p)){let m=qi(e.matches,d==null?void 0:d.route.id);l&&l[m.route.id]||(l=tt({},l,{[m.route.id]:p.error})),e.fetchers.delete(f)}else if(ni(p))ke(!1,"Unhandled fetcher revalidation redirect");else if(vo(p))ke(!1,"Unhandled fetcher deferred data");else{let m=so(p.data);e.fetchers.set(f,m)}}),{loaderData:u,errors:l}}function cg(e,t,n,r){let o=tt({},t);for(let i of n){let a=i.route.id;if(t.hasOwnProperty(a)?t[a]!==void 0&&(o[a]=t[a]):e[a]!==void 0&&i.route.loader&&(o[a]=e[a]),r&&r.hasOwnProperty(a))break}return o}function fg(e){return e?gn(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function qi(e,t){return(t?e.slice(0,e.findIndex(r=>r.route.id===t)+1):[...e]).reverse().find(r=>r.route.hasErrorBoundary===!0)||e[0]}function dg(e){let t=e.length===1?e[0]:e.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function Qt(e,t){let{pathname:n,routeId:r,method:o,type:i,message:a}=t===void 0?{}:t,s="Unknown Server Error",u="Unknown @remix-run/router error";return e===400?(s="Bad Request",i==="route-discovery"?u='Unable to match URL "'+n+'" - the `unstable_patchRoutesOnNavigation()` '+(`function threw the following error:
`+a):o&&n&&r?u="You made a "+o+' request to "'+n+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":i==="defer-action"?u="defer() is not supported in actions":i==="invalid-body"&&(u="Unable to encode submission body")):e===403?(s="Forbidden",u='Route "'+r+'" does not match URL "'+n+'"'):e===404?(s="Not Found",u='No route matches URL "'+n+'"'):e===405&&(s="Method Not Allowed",o&&n&&r?u="You made a "+o.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":o&&(u='Invalid request method "'+o.toUpperCase()+'"')),new Al(e||500,s,new Error(u),!0)}function Fu(e){let t=Object.entries(e);for(let n=t.length-1;n>=0;n--){let[r,o]=t[n];if(ni(o))return{key:r,result:o}}}function G1(e){let t=typeof e=="string"?Oo(e):e;return vi(tt({},t,{hash:""}))}function m_(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function g_(e){return typeof e=="object"&&e!=null&&"then"in e}function y_(e){return K1(e.result)&&e_.has(e.result.status)}function vo(e){return e.type===He.deferred}function gn(e){return e.type===He.error}function ni(e){return(e&&e.type)===He.redirect}function hg(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function x_(e){let t=e;return t&&typeof t=="object"&&typeof t.data=="object"&&typeof t.subscribe=="function"&&typeof t.cancel=="function"&&typeof t.resolveData=="function"}function K1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function w_(e){return ZC.has(e.toLowerCase())}function Qn(e){return QC.has(e.toLowerCase())}async function b_(e,t,n,r,o){let i=Object.entries(t);for(let a=0;a<i.length;a++){let[s,u]=i[a],l=e.find(d=>(d==null?void 0:d.route.id)===s);if(!l)continue;let c=r.find(d=>d.route.id===l.route.id),f=c!=null&&!V1(c,l)&&(o&&o[l.route.id])!==void 0;vo(u)&&f&&await Ep(u,n,!1).then(d=>{d&&(t[s]=d)})}}async function E_(e,t,n){for(let r=0;r<n.length;r++){let{key:o,routeId:i,controller:a}=n[r],s=t[o];e.find(l=>(l==null?void 0:l.route.id)===i)&&vo(s)&&(ke(a,"Expected an AbortController for revalidating fetcher deferred result"),await Ep(s,a.signal,!0).then(l=>{l&&(t[o]=l)}))}}async function Ep(e,t,n){if(n===void 0&&(n=!1),!await e.deferredData.resolveData(t)){if(n)try{return{type:He.data,data:e.deferredData.unwrappedData}}catch(o){return{type:He.error,error:o}}return{type:He.data,data:e.deferredData.data}}}function Cp(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function Qa(e,t){let n=typeof t=="string"?Oo(t).search:t.search;if(e[e.length-1].route.index&&Cp(n||""))return e[e.length-1];let r=z1(e);return r[r.length-1]}function pg(e){let{formMethod:t,formAction:n,formEncType:r,text:o,formData:i,json:a}=e;if(!(!t||!n||!r)){if(o!=null)return{formMethod:t,formAction:n,formEncType:r,formData:void 0,json:void 0,text:o};if(i!=null)return{formMethod:t,formAction:n,formEncType:r,formData:i,json:void 0,text:void 0};if(a!==void 0)return{formMethod:t,formAction:n,formEncType:r,formData:void 0,json:a,text:void 0}}}function Sf(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function C_(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function za(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function __(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function so(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function S_(e,t){try{let n=e.sessionStorage.getItem(j1);if(n){let r=JSON.parse(n);for(let[o,i]of Object.entries(r||{}))i&&Array.isArray(i)&&t.set(o,new Set(i||[]))}}catch{}}function k_(e,t){if(t.size>0){let n={};for(let[r,o]of t)n[r]=[...o];try{e.sessionStorage.setItem(j1,JSON.stringify(n))}catch(r){va(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fl(){return Fl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fl.apply(this,arguments)}const Rc=F.createContext(null),q1=F.createContext(null),Lo=F.createContext(null),_p=F.createContext(null),Bo=F.createContext({outlet:null,matches:[],isDataRoute:!1}),X1=F.createContext(null);function R_(e,t){let{relative:n}=t===void 0?{}:t;_a()||ke(!1);let{basename:r,navigator:o}=F.useContext(Lo),{hash:i,pathname:a,search:s}=Q1(e,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:$r([r,a])),o.createHref({pathname:u,search:s,hash:i})}function _a(){return F.useContext(_p)!=null}function Sa(){return _a()||ke(!1),F.useContext(_p).location}function Y1(e){F.useContext(Lo).static||F.useLayoutEffect(e)}function Ic(){let{isDataRoute:e}=F.useContext(Bo);return e?W_():I_()}function I_(){_a()||ke(!1);let e=F.useContext(Rc),{basename:t,future:n,navigator:r}=F.useContext(Lo),{matches:o}=F.useContext(Bo),{pathname:i}=Sa(),a=JSON.stringify(_c(o,n.v7_relativeSplatPath)),s=F.useRef(!1);return Y1(()=>{s.current=!0}),F.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let f=Sc(l,JSON.parse(a),i,c.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:$r([t,f.pathname])),(c.replace?r.replace:r.push)(f,c.state,c)},[t,r,a,i,e])}function Q1(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=F.useContext(Lo),{matches:o}=F.useContext(Bo),{pathname:i}=Sa(),a=JSON.stringify(_c(o,r.v7_relativeSplatPath));return F.useMemo(()=>Sc(e,JSON.parse(a),i,n==="path"),[e,a,i,n])}function T_(e,t,n,r){_a()||ke(!1);let{navigator:o}=F.useContext(Lo),{matches:i}=F.useContext(Bo),a=i[i.length-1],s=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let l=Sa(),c;c=l;let f=c.pathname||"/",d=f;if(u!=="/"){let m=u.replace(/^\//,"").split("/");d="/"+f.replace(/^\//,"").split("/").slice(m.length).join("/")}let h=Qo(e,{pathname:d});return F_(h&&h.map(m=>Object.assign({},m,{params:Object.assign({},s,m.params),pathname:$r([u,o.encodeLocation?o.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?u:$r([u,o.encodeLocation?o.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),i,n,r)}function D_(){let e=B_(),t=kc(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},t),n?F.createElement("pre",{style:o},n):null,null)}const N_=F.createElement(D_,null);class P_ extends F.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?F.createElement(Bo.Provider,{value:this.props.routeContext},F.createElement(X1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function A_(e){let{routeContext:t,match:n,children:r}=e,o=F.useContext(Rc);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),F.createElement(Bo.Provider,{value:t},r)}function F_(e,t,n,r){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,s=(o=n)==null?void 0:o.errors;if(s!=null){let c=a.findIndex(f=>f.route.id&&(s==null?void 0:s[f.route.id])!==void 0);c>=0||ke(!1),a=a.slice(0,Math.min(a.length,c+1))}let u=!1,l=-1;if(n&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let f=a[c];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(l=c),f.route.id){let{loaderData:d,errors:h}=n,p=f.route.loader&&d[f.route.id]===void 0&&(!h||h[f.route.id]===void 0);if(f.route.lazy||p){u=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((c,f,d)=>{let h,p=!1,m=null,g=null;n&&(h=s&&f.route.id?s[f.route.id]:void 0,m=f.route.errorElement||N_,u&&(l<0&&d===0?(p=!0,g=null):l===d&&(p=!0,g=f.route.hydrateFallbackElement||null)));let v=t.concat(a.slice(0,d+1)),y=()=>{let x;return h?x=m:p?x=g:f.route.Component?x=F.createElement(f.route.Component,null):f.route.element?x=f.route.element:x=c,F.createElement(A_,{match:f,routeContext:{outlet:c,matches:v,isDataRoute:n!=null},children:x})};return n&&(f.route.ErrorBoundary||f.route.errorElement||d===0)?F.createElement(P_,{location:n.location,revalidation:n.revalidation,component:m,error:h,children:y(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):y()},null)}var J1=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(J1||{}),Ml=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ml||{});function M_(e){let t=F.useContext(Rc);return t||ke(!1),t}function O_(e){let t=F.useContext(q1);return t||ke(!1),t}function L_(e){let t=F.useContext(Bo);return t||ke(!1),t}function Z1(e){let t=L_(),n=t.matches[t.matches.length-1];return n.route.id||ke(!1),n.route.id}function B_(){var e;let t=F.useContext(X1),n=O_(Ml.UseRouteError),r=Z1(Ml.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function W_(){let{router:e}=M_(J1.UseNavigateStable),t=Z1(Ml.UseNavigateStable),n=F.useRef(!1);return Y1(()=>{n.current=!0}),F.useCallback(function(o,i){i===void 0&&(i={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,Fl({fromRouteId:t},i)))},[e,t])}function $_(e){let{to:t,replace:n,state:r,relative:o}=e;_a()||ke(!1);let{future:i,static:a}=F.useContext(Lo),{matches:s}=F.useContext(Bo),{pathname:u}=Sa(),l=Ic(),c=Sc(t,_c(s,i.v7_relativeSplatPath),u,o==="path"),f=JSON.stringify(c);return F.useEffect(()=>l(JSON.parse(f),{replace:n,state:r,relative:o}),[l,f,o,n,r]),null}function Go(e){ke(!1)}function z_(e){let{basename:t="/",children:n=null,location:r,navigationType:o=vt.Pop,navigator:i,static:a=!1,future:s}=e;_a()&&ke(!1);let u=t.replace(/^\/*/,"/"),l=F.useMemo(()=>({basename:u,navigator:i,static:a,future:Fl({v7_relativeSplatPath:!1},s)}),[u,s,i,a]);typeof r=="string"&&(r=Oo(r));let{pathname:c="/",search:f="",hash:d="",state:h=null,key:p="default"}=r,m=F.useMemo(()=>{let g=Ca(c,u);return g==null?null:{location:{pathname:g,search:f,hash:d,state:h,key:p},navigationType:o}},[u,c,f,d,h,p,o]);return m==null?null:F.createElement(Lo.Provider,{value:l},F.createElement(_p.Provider,{children:n,value:m}))}new Promise(()=>{});function Qd(e,t){t===void 0&&(t=[]);let n=[];return F.Children.forEach(e,(r,o)=>{if(!F.isValidElement(r))return;let i=[...t,o];if(r.type===F.Fragment){n.push.apply(n,Qd(r.props.children,i));return}r.type!==Go&&ke(!1),!r.props.index||!r.props.children||ke(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Qd(r.props.children,i)),n.push(a)}),n}function U_(e){let t={hasErrorBoundary:e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&Object.assign(t,{element:F.createElement(e.Component),Component:void 0}),e.HydrateFallback&&Object.assign(t,{hydrateFallbackElement:F.createElement(e.HydrateFallback),HydrateFallback:void 0}),e.ErrorBoundary&&Object.assign(t,{errorElement:F.createElement(e.ErrorBoundary),ErrorBoundary:void 0}),t}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ps(){return Ps=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ps.apply(this,arguments)}function j_(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,i;for(i=0;i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function V_(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function H_(e,t){return e.button===0&&(!t||t==="_self")&&!V_(e)}const G_=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],K_="6";try{window.__reactRouterVersion=K_}catch{}function q_(e,t){return o_({basename:t==null?void 0:t.basename,future:Ps({},t==null?void 0:t.future,{v7_prependBasename:!0}),history:IC({window:t==null?void 0:t.window}),hydrationData:(t==null?void 0:t.hydrationData)||X_(),routes:e,mapRouteProperties:U_,unstable_dataStrategy:t==null?void 0:t.unstable_dataStrategy,unstable_patchRoutesOnNavigation:t==null?void 0:t.unstable_patchRoutesOnNavigation,window:t==null?void 0:t.window}).initialize()}function X_(){var e;let t=(e=window)==null?void 0:e.__staticRouterHydrationData;return t&&t.errors&&(t=Ps({},t,{errors:Y_(t.errors)})),t}function Y_(e){if(!e)return null;let t=Object.entries(e),n={};for(let[r,o]of t)if(o&&o.__type==="RouteErrorResponse")n[r]=new Al(o.status,o.statusText,o.data,o.internal===!0);else if(o&&o.__type==="Error"){if(o.__subType){let i=window[o.__subType];if(typeof i=="function")try{let a=new i(o.message);a.stack="",n[r]=a}catch{}}if(n[r]==null){let i=new Error(o.message);i.stack="",n[r]=i}}else n[r]=o;return n}const Q_=F.createContext({isTransitioning:!1}),J_=F.createContext(new Map),Z_="startTransition",vg=v2[Z_],eS="flushSync",mg=RC[eS];function tS(e){vg?vg(e):e()}function Ua(e){mg?mg(e):e()}class nS{constructor(){this.status="pending",this.promise=new Promise((t,n)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",t(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",n(r))}})}}function rS(e){let{fallbackElement:t,router:n,future:r}=e,[o,i]=F.useState(n.state),[a,s]=F.useState(),[u,l]=F.useState({isTransitioning:!1}),[c,f]=F.useState(),[d,h]=F.useState(),[p,m]=F.useState(),g=F.useRef(new Map),{v7_startTransition:v}=r||{},y=F.useCallback(E=>{v?tS(E):E()},[v]),x=F.useCallback((E,k)=>{let{deletedFetchers:_,unstable_flushSync:T,unstable_viewTransitionOpts:D}=k;_.forEach(W=>g.current.delete(W)),E.fetchers.forEach((W,V)=>{W.data!==void 0&&g.current.set(V,W.data)});let z=n.window==null||n.window.document==null||typeof n.window.document.startViewTransition!="function";if(!D||z){T?Ua(()=>i(E)):y(()=>i(E));return}if(T){Ua(()=>{d&&(c&&c.resolve(),d.skipTransition()),l({isTransitioning:!0,flushSync:!0,currentLocation:D.currentLocation,nextLocation:D.nextLocation})});let W=n.window.document.startViewTransition(()=>{Ua(()=>i(E))});W.finished.finally(()=>{Ua(()=>{f(void 0),h(void 0),s(void 0),l({isTransitioning:!1})})}),Ua(()=>h(W));return}d?(c&&c.resolve(),d.skipTransition(),m({state:E,currentLocation:D.currentLocation,nextLocation:D.nextLocation})):(s(E),l({isTransitioning:!0,flushSync:!1,currentLocation:D.currentLocation,nextLocation:D.nextLocation}))},[n.window,d,c,g,y]);F.useLayoutEffect(()=>n.subscribe(x),[n,x]),F.useEffect(()=>{u.isTransitioning&&!u.flushSync&&f(new nS)},[u]),F.useEffect(()=>{if(c&&a&&n.window){let E=a,k=c.promise,_=n.window.document.startViewTransition(async()=>{y(()=>i(E)),await k});_.finished.finally(()=>{f(void 0),h(void 0),s(void 0),l({isTransitioning:!1})}),h(_)}},[y,a,c,n.window]),F.useEffect(()=>{c&&a&&o.location.key===a.location.key&&c.resolve()},[c,d,o.location,a]),F.useEffect(()=>{!u.isTransitioning&&p&&(s(p.state),l({isTransitioning:!0,flushSync:!1,currentLocation:p.currentLocation,nextLocation:p.nextLocation}),m(void 0))},[u.isTransitioning,p]),F.useEffect(()=>{},[]);let w=F.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:E=>n.navigate(E),push:(E,k,_)=>n.navigate(E,{state:k,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(E,k,_)=>n.navigate(E,{replace:!0,state:k,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[n]),b=n.basename||"/",C=F.useMemo(()=>({router:n,navigator:w,static:!1,basename:b}),[n,w,b]),S=F.useMemo(()=>({v7_relativeSplatPath:n.future.v7_relativeSplatPath}),[n.future.v7_relativeSplatPath]);return F.createElement(F.Fragment,null,F.createElement(Rc.Provider,{value:C},F.createElement(q1.Provider,{value:o},F.createElement(J_.Provider,{value:g.current},F.createElement(Q_.Provider,{value:u},F.createElement(z_,{basename:b,location:o.location,navigationType:o.historyAction,navigator:w,future:S},o.initialized||n.future.v7_partialHydration?F.createElement(oS,{routes:n.routes,future:n.future,state:o}):t))))),null)}const oS=F.memo(iS);function iS(e){let{routes:t,future:n,state:r}=e;return T_(t,void 0,r,n)}const aS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",sS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Jd=F.forwardRef(function(t,n){let{onClick:r,relative:o,reloadDocument:i,replace:a,state:s,target:u,to:l,preventScrollReset:c,unstable_viewTransition:f}=t,d=j_(t,G_),{basename:h}=F.useContext(Lo),p,m=!1;if(typeof l=="string"&&sS.test(l)&&(p=l,aS))try{let x=new URL(window.location.href),w=l.startsWith("//")?new URL(x.protocol+l):new URL(l),b=Ca(w.pathname,h);w.origin===x.origin&&b!=null?l=b+w.search+w.hash:m=!0}catch{}let g=R_(l,{relative:o}),v=uS(l,{replace:a,state:s,target:u,preventScrollReset:c,relative:o,unstable_viewTransition:f});function y(x){r&&r(x),x.defaultPrevented||v(x)}return F.createElement("a",Ps({},d,{href:p||g,onClick:m||i?r:y,ref:n,target:u}))});var gg;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(gg||(gg={}));var yg;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(yg||(yg={}));function uS(e,t){let{target:n,replace:r,state:o,preventScrollReset:i,relative:a,unstable_viewTransition:s}=t===void 0?{}:t,u=Ic(),l=Sa(),c=Q1(e,{relative:a});return F.useCallback(f=>{if(H_(f,n)){f.preventDefault();let d=r!==void 0?r:vi(l)===vi(c);u(e,{replace:d,state:o,preventScrollReset:i,relative:a,unstable_viewTransition:s})}},[l,u,c,r,o,n,e,i,a,s])}function lS(){return J.jsx("div",{className:"bg-white py-40 md:pt-60 md:pb-24",children:J.jsx("div",{className:"mx-auto max-w-7xl",children:J.jsxs("div",{className:"text-center mb-24",children:[J.jsx("h1",{className:"block text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl",children:"Welcome To"}),J.jsx("h1",{className:"block text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-indigo-900",children:"Biometric FACE-VOICE Auth"}),J.jsx("p",{className:"mt-8 text-md text-gray-600 max-w-3xl mx-4 md:mx-16 lg:mx-auto",children:"The Facial Recognition-Based Authentication Application is a cutting-edge web application developed using React and face-api.js. The main objective of the application is to offer a reliable and efficient authentication system by analyzing and verifying the user's facial features."}),J.jsxs(Jd,{to:"/user-select",className:"flex gap-2 mt-12 w-fit mx-auto cursor-pointer z-10 py-3 px-6 rounded-full bg-gradient-to-r from-indigo-300 to-indigo-500",children:[J.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:[J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),J.jsx("span",{className:"text-white",children:"Log In"})]})]})})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ex=function(e,t){return(ex=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])})(e,t)};function ir(e,t){function n(){this.constructor=e}ex(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function se(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(l){try{u(r.next(l))}catch(c){i(c)}}function s(l){try{u(r.throw(l))}catch(c){i(c)}}function u(l){l.done?o(l.value):new n(function(c){c(l.value)}).then(a,s)}u((r=r.apply(e,[])).next())})}function ue(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(f){c=[6,f],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var cS=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,o=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return fS(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0],u=a[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},e}();function fS(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function H(){return tx}var tx=null,Ol=new Map,Zd=new Map;function nx(e,t){var n=ox(e,t);return Ol.get(n)}function dS(e){return Zd.get(e)}function xg(e){for(var t=Ol.entries(),n=[];;){var r=t.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&n.push(s)}return n}function rx(e){var t=e.kernelName,n=e.backendName,r=ox(t,n);if(Ol.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Ol.set(r,e)}function hS(e){var t=e.kernelName;Zd.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Zd.set(t,e)}function ox(e,t){return t+"_"+e}function eh(e,t,n){return Math.max(e,Math.min(t,n))}function ix(e){return e%2==0?e:e+1}function pS(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function I(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Ue(e,t,n){n===void 0&&(n=""),I(Pt(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function ka(e){I(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function ma(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||br(e)&&!n)for(var r=0;r<e.length;++r)ma(e[r],t,n);else t.push(e);return t}function le(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Pt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ht(e){return e%1==0}function vS(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function th(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ta(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function wg(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=t(i);n!=null&&i>=n?o():setTimeout(a,s)}};a()})}function mS(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function kt(e,t){var n=t.length;return I((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),I(e.every(function(r){return ht(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function Jo(e,t){for(var n=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||o?null:kt(t,e).sort(),a=0,s=0;s<e.length;++s){if(i!=null){if(i[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(i[a]==null||i[a]>s)&&e[s]===1&&(n.push(e[s]),r.push(s)),i[a]<=s&&a++}e[s]!==1&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function As(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Ll(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function gS(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function yS(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function xS(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function br(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function ax(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function wS(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function Sp(e){return typeof e=="string"||e instanceof String}function bS(e){return typeof e=="boolean"}function ES(e){return typeof e=="number"}function Ks(e){return Array.isArray(e)?Ks(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":ES(e)?"float32":Sp(e)?"string":bS(e)?"bool":"float32"}function nh(e){return!!(e&&e.constructor&&e.call&&e.apply)}function rh(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Er(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function sx(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ma(e)),n&&gS(e,t),function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function bg(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,o){return r*o});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],l=0;l<u;l++)s[l]=a[o+l];else{u=i[0];var c=i.slice(1),f=c.reduce(function(d,h){return d*h});for(l=0;l<u;l++)s[l]=r(o+l*f,c,a)}return s}(0,e,t)}function ux(e,t){for(var n=qs(e,t),r=0;r<n.length;r++)n[r]=1;return n}function qs(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function pr(){return H().platform.now()}function lx(e){e.forEach(function(t){I(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function CS(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",H().platform.encode(e,t)}function Bl(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",H().platform.decode(e,t)}function Eg(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function _S(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}var SS=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new kS)}return e.prototype.profileKernel=function(t,n,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(l,c,f){if(c!=="float32")return!1;for(var d=0;d<l.length;d++){var h=l[d];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+f+"'"),!0}})(u,s.dtype,t),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),i.logger.logKernelProfile(t,s,u,l.kernelMs,n,c)})})}),o},e}(),kS=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,i,a){var s=typeof o=="number"?ta(o+"ms",9):o.error,u=ta(t,25),l=n.rank,c=n.size,f=ta(n.shape.toString(),14),d="";for(var h in i){var p=i[h].shape||n.shape,m=p.length;d+=h+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),Cg=20,ja=3,kf=7;function RS(e,t,n,r){var o=Er(t),i=function(l,c,f,d){var h=le(c),p=d[d.length-1],m=new Array(p).fill(0),g=c.length,v=f==="complex64"?Ha(l):l;if(g>1)for(var y=0;y<h/p;y++)for(var x=y*p,w=0;w<p;w++)m[w]=Math.max(m[w],Va(v[x+w],0,f).length);return m}(e,t,n,o),a=t.length,s=function l(c,f,d,h,p,m){m===void 0&&(m=!0);var g=d==="complex64"?2:1,v=f[0],y=f.length;if(y===0)return d==="complex64"?[Va(Ha(c)[0],0,d)]:d==="bool"?[cx(c[0])]:[c[0].toString()];if(y===1){if(v>Cg){var x=ja*g,w=Array.from(c.slice(0,x)),b=Array.from(c.slice((v-ja)*g,v*g));return d==="complex64"&&(w=Ha(w),b=Ha(b)),["["+w.map(function(V,K){return Va(V,p[K],d)}).join(", ")+", ..., "+b.map(function(V,K){return Va(V,p[v-ja+K],d)}).join(", ")+"]"]}return["["+(d==="complex64"?Ha(c):Array.from(c)).map(function(V,K){return Va(V,p[K],d)}).join(", ")+"]"]}var C=f.slice(1),S=h.slice(1),E=h[0]*g,k=[];if(v>Cg){for(var _=0;_<ja;_++){var T=(D=_*E)+E;k.push.apply(k,l(c.slice(D,T),C,d,S,p,!1))}for(k.push("..."),_=v-ja;_<v;_++)T=(D=_*E)+E,k.push.apply(k,l(c.slice(D,T),C,d,S,p,_===v-1))}else for(_=0;_<v;_++){var D;T=(D=_*E)+E,k.push.apply(k,l(c.slice(D,T),C,d,S,p,_===v-1))}var z=y===2?",":"";for(k[0]="["+k[0]+z,_=1;_<k.length-1;_++)k[_]=" "+k[_]+z;var W=`,
`;for(_=2;_<y;_++)W+=`
`;return k[k.length-1]=" "+k[k.length-1]+"]"+(m?"":W),k}(e,t,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Va(e,t,n){return ta(Array.isArray(e)?parseFloat(e[0].toFixed(kf))+" + "+parseFloat(e[1].toFixed(kf))+"j":Sp(e)?"'"+e+"'":n==="bool"?cx(e):parseFloat(e.toFixed(kf)).toString(),t)}function cx(e){return e===0?"false":"true"}function Ha(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Fs=function(){function e(t,n,r){var o=this;if(this.dtype=n,this.shape=t.slice(),this.size=le(t),r!=null){var i=r.length;I(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ll(n,this.size),this.strides=Er(t)}return e.prototype.set=function(t){for(var n=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),I(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var i=this.locToIndex(r);this.values[i]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,o=0,i=t;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return mr().makeTensor(this.values,this.shape,this.dtype)},e}(),mr=null,j=null,fx=null,rt=function(){function e(t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=le(t),this.strides=Er(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),I(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,i){return this.throwIfDisposed(),this.reshape([t,n,r,o,i])},e.prototype.asType=function(t){return this.throwIfDisposed(),j.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,j.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return j.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,bg(this.shape,t)]}})})},e.prototype.arraySync=function(){return bg(this.shape,this.dataSync())},e.prototype.data=function(){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=mr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(o){return Bl(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=mr().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return Bl(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,mr().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(mr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),j.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),j.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),j.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),j.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),j.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),j.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),j.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),RS(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),j.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),j.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),j.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),j.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),j.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),j.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),j.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),j.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),j.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),j.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),j.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),j.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,i){return r===void 0&&(r=.001),fx("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,i,o,r)},e.prototype.batchNorm=function(t,n,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),j.batchNorm(this,t,n,r,o,i)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),j.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),j.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),j.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),j.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),j.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),j.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),j.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),j.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),j.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),j.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),j.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),j.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),j.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),j.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),j.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),j.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),j.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),j.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),j.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),j.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),j.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),j.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),j.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),j.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),j.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),j.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),j.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),j.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),j.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),j.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),j.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),j.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),j.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),j.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),j.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),j.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),j.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),j.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),j.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),j.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),j.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),j.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),j.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),j.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),j.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),j.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),j.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),j.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),j.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),j.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),j.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),j.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),j.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),j.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),j.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),j.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),j.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),j.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),j.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),j.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),j.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),j.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),j.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),j.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),j.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),j.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),j.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),j.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),j.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),j.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),j.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),j.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),j.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),j.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),j.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),j.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),j.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),j.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),j.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),j.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),j.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),j.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),j.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),j.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),j.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),j.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),j.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),j.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),j.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),j.conv1d(this,t,n,r,o,i,a)},e.prototype.conv2d=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),j.conv2d(this,t,n,r,o,i,a)},e.prototype.conv2dTranspose=function(t,n,r,o,i){return this.throwIfDisposed(),j.conv2dTranspose(this,t,n,r,o,i)},e.prototype.depthwiseConv2D=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),j.depthwiseConv2d(this,t,n,r,o,i,a)},e.prototype.separableConv2d=function(t,n,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),j.separableConv2d(this,t,n,r,o,i,a)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),j.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),j.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),j.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,i){return this.throwIfDisposed(),j.pool(this,t,n,r,o,i)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),mr().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),j.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),j.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),j.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),j.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),j.stridedSlice(this,t,n,r,o,i,a,s,u)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),j.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),j.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),j.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),j.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),j.spectral.irfft(this)},e}();Object.defineProperty(rt,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var _g,oh,ih,ah,sh,ga=function(e){function t(n,r,o,i){var a=e.call(this,n.shape,n.dtype,n.dataId,i)||this;return a.trainable=r,a.name=o,a}return ir(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!Pt(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");mr().disposeTensor(this),this.dataId=n.dataId,mr().incRef(this,null)},t.prototype.dispose=function(){mr().disposeVariable(this),this.isDisposedInternal=!0},t}(rt);Object.defineProperty(ga,Symbol.hasInstance,{value:function(e){return e instanceof rt&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(_g||(_g={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(oh||(oh={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ih||(ih={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ah||(ah={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(sh||(sh={}));var IS={float32:ah,int32:oh,bool:ih,complex64:sh};function Ot(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return IS[e][t]}function Rf(e){return Ot(e,"int32")}function st(e,t){if(e.dtype===t.dtype)return[e,t];var n=Ot(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function TS(e,t){I(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function dx(e){var t=[];return function n(r,o,i){if(r!=null){if(r instanceof rt)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];i.has(l)||(i.add(l),n(l,o,i))}}}}(e,t,new Set),t}var If,Sg=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),DS=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Sg}return e.prototype.ready=function(){return se(this,void 0,void 0,function(){var t,n,r;return ue(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,o.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return se(this,void 0,void 0,function(){var n,r,o;return ue(this,function(i){switch(i.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new SS(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;xg(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;xg(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<n.pendingBackendInitId)&&(n.registry[t]=s,n.pendingBackendInit=null,!0)}).catch(function(s){return!(i<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),o=r.backend,i=this.readSync(n);o.disposeData(n),r.backend=t,t.move(n,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,o=this,i=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(i){throw n(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(o){return{x:function(){return o.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,o,i){return this.runKernelFunc(null,n,null,t,r,o,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-n-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,o,i,a,s){var u,l=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var c=[],f=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var d,h=function(y){f&&(c=y.map(function(x){return l.keep(l.clone(x))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=nx(o,this.backendName);return d=v!=null?function(){var y=l.backend.numDataIds();g=v.kernelFunc({inputs:n,attrs:i,backend:l.backend});var x=Array.isArray(g)?g:[g];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,y,x);var w=x.map(function(C){var S=C.dataId,E=C.shape,k=C.dtype;return l.makeTensorFromDataId(S,E,k)}),b=w.filter(function(C,S){return s[S]});return h((a||[]).slice().concat(b)),w}:function(){var y=l.backend.numDataIds();g=l.tidy(function(){return t(l.backend,h)});var x=Array.isArray(g)?g:[g];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,y,x),x},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,n,function(){return d()}):d()}),f&&this.addTapeNode(o,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(y){return n[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(g)?u:u[0]},e.prototype.makeTensor=function(t,n,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=t;r==="string"&&Sp(t[0])&&(i=t.map(function(c){return CS(c)}));var a=o.write(i,n,r),s=new rt(n,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),l=wS(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},e.prototype.makeTensorFromDataId=function(t,n,r,o){var i=new rt(n,r=r||"float32",t,this.nextTensorId());return this.incRef(i,o),i},e.prototype.makeVariable=function(t,n,r,o){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var i=new ga(t,n,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*ax(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof ga||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return se(this,void 0,void 0,function(){var n,r;return ue(this,function(o){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:i},u=dS(t);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(l){return l=l.map(function(c,f){if(c==null){var d=r[f],h=qs(d.size,d.dtype);return a.makeTensor(h,d.shape,d.dtype)}return c}),o(l.length>1?l:l[0],i)}),this.state.activeTape.push(s)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=dx(t),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||n.track(u)})},e.prototype.gradients=function(t,n,r,o){var i=this;if(o===void 0&&(o=!1),I(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});I(a instanceof rt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var f={},d={},h=0;h<l.length;h++)f[l[h].id]=!0;for(h=0;h<u.length;h++){var p=(C=u[h]).inputs;for(var m in p){for(var g=p[m],v=!1,y=0;y<l.length;y++)if(f[g.id]){C.outputs.forEach(function(_){return f[_.id]=!0}),v=!0,d[C.id]=!0;break}if(v)break}}var x={};x[c.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(p=(C=u[h]).inputs,y=0;y<C.outputs.length;y++)if(x[C.outputs[y].id]){for(var m in p)x[p[m].id]=!0,w[C.id]=!0;break}var b=[];for(h=0;h<u.length;h++){var C;if(d[(C=u[h]).id]&&w[C.id]){var S={};for(var m in C.inputs){var E=C.inputs[m];f[E.id]&&(S[m]=E)}var k=Object.assign({},C);k.inputs=S,k.outputs=C.outputs,b.push(k)}}return b}(this.state.activeTape,n,a);if(!o&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=ux(le(u),"float32"),M.makeTensor(l,u,"float32")),function(d,h,p){for(var m=function(v){var y=h[v],x=[];if(y.outputs.forEach(function(S){var E=d[S.id];E!=null?x.push(E):x.push(null)}),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var w=y.gradient(x),b=function(S){if(!(S in w))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(w)+".");var E=p(function(){return w[S]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+E.dtype+"'");var k=y.inputs[S];if(!Pt(E.shape,k.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+S+"' has shape '"+E.shape+"', which does not match the shape of the input '"+k.shape+"'");if(d[k.id]==null)d[k.id]=E;else{var _=d[k.id];d[k.id]=_.add(E),_.dispose()}};for(var C in y.inputs)b(C)},g=h.length-1;g>=0;g--)m(g)}(c,s,function(d){return i.tidy(d)});var f=n.map(function(d){return c[d.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(d){for(var h=0,p=d.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:f}})},e.prototype.customGrad=function(t){var n=this;return I(nh(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];I(o.every(function(s){return s instanceof rt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),n.runKernelFunc(function(s,u){return I((r=t.apply(void 0,o.concat([u]))).value instanceof rt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I(nh(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];I(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I(c.every(function(d){return d instanceof rt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var f={};return c.forEach(function(d,h){f[h]=function(){return d}}),f})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return se(this,void 0,void 0,function(){var n,r;return ue(this,function(o){switch(o.label){case 0:return n=pr(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=pr()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Sg,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),M=function(){var e=function(){if(If==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}If=n}return If}();if(e._tfengine==null){var t=new cS(e);e._tfengine=new DS(t)}return function(n){tx=n}(e._tfengine.ENV),mr=function(){return e._tfengine},e._tfengine}();function hx(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Pr=H();Pr.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Pr.registerFlag("IS_BROWSER",function(){return hx()}),Pr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Pr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Pr.registerFlag("PROD",function(){return!1}),Pr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Pr.getBool("DEBUG")}),Pr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Pr.registerFlag("IS_TEST",function(){return!1});var Ms,bn,xn,Ko={},Tf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function NS(e,t){Ko[e]=t}function kr(e){e in Ko||(Ko[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete Ko[n]},!1),n===1?r.getContext("webgl",Tf)||r.getContext("experimental-webgl",Tf):r.getContext("webgl2",Tf)}(e));var t=Ko[e];return t.isContextLost()?(delete Ko[e],kr(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ko[e])}function Tc(e,t){return[t,e]}function ls(e){var t=le(e);return th(Math.ceil(t/4))}function Xs(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function kp(e,t){var n,r,o,i,a,s,u,l,c,f=e;return H().getNumber("WEBGL_VERSION")===2?(n=f.R32F,r=f.R16F,o=f.RGBA16F,i=f.RGBA32F,a=f.RED,s=4,u=1,l=f.HALF_FLOAT,c=f.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,i=f.RGBA,a=e.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function de(e,t,n){var r=n();return t&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+MS(o,i))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Ms||(Ms={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(bn||(bn={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(xn||(xn={}));var PS=596e-10,AS=65504;function FS(e){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||PS<Math.abs(e)&&Math.abs(e)<AS)}function MS(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Mu(e,t,n){return qr(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function OS(e,t,n){var r=qr(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(de(e,t,function(){return e.shaderSource(r,n)}),de(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function LS(e,t,n){var r=qr(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(de(e,t,function(){return e.shaderSource(r,n)}),de(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(o,i){var a=BS.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,v){return ta((v+1).toString(),l)+g}),f=0,d=0;d<c.length;d++)f=Math.max(c[d].length,f);var h=c.slice(0,s-1),p=c.slice(s-1,s),m=c.slice(s);console.log(h.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+ta(p[0],f),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Df,Nf,BS=/ERROR: [0-9]+:([0-9]+):/g;function WS(e,t){return qr(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function $S(e,t,n){if(de(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Pf(e,t,n){if(de(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function zS(e,t,n){var r=qr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return de(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),de(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function US(e,t,n){var r=qr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return de(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),de(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function jS(e,t){return qr(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function VS(e,t){var n=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function HS(e,t){return qr(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function kg(e,t,n,r,o,i,a,s){var u=e.getAttribLocation(n,r);return u!==-1&&(de(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),de(e,t,function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)}),de(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function GS(e,t,n,r){QS(e,r),de(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function KS(e,t,n,r){return qr(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function qS(e,t,n){return e.getUniformLocation(t,n)}function XS(e,t,n,r,o,i){de(e,t,function(){return GS(e,t,r,i)}),de(e,t,function(){return e.uniform1i(o,i)})}function Af(e,t,n,r){de(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),de(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function Rg(e,t,n){de(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),de(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Ou(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+YS(e,t))}function YS(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function qr(e,t,n,r){var o=de(e,t,function(){return n()});if(o==null)throw new Error(r);return o}function QS(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Wl(e,t){return t===void 0&&(t=2),le(e.slice(0,e.length-t))}function $l(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ff(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[Wl(e)].concat($l(e))),t}function JS(e,t){var n;t===void 0&&(t=!1);var r=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(l,c){return c>=e.length-2?ix(e[c]):e[c]})).length===1&&(e=[2,e[0]])),e.length!==2){var o=Jo(e);e=o.newShape}var i=le(e);if(e.length<=1&&i<=r)return[1,i];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var a=Wl(e),s=2,u=2;return e.length&&(s=(n=$l(e))[0],u=n[1]),th(i=a*(s/2)*(u/2)).map(function(l){return 2*l})}return th(i)}function Lu(e){return e%2==0}function Bu(e,t){if(Pt(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Lu(n)&&Lu(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Lu(e[0])&&Lu(t[0])}function ZS(e){if(Df==null){var t=kr(e);Df=t.getParameter(t.MAX_TEXTURE_SIZE)}return Df}function ek(e){if(Nf==null){var t=kr(e);Nf=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Nf)}function tk(e){if(e===0)return 0;var t=kr(e);return Wn(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:Wn(t,"EXT_disjoint_timer_query")?1:0}function Wn(e,t){return e.getExtension(t)!=null}function Ig(e){try{if(kr(e)!=null)return!0}catch{return!1}return!1}function nk(e){if(e===0)return!1;var t=kr(e);if(e===1){if(!Wn(t,"OES_texture_float"))return!1}else if(!Wn(t,"EXT_color_buffer_float"))return!1;return uh(t)}function rk(e){if(e===0)return!1;var t=kr(e);if(e!==1){if(Wn(t,"EXT_color_buffer_float"))return uh(t);if(Wn(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=kp(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(t,n)}return!1}return!!Wn(t,"OES_texture_float")&&!!Wn(t,"WEBGL_color_buffer_float")&&uh(t)}function uh(e){var t=kp(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function ok(e){return e===2&&kr(e).fenceSync!=null}var we=H();function px(e){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function oe(e,t){return M.tidy(e,t)}function fn(e){dx(e).forEach(function(t){return t.dispose()})}function ik(e){return M.keep(e)}function zl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];H().getBool("IS_TEST")||console.warn.apply(console,e)}function Wo(e,t){var n=e;if(br(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||br(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!br(i))return void I(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});I(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),I(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),l=0;l<i.length;++l)o(i[l],u,s.concat(l))}(e,r,[]),r}function Tg(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function R(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof rt)return Tg(r,e.dtype,t,n),e;var o=Ks(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Tg(r,o,t,n),e==null||!br(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var i=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Wo(e,o);br(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?sx(e,o,H().getBool("DEBUG")):ma(e,[],!0);return M.makeTensor(s,a,o)}function Ul(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(o,i){return R(o,t+"["+i+"]",n)},r)}function vx(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ak(e,t,n){for(var r=e.length+t.length,o=[],i=0,a=0,s=0;s<r;s++)n.indexOf(s)===-1?o.push(e[i++]):o.push(t[a++]);return o}function jt(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(i){return e[i]})]}function dn(e,t){return ak(e,t.map(function(n){return 1}),t)}function yn(e,t,n){I(vx(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function Rr(e,t){if(vx(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function Rp(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function Ir(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function sk(e,t){var n=e[0].length;e.forEach(function(o,i){I(o.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+n+")"})}),I(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(o,i){for(var a=0;a<n;a++)I(a===t||o[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function ya(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function P(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];M.startScope(n);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),M.endScope(s),s}catch(u){throw M.endScope(null),u}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}we.registerFlag("HAS_WEBGL",function(){return we.getNumber("WEBGL_VERSION")>0}),we.registerFlag("WEBGL_VERSION",function(){return Ig(2)?2:Ig(1)?1:0}),we.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return we.get("WEBGL_VERSION")===2}),we.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),we.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),we.registerFlag("WEBGL_PACK",function(){return we.getBool("HAS_WEBGL")}),we.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_CLIP",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),we.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_PACK_REDUCE",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_LAZILY_UNPACK",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_CONV_IM2COL",function(){return we.getBool("WEBGL_PACK")}),we.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ZS(we.getNumber("WEBGL_VERSION"))}),we.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return ek(we.getNumber("WEBGL_VERSION"))}),we.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=we.getNumber("WEBGL_VERSION");return e===0?0:tk(e)}),we.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return we.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),we.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return nk(we.getNumber("WEBGL_VERSION"))}),we.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!we.getBool("WEBGL_FORCE_F16_TEXTURES")&&we.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),we.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return rk(we.getNumber("WEBGL_VERSION"))}),we.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ok(we.getNumber("WEBGL_VERSION"))}),we.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return we.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),fx=px;var Mt=P({complex_:function(e,t){var n=R(e,"real","complex"),r=R(t,"imag","complex");return Ue(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),M.runKernelFunc(function(o){return o.complex(n,r)},{$real:n,$imag:r})}}),Ln=P({real_:function(e){var t=R(e,"input","real");return M.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),gr=P({imag_:function(e){var t=R(e,"input","imag");return M.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function Lt(e,t,n){return $o(e,t,Wo(e,n),n)}function $o(e,t,n,r){if(r==null&&(r=Ks(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!br(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){lx(t);var o=le(t),i=le(n);I(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==le(t.slice(a));I(n[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return br(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?sx(e,r,H().getBool("DEBUG")):ma(e,[],!0),M.makeTensor(e,t,r)}function te(e,t){if((br(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&br(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return $o(e,[],[],t)}function yt(e,t){ka(e);var n=Wo(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return $o(e,null,n,t)}function Ro(e,t,n){if(ka(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Wo(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return $o(e,t,r,n)}function Ip(e,t,n){if(ka(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Wo(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return $o(e,t,r,n)}function on(e,t,n){if(ka(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Wo(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return $o(e,t,r,n)}function uk(e,t,n){if(ka(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Wo(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return $o(e,t,r,n)}function lk(e,t,n){if(ka(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Wo(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return $o(e,t=t||r,r,n)}function ck(e,t,n,r){return t===void 0&&(t=!0),M.makeVariable(e,t,n,r)}function Ra(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Ra(e,"float32"),r=Je(e,"float32");return Mt(n,r)}var o=ux(le(e),t);return M.makeTensor(o,e,t)}function Je(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Je(e,"float32"),r=Je(e,"float32");return Mt(n,r)}var o=qs(le(e),t);return M.makeTensor(o,e,t)}function Cr(e,t,n){return M.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function fk(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return M.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function jl(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Je([0],r);var o=qs(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return yt(o,r)}var mx=P({onesLike_:function(e){var t=R(e,"x","onesLike");if(t.dtype==="complex64"){var n=mx(Ln(t)),r=Fe(gr(t));return Mt(n,r)}return M.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,i){return{$x:function(){return Fe(o)}}})}}),Fe=P({zerosLike_:function(e){var t=R(e,"x","zerosLike");return M.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return Fe(n)}}})}}),Et=P({concat_:function(e,t){t===void 0&&(t=0),I(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=Ul(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=kt(t,n[0].shape)[0];var r=ya(n.map(function(s){return s.shape}),t);if(le(r)===0)return Lt([],r);if((n=n.filter(function(s){return s.size>0})).length===1)return n[0];var o=n.map(function(s){return s.shape});sk(o,t);var i=n,a={axis:t};return M.runKernelFunc(function(s){return s.concat(n,t)},i,function(s){var u=o.map(function(l){return l[t]});return Tp(s,u,t).map(function(l){return function(){return l}})},"Concat",a)}}),dk=P({concat1d_:function(e){return Et(e,0)}}),hk=P({concat2d_:function(e,t){return Et(e,t)}}),pk=P({concat3d_:function(e,t){return Et(e,t)}}),vk=P({concat4d_:function(e,t){return Et(e,t)}}),Tp=P({split_:function(e,t,n){n===void 0&&(n=0);var r,o=R(e,"x","split");return n=kt(n,o.shape)[0],typeof t=="number"?(I(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(I(o.shape[n]===t.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),M.runKernelFunc(function(i){return i.split(o,r,n)},{$x:o},function(i){return{$x:function(){return Et(i,n)}}})}});function wi(e,t){return e(t={exports:{}},t.exports),t.exports}var mk=wi(function(e){(function(t,n,r){function o(s){var u,l=this,c=(u=4022871197,function(f){f=f.toString();for(var d=0;d<f.length;d++){var h=.02519603282416938*(u+=f.charCodeAt(d));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var f=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=0|f)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new o(s),c=u&&u.state,f=l.next;return f.int32=function(){return 4294967296*l.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.alea=a})(0,e)}),gk=wi(function(e){(function(t,n,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new o(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.xor128=a})(0,e)}),yk=wi(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^f^f<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.xorwow=a})(0,e)}),xk=wi(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,f=u.x,d=u.i;return l=f[d],c=(l^=l>>>7)^l<<24,c^=(l=f[d+1&7])^l>>>10,c^=(l=f[d+3&7])^l>>>3,c^=(l=f[d+4&7])^l<<7,l=f[d+7&7],c^=(l^=l<<13)^l<<9,f[d]=c,u.i=d+1&7,c},function(l,c){var f,d=[];if(c===(0|c))d[0]=c;else for(c=""+c,f=0;f<c.length;++f)d[7&f]=d[7&f]<<15^c.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],l.x=d,l.i=0,f=256;f>0;--f)l.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.xorshift7=a})(0,e)}),wk=wi(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,f=u.w,d=u.X,h=u.i;return u.w=f=f+1640531527|0,c=d[h+34&127],l=d[h=h+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=d[h]=c^l,u.i=h,c+(f^f>>>16)|0},function(l,c){var f,d,h,p,m,g=[],v=128;for(c===(0|c)?(d=c,c=null):(c+="\0",d=0,v=Math.max(v,c.length)),h=0,p=-32;p<v;++p)c&&(d^=c.charCodeAt((p+32)%c.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,h=(f=g[127&p]^=d+m)==0?h+1:0);for(h>=128&&(g[127&(c&&c.length||0)]=-1),h=127,p=512;p>0;--p)d=g[h+34&127],f=g[h=h+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,g[h]=d^f;l.w=m,l.X=g,l.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.xor4096=a})(0,e)}),bk=wi(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var f=u.b,d=u.c,h=u.d,p=u.a;return f=f<<25^f>>>7^d,d=d-h|0,h=h<<24^h>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^d,u.c=d=d-h|0,u.d=h<<16^d>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}n&&n.exports?n.exports=a:this.tychei=a})(0,e)}),qo=wi(function(e){(function(t,n){var r,o=this,i=256,a=6,s="random",u=n.pow(i,a),l=n.pow(2,52),c=2*l,f=i-1;function d(v,y,x){var w=[],b=m(function E(k,_){var T,D=[],z=typeof k;if(_&&z=="object")for(T in k)try{D.push(E(k[T],_-1))}catch{}return D.length?D:z=="string"?k:k+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[v,g(t)]:v??function(){try{var E;return r&&(E=r.randomBytes)?E=E(i):(E=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(E)),g(E)}catch{var k=o.navigator,_=k&&k.plugins;return[+new Date,o,_,o.screen,g(t)]}}(),3),w),C=new h(w),S=function(){for(var E=C.g(a),k=u,_=0;E<l;)E=(E+_)*i,k*=i,_=C.g(1);for(;E>=c;)E/=2,k/=2,_>>>=1;return(E+_)/k};return S.int32=function(){return 0|C.g(4)},S.quick=function(){return C.g(4)/4294967296},S.double=S,m(g(C.S),t),(y.pass||x||function(E,k,_,T){return T&&(T.S&&p(T,C),E.state=function(){return p(C,{})}),_?(n[s]=E,k):E})(S,b,"global"in y?y.global:this==n,y.state)}function h(v){var y,x=v.length,w=this,b=0,C=w.i=w.j=0,S=w.S=[];for(x||(v=[x++]);b<i;)S[b]=b++;for(b=0;b<i;b++)S[b]=S[C=f&C+v[b%x]+(y=S[b])],S[C]=y;(w.g=function(E){for(var k,_=0,T=w.i,D=w.j,z=w.S;E--;)k=z[T=f&T+1],_=_*i+z[f&(z[T]=z[D=f&D+k])+(z[D]=k)];return w.i=T,w.j=D,_})(i)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function m(v,y){for(var x,w=v+"",b=0;b<w.length;)y[f&b]=f&(x^=19*y[f&b])+w.charCodeAt(b++);return g(y)}function g(v){return String.fromCharCode.apply(0,v)}if(n["seed"+s]=d,m(n.random(),t),e.exports){e.exports=d;try{r=require("crypto")}catch{}}})([],Math)});qo.alea=mk,qo.xor128=gk,qo.xorwow=yk,qo.xorshift7=xk,qo.xor4096=wk,qo.tychei=bk;var Dc=qo.alea,Dp=function(){function e(t,n,r,o,i){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Dc(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),Ek=function(){function e(t,n,r,o){this.alpha=t,this.beta=1/n,this.dtype=r;var i=o||Math.random();this.randu=Dc(i.toString()),this.randn=new Dp(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,n=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-a+Math.log(a)),(i=this.randu())<n||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),Ck=function(){function e(t,n,r,o){var i=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=Dc(o)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Ce(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",lx(e),new Fs(e,t,n)}function _k(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var gx=P({batchToSpaceND_:function(e,t,n){var r=R(e,"x","batchToSpaceND"),o=t.reduce(function(i,a){return i*a});return I(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),I(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),I(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),M.runKernelFunc(function(i){return i.batchToSpaceND(r,t,n)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,n)}}})}}),Sk=P({broadcastTo_:function(e,t){var n=R(e,"broadcastTo","x"),r=n.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(t),a=t.length-1;a>=0;a--)if(n.shape[a]===t[a])i[a]=1;else if(n.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?n.clone():M.runKernelFunc(function(u){return u.tile(n,i)},{input:n},function(u){return{input:function(){return u.sum(s,!0)}}})}}),kk=P({cast_:function(e,t){var n=R(e,"x","cast");if(!yS(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return M.runKernelFunc(function(o){return o.cast(n,t)},{x:n},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),Rk=P({clone_:function(e){var t=R(e,"x","clone",null);return M.runKernelFunc(function(){return M.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),Ik=P({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=R(e,"x","cumsum"),i=Rr([t|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=Ir(1,o.rank)[0],u=M.runKernelFunc(function(l){return l.cumsum(a,s,n,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(t,n,!r)}}});return i!=null&&(u=u.transpose(i)),u}}),Tk=P({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=R(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],a=n==="NHWC"?r.shape[3]:r.shape[1];return I(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),I(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape}),I(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape}),M.runKernelFunc(function(s){return s.depthToSpace(r,t,n)},{$x:r})}}),Mn=P({expandDims_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","expandDims",null);I(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(I(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),er(n,r)}}),yx=P({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=Ce([e,t],r),i=e<=t?e:t,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,t);if(n==null)return s;if(n.length===1)return na(Mn(s,0),[n[0],1,1]);if(n.length===2)return na(Mn(Mn(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return na(Mn(Mn(Mn(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Dk=P({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var o=R(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=a===1?o.as2D(1,-1):o,u=M.runKernelFunc(function(l){return l.multinomial(s,r,t,n)},{logits2D:s});return a===1?u.as1D():u}}),lh=P({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=R(e,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),M.runKernelFunc(function(a){return a.oneHot(o,t,n,r)},{$indices:o},function(a){return{$indices:function(){return Je(o.shape,"float32")}}}).reshape(i)}}),bi=P({pad_:function(e,t,n){n===void 0&&(n=0);var r=R(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return M.runKernelFunc(function(i){return i.pad(r,t,n)},{x:r},function(i){var a=t.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",o)}}),Nk=P({pad1d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),bi(e,[t],n)}}),Pk=P({pad2d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),bi(e,t,n)}}),Ak=P({pad3d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),bi(e,t,n)}}),Fk=P({pad4d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),bi(e,t,n)}}),Mk=P({rand_:function(e,t,n){var r=le(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return M.makeTensor(o,e,n)}}),Ok=P({randomNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Dp(t,n,r,!1,o),a=Ce(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Lk=P({randomGamma_:function(e,t,n,r,o){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new Ek(t,n,r,o),a=Ce(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),xx=P({randomUniform_:function(e,t,n,r,o){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var i=Ce(e,r),a=new Ck(t,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),er=P({reshape_:function(e,t){var n=R(e,"x","reshape",null);t=mS(t,n.size),I(n.size===le(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return M.runKernelFunc(function(o){return o.reshape(n,t)},{x:n},function(o){return{x:function(){return o.reshape(n.shape)}}},"Reshape",r)}}),wx=P({spaceToBatchND_:function(e,t,n){var r=R(e,"x","spaceToBatchND");return I(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),I(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),I(r.shape.reduce(function(o,i,a){return a>0&&a<=t.length?o&&(i+n[a-1][0]+n[a-1][1])%t[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),M.runKernelFunc(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}}),bx=P({squeeze_:function(e,t){var n=R(e,"x","squeeze");return er(n,Jo(n.shape,t).newShape)}}),Sn=P({stack_:function(e,t){t===void 0&&(t=0);var n=Ul(e,"tensors","stack");if(I(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;I(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(s){Ue(o,s.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(s){I(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(s){return s.expandDims(t)});return Et(a,t)}}),na=P({tile_:function(e,t){var n=R(e,"x","tile",null);I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return M.runKernelFunc(function(i,a){var s=i.tile(n,t);return a([n]),s},{x:n},function(i,a){var s=a[0];return{x:function(){var u=Fe(s);if(s.rank===1)for(var l=0;l<t[0];++l)u=u.add(i.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(i.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var f=0;f<t[2];++f)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],f*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(f=0;f<t[2];++f)for(var d=0;d<t[3];++d)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],f*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,r)}}),Bk=P({truncatedNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Dp(t,n,r,!0,o),a=Ce(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Ct=P({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=R(e,"x","unstack");I(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return M.runKernelFunc(function(o){return o.unstack(n,t)},{x:n},function(o){return{x:function(){return Sn(o,t)}}},"Unpack",r)}}),Wk=function(e,t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,f;return ue(this,function(d){switch(d.label){case 0:return n=R(e,"x","setdiff1d"),r=R(t,"y","setdiff1d"),I(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),I(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),I(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new Fs([s],n.dtype),l=new Fs([s],"int32"),c=0,f=0;c<o.length;c++)a.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Vl(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,a=0;a<i;++a)o=o.concat([e[a+1]/t[a],t[a]]);o=o.concat(e.slice(i+1))}return o}function Hl(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Gl(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function Ex(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Cx(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function _x(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=e.shape,s=n.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var l=Er(e.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var Sx=30;function Mf(e){return e<=Sx?e:rh(e,Math.floor(Math.sqrt(e)))}function $k(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==t.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function zk(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}$k(n,t,e)}function Kl(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:le(t.shape)/u,sliceSize:a,strides:Er(n.slice(0,o)).concat([1]),outputSize:le(n)}}function Uk(e,t,n){I(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),I(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(i){I(t[i]+n[i]<=e.shape[i],function(){return"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+n[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")"})},o=0;o<e.rank;++o)r(o)}function Dg(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Np(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function jk(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=eh(0,i,s-1)}function Vk(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?eh(0,i,s):eh(-1,i,s-1)}function kx(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function Rx(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Hk(e,t){I(nh(e),function(){return"The f passed in variableGrads(f) must be a function"}),I(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof ga}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],M.registeredVariables)t.push(M.registeredVariables[r]);var o=n?t.filter(function(c){return!c.trainable}):null,i=t.length;I((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=M.gradients(e,t,null,!0),s=a.value,u=a.grads;I(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),I(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,f){u[f]!=null&&(l[c.name]=u[f])}),o!=null&&o.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Nc(e){return M.customGrad(e)}var Xr=P({softmax_:function(e,t){t===void 0&&(t=-1);var n=R(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return M.runKernelFunc(function(r,o){var i=r.softmax(n,t);return o([i]),i},{logits:n},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([t],!0).mul(i))}}},"Softmax",{dim:t},[],[!0])}}),Gk=P({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=R(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Nc(function(r,o){var i=r.max(t,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(n)}}),Ix=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),Tx=function(){function e(){}return e.prototype.time=function(t){return $("time")},e.prototype.read=function(t){return $("read")},e.prototype.readSync=function(t){return $("readSync")},e.prototype.numDataIds=function(){return $("numDataIds")},e.prototype.disposeData=function(t){return $("disposeData")},e.prototype.write=function(t,n,r){return $("write")},e.prototype.move=function(t,n,r,o){return $("move")},e.prototype.memory=function(){return $("memory")},e.prototype.floatPrecision=function(){return $("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,o){return $("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,$("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return $("slice")},e.prototype.stridedSlice=function(t,n,r,o){return $("stridedSlice")},e.prototype.unstack=function(t,n){return $("unstack")},e.prototype.reverse=function(t,n){return $("reverse")},e.prototype.concat=function(t,n){return $("concat")},e.prototype.neg=function(t){return $("neg")},e.prototype.add=function(t,n){return $("add")},e.prototype.addN=function(t){return $("addN")},e.prototype.subtract=function(t,n){return $("subtract")},e.prototype.multiply=function(t,n){return $("multiply")},e.prototype.realDivide=function(t,n){return $("realDivide")},e.prototype.floorDiv=function(t,n){return $("floorDiv")},e.prototype.sum=function(t,n){return $("sum")},e.prototype.prod=function(t,n){return $("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return $("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return $("argMin")},e.prototype.argMax=function(t,n){return $("argMax")},e.prototype.equal=function(t,n){return $("equal")},e.prototype.notEqual=function(t,n){return $("notEqual")},e.prototype.less=function(t,n){return $("less")},e.prototype.lessEqual=function(t,n){return $("lessEqual")},e.prototype.greater=function(t,n){return $("greater")},e.prototype.greaterEqual=function(t,n){return $("greaterEqual")},e.prototype.logicalNot=function(t){return $("logicalNot")},e.prototype.logicalAnd=function(t,n){return $("logicalAnd")},e.prototype.logicalOr=function(t,n){return $("logicalOr")},e.prototype.where=function(t){return $("where")},e.prototype.select=function(t,n,r){return $("select")},e.prototype.topk=function(t,n,r){return $("topk")},e.prototype.min=function(t,n){return $("min")},e.prototype.minimum=function(t,n){return $("minimum")},e.prototype.mod=function(t,n){return $("mod")},e.prototype.max=function(t,n){return $("max")},e.prototype.maximum=function(t,n){return $("maximum")},e.prototype.all=function(t,n){return $("all")},e.prototype.any=function(t,n){return $("any")},e.prototype.squaredDifference=function(t,n){return $("squaredDifference")},e.prototype.ceil=function(t){return $("ceil")},e.prototype.floor=function(t){return $("floor")},e.prototype.round=function(t){return $("round")},e.prototype.sign=function(t){return $("sign")},e.prototype.isNaN=function(t){return $("isNaN")},e.prototype.isInf=function(t){return $("isInf")},e.prototype.isFinite=function(t){return $("isFinite")},e.prototype.pow=function(t,n){return $("pow")},e.prototype.exp=function(t){return $("exp")},e.prototype.expm1=function(t){return $("expm1")},e.prototype.softmax=function(t,n){return $("softmax")},e.prototype.log=function(t){return $("log")},e.prototype.log1p=function(t){return $("log1p")},e.prototype.sqrt=function(t){return $("sqrt")},e.prototype.rsqrt=function(t){return $("rsqrt")},e.prototype.square=function(t){return $("square")},e.prototype.reciprocal=function(t){return $("reciprocal")},e.prototype.relu=function(t){return $("relu")},e.prototype.relu6=function(t){return $("relu6")},e.prototype.prelu=function(t,n){return $("prelu")},e.prototype.elu=function(t){return $("elu")},e.prototype.eluDer=function(t,n){return $("eluDer")},e.prototype.selu=function(t){return $("selu")},e.prototype.int=function(t){return $("int")},e.prototype.clip=function(t,n,r){return $("clip")},e.prototype.abs=function(t){return $("abs")},e.prototype.complexAbs=function(t){return $("complexAbs")},e.prototype.sigmoid=function(t){return $("sigmoid")},e.prototype.softplus=function(t){return $("softplus")},e.prototype.sin=function(t){return $("sin")},e.prototype.cos=function(t){return $("cos")},e.prototype.tan=function(t){return $("tan")},e.prototype.asin=function(t){return $("asin")},e.prototype.acos=function(t){return $("acos")},e.prototype.atan=function(t){return $("atan")},e.prototype.atan2=function(t,n){return $("atan2")},e.prototype.sinh=function(t){return $("sinh")},e.prototype.cosh=function(t){return $("cosh")},e.prototype.tanh=function(t){return $("tanh")},e.prototype.asinh=function(t){return $("asinh")},e.prototype.acosh=function(t){return $("acosh")},e.prototype.atanh=function(t){return $("atanh")},e.prototype.erf=function(t){return $("erf")},e.prototype.step=function(t,n){return $("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,$("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return $("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return $("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return $("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,$("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return $("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return $("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return $("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return $("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return $("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return $("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return $("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,o){return $("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return $("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return $("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return $("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return $("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return $("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,o){return $("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return $("reshape")},e.prototype.cast=function(t,n){return $("cast")},e.prototype.tile=function(t,n){return $("tile")},e.prototype.pad=function(t,n,r){return $("pad")},e.prototype.transpose=function(t,n){return $("transpose")},e.prototype.gather=function(t,n,r){return $("gather")},e.prototype.gatherND=function(t,n){return $("gatherND")},e.prototype.scatterND=function(t,n,r){return $("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return $("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return $("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,o){return $("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return $("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,o){return $("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return $("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,o,i,a){return $("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){return $("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,o,i,a,s){return $("LRNGrad")},e.prototype.multinomial=function(t,n,r,o){return $("multinomial")},e.prototype.oneHot=function(t,n,r,o){return $("oneHot")},e.prototype.cumsum=function(t,n,r,o){return $("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return $("nonMaxSuppression")},e.prototype.fft=function(t){return $("fft")},e.prototype.ifft=function(t){return $("ifft")},e.prototype.complex=function(t,n){return $("complex")},e.prototype.real=function(t){return $("real")},e.prototype.imag=function(t){return $("imag")},e.prototype.cropAndResize=function(t,n,r,o,i,a){return $("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return $("depthToSpace")},e.prototype.split=function(t,n,r){return $("split")},e.prototype.sparseToDense=function(t,n,r,o){return $("sparseToDense")},e.prototype.diag=function(t){return $("diag")},e.prototype.fill=function(t,n,r){return $("fill")},e.prototype.onesLike=function(t){return $("onesLike")},e.prototype.zerosLike=function(t){return $("zerosLike")},e.prototype.linspace=function(t,n,r){return $("linspace")},e.prototype.dispose=function(){return $("dispose")},e}();function $(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function mo(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,a=e[i]||1;(t[t.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function _t(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,a=t[i];(o==null||o===1&&a>1)&&n.unshift(i)}return n}function Ne(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var a=t[t.length-o-1];if(a==null&&(a=1),i===1)n.unshift(a);else if(a===1)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function Os(e,t,n,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=Yl(t),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,e[1],e[1]]}return Ei(e,s,n,r,o,i,!1,a)}function ql(e,t,n,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,l=ch(t),c=l[0],f=l[1],d=l[2];if(a==="NDHWC")u="channelsLast",s=[c,f,d,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,f,d,e[1],e[1]]}return Xl(e,s,n,r,o,!1,u,i)}function Ei(e,t,n,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3];if(s==="channelsLast")l=e[0],c=e[1],f=e[2],d=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],c=e[2],f=e[3]}var h,p=t[0],m=t[1],g=t[3],v=Yl(n),y=v[0],x=v[1],w=Yl(r),b=w[0],C=w[1],S=ra(p,b),E=ra(m,C),k=function(W,V,K,G,N,O,B,q){var Q,ne,re;if(typeof W=="number"){Q={top:W,bottom:W,left:W,right:W,type:W===0?"VALID":"NUMBER"};var ve=function(De,$e,Me,Ie,ze){Ie==null&&(Ie=Dx(De,$e,Me));var Ke=De[0],Tn=De[1],Rt=cs((Ke-$e+2*Ie)/Me+1,ze);I(ht(Rt),function(){return"The output # of rows ("+Rt+") must be an integer. Change the stride and/or zero pad parameters"});var Yt=cs((Tn-$e+2*Ie)/Me+1,ze);return I(ht(Yt),function(){return"The output # of columns ("+Yt+") must be an integer. Change the stride and/or zero pad parameters"}),[Rt,Yt]}([V,K],O,G,W,q);ne=ve[0],re=ve[1]}else if(W==="same"){ne=Math.ceil(V/G),re=Math.ceil(K/N);var me=Math.max(0,(ne-1)*G+O-V),xe=Math.max(0,(re-1)*N+B-K),_e=Math.floor(me/2),Ae=me-_e,Ge=Math.floor(xe/2);Q={top:_e,bottom:Ae,left:Ge,right:xe-Ge,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Q={top:0,bottom:0,left:0,right:0,type:"VALID"},ne=Math.ceil((V-O+1)/G),re=Math.ceil((K-B+1)/N)}return{padInfo:Q,outHeight:ne,outWidth:re}}(o,c,f,y,x,S,E,i),_=k.padInfo,T=k.outHeight,D=k.outWidth,z=a?g*d:g;return s==="channelsFirst"?h=[l,z,T,D]:s==="channelsLast"&&(h=[l,T,D,z]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:d,outHeight:T,outWidth:D,outChannels:z,padInfo:_,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:E,dilationHeight:b,dilationWidth:C,inShape:e,outShape:h,filterShape:t}}function Xl(e,t,n,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3],h=u[4];if(a==="channelsLast")l=e[0],c=e[1],f=e[2],d=e[3],h=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=e[0],h=e[1],c=e[2],f=e[3],d=e[4]}var p,m=t[0],g=t[1],v=t[2],y=t[4],x=ch(n),w=x[0],b=x[1],C=x[2],S=ch(r),E=S[0],k=S[1],_=S[2],T=ra(m,E),D=ra(g,k),z=ra(v,_),W=function(B,q,Q,ne,re,ve,me,xe,_e,Ae,Ge){var De,$e,Me,Ie;if(typeof B=="number"){De={top:B,bottom:B,left:B,right:B,front:B,back:B,type:B===0?"VALID":"NUMBER"};var ze=function(to,Hn,Gn,Nn,pn,Uo){pn==null&&(pn=Dx(to,Hn,Nn));var lr=to[0],Kn=to[1],uu=to[2],no=cs((lr-Hn+2*pn)/Nn+1,Uo);I(ht(no),function(){return"The output # of depths ("+no+") must be an integer. Change the stride and/or zero pad parameters"});var Da=cs((Kn-Hn+2*pn)/Nn+1,Uo);I(ht(Da),function(){return"The output # of rows ("+Da+") must be an integer. Change the stride and/or zero pad parameters"});var Pn=cs((uu-Hn+2*pn)/Nn+1,Uo);return I(ht(Pn),function(){return"The output # of columns ("+Pn+") must be an integer. Change the stride and/or zero pad parameters"}),[no,Da,Pn,Gn]}([q,Q,ne,1],xe,1,re,B,Ge);$e=ze[0],Me=ze[1],Ie=ze[2]}else if(B==="same"){$e=Math.ceil(q/re),Me=Math.ceil(Q/ve),Ie=Math.ceil(ne/me);var Ke=($e-1)*re+xe-q,Tn=(Me-1)*ve+_e-Q,Rt=(Ie-1)*me+Ae-ne,Yt=Math.floor(Ke/2),eo=Ke-Yt,Dn=Math.floor(Tn/2),ur=Tn-Dn,Vn=Math.floor(Rt/2);De={top:Dn,bottom:ur,left:Vn,right:Rt-Vn,front:Yt,back:eo,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);De={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},$e=Math.ceil((q-xe+1)/re),Me=Math.ceil((Q-_e+1)/ve),Ie=Math.ceil((ne-Ae+1)/me)}return{padInfo:De,outDepth:$e,outHeight:Me,outWidth:Ie}}(o,c,f,d,w,b,C,T,D,z,s),V=W.padInfo,K=W.outDepth,G=W.outHeight,N=W.outWidth,O=i?y*h:y;return a==="channelsFirst"?p=[l,O,K,G,N]:a==="channelsLast"&&(p=[l,K,G,N,O]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:f,inWidth:d,inChannels:h,outDepth:K,outHeight:G,outWidth:N,outChannels:O,padInfo:V,strideDepth:w,strideHeight:b,strideWidth:C,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:T,effectiveFilterHeight:D,effectiveFilterWidth:z,dilationDepth:E,dilationHeight:k,dilationWidth:_,inShape:e,outShape:p,filterShape:t}}function Dx(e,t,n,r){r===void 0&&(r=1);var o=ra(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function Yl(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function ch(e){return typeof e=="number"?[e,e,e]:e}function ra(e,t){return t<=1?e:e+(e-1)*(t-1)}function cs(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function xa(e){var t=Yl(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function hn(e,t){return xa(e)||xa(t)}function Pp(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Nx(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Je(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!xS(e.dtype,t))return M.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var a=n.real(e);return i=a.cast(t),a.dispose(),i}if(t==="int32")return n.int(e);if(t==="bool"){var s=te(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function fh(e,t){return M.makeTensorFromDataId(e.dataId,t,e.dtype)}function Px(e,t,n){var r=(t-e)/(n-1),o=qs(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return yt(o,"float32")}function dh(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Ng(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Kk(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function qk(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Xk(e,t,n){var r=function(i,a,s){return function(u,l,c){for(var f=0,d=u.length,h=0,p=!1;f<d;){var m=c(l,u[h=f+(d-f>>>1)]);m>0?f=h+1:(d=h,p=!m)}return p?f:-f-1}(i,a,s||Yk)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Yk(e,t){return e>t?1:e<t?-1:0}function Ap(e,t,n,r,o){return Ax(e,t,n,r,o,0).selectedIndices}function Fp(e,t,n,r,o,i){var a=Ax(e,t,n,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function Ax(e,t,n,r,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(w,b){return{score:w,boxIndex:b,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(Pg),l=i>0?-.5/i:0,c=[],f=[];c.length<n&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(h<o)break;for(var g=!1,v=c.length-1;v>=m;--v){var y=Qk(e,p,c[v]);if(y>=r){g=!0;break}if(d.score=d.score*Jk(r,l,y),d.score<=o)break}d.suppressBeginIndex=c.length,g||(d.score===h?(c.push(p),f.push(d.score)):d.score>o&&Xk(u,d,Pg))}var x=c.length;return s&&(c.fill(0,x),f.fill(0,x)),{selectedIndices:yt(c,"int32"),selectedScores:yt(f,"float32"),numValidOutputs:te(x,"int32")}}function Qk(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(f-l)*(d-c);if(h<=0||p<=0)return 0;var m=Math.max(i,l),g=Math.max(a,c),v=Math.min(s,f),y=Math.min(u,d),x=Math.max(v-m,0)*Math.max(y-g,0);return x/(h+p-x)}function Jk(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Pg(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Fx(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(i){o[n]=i;var a=e.slice(r,o);return r[n]+=i,a})}function Mx(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Ce(n,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function Ox(e,t,n,r,o){for(var i=t[t.length-1],a=[e.length/i,i],s=a[0],u=a[1],l=As(n,s*r),c=As("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort(function(w,b){return b.value-w.value});var g=f*r,v=l.subarray(g,g+r),y=c.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var x=t.slice();return x[x.length-1]=r,[Lt(l,x,n),Lt(c,x,"int32")]}function Mp(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Ce(e,"int32"),i=Ce([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var Zk=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},eR=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},tR=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Lx(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function an(e,t){return t===1?[e]:Lx(e,t)}function Gt(){var e,t,n,r,o,i,a,s,u,l;return H().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function ri(e,t,n){n===void 0&&(n="index");var r=Er(t);return r.map(function(o,i){return"int "+e[i]+" = "+n+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"}).join("")}function Op(e){var t=Er(e).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var Bx=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function nR(e,t,n,r){var o=[];e.forEach(function(h){var p=le(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,s=o.join(`
`),u=e.map(function(h){return function(p,m,g){g===void 0&&(g=!1);var v="";v+=g?Wx(p):Pi(p);var y=p.shapeInfo.logicalShape,x=m.logicalShape;return y.length<=x.length&&(v+=g?function(w,b){var C,S=w.name,E=S.charAt(0).toUpperCase()+S.slice(1),k="get"+E+"AtOutCoords",_=w.shapeInfo.logicalShape.length,T=b.logicalShape.length,D=mo(w.shapeInfo.logicalShape,b.logicalShape),z=Xe(T),W=T-_,V=["x","y","z","w","u","v"];C=_===0?"":T<2&&D.length>=1?"coords = 0;":D.map(function(Q){return"coords."+V[Q+W]+" = 0;"}).join(`
`);var K="";K=T<2&&_>0?"coords":w.shapeInfo.logicalShape.map(function(Q,ne){return"coords."+V[ne+W]}).join(", ");var G="return outputValue;",N=le(w.shapeInfo.logicalShape)===1,O=le(b.logicalShape)===1;if(_!==1||N||O){if(N&&!O)G=T===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(D.length){var B=_-2,q=_-1;D.indexOf(B)>-1&&D.indexOf(q)>-1?G="return vec4(outputValue.x);":D.indexOf(B)>-1?G="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":D.indexOf(q)>-1&&(G="return vec4(outputValue.xx, outputValue.zz);")}}else G=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+k+`() {
      `+z+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+E+"("+K+`);
      `+G+`
    }
  `}(p,m):function(w,b){var C=w.name,S=C.charAt(0).toUpperCase()+C.slice(1),E="get"+S+"AtOutCoords",k=b.texShape,_=w.shapeInfo.texShape,T=w.shapeInfo.logicalShape.length,D=b.logicalShape.length;if(!w.shapeInfo.isUniform&&T===D&&w.shapeInfo.flatOffset==null&&Pt(_,k))return`
      float `+E+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var z,W=Xe(D),V=mo(w.shapeInfo.logicalShape,b.logicalShape),K=D-T,G=["x","y","z","w","u","v"];z=T===0?"":D<2&&V.length>=1?"coords = 0;":V.map(function(O){return"coords."+G[O+K]+" = 0;"}).join(`
`);var N="";return N=D<2&&T>0?"coords":w.shapeInfo.logicalShape.map(function(O,B){return"coords."+G[B+K]}).join(", "),`
    float `+E+`() {
      `+W+` coords = getOutputCoords();
      `+z+`
      return get`+S+"("+N+`);
    }
  `}(p,m)),v}(h,t,r)}).join(`
`),l=t.texShape,c=Gt(),f=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(c),d=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+rR+`
    `+oR+`
    `+iR+`
  `}(c);return t.isPacked?(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,b){var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(w,b){var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];if(Pt(w,b))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var S=Math.ceil(w[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=h,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],y=Math.ceil(m[2]/2),x=y*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(w,b){for(var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],S=Math.ceil(w[w.length-1]/2),E=S*Math.ceil(w[w.length-2]/2),k=E,_="",T="b, r, c",D=2;D<w.length-1;D++)k*=w[w.length-D-1],_=`
      int b`+D+" = index / "+k+`;
      index -= b`+D+" * "+k+`;
    `+_,T="b"+D+", "+T;return`
    ivec`+w.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+_+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+w.length+"("+T+`);
    }
  `}(h,p)}var m,g,v,y,x}(t.logicalShape,l),a=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(c)):(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,y){return Pt(v,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=p,g=ri(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,y){var x=ri(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(h,p);case 5:return function(v,y){var x=ri(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,p);case 6:return function(v,y){var x=ri(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var m,g}(t.logicalShape,l),a=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(d+=aR),[d,f,a,s,i,u,n].join(`
`)}function Pi(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],f=jo(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+f+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Ii(n)+`
      }
    `;var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=jo(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n.shapeInfo.texShape;if(a!=null&&Pt(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=Jo(r),c=l.newShape,f=l.keptDims,d=c;if(d.length<r.length){var h=Ai(n,d);return`
      `+Pi(h)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Fi(["row","col"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ii(n)+`
      }
    `;var p=a[0],m=a[1],g=jo(o);return m===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=Jo(r),l=u.newShape,c=u.keptDims,f=l;if(f.length<r.length){var d=Ai(n,f);return`
        `+Pi(d)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Fi(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Ii(n)+`
      }
    `;var h=n.shapeInfo.texShape,p=h[0],m=h[1],g=n.shapeInfo.flatOffset;if(m===a&&g==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(m===s&&g==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var v=jo(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=Jo(r),c=l.newShape,f=l.keptDims;if(c.length<r.length){var d=Ai(n,c);return`
      `+Pi(d)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Fi(["row","col","depth","depth2"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Ii(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],g=p[1];if(g===u&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var v=jo(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+v+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=Jo(r),f=c.newShape,d=c.keptDims;if(f.length<r.length){var h=Ai(n,f);return`
      `+Pi(h)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Fi(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Ii(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],v=m[1];if(v===l&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(v===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var y=jo(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=Jo(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=Ai(n,s);return`
      `+Pi(l)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Fi(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],f=r[4]*c,d=r[3]*f,h=r[2]*d,p=r[1]*h;if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+d+", "+f+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Ii(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,g=n.shapeInfo.texShape,v=g[0],y=g[1];if(y===p&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+d+", "+f+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(y===c&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=jo(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+d+` +
          depth2 * `+f+" + depth3 * "+c+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Wx(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Gt(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Gt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+i+`, uv);
    }
  `}(e);case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=u[0],c=u[1],f=Gt();if(u!=null&&Pt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+f.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+d[0]+", "+d[1]+`, row, col);
      return `+f.texture2D+"("+a+`, uv);
    }
  `}(e);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var c=i.slice(1),f=Ai(o,c);return`
        `+Wx(f)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+Fi(["b","row","col"],[1,2])+`);
        }
      `}var d=l[0],h=l[1],p=Math.ceil(i[2]/2),m=p*Math.ceil(i[1]/2),g=Gt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+h+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+a+`, uv);
    }
  `}(e);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],f=c[0],d=c[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<a-1;v++)m="int b"+v+", "+m,p*=i[a-v-1],g="b"+v+" * "+p+" + "+g;var y=Gt();return`
    vec4 `+u+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+f+`);
      return `+y.texture2D+"("+s+`, uv);
    }
  `}(e)}}var rR=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,oR=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iR=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,aR=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function jo(e){return"offset"+e}function Ii(e){var t=e.name,n=le(e.shapeInfo.logicalShape);return n<2?"return "+t+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Xe(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Ai(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Fi(e,t){return t.map(function(n){return e[n]}).join(", ")}var sR=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,I(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Xe(l),f=an("coords",l);if(i===1){var d=Xe(s=l+1);a=`
        `+d+" sourceLocR = "+d+"("+f.join()+`, 0);
        ++`+f[l-1]+`;
        `+d+" sourceLocG = "+d+"("+f.join()+`, 0);
        ++`+f[l-2]+`;
        `+d+" sourceLocA = "+d+"("+f.join()+`, 0);
        --`+f[l-1]+`;
        `+d+" sourceLocB = "+d+"("+f.join()+`, 0);
        --`+f[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+f[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+f[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+f[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+f[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map(function(E){return"int "+E}),g=an("sourceLocR",s-1).concat("inIdx.r"),v=an("sourceLocG",s-1).concat("inIdx.g"),y=an("sourceLocB",s-1).concat("inIdx.b"),x=an("sourceLocA",s-1).concat("inIdx.a"),w=n==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",C=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",S=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+f[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+f[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+b+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+w+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},uR=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+f+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},lR=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=f-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+f+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},cR=function(e,t,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ne(e,t),Ne(e,n);var a="0.0";r!=null&&(Ne(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Ne(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},fR=function(e,t,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ne(e,t),Ne(e,n);var a="vec4(0.0)";r!=null&&(Ne(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Ne(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},dR="return areal * breal - aimag * bimag;",hR="return areal * bimag + aimag * breal;",Ag=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ne(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Of="return a + b;",Lf="return a - b;",Fg="return a * b;",$x="return (a < 0.) ? b * a : a;",ct=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ne(t,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},zx=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ar=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ne(t,n);var o=this.outputShape.length,i="";if(r)if(o===0||le(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Xe(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=an("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},pR=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),vR=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),mR=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},gR=function(e){this.outputShape=[],this.outputShape=ya(e,1),this.variableNames=e.map(function(s,u){return"T"+u});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var i=t.length,a=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},yR=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ya(e,t);var n=this.outputShape,r=n.length,o=Xe(r),i=an("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(g,v){return"T"+v});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=a[t],c=a.slice(-2),f=a.join(),d="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+f+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];d+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Wu(a,l,h)+`),
            vec2(`+Wu(c,l,h)+`));
        }`}var p=s.length,m=s[s.length-1];d+=`
        return getChannel(
          getT`+p+"("+Wu(a,l,m)+`),
          vec2(`+Wu(c,l,m)+"));",this.userCode=`
      float getValue(`+a.map(function(g){return"int "+g})+`) {
        `+d+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+n[r-2]+` &&
            `+i[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Wu(e,t,n){var r=e.indexOf(t);return e.map(function(o,i){return i===r?o+" - "+n:o}).join()}var xR=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},wR=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=i?1:2,l=i?2:3,c=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},bR=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},ER=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},CR=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},_R=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Mg=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p=e.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,v=p?3:1,y="",x="";n&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,x="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+w+`
        `+x+`
        setOutput(result);
      }
    `},SR=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Og=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,m="",g="";n&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+g+`
        setOutput(result);
      }
    `},Lg=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<h;v++)m+=`
          vec4 xTexelR`+g+"C"+2*v+` = vec4(0.);
          vec4 wR`+g+"C"+v+` = vec4(0.);
          vec4 xR`+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var y=0;y<p;y++){if(m+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(v=2*y)*f+`;
        `,l===1){if(v<h&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+g+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+`.xy);
                } else {
                  xR`+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xR`+g+"C"+v+" = xTexelR"+g+"C"+v+`;
              `,v+1<h)){var x=s%2==0?ix(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,f>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+`;
                `}}else v<h&&(m+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
              `,v+1<h&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+`.xy);
              `,v+1<h&&(m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
                `)),m+="}");v<h&&(m+=`
            vec4 wTexelR`+g+"C"+v+" = getW("+g+", "+v+`, d1, q);
            wR`+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+`.xz);
          `,v+1<h&&(m+=`
              vec4 wTexelR`+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+`, d1, q);
              wR`+g+"C"+(v+1)+` =
                vec4(wTexelR`+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var w="",b="";n&&(w=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,b="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+C+`
        `+b+`
        setOutput(result);
      }
    `},kR=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var d=r==="bilinear"?1:0,h=[a-1+".0",s-1+".0"],p=h[0],m=h[1],g=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],x=g[2],w=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],b=w[0],C=w[1],S=w[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+b+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+C+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},RR=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xe(r)+` coords = getOutputCoords();
        int end = `+Bg(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Bg(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Bg(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var IR=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ms.DENSE;var t=ls(e),n=Gt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ri(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},TR=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ms.DENSE;var t=ls(e),n=Gt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ri(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},DR=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),NR=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},PR=function(e){this.variableNames=["A"],this.outTexUsage=bn.DOWNLOAD;var t=Gt();this.outputShape=e,this.userCode=`
      `+Bx+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},AR=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=bn.DOWNLOAD;var t=Gt();this.outputShape=e,this.userCode=`
      `+Bx+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},FR=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=Gt(),o=t[0],i=t[1];this.outputShape=e;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Op(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},MR=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Gt(),o=t[0],i=t[1];this.outputShape=e;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+e[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Op(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},OR="return real * expR - imag * expI;",LR="return real * expI + imag * expR;",Wg=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},BR=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),WR=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Xe(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],f=0;f<a.length;f++)f===s?c.push("int(getIndices("+l[f]+"))"):c.push(""+l[f]);return c.join()}(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},$R=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Xe(t.length),o=Xe(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function zR(e,t){var n=Gt();return OS(e,t,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function UR(e,t){return zS(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function jR(e,t){return US(e,t,new Uint16Array([0,1,2,2,1,3]))}function Ys(e,t,n,r,o,i,a){VS(n,r);var s=jS(e,t),u=e.TEXTURE_2D;return de(e,t,function(){return e.bindTexture(u,s)}),de(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),de(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),de(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),de(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),de(e,t,function(){return e.texImage2D(u,0,o,n,r,0,i,a,null)}),de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function VR(e,t,n,r,o){var i=Tc(n,r);return Ys(e,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function HR(e,t,n,r,o){var i=Tc(n,r);return Ys(e,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function GR(e,t,n,r,o){var i=Tc(n,r);return Ys(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function KR(e,t,n,r,o){var i=Xs(n,r);return Ys(e,t,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function qR(e,t,n,r,o){var i=Xs(n,r);return Ys(e,t,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function XR(e,t,n,r){return de(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),kg(e,t,n,"clipSpacePos",r,3,20,0)&&kg(e,t,n,"uv",r,2,20,12)}function YR(e,t,n,r,o,i,a){var s,u,l;de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=a.internalFormatPackedFloat),s.set(i),de(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function QR(e,t,n,r){de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?de(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):de(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),de(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function JR(e,t,n,r,o){var i=e.createBuffer();de(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return de(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)}),de(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),de(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),i}function ZR(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function eI(e,t,n,r,o){var i=Tc(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return de(e,t,function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function tI(e,t,n,r,o,i,a,s){var u=e,l=new Float32Array(function(c,f){var d=Xs(c,f);return d[0]*d[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function nI(e,t,n,r){var o=new Float32Array(n*r*4);return de(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var rI=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=H().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,NS(n,t)):this.gl=kr(n);var r="WEBGL_color_buffer_float";if(H().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Mu(this.gl,this.debug,"OES_texture_float"),Wn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Mu(this.gl,this.debug,"OES_texture_half_float");else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Wn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Mu(this.gl,this.debug,"EXT_color_buffer_half_float");else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Wn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Wn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=UR(this.gl,this.debug),this.indexBuffer=jR(this.gl,this.debug),this.framebuffer=HS(this.gl,this.debug),this.textureConfig=kp(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return H().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;de(n,this.debug,function(){return n.finish()}),de(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),de(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),de(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),de(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),de(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),VR(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),HR(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),GR(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),QR(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,o){this.throwIfDisposed(),YR(this.gl,this.debug,t,n,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),qR(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),KR(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(Rg(this.gl,this.debug,this.framebuffer),this.outputTexture=null),de(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return eI(o.gl,o.debug,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,i,a){return tI(this.gl,t,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return ZR(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=JR(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(H().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=a}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return nI(o.gl,o.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=LS(n,this.debug,t),o=zR(n,this.debug),i=WS(n,this.debug);return de(n,this.debug,function(){return n.attachShader(i,o)}),de(n,this.debug,function(){return n.attachShader(i,r)}),$S(n,this.debug,i),this.debug&&Pf(n,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=XR(n,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&de(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Pf(this.gl,this.debug,this.program),de(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?KS(this.gl,this.debug,t,n):qS(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),de(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),XS(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=Xs(n,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(t,i,a)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Pf(this.gl,this.debug,this.program),Ou(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),de(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),de(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Mu(this.gl,this.debug,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return se(this,void 0,void 0,function(){var n=this;return ue(this,function(r){switch(r.label){case 0:return[4,wg(function(){return n.disposed||n.isQueryAvailable(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||wg(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Af(this.gl,this.debug,t,this.framebuffer),this.debug&&Ou(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Af(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ou(this.gl)):Rg(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;Af(o,this.debug,t,this.framebuffer),this.debug&&Ou(o),this.outputTexture=t,de(o,this.debug,function(){return o.viewport(0,0,n,r)}),de(o,this.debug,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var i=this;this.throwIfDisposed(),de(this.gl,this.debug,function(){return i.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function $g(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,i=t[r],a=i.shape;if(!Pt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!n.isUniform||!i.isUniform){var s=n.texShape,u=i.isUniform?null:i.texData.texShape;if(!Pt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var oI=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=n.dataFormat,d=s.left,h=s.top,p=o*r,m=Gt(),g=f==="channelsLast",v=g?0:1,y=g?1:2,x="",w=0;w<=1;w++)for(var b=0;b<=1;b++)x+=`
          blockIndex = rc.y + `+b+`;
          pos = rc.x + `+w+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+h+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+t[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+d+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+t[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+m.output+` = result;
      }
    `},iI=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},aI=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},sI=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},uI=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},lI=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=l-1-e.padInfo.left,h=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+f+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Bf=function(e,t,n,r,o,i,a){n===void 0&&(n=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+f[0]+" * "+d[0]+`);
          result += (`+f[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},cI=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),fI=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},dI=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=an("rc",t),r=Xe(t),o=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",f=s-2;f<s;f++)c+=l[f]+" >= "+u[f],f<s-1&&(c+="||");return c}(t,e,n),i=function(s,u,l,c){if(s===1)return"";var f=c.slice(-2);return`
    int r = `+f[0]+`;
    int c = `+f[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,e[e.length-1],e[e.length-2],n),a=function(s,u){var l=s.length,c=function(f,d){for(var h=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<f;v++)g=d[d.length-1-v]+","+g;h.push(g)}return h}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},hI=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+e[l]+u[1]});var r=e.length,o=Xe(r),i=t.map(function(u){return u[0]}).join(","),a=t.map(function(u,l){return u[0]+e[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},pI=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(g,v){return g[0]+e[v]+g[1]});for(var r=e.length,o=Xe(r),i=t.map(function(g){return g[0]}).join(","),a=t.map(function(g,v){return g[0]+e[v]}).join(","),s=an("rc",r),u=an("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=r===1?2:4;p<m;p++)h+=`
        `+f[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+n+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},Wf=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d=t==="avg",h="0.0";if(d||(h="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+c+", "+f+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+c+", "+f+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},$f=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var g=t==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+f+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+f+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(y="avgValue / count");var x=4*Math.floor(r/4),w=r%4,b=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+b+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(w===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+b+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},vI=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",s="min"):t==="max"&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";t==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):t==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var h="";o%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+f+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+f+`
        }
        setOutput(`+u+`);
      }
    `},mI=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+ri(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+Op(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `},gI=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},yI=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},xI=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},wI=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},bI=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},EI=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(i,a){return function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),o=Xe(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},CI=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=an("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Xe(n);function s(u){var l=e.map(function(c,f){return function(d,h){return t.indexOf(d)!==-1&&e[d]!==1?e[d]+" - "+h[d]+" - 1":""+h[d]}(f,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},zg=function(e,t,n,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Xe(o.length),u=Xe(i.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",f="";r===1?f="i":r===2&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},_I=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var f="";o%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+f+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},SI=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=Xe(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},kI=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Xe(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(a===1)return"sourceLoc";if(a<=6)return zf.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(a,s){return"sourceLoc."+zf[s]+" = start["+s+"] + coords."+zf[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+n+`
        setOutput(getSource(`+i+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),zf=["x","y","z","w","u","v"],RI=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Xe(this.rank),r=an("coords",this.rank),o=an("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+t.map(function(c,f){return"start["+f+"]"}).join()+");":t.map(function(c,f){return o[f]+" = "+r[f]+" + start["+f+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),II=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Xe(n.length),i=Xe(n.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=n.map(function(u,l){return s++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},TI=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,i=Ug(n,r),a=jg(t,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===xn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===xn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===xn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===xn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===xn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var i=jg(n,Ug(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Ug(e,t){if(e===bn.UPLOAD)return xn.PACKED_2X2_FLOAT32;if(e===bn.RENDER||e==null)return function(n){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?xn.PACKED_2X2_FLOAT32:xn.UNPACKED_FLOAT32:n?xn.PACKED_2X2_FLOAT16:xn.UNPACKED_FLOAT16}(t);if(e===bn.DOWNLOAD||e===bn.PIXELS)return xn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function jg(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var DI=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Xe(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},NI=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Xe(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},PI=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Xe(this.rank),i=Lx("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Lp=1.7580993408473768,Bp=1.0507009873554805,Se=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ar="if (isnan(x)) return x;",AI="return x;",Vg="return abs(x);",Ux=ar+`
  return (x < 0.0) ? 0.0 : x;
`,jx=ar+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Vx="return (x >= 0.0) ? x : (exp(x) - 1.0);",FI=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Lp+`;
  float scale = `+Bp+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Hg="return -x;",Gg="return ceil(x);",Kg="return floor(x);",qg="return exp(x);",Xg="return exp(x) - 1.0;",MI=ar+`
  return sin(x);
`,OI=ar+`
  return cos(x);
`,LI=ar+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,BI=ar+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,WI=ar+`
  return atan(x);
`,$I=ar+"return log(x + sqrt(x * x + 1.0));",zI=ar+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,UI=ar+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,$u="return x;",jI="return x;",Hx=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gx=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Kx=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ga=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},VI=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=an("rc",t),r=Xe(t),o=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,n),i=n.slice(-2),a=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},zu={};function Uu(e,t){if(t===void 0&&(t=!1),e==="linear")return t?jI:AI;if(e==="relu")return t?Hx:Ux;if(e==="elu")return t?Kx:Vx;if(e==="relu6")return t?Gx:jx;if(e==="prelu")return t?zx:$x;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var HI=600,GI=function(e){function t(n){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var i=kr(H().getNumber("WEBGL_VERSION"));o.binaryCache=((r=H().getNumber("WEBGL_VERSION"))in zu||(zu[r]={}),zu[r]),o.gpgpu=new rI(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=n,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=n.gl.canvas;return o.textureManager=new TI(o.gpgpu),o.numMBBeforeWarning=H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*HI/1024/1024,o.texData=new Ix(o,M),o}return ir(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,o){if(H().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:n,usage:bn.UPLOAD}),i},t.prototype.move=function(n,r,o,i){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:o,dtype:i,values:r,usage:bn.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Ga(u,$u):new Se(u,$u);var f=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:i}],i),d=this.readSync(f.dataId);return this.disposeData(f.dataId),d}if(o!=null)return this.convertAndCacheOnCPU(n);if(i==="string")return o;var h,p,m=this.activeTimers!=null;return m&&(h=pr()),i==="complex64"?p=dh(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(n),m&&(this.downloadWaitMs+=pr()-h),this.convertAndCacheOnCPU(n,p)},t.prototype.read=function(n){return se(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,f,d,h,p,m,g,v,y,x,w,b,C,S,E;return ue(this,function(k){switch(k.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(_){return r.push(_)})];if(o=this.texData.get(n),i=o.values,a=o.shape,s=o.slice,u=o.dtype,l=o.complexTensors,c=o.isPacked,s!=null)return f=void 0,f=c?new Ga(a,$u):new Se(a,$u),d=this.runWebGLProgram(f,[{dataId:n,shape:a,dtype:u}],u),h=this.read(d.dataId),this.disposeData(d.dataId),[2,h];if(i!=null)return[2,this.convertAndCacheOnCPU(n)];if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(n),g=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[g.texture].concat(ls(a)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:k.sent(),k.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=k.sent(),x=y[0],w=y[1],v=dh(x,w),[3,5];case 4:p==null?v=this.getValuesFromTexture(n):(b=le(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,b)),k.label=5;case 5:return m!=null&&this.disposeData(m.dataId),C=this.convertAndCacheOnCPU(n,v),S=this.pendingRead.get(n),this.pendingRead.delete(n),S.forEach(function(_){return _(C)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,C]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var o=n[r];if(!FS(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.isPacked,u=le(i);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(ls(i))).subarray(0,u);return this.disposeData(l.dataId),f}var d=H().getBool("WEBGL_PACK")&&s===!0,h=d?Ff(i):i,p=d?new AR(h):new PR(h),m=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:n}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),v},t.prototype.time=function(n){return se(this,void 0,void 0,function(){var r,o,i,a,s,u,l;return ue(this,function(c){switch(c.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,n(),a=ma(this.activeTimers.map(function(f){return f.query})).filter(function(f){return f!=null}),s=ma(this.activeTimers.map(function(f){return f.name})).filter(function(f){return f!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=pS(l),u.getExtraProfileInfo=function(){return l.map(function(f,d){return{name:s[d],ms:f}}).map(function(f){return f.name+": "+f.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:pr(),endMs:null}},t.prototype.endTimer=function(n){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=pr(),n)},t.prototype.getQueryTime=function(n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,f=this.dataRefCount.get(c);f>1?this.dataRefCount.set(c,f-1):(this.dataRefCount.delete(c),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var d=this.texData.get(n);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return H().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=M.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var o=this.makeOutput(n.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:M.keep(n.clone()),imag:M.keep(r.clone())},o},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,o);if(le(o)===0)return Lt([],o,n.dtype);var i=this.texData.get(n.dataId).isPacked,a=kx(n.shape,r,o);if(i||!a){var s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RI(o):new kI(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,o)},t.prototype.shallowSlice=function(n,r,o){var i=this.texData.get(n.dataId),a=this.makeOutput(o,n.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=n.dtype;var u=Rx(r,n.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||n.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},t.prototype.stridedSlice=function(n,r,o,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,o,i);var a=Np(r,o,i);if(a.some(function(u){return u===0}))return Lt([],a);var s=new II(r,i,a);return this.compileAndRun(s,[n])},t.prototype.reverse=function(n,r){var o=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CI(n.shape,r):new EI(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var o=n.map(function(h){return Ln(h)}),i=n.map(function(h){return gr(h)});return Mt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),s=this.concat(n.slice(0,a),r),u=this.concat(n.slice(a),r);return this.concat([s,u],r)}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new yR(n.map(function(h){return h.shape}),r);return this.compileAndRun(l,n)}var c=ya(n.map(function(h){return h.shape}),r),f=n.map(function(h){return h.as2D(-1,le(h.shape.slice(r)))}),d=new gR(f.map(function(h){return h.shape}));return this.compileAndRun(d,f).reshape(c)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Hg,n.dtype);var r=new Se(n.shape,Hg);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,o,i){var a=o?n.shape[2]:n.shape[1],s=i?r.shape[1]:r.shape[2],u=o?n.shape[1]:n.shape[2],l=n.shape[0];if((a===1||s===1)&&u>1e3){o&&(n=n.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var c=s===1?n:n.as3D(l,u,1),f=s===1?2:1,d=s===1?r.as3D(l,1,u):r;return this.multiply(c,d).sum(f,!0)}var h=Ot(n.dtype,r.dtype),p=new Bf(n.shape,[l,a,s],o,i);return this.compileAndRun(p,[n,r],h)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=i?r.shape[2]:r.shape[1],f=a?o.shape[1]:o.shape[2],d=r.shape[0],h=Ot(r.dtype,o.dtype),p=s!=null,m=l!=null,g=u?Uu(u,!0):null,v=new Bf(r.shape,[d,c,f],i,a,p,g,m),y=[r,o];return s&&y.push(s),l&&y.push(l),this.compileAndRun(v,y,h)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var o=this.texData.get(n.dataId),i=this.texData.get(r.dataId),a=new Ag(dR,n.shape,r.shape),s=new Ag(hR,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),f=this.complex(l,c);return l.dispose(),c.dispose(),f}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Fg,n.dtype);var d=new ct(Fg,n.shape,r.shape);return this.compileAndRun(d,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){var u=[n,r,o],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),H().getBool("WEBGL_PACK_NORMALIZATION")){var f=new fR(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(f,u)}var d=new cR(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(d,u)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){var s=H().getBool("WEBGL_PACK_NORMALIZATION")?new sI(n.shape,r,o,i,a):new iI(n.shape,r,o,i,a);return this.compileAndRun(s,[n])},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){var l=new aI(r.shape,i,a,s,u);return this.compileAndRun(l,[r,o,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var o=this.readSync(n.dataId).map(function(a){return Bl(a)});return Mx(Ce(n.shape,n.dtype,o),r)}var i=new DI(n.shape,r);return this.compileAndRun(i,[n])},t.prototype.pad=function(n,r,o){var i=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pI(n.shape,r,o):new hI(n.shape,r,o);return this.compileAndRun(i,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var o=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PI(n.shape,r):new NI(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.gather=function(n,r,o){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,o);var i=new WR(n.shape,r.size,o);return this.compileAndRun(i,[n,r])},t.prototype.batchToSpaceND=function(n,r,o){I(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,d){return f*d}),a=Vl(n.shape,r,i),s=Hl(a.length,r.length),u=Gl(n.shape,r,i),l=Ex(o,r.length),c=Cx(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){I(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,h){return d*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=Vl(u.shape,r,i,!1),c=Hl(l.length,r.length,!1),f=Gl(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(f)},t.prototype.reduce=function(n,r,o){var i=n.shape[0],a=n.shape[1],s=Mf(a),u=new vI({windowSize:s,inSize:a,batchSize:i},r),l=this.compileAndRun(u,[n],o);return l.shape[1]===1?l:this.reduce(l,r,o)},t.prototype.argReduce=function(n,r,o){o===void 0&&(o=null);var i=n.shape[0],a=n.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=Mf(a),u=new tR({windowSize:s,inSize:a,batchSize:i},r,o==null),l=[n];o!=null&&l.push(o);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},t.prototype.argReducePacked=function(n,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:n.shape,a=Mf(i[i.length-1]),s=new sR(i,a,r,o==null),u=o==null?[n]:[n,o],l=this.compileAndRun(s,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},t.prototype.sum=function(n,r){yn("sum",r,n.rank);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a),u=Rf(n.dtype);return this.reduce(s,"sum",u).reshape(i)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a),u=Rf(n.dtype);return this.reduce(s,"prod",u).reshape(i)},t.prototype.unsortedSegmentSum=function(n,r,o){var i=0,a=Rr([i],n.rank),s=n;a!=null&&(s=n.transpose(a),i=Ir(1,n.rank)[0]);var u=function(h,p,m){for(var g=[],v=h.length,y=0;y<v;y++)y!==p?g.push(h[y]):g.push(m);return g}(s.shape,i,o),l=le([s.shape[i]]),c=s.as2D(-1,l),f=Rf(n.dtype),d=this.segOpCompute(c,"unsortedSegmentSum",r,f,o).reshape(u);return a!=null&&(d=d.transpose(Rp(a))),d},t.prototype.segOpCompute=function(n,r,o,i,a){var s=n.shape[0],u=n.shape[1],l=function(d,h){var p,m=!1;for(d<=Sx?(p=d,m=!0):p=rh(d,Math.floor(Math.sqrt(d)));!m;)p>h||p===d?m=!0:p=rh(d,p+1);return p}(u,a),c=new _I({windowSize:l,inSize:u,batchSize:s,numSegments:a}),f=this.compileAndRun(c,[n,o],i);return f.shape[1]===a?f:(o=jl(0,a).tile([u/l]),this.segOpCompute(f,r,o,i,a))},t.prototype.argMinMaxReduce=function(n,r,o){var i=[r];if(yn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,n.rank),!H().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var a=jt(n.shape,i),s=a[0],u=le(a[1]),l=n.as2D(-1,u);return this.argReduce(l,o).reshape(s)}return this.argReducePacked(n,o)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,o,i){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var a=new RR(n.shape,o,i);return this.compileAndRun(a,[n])},t.prototype.equal=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var o=new ct("return float(a == b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new ct("return float(a != b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new ct("return float(a < b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new ct("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new ct("return float(a > b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new ct("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new Se(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new ct("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new ct("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.select=function(n,r,o){var i=new SI(n.rank,r.shape,r.rank);return this.compileAndRun(i,[n,r,o],Ot(r.dtype,o.dtype))},t.prototype.where=function(n){zl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return Mp(n.shape,r)},t.prototype.topk=function(n,r,o){return Ox(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){yn("min",r,n.rank);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new ct(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.mod=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new ct(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);yn("max",r,n.rank);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new ct(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.all=function(n,r){yn("all",r,n.rank);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},t.prototype.any=function(n,r){yn("any",r,n.rank);var o=jt(n.shape,r),i=o[0],a=le(o[1]),s=n.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},t.prototype.realDivide=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new ct(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new ct(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Of);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var o=Ot(n.dtype,r.dtype);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Of,o);var i=new ct(Of,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.packedUnaryOp=function(n,r,o){var i=new Ga(n.shape,r);return this.compileAndRun(i,[n],o)},t.prototype.packedBinaryOp=function(n,r,o,i,a){a===void 0&&(a=!1);var s=new Ar(o,n.shape,r.shape,a);return this.compileAndRun(s,[n,r],i)},t.prototype.complexSeparableBinaryOp=function(n,r,o){var i=this,a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var h=d[0],p=d[1],m=i.makeComplexComponentTensorInfo(n,h),g=i.makeComplexComponentTensorInfo(r,p),v=new ct(o,n.shape,r.shape);return i.compileAndRun(v,[m,g],Ot(h.dtype,p.dtype))}),l=u[0],c=u[1],f=this.complex(l,c);return l.dispose(),c.dispose(),f},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),o=this.addN(n.slice(0,r)),i=this.addN(n.slice(r));return this.addN([o,i])}var a=n.map(function(l){return l.dtype}).reduce(function(l,c){return Ot(l,c)}),s=n.map(function(l){return l.shape}),u=H().getBool("WEBGL_PACK")?new eR(n[0].shape,s):new Zk(n[0].shape,s);return this.compileAndRun(u,n,a)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Lf);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var o=Ot(n.dtype,r.dtype);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Lf,n.dtype);var i=new ct(Lf,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.pow=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new ct(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),i=Ot(n.dtype,r.dtype);return this.compileAndRun(o,[n,r],i)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Gg,n.dtype);var r=new Se(n.shape,Gg);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Kg,n.dtype);var r=new Se(n.shape,Kg);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new Se(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new Se(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new Se(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new Se(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new Se(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,qg,n.dtype);var r=new Se(n.shape,qg);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Xg,n.dtype);var r=new Se(n.shape,Xg);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var o=kt([r],n.shape),i=this.max(n,o),a=dn(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new Se(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new Se(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new Se(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new Se(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new Se(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=H().getBool("WEBGL_PACK")?new Ga(n.shape,Hx):new Se(n.shape,Ux),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=H().getBool("WEBGL_PACK")?new Ga(n.shape,Gx):new Se(n.shape,jx),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(zx,n.shape,r.shape):new ct($x,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.elu=function(n){if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Kx,n.dtype);var r=new Se(n.shape,Vx);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new ct("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.selu=function(n){var r=new Se(n.shape,FI);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new Se(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,o){var i,a=(i=H().getBool("WEBGL_PACK_CLIP")?new vR(n.shape):new pR(n.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[n],null,a)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Vg,n.dtype);var r=new Se(n.shape,Vg);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),o=new mR(n.shape),i=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(o,i)},t.prototype.sigmoid=function(n){var r=new Se(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new Se(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new Se(n.shape,MI);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new Se(n.shape,OI);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new Se(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new Se(n.shape,LI);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new Se(n.shape,BI);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new Se(n.shape,WI);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new ct(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.sinh=function(n){var r=new Se(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new Se(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new Se(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new Se(n.shape,$I);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new Se(n.shape,zI);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new Se(n.shape,UI);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new Se(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var o=new Se(n.shape,function(i){return i===void 0&&(i=0),ar+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(o,[n])},t.prototype.conv2dByMatMul=function(n,r,o,i,a,s){var u=n.shape,l=this.texData.get(n.dataId),c=o.inChannels,f=u[0]*u[1]*u[2],d=o.outChannels,h=o.dataFormat==="channelsLast",p=(f===1||d===1)&&c>1e3,m=u[2]%2!=0&&!!l.isPacked;if(p||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(n,[1,g,o.inChannels]),y=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),w={dataId:n.dataId,shape:[1,x,o.inChannels],dtype:n.dtype},b=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,I(Bu(l.shape,w.shape),function(){return"packed reshape "+l.shape+" to "+w.shape+" isn't free"});var C=this.reshape(r,[1,o.inChannels,o.outChannels]),S=this.fusedBatchMatMul({a:w,b:C,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),E=this.texData.get(S.dataId);return I(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=b,E.shape=o.outShape,M.makeTensorFromDataId(S.dataId,o.outShape,S.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,o,i,a,s){var u=o.filterWidth,l=o.filterHeight,c=o.inChannels,f=o.outWidth,d=o.outHeight,h=o.dataFormat==="channelsLast",p=u*l*c,m=d*f,g=[p,m],v=n.squeeze([0]),y=r.reshape([1,p,-1]),x=new oI(g,v.shape,o),w=this.compileAndRun(x,[v]).reshape([1,g[0],g[1]]),b=i!=null,C=s!=null,S=a?Uu(a,!0):null,E=new Bf(w.shape,[1,m,o.outChannels],!0,!1,b,S,C),k=[w,y];i&&k.push(i),C&&k.push(s);var _=this.compileAndRun(E,k);return h?_.reshape([1,d,f,o.outChannels]):_.reshape([1,o.outChannels,d,f])},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(H().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var l=a!=null,c=u!=null,f=s?Uu(s,!1):null,d=new Mg(i,l,f,c),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(d,h)},t.prototype.conv2d=function(n,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,o);if(H().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,o);var i=new Mg(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerInput=function(n,r,o){var i=new wR(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerFilter=function(n,r,o){var i=new xR(o);return this.compileAndRun(i,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,o=n.input,i=n.filter,a=n.convInfo,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,f=u?Uu(u,c):null,d=[o,i],h=s!=null,p=l!=null;return h&&d.push(s),p&&d.push(l),c?(r=new Lg(a,h,f,p),this.compileAndRun(r,d)):(r=new Og(a,h,f,p),this.compileAndRun(r,d))},t.prototype.depthwiseConv2D=function(n,r,o){var i;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Lg(o),this.compileAndRun(i,[n,r])):(i=new Og(o),this.compileAndRun(i,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,o){var i=new _R(o);return this.compileAndRun(i,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){var i=new CR(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3d=function(n,r,o){var i=new SR(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerInput=function(n,r,o){var i=new ER(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerFilter=function(n,r,o){var i=new bR(o);return this.compileAndRun(i,[n,r])},t.prototype.maxPool=function(n,r){var o=new Wf(r,"max",!1);return this.compileAndRun(o,[n])},t.prototype.avgPool=function(n,r){var o=new Wf(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,o,i){var a=new Wf(i,"max",!0),s=this.compileAndRun(a,[r]),u=new uI(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(n,r,o){var i=new uR(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.cast=function(n,r){return Nx(n,r,this)},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.avgPool3d=function(n,r){var o=new $f(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,o){var i=new lR(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var o=new $f(r,"max",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,o,i){var a=new $f(i,"max",!0),s=this.compileAndRun(a,[r]),u=new lI(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(n,r){var o=this.texData.get(n.dataId);if(o.isPacked&&!Bu(n.shape,r)&&(o.texture===null||!Bu(o.shape,r))){var i=this.packedReshape(n,r);return M.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return fh(n,r)},t.prototype.resizeBilinear=function(n,r,o,i){var a=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xI(n.shape,r,o,i):new yI(n.shape,r,o,i);return this.compileAndRun(a,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,o){var i=new gI(n,r,o);return this.compileAndRun(i,[n])},t.prototype.resizeNearestNeighbor=function(n,r,o,i){var a=new bI(n.shape,r,o,i);return this.compileAndRun(a,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){var i=new wI(n,r,o);return this.compileAndRun(i,[n])},t.prototype.multinomial=function(n,r,o,i){var a=r?n:Xr(n),s=a.shape[0],u=a.shape[1],l=new cI(s,u,o),c=l.getCustomSetupFunc(i);return this.compileAndRun(l,[a],"int32",c)},t.prototype.oneHot=function(n,r,o,i){var a=new fI(n.size,r,o,i);return this.compileAndRun(a,[n])},t.prototype.diag=function(n){var r=new NR(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return zl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ap(n.dataSync(),r.dataSync(),o,i,a)},t.prototype.cropAndResize=function(n,r,o,i,a,s){var u=new kR(n.shape,r.shape,i,a,s);return this.compileAndRun(u,[n,r,o],"float32")},t.prototype.depthToSpace=function(n,r,o){I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=n.shape[0],a=o==="NHWC"?n.shape[1]:n.shape[2],s=o==="NHWC"?n.shape[2]:n.shape[3],u=o==="NHWC"?n.shape[3]:n.shape[1],l=a*r,c=s*r,f=u/(r*r),d=new DR(o==="NHWC"?[i,l,c,f]:[i,f,l,c],r,o);return this.compileAndRun(d,[n])},t.prototype.split=function(n,r,o){return Fx(n,r,o)},t.prototype.scatterND=function(n,r,o){var i=Kl(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,f=[c/u,u],d=n.reshape([s,a]),h=r.reshape([s,u]);if(c===0)return fh(Lt([]),o);var p=te(0),m=new zg(s,a,d.rank,h.rank,l,f);return this.compileAndRun(m,[h,d,p]).reshape(o)},t.prototype.sparseToDense=function(n,r,o,i){var a=Kl(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,f=new zg(u,s,n.rank,r.rank,l,[c,1]);return this.compileAndRun(f,[r,n,i]).reshape(o)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var o=this.texData.get(n.dataId),i=new Wg(OR,n.shape,r),a=new Wg(LR,n.shape,r),s=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],u=this.compileAndRun(i,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=_x(n,r),s=a[0],u=a[1],l=a[2],c=a[3],f=r.reshape([u,i]),d=n.reshape([n.size/l,l]),h=new $R(i,c,[u,l]);return this.compileAndRun(h,[d,f]).reshape(s)},t.prototype.fill=function(n,r,o){if((o=o||Ks(r))==="string"){var i=Ll(o,le(n));return i.fill(r),M.makeTensor(i,n,o,this)}var a=new BR(n,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,o){return Px(n,r,o)},t.prototype.makeTensorInfo=function(n,r){var o=this.write(null,n,r);return this.texData.get(o).usage=null,{dataId:o,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var o=this.makeTensorInfo(n,r).dataId;return M.makeTensorFromDataId(o,n,r,this)},t.prototype.unpackTensor=function(n){var r=new VI(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new dI(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var o=[Wl(n.shape)].concat($l(n.shape)),i={dtype:n.dtype,shape:o,dataId:n.dataId},a=[Wl(r)].concat($l(r)),s=new mI(a,o),u=this.runWebGLProgram(s,[i],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(n){var r,o=this.texData.get(n),i=o.isPacked,a=o.shape,s=o.dtype,u=Ff(a);return r=i?new TR(u):new IR(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:n}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(n.outputShape,o),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===Ms.DENSE){var c=ls(n.outputShape);l.texShape=c.map(function(x){return 2*x})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),le(u.shape)===0)return l.values=As(u.dtype,0),u;var f=[],d=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(x.dataId);if(w.texture==null){if(!n.packedInputs&&le(x.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:w.values};n.packedInputs&&(w.isPacked=!0,w.shape=x.shape)}else if(!!w.isPacked!=!!n.packedInputs)x=w.isPacked?s.unpackTensor(x):s.packTensor(x),f.push(x),w=s.texData.get(x.dataId);else if(w.isPacked&&!Bu(w.shape,x.shape)){var b=x,C=x.shape;x.shape=w.shape,x=s.packedReshape(x,C),f.push(x),w=s.texData.get(x.dataId),b.shape=C}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:l,isUniform:!1},m=function(x,w,b){var C="";w.concat(b).forEach(function(k){var _=k.texData!=null&&k.texData.slice!=null&&k.texData.slice.flatOffset>0,T=k.isUniform?"uniform":k.texData.texShape;C+=k.shape+"_"+T+"_"+_});var S=x.userCode,E=x.constructor.name;return E+="_"+C+"_"+S}(n,d,p),g=this.getAndSaveBinary(m,function(){return function(x,w,b,C){var S=w.userCode,E=b.map(function(N,O){var B={logicalShape:N.shape,texShape:N.isUniform?null:N.texData.texShape,isUniform:N.isUniform,isPacked:!N.isUniform&&N.texData.isPacked,flatOffset:null};return N.texData!=null&&N.texData.slice!=null&&N.texData.slice.flatOffset>0&&(B.flatOffset=N.texData.slice.flatOffset),{name:w.variableNames[O],shapeInfo:B}}),k=E.map(function(N){return N.shapeInfo}),_={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},T=nR(E,_,S,w.packedInputs),D=x.createProgram(T),z=null,W=x.getUniformLocation(D,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(z=x.getUniformLocation(D,"INFINITY",!1));for(var V={},K=0;K<w.variableNames.length;K++){var G=w.variableNames[K];V[G]=x.getUniformLocation(D,G,!1),V["offset"+G]=x.getUniformLocation(D,"offset"+G,!1)}return{program:w,source:T,webGLProgram:D,uniformLocations:V,inShapeInfos:k,outShapeInfo:_,infLoc:z,nanLoc:W}}(s.gpgpu,n,d,p)}),v=this.activeTimers!=null;if(v&&(h=this.startTimer()),function(x,w,b,C,S){$g(w.inShapeInfos,b),$g([w.outShapeInfo],[C]);var E=C.texData.texture,k=C.texData.texShape;C.texData.isPacked?x.setOutputPackedMatrixTexture(E,k[0],k[1]):x.setOutputMatrixTexture(E,k[0],k[1]),x.setProgram(w.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&w.infLoc!==null&&x.gl.uniform1f(w.infLoc,1/0),w.nanLoc!==null&&x.gl.uniform1f(w.nanLoc,NaN),b.forEach(function(_,T){var D=w.program.variableNames[T],z=w.uniformLocations[D],W=w.uniformLocations["offset"+D];if(z!=null)if(_.isUniform)if(le(_.shape)<2)x.gl.uniform1f(z,_.uniformValues[0]);else{var V=_.uniformValues;V instanceof Float32Array||(V=new Float32Array(V)),x.gl.uniform1fv(z,V)}else _.texData.slice!=null&&W!=null&&x.gl.uniform1i(W,_.texData.slice.flatOffset),x.setInputMatrixTexture(_.texData.texture,z,T)}),S!=null&&S(x,w.webGLProgram),x.executeProgram()}(this.gpgpu,g,d,p,i),f.forEach(function(x){return s.disposeData(x.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(h)})),!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},t.prototype.compileAndRun=function(n,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(n,r,o,i,a);return M.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=oe(function(){if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=H().getBool("DEBUG");H().set("DEBUG",!1);var o=n.abs(te(1e-8)).dataSync()[0];if(H().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.values,u=o.texture,l=o.usage,c=o.isPacked;if(u==null){var f,d=this.activeTimers!=null;d&&(f=pr());var h=o.texShape;if(h==null&&(h=JS(i,c),o.texShape=h),s!=null){var p=Ff(i),m=void 0,g=h[1],v=h[0],y=s instanceof Uint8Array;c?(g=(r=Xs(h[0],h[1]))[0],v=r[1],m=new MR(p,[v,g],y)):m=new FR(p,[v,g],y);var x=this.makeTensorInfo([v,g],a);this.texData.get(x.dataId).usage=y?bn.PIXELS:bn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),g,v,s);var w=this.runWebGLProgram(m,[x],a,null,!0),b=this.texData.get(w.dataId);o.texture=b.texture,o.texShape=b.texShape,o.isPacked=b.isPacked,o.usage=b.usage,this.disposeData(x.dataId),this.texData.delete(w.dataId),o.values=null,d&&(this.uploadWaitMs+=pr()-f)}else{var C=this.acquireTexture(h,l,a,c);o.texture=C}}},t.prototype.convertAndCacheOnCPU=function(n,r){var o=this.texData.get(n),i=o.dtype;return this.releaseGPUData(n),r!=null&&(o.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},t.prototype.acquireTexture=function(n,r,o,i){if(this.numBytesInGPU+=this.computeBytes(n,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,i)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*ax(r)},t}(Tx);hx()&&M.registerBackend("webgl",function(){return new GI},2);var KI=P({square_:function(e){var t=R(e,"x","square"),n=[t];return M.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),Ls="SquaredDifference",qx=P({squaredDifference_:function(e,t){var n,r=R(e,"a","squaredDifference"),o=R(t,"b","squaredDifference");n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return M.runKernelFunc(function(s,u){var l=s.squaredDifference(r,o);return u([r,o]),l},i,function(s,u){var l=u[0],c=u[1],f=te(2);return{a:function(){return s.mul(l.sub(c).mul(f))},b:function(){return s.mul(c.sub(l).mul(f))}}},Ls,{},a,[])}}),qI=P({abs_:function(e){var t=R(e,"x","abs");return t.dtype==="complex64"?M.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):M.runKernelFunc(function(n,r){var o=n.abs(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.toFloat().step(-1))}}},"Abs")}}),XI=P({acos_:function(e){var t=R(e,"x","acos");return M.runKernelFunc(function(n,r){var o=n.acos(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(te(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),YI=P({acosh_:function(e){var t=R(e,"x","acosh");return M.runKernelFunc(function(n,r){var o=n.acosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),QI=P({asin_:function(e){var t=R(e,"x","asin");return M.runKernelFunc(function(n,r){var o=n.asin(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(te(1).sub(o.toFloat().square()).sqrt())}}})}}),JI=P({asinh_:function(e){var t=R(e,"x","asinh");return M.runKernelFunc(function(n,r){var o=n.asinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(te(1).add(o.toFloat().square()).sqrt())}}})}}),ZI=P({atan_:function(e){var t=R(e,"x","atan");return M.runKernelFunc(function(n,r){var o=n.atan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().square().add(1))}}})}}),eT=P({atanh_:function(e){var t=R(e,"x","atanh");return M.runKernelFunc(function(n,r){var o=n.atanh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(te(1).sub(o.toFloat().square()))}}})}}),tT=P({ceil_:function(e){var t=R(e,"x","ceil");return M.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),Wp=P({clipByValue_:function(e,t,n){var r=R(e,"x","clipByValue");I(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],i={min:t,max:n};return M.runKernelFunc(function(a,s){var u=a.clip(r,t,n);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(t).logicalAnd(u.lessEqual(n)),Fe(a))}}},"ClipByValue",i,o)}}),nT=P({cos_:function(e){var t=R(e,"x","cos"),n=[t];return M.runKernelFunc(function(r,o){var i=r.cos(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),rT=P({cosh_:function(e){var t=R(e,"x","cosh");return M.runKernelFunc(function(n,r){var o=n.cosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(n)}}})}}),oT=P({erf_:function(e){var t=R(e,"x","erf");return I(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),M.runKernelFunc(function(n,r){var o=n.erf(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),hh=P({exp_:function(e){var t=R(e,"x","exp");return M.runKernelFunc(function(n,r){var o=n.exp(t);return r([o]),o},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),iT=P({expm1_:function(e){var t=R(e,"x","expm1");return M.runKernelFunc(function(n,r){var o=n.expm1(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.exp())}}})}}),aT=P({floor_:function(e){var t=R(e,"x","floor");return M.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),sT=P({log_:function(e){var t=R(e,"x","log"),n=[t];return M.runKernelFunc(function(r,o){var i=r.log(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},n)}}),uT=P({log1p_:function(e){var t=R(e,"x","log1p");return M.runKernelFunc(function(n,r){var o=n.log1p(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.add(1))}}})}}),lT=P({logSigmoid_:function(e){var t=R(e,"x","logSigmoid");return M.runKernelFunc(function(n,r){var o=n.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.neg().sigmoid())}}})}}),Ql=P({neg_:function(e){var t=R(e,"x","neg"),n=[t];return M.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),cT=P({reciprocal_:function(e){var t=R(e,"x","reciprocal");return M.runKernelFunc(function(n,r){var o=n.reciprocal(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.square().neg())}}})}}),fT=P({round_:function(e){var t=R(e,"x","round");return M.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),Xx=P({rsqrt_:function(e){var t=R(e,"x","rsqrt"),n=[t];return M.runKernelFunc(function(r,o){var i=r.rsqrt(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Yx=P({sigmoid_:function(e){var t=R(e,"x","sigmoid");return M.runKernelFunc(function(n,r){var o=n.sigmoid(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.mul(te(1).sub(o)))}}},"Sigmoid")}}),dT=P({sign_:function(e){var t=R(e,"x","sign");return M.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),hT=P({isNaN_:function(e){var t=R(e,"x","isNaN");return M.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),pT=P({isInf_:function(e){var t=R(e,"x","isInf");return M.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),vT=P({isFinite_:function(e){var t=R(e,"x","isFinite");return M.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return Fe(n)}}})}}),mT=P({sin_:function(e){var t=R(e,"x","sin"),n=[t];return M.runKernelFunc(function(r,o){var i=r.sin(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},n)}}),gT=P({sinh_:function(e){var t=R(e,"x","sinh");return M.runKernelFunc(function(n,r){var o=n.sinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(n)}}})}}),yT=P({softplus_:function(e){var t=R(e,"x","softplus");return M.runKernelFunc(function(n,r){var o=n.softplus(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.sigmoid())}}})}}),xT=P({sqrt_:function(e){var t=R(e,"x","sqrt");return M.runKernelFunc(function(n,r){var o=n.sqrt(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().sqrt().mul(2))}}})}}),wT=P({step_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","step");return M.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Fe(r)}}})}}),bT=P({tan_:function(e){var t=R(e,"x","tan");return M.runKernelFunc(function(n,r){var o=n.tan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.cos().square())}}})}}),ET=P({tanh_:function(e){var t=R(e,"x","tanh");return M.runKernelFunc(function(n,r){var o=n.tanh(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return te(1).sub(o.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function Qx(e,t,n,r,o,i){var a,s,u=R(e,"x","batchNorm"),l=R(t,"mean","batchNorm"),c=R(n,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),I(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),I(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Qs(u,l,c,s,a,i)}function Jx(e,t,n,r,o,i){var a,s,u=R(e,"x","batchNorm"),l=R(t,"mean","batchNorm"),c=R(n,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),I(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),I(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Qs(u,l,c,s,a,i)}function Zx(e,t,n,r,o,i){var a,s,u=R(e,"x","batchNorm"),l=R(t,"mean","batchNorm"),c=R(n,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),I(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),I(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),I(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Qs(u,l,c,s,a,i)}function Qs(e,t,n,r,o,i){i==null&&(i=.001);var a,s,u,l=R(e,"x","batchNorm"),c=R(t,"mean","batchNorm"),f=R(n,"variance","batchNorm");o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),I(c.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var d=[l,c,f,a];return M.runKernelFunc(function(h,p){var m=h.batchNormalization(u,ju(c),ju(f),i,ju(a),ju(s));return p([l,c,f,a]),m},{x:l,mean:c,variance:f,scale:a,offset:s},function(h,p){var m=p,g=m[0],v=m[1],y=m[2],x=m[3],w=x??te(1),b=_t(v.shape,u.shape),C=[];if(v.rank===1){for(var S=0;S<u.shape.length-1;++S)C.push(u.shape[S]);C.push(1)}var E=g.sub(v),k=h.mul(w),_=Xx(y.add(te(i))),T=_.mul(_).mul(_).mul(te(-.5));return{x:function(){return v.rank===1?h.mul(na(_.as4D(1,1,1,v.shape[0]),C)).mul(w).reshape(g.shape):h.mul(_).mul(w).reshape(g.shape)},mean:function(){var D=_.mul(te(-1)).mul(k);return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)},variance:function(){var D=T.mul(E).mul(k);return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)},scale:function(){var D=E.mul(_),z=h.mul(D);return v.rank===1&&(z=z.sum(b)),z.reshape(v.shape)},offset:function(){var D=h;return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(l.shape)}function ju(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Pc(){px("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var CT=P({batchNormalization2d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),Pc(),Qx(e,t,n,i,o,r)}}),_T=P({batchNormalization3d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),Pc(),Jx(e,t,n,i,o,r)}}),ST=P({batchNormalization4d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),Pc(),Zx(e,t,n,i,o,r)}}),kT=P({batchNormalization_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),Pc(),Qs(e,t,n,i,o,r)}}),ew=P({batchNorm_:Qs}),RT=P({batchNorm2d_:Qx}),IT=P({batchNorm3d_:Jx}),TT=P({batchNorm4d_:Zx}),Ac=P({logicalAnd_:function(e,t){var n=R(e,"a","logicalAnd","bool"),r=R(t,"b","logicalAnd","bool");return Ne(n.shape,r.shape),M.runKernelFunc(function(o){return o.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),DT=P({logicalNot_:function(e){var t=R(e,"x","logicalNot","bool");return M.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),tw=P({logicalOr_:function(e,t){var n=R(e,"a","logicalOr","bool"),r=R(t,"b","logicalOr","bool");return Ne(n.shape,r.shape),M.runKernelFunc(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}}),NT=P({logicalXor_:function(e,t){var n=R(e,"a","logicalXor","bool"),r=R(t,"b","logicalXor","bool");return Ne(n.shape,r.shape),tw(e,t).logicalAnd(Ac(e,t).logicalNot())}}),mi=P({where_:function(e,t,n){var r=R(t,"a","where"),o=R(n,"b","where"),i=R(e,"condition","where","bool");return Ue(r.shape,o.shape,"Error in where: "),i.rank===1?I(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ue(i.shape,o.shape,"Error in where: "),M.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Fe(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),nw=function(e){return se(this,void 0,void 0,function(){var t,n,r;return ue(this,function(o){switch(o.label){case 0:return[4,(t=R(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Mp(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Te=P({add_:function(e,t){var n,r=R(e,"a","add"),o=R(t,"b","add");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=_t(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=_t(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),PT=P({addN_:function(e){I(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),I(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,i){return R(o,"tensors"+i,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Pt(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return M.runKernelFunc(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),AT=P({addStrict_:function(e,t){var n=R(e,"a","addStrict"),r=R(t,"b","addStrict");return Ue(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),FT=P({atan2_:function(e,t){var n,r=R(e,"a","atan2"),o=R(t,"b","atan2");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Te(u.square(),l.square()),f=a.mul(l.div(c)),d=_t(u.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)},$b:function(){var c=Te(u.square(),l.square()),f=Ql(a.mul(u.div(c))),d=_t(l.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(l.shape)}}})}}),Zn=P({div_:function(e,t){var n,r=R(e,"a","div"),o=R(t,"b","div");if(n=st(r,o),r=n[0],o=n[1],r.dtype==="int32"&&o.dtype==="int32")return rw(r,o);var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),f=_t(u.shape,i);return f.length>0?c.sum(f).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),f=_t(l.shape,i);f.length>0&&(c=c.sum(f).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"Div")}}),MT=P({divNoNan_:function(e,t){var n,r=R(e,"a","div"),o=R(t,"b","div");r=(n=st(r,o))[0],o=n[1];var i=Zn(r,o),a=Fe(i),s=o.equal(a);return mi(s,a,i)}}),OT=P({divStrict_:function(e,t){var n=R(e,"a","div"),r=R(t,"b","div");return Ue(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),rw=P({floorDiv_:function(e,t){var n,r=R(e,"a","floorDiv"),o=R(t,"b","floorDiv");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),f=_t(u.shape,i);return f.length>0?c.sum(f).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),f=_t(l.shape,i);f.length>0&&(c=c.sum(f).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"FloorDiv")}}),$p=P({maximum_:function(e,t){var n,r=R(e,"a","maximum"),o=R(t,"b","maximum");return n=st(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ne(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),LT=P({maximumStrict_:function(e,t){var n=R(e,"a","maximumStrict"),r=R(t,"b","maximumStrict");return Ue(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),ow=P({minimum_:function(e,t){var n,r=R(e,"a","minimum"),o=R(t,"b","minimum");return n=st(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ne(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),BT=P({minimumStrict_:function(e,t){var n=R(e,"a","minimumStrict"),r=R(t,"b","minimumStrict");return Ue(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),WT=P({mod_:function(e,t){var n,r=R(e,"a","mod"),o=R(t,"b","mod");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=_t(u.shape,i);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),f=_t(l.shape,i);return f.length>0?c.sum(f).reshape(l.shape):c}}})}}),$T=P({modStrict_:function(e,t){var n=R(e,"a","modStrict"),r=R(t,"b","modStrict");return Ue(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),qt=P({mul_:function(e,t){var n,r=R(e,"a","mul"),o=R(t,"b","mul");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),f=_t(u.shape,i);return f.length>0?c.sum(f).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),f=_t(l.shape,i);return f.length>0?c.sum(f).reshape(l.shape):c}}},"Mul")}}),zT=P({mulStrict_:function(e,t){var n=R(e,"a","mul"),r=R(t,"b","mul");return Ue(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Jl=P({pow_:function(e,t){var n,r=R(e,"base","pow"),o=R(t,"exp","pow");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape),a=[r,o];return M.runKernelFunc(function(s,u){var l=s.pow(r,o);return u([r,o,l]),l},{a:r,b:o},function(s,u){var l=u[0],c=u[1],f=u[2];return{a:function(){var d=c.toFloat(),h=s.mul(d.mul(l.pow(d.sub(te(1))))),p=_t(l.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(l.shape)},b:function(){var d=l.greater(0),h=l.log().where(d,Fe(l)),p=s.mul(f.mul(h)),m=_t(c.shape,i);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}},"Pow",{},a,[!0])}}),UT=P({powStrict_:function(e,t){return Ue(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),jT=P({squaredDifferenceStrict_:function(e,t){var n=R(e,"a","squaredDifferenceStrict"),r=R(t,"b","squaredDifferenceStrict");return Ue(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),St=P({sub_:function(e,t){var n,r=R(e,"a","sub"),o=R(t,"b","sub");n=st(r,o),r=n[0],o=n[1];var i=Ne(r.shape,o.shape);return M.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=_t(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=_t(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),VT=P({subStrict_:function(e,t){var n=R(e,"a","subStrict"),r=R(t,"b","subStrict");return Ue(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),iw=P({equal_:function(e,t){var n,r=R(e,"a","equal"),o=R(t,"b","equal");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),HT=P({equalStrict_:function(e,t){var n=R(e,"a","equalStrict"),r=R(t,"b","equalStrict");return Ue(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),GT=P({greater_:function(e,t){var n,r=R(e,"a","greater"),o=R(t,"b","greater");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),aw=P({greaterEqual_:function(e,t){var n,r=R(e,"a","greaterEqual"),o=R(t,"b","greaterEqual");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Fe(s)},b:function(){return Fe(u)}}},"GreaterEqual")}}),KT=P({greaterEqualStrict_:function(e,t){var n=R(e,"a","greaterEqualStrict"),r=R(t,"b","greaterEqualStrict");return Ue(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),qT=P({greaterStrict_:function(e,t){var n=R(e,"a","greaterStrict"),r=R(t,"b","greaterStrict");return Ue(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),XT=P({less_:function(e,t){var n,r=R(e,"a","less"),o=R(t,"b","less");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),YT=P({lessEqual_:function(e,t){var n,r=R(e,"a","lessEqual"),o=R(t,"b","lessEqual");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),QT=P({lessEqualStrict_:function(e,t){var n=R(e,"a","lessEqualStrict"),r=R(t,"b","lessEqualStrict");return Ue(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),JT=P({lessStrict_:function(e,t){var n=R(e,"a","lessStrict"),r=R(t,"b","lessStrict");return Ue(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),ZT=P({notEqual_:function(e,t){var n,r=R(e,"a","notEqual"),o=R(t,"b","notEqual");return n=st(r,o),r=n[0],o=n[1],Ne(r.shape,o.shape),M.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),eD=P({notEqualStrict_:function(e,t){var n=R(e,"a","notEqualStrict"),r=R(t,"b","notEqualStrict");return Ue(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Yg(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Qg(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var zp=P({gather_:function(e,t,n){n===void 0&&(n=0);var r=R(e,"x","gather"),o=R(t,"indices","gather","int32");n=kt(n,r.shape)[0];var i=function(a,s,u){for(var l=a.shape[u],c=[],f=1,d=1,h=0;h<u;h++)c.push(a.shape[h]),f*=a.shape[h];for(h=0;h<s.rank;h++)c.push(s.shape[h]);for(h=u+1;h<a.rank;h++)c.push(a.shape[h]),d*=a.shape[h];return{batchSize:f,sliceSize:d,dimSize:l,outputShape:c}}(r,o,n);return M.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),n);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,f=l.slice(0,n),d=f.length,h=l.slice(n,l.length).slice(1),p=h.length,m=Yg(0,d),g=Yg(d+1,d+1+p),v=Qg([f,[c],h]),y=a.reshape(v),x=u.reshape([c]),w=Qg([[d],m,g]),b=y.transpose(w),C=sw(b,x,r.shape[n]),S=Rp(w);return C=C.transpose(S)},indices:function(){return u}}},"Gather",{axis:n}).reshape(i.outputShape)}}),sw=P({unsortedSegmentSum_:function(e,t,n){var r=R(e,"x","unsortedSegmentSum"),o=R(t,"segmentIds","unsortedSegmentSum","int32");return I(ht(n),function(){return"numSegments must be of dtype int"}),M.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,n);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=$p(l,Fe(l)),f=zp(u,c),d=aw(l,te(0,"int32")),h=f.rank-d.rank,p=0;p<h;++p)d=Mn(d,p+1);d=Ac(d,Ra(f.shape,"bool"));var m=Fe(f);return mi(d,f,m)}(i,s)}}})}}),tD=function(e,t,n){return se(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,f,d,h,p,m;return ue(this,function(g){switch(g.label){case 0:for(r=R(e,"tensor","boolMask"),o=R(t,"mask","boolMask","bool"),i=n??0,a=o.rank,s=r.shape,I(a>0,function(){return"mask cannot be scalar"}),Ue(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+a;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+a)),f=r.reshape(c),d=o.reshape([-1]),[4,nw(d)];case 1:return h=g.sent(),p=h.squeeze([1]),m=zp(f,p,i),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),f.dispose(),d.dispose(),h.dispose(),[2,m]}})})};function uw(e,t,n,r,o,i,a){i===void 0&&(i="NHWC"),I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),I(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),I(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),I(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];I(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),I(f===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."}),a!=null&&I(ht(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=Pp(i),h=Ei(s,n.shape,r,1,o,a,!1,d),p=M.runKernelFunc(function(m,g){var v=m.conv2dDerInput(u,n,h);return g([n,u]),v},{dy4D:u,filter:n},function(m,g){var v=g[0],y=g[1];return{dy4D:function(){return jn(m,v,r,o,i,1,a)},filter:function(){return Up(m,y,v.shape,r,o,i,a)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Uf(e){var t=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function lw(e,t,n,r,o){I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,a=t,s=!1;t.rank===4&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],l=a.shape[4];I(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),I(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),I(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),I(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),I(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Xl(i,n.shape,r,1,o),f=M.runKernelFunc(function(d){return d.conv3dDerInput(a,n,c)},{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var nD=P({conv1d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=R(e,"x","conv1d"),u=R(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),I(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),I(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&I(ht(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),I(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),I(hn(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),I(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=jn(d,f,[1,n],r,"NHWC",[1,i],a);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),jn=P({conv2d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=R(e,"x","conv2d"),u=R(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&I(ht(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f=o==="NHWC"?l.shape[3]:l.shape[1];I(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."}),I(hn(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var d=Pp(o),h=Ei(l.shape,u.shape,n,i,r,a,!1,d),p=[u,l],m=M.runKernelFunc(function(g,v){var y=g.conv2d(l,u,h);return v([u,l]),y},{x:l,filter:u},function(g,v){var y=v,x=y[0],w=y[1];return I(xa(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return cw(w.shape,g,x,n,r,o)},filter:function(){return Up(w,g,x.shape,n,r,o)}}},"Conv2D",h,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),rD=P({conv3d_:function(e,t,n,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=R(e,"x","conv3d"),s=R(t,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),I(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),I(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),I(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),I(function(d,h){return Uf(d)||Uf(h)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),I(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Xl(u.shape,s.shape,n,i,r),f=M.runKernelFunc(function(d,h){var p=d.conv3d(u,s,c);return h([u,s]),p},{x:u,$filter:s},function(d,h){I(Uf(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],m=h[1];return{x:function(){return lw(p.shape,d,m,n,r)},$filter:function(){return function(g,v,y,x,w){var b=g;g.rank===4&&(b=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var C=v;C.rank===4&&(C=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),I(b.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+b.shape+"."}),I(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),I(y.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),I(b.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+b.shape[4]+") must match input depth in filter ("+y[3]+"."}),I(C.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+y[4]+")."});var S=Xl(b.shape,y,x,1,w);return M.runKernelFunc(function(E){return E.conv3dDerFilter(b,C,S)},{x5D:b,dy5D:C})}(p,d,m.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Up=P({conv2dDerFilter_:function(e,t,n,r,o,i,a){i===void 0&&(i="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),I(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),I(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),I(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];I(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),I(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),a!=null&&I(ht(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Pp(i),d=Ei(s.shape,n,r,1,o,a,!1,f);return M.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),cw=P({conv2dDerInput_:uw}),Fc=P({depthwiseConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]);var s=R(e,"x","depthwiseConv2d"),u=R(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),I(hn(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),a!=null&&I(ht(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f=Ei(l.shape,u.shape,n,i,r,a,!0),d=[l,u],h=M.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(l,u,f);return m([l,u]),g},{x:l,filter:u},function(p,m){I(xa(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=m[0],v=m[1];return{x:function(){return fw(g.shape,p,v,f)},filter:function(){return dw(g,p,v.shape,f)}}},"DepthwiseConv2dNative",f,d);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),fw=P({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=M.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),dw=P({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),M.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),jp=P({separableConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=R(e,"x","separableConv2d"),u=R(t,"depthwiseFilter","separableConv2d"),l=R(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),I(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),I(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],h=u.shape[3];I(l.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+l.shape[2]+"."});var p=Fc(c,u,r,o,a,i),m=jn(p,l,1,"valid",a);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),oD=P({conv2dTranspose_:function(e,t,n,r,o,i){return uw(n,R(e,"x","conv2dTranspose"),R(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),iD=P({conv3dTranspose_:function(e,t,n,r,o){return lw(n,R(e,"x","conv3dTranspose"),R(t,"filter","conv3dTranspose"),r,o)}}),Mc=P({matMul_:function(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var i=R(e,"a","matMul"),a=R(t,"b","matMul");o=st(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),d=a.shape.slice(0,-2),h=le(f),p=le(d);I(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),I(Pt(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),I(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,c]),g=n?i.as3D(h,s,l):i.as3D(h,l,s),v=r?a.as3D(p,c,u):a.as3D(p,u,c),y={transposeA:n,transposeB:r};return M.runKernelFunc(function(x,w){var b=x.batchMatMul(g,v,n,r);return w([g,v]),b},{a:g,b:v},function(x,w){var b=w,C=b[0],S=b[1];return n||r?!n&&r?{a:function(){return x.matMul(S,!1,!1)},b:function(){return x.matMul(C,!0,!1)}}:n&&!r?{a:function(){return S.matMul(x,!1,!0)},b:function(){return C.matMul(x,!1,!1)}}:{a:function(){return S.matMul(x,!0,!0)},b:function(){return x.matMul(C,!0,!0)}}:{a:function(){return x.matMul(S,!1,!0)},b:function(){return C.matMul(x,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),aD=P({dot_:function(e,t){var n=R(e,"t1","dot"),r=R(t,"t2","dot");I(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];return I(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),sD=P({outerProduct_:function(e,t){var n=R(e,"v1","outerProduct"),r=R(t,"v2","outerProduct");return I(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Js=P({reverse_:function(e,t){var n=R(e,"x","reverse");if(n.rank===0)return n.clone();var r=kt(t,n.shape);return M.runKernelFunc(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}}),uD=P({reverse1d_:function(e){var t=R(e,"x","reverse");return I(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Js(t,0)}}),lD=P({reverse2d_:function(e,t){var n=R(e,"x","reverse");return I(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Js(n,t)}}),cD=P({reverse3d_:function(e,t){var n=R(e,"x","reverse");return I(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Js(n,t)}}),fD=P({reverse4d_:function(e,t){var n=R(e,"x","reverse");return I(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Js(n,t)}});function hw(e,t,n,r,o,i){var a=R(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),I(hn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),i!=null&&I(ht(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Os(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&Pt(l.inShape,l.outShape))return a.clone();var c=[s],f=M.runKernelFunc(function(d,h){var p=d.maxPool(s,l);return h([s,p]),p},{x:s},function(d,h){var p=h[0],m=h[1];return{x:function(){return function(g,v,y,x,w,b,C,S){var E=R(g,"dy","maxPoolBackprop"),k=R(v,"input","maxPoolBackprop"),_=R(y,"output","maxPoolBackprop");I(k.rank===E.rank,function(){return"Rank of input ("+k.rank+") does not match rank of dy ("+E.rank+")"}),I(hn(w,b),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),I(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),I(k.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+k.rank+"."});var T=Os(k.shape,x,w,b,C,S);return M.runKernelFunc(function(D){return D.maxPoolBackprop(E,k,_,T)},{$dy:E,$input:k})}(d,p,m,t,n,r,o)}}},"MaxPool",l,c);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function pw(e,t,n,r,o,i){var a=R(e,"x","avgPool","float32");I(hn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&I(ht(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Os(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&Pt(l.inShape,l.outShape))return a.clone();var c=M.runKernelFunc(function(f){return f.avgPool(s,l)},{x:s},function(f){return{x:function(){return function(d,h,p,m,g,v){var y=R(d,"dy","avgPoolBackprop"),x=R(h,"input","avgPoolBackprop");I(x.rank===y.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+y.rank+")"}),I(hn(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var w=x,b=y,C=!1;x.rank===3&&(C=!0,w=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),b=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),I(b.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+b.rank+"."}),I(w.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var S=Os(w.shape,p,m,g,v),E=M.runKernelFunc(function(k){return k.avgPoolBackprop(b,w,S)},{dy4D:b,input4D:w});return C?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(f,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Tt=P({maxPool_:function(e,t,n,r,o){return hw(e,t,n,1,r,o)}}),Zs=P({avgPool_:function(e,t,n,r,o){return pw(e,t,n,1,r,o)}}),dD=P({pool_:function(e,t,n,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=R(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(hn(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=Os(s.shape,t,i,o,r),f=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(w,b){var C=w.map(function(k,_){return k+(k-1)*(b[_]-1)}).map(function(k){return k-1}),S=C.map(function(k){return Math.floor(k/2)}),E=C.map(function(k,_){return k-S[_]});return C.map(function(k,_){return[S[_],E[_]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,h=function(w,b,C){var S=C.map(function(W){return W[0]}),E=C.map(function(W){return W[1]}),k=w.concat(S,E),_=b.map(function(W,V){return(W-k[V]%W)%W}),T=E.map(function(W,V){return W+_[V]}),D=b.map(function(W,V){return[S[V],T[V]]}),z=b.map(function(W,V){return[0,_[V]]});return[D,z]}([c.inHeight,c.inWidth],f,l),p=h[0],m=h[1],g=d?r:"valid",v=d?s:wx(s,f,p),y=(n==="avg"?function(){return pw(v,t,i,1,g)}:function(){return hw(v,t,i,1,g)})(),x=d?y:gx(y,f,m);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),hD=P({maxPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=R(e,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),I(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),I(hn(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&I(ht(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=ql(u.shape,t,n,a,r,o,i),f=M.runKernelFunc(function(d,h){var p=d.maxPool3d(u,c);return h([u,p]),p},{x:u},function(d,h){var p=h[0],m=h[1];return{x:function(){return function(g,v,y,x,w,b,C,S){var E=R(g,"dy","maxPool3dBackprop"),k=R(v,"input","maxPool3dBackprop"),_=R(y,"output","maxPool3dBackprop"),T=E,D=k,z=_,W=!1;k.rank===4&&(W=!0,T=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),D=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),z=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),I(T.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+T.rank+"."}),I(D.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+D.rank+"."}),I(z.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+z.rank+"."}),b==null&&(b=[1,1,1]),I(hn(w,b),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),S!=null&&I(ht(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+C+"."});var V=ql(D.shape,x,w,b,C,S),K=M.runKernelFunc(function(G){return G.maxPool3dBackprop(T,D,z,V)},{dy5D:T,input5D:D});return W?K.as4D(K.shape[1],K.shape[2],K.shape[3],K.shape[4]):K}(d,p,m,t,n,a,r,o)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),pD=P({avgPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=R(e,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),I(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),I(hn(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&I(ht(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=ql(u.shape,t,n,a,r,o,i),f=M.runKernelFunc(function(d){return d.avgPool3d(u,c)},{x:u},function(d){return{x:function(){return function(h,p,m,g,v,y,x){var w=R(h,"dy","avgPool3dBackprop"),b=R(p,"input","avgPool3dBackprop"),C=w,S=b,E=!1;b.rank===4&&(E=!0,C=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),S=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),I(C.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."}),I(S.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."}),v==null&&(v=[1,1,1]),I(hn(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),x!=null&&I(ht(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+y+"."});var k=ql(S.shape,m,g,v,y,x),_=M.runKernelFunc(function(T){return T.avgPool3dBackprop(C,S,k)},{dy5D:C,input5D:S});return E?_.as4D(_.shape[1],_.shape[2],_.shape[3],_.shape[4]):_}(d,u,t,n,a,r,o)}}});return f=f.cast(u.dtype),l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Sr=P({slice_:function(e,t,n){var r,o,i=R(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(u){I(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=n==null?new Array(i.rank).fill(-1):typeof n=="number"?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(I(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),i.shape[l]-r[l])}),Uk(i,r,o);var a=i.shape,s={begin:r,size:o};return M.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-o[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),vD=P({slice1d_:function(e,t,n){var r=R(e,"x","slice1d");return I(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Sr(r,[t],[n])}}),mD=P({slice2d_:function(e,t,n){var r=R(e,"x","slice2d");return I(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Sr(r,t,n)}}),vw=P({slice3d_:function(e,t,n){var r=R(e,"x","slice3d");return I(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Sr(r,t,n)}}),gD=P({slice4d_:function(e,t,n){var r=R(e,"x","slice4d");return I(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Sr(r,t,n)}});function mw(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(dn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(dn(e.shape,r))),{x:function(){var i=e.mul(n.equal(t).cast(e.dtype));return o==null?i:i.transpose(o)}}}var yD=P({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","all","bool"),o=kt(t,r.shape),i=o,a=Rr(i,r.rank);a!=null&&(r=r.transpose(a),i=Ir(i.length,r.rank));var s=M.runKernelFunc(function(l){return l.all(r,i)},{$x:r});if(n){var u=dn(s.shape,o);return s.reshape(u)}return s}}),xD=P({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","any","bool"),o=kt(t,r.shape),i=o,a=Rr(i,r.rank);a!=null&&(r=r.transpose(a),i=Ir(i.length,r.rank));var s=M.runKernelFunc(function(l){return l.any(r,i)},{$x:r});if(n){var u=dn(s.shape,o);return s.reshape(u)}return s}}),wD=P({argMax_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","argMax");t==null&&(t=0);var r=kt(t,n.shape),o=Rr(r,n.rank);o!=null&&(n=n.transpose(o),r=Ir(r.length,n.rank));var i={axis:r[0]},a=[n];return M.runKernelFunc(function(s,u){var l=s.argMax(n,r[0]);return u([n]),l},{x:n},function(s,u){var l=u[0];return{x:function(){return Fe(l)}}},"ArgMax",i,a)}}),bD=P({argMin_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","argMin");t==null&&(t=0);var r=kt(t,n.shape),o=Rr(r,n.rank);return o!=null&&(n=n.transpose(o),r=Ir(r.length,n.rank)),M.runKernelFunc(function(i,a){var s=i.argMin(n,r[0]);return a([n]),s},{$x:n},function(i,a){var s=a[0];return{$x:function(){return Fe(s)}}})}}),ED=P({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","logSumExp"),o=kt(t,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=dn(s.shape,o);return s.reshape(u)}return s}}),Oc=P({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","max"),o=r,i=kt(t,r.shape),a=i,s=Rr(a,r.rank);s!=null&&(r=r.transpose(s),a=Ir(a.length,r.rank));var u=[r],l=M.runKernelFunc(function(f,d){var h=f.max(r,a);return d([o,h]),h},{x:r},function(f,d){return mw(f,d[1],d[0],i,s)},"Max",{axes:a},u,[!0]);if(n){var c=dn(l.shape,i);l=l.reshape(c)}return l}}),CD=P({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","mean"),o=kt(t,r.shape),i=le(jt(r.shape,o)[1]);return Nc(function(a){var s=te(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(t,n),gradFunc:function(u){var l=a.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(Ra(a.shape,"float32")).div(i)}}})(r)}}),_D=P({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","min"),o=r,i=kt(t,r.shape),a=i,s=Rr(a,r.rank);s!=null&&(r=r.transpose(s),a=Ir(a.length,r.rank));var u=[r],l=M.runKernelFunc(function(f,d){var h=f.min(r,a);return d([o,h]),h},{x:r},function(f,d){return mw(f,d[1],d[0],i,s)},"Min",{axes:a},u,[!0]);if(n){var c=dn(l.shape,i);l=l.reshape(c)}return l}}),SD=P({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=kt(t,(e=R(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;n||(i=dn(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),gw=P({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=kt(t,r.shape);return Nc(function(i){var a=Rr(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=Ir(s.length,i.rank));var l=function(h){var p=i.shape.slice();return o.forEach(function(m){p[m]=1}),h.reshape(p).mul(Ra(i.shape,"float32"))},c={axes:s},f=M.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return l(h)}}},"Sum",c);if(n){var d=dn(f.shape,o);f=f.reshape(d)}return{value:f,gradFunc:l}})(r)}}),kD=P({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=kt(t,r.shape),i=Rr(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=Ir(a.length,r.rank));var u=M.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(n){var l=dn(u.shape,o);u=u.reshape(l)}return u}}),yw=P({elu_:function(e){var t=R(e,"x","elu");return M.runKernelFunc(function(n,r){var o=n.elu(t);return r([o]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return M.runKernelFunc(function(i){return i.eluDer(n,o)},{dy:n,y:o})}}})}}),RD=P({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=R(e,"x","leakyRelu");return $p(te(t).mul(n),n)}}),xw=P({prelu_:function(e,t){var n=R(e,"x","prelu"),r=R(t,"alpha","prelu");return M.runKernelFunc(function(o,i){var a=o.prelu(n,r);return i([n,r]),a},{x:n,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return mi(u,o,o.mul(s))},alpha:function(){var l=mi(u,Fe(o),o.mul(a)),c=_t(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),ot=P({relu_:function(e){var t=R(e,"x","relu");return t.dtype==="bool"?t.toInt():M.runKernelFunc(function(n,r){var o=n.relu(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mulStrict(o.step().toFloat())}}},"Relu")}}),ww=P({relu6_:function(e){var t=R(e,"x","relu6");return t.dtype==="bool"?t.toInt():M.runKernelFunc(function(n,r){var o=n.relu6(t);return r([t]),o},{x:t},function(n,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return n.mulStrict(i.toFloat())}}},"Relu6")}}),ID=P({selu_:function(e){var t=R(e,"x","selu");return M.runKernelFunc(function(n,r){var o=n.selu(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){var i=o.greater(te(0)),a=te(Lp),s=te(Bp),u=n.mul(s),l=n.mul(a).mul(o.toFloat().exp());return mi(i,u,l)}}})}}),Po=P({transpose_:function(e,t){var n=R(e,"x","transpose");if(t==null&&(t=n.shape.map(function(o,i){return i}).reverse()),I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(o){I(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return M.runKernelFunc(function(o){return o.transpose(n,t)},{x:n},function(o){var i=Rp(t);return{x:function(){return o.transpose(i)}}},"Transpose",r)}}),TD=P({localResponseNormalization_:function(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=R(e,"x","localResponseNormalization");I(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),I(ht(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=M.runKernelFunc(function(l,c){var f=l.localResponseNormalization4D(a,t,n,r,o);return c([a,f]),f},{x4D:a},function(l,c){var f=c[0],d=c[1];return{x4D:function(){return M.runKernelFunc(function(h){return h.LRNGrad(l,f,d,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),bw=P({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(te(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(e=R(e,"x","norm"),t,n),i=o.shape;if(r){var a=kt(n,e.shape);i=dn(o.shape,a)}return o.reshape(i)}}),DD=P({basicLSTMCell_:function(e,t,n,r,o,i){var a=R(e,"forgetBias","basicLSTMCell"),s=R(t,"lstmKernel","basicLSTMCell"),u=R(n,"lstmBias","basicLSTMCell"),l=R(r,"data","basicLSTMCell"),c=R(o,"c","basicLSTMCell"),f=R(i,"h","basicLSTMCell"),d=l.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,m=[h,p],g=d.slice([0,0],m),v=d.slice([0,p],m),y=d.slice([0,2*p],m),x=d.slice([0,3*p],m),w=g.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(a.add(y).sigmoid())),b=w.tanh().mulStrict(x.sigmoid());return[w,b]}}),ND=P({multiRNNCell_:function(e,t,n,r){for(var o=R(t,"data","multiRNNCell"),i=Ul(n,"c","multiRNNCell"),a=Ul(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],d=[];for(l=0;l<u.length;l+=2)f.push(u[l]),d.push(u[l+1]);return[f,d]}}),PD=P({movingAverage_:function(e,t,n,r,o){o===void 0&&(o=!0);var i=R(e,"v","movingAverage"),a=R(t,"x","movingAverage"),s=R(n,"decay","movingAverage");TS(i,a),I(Pt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=te(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){I(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=R(r,"step","movingAverage");c=c.div(u.sub(Jl(s,f)))}return i.add(c)}}),AD=P({stridedSlice_:function(e,t,n,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=R(e,"x","stridedSlice"),c=Dg(s),f=l.shape.slice();c.forEach(function(g){t[g]=0,n[g]=1,f.splice(g,0,1)}),l=l.reshape(f);for(var d=0;d<l.rank;d++)t[d]=jk(o,t,r,l.shape,d),n[d]=Vk(i,n,r,l.shape,d),r[d]=r[d]||1;var h=Dg(u);h.forEach(function(g){n[g]=t[g]+1,r[g]=1});var p=Np(t,n,r),m=p.filter(function(g,v){return h.indexOf(v)===-1});return r.every(function(g){return g===1})?Sr(l,t,p).reshape(m):M.runKernelFunc(function(g){return g.stridedSlice(l,t,n,r)},{$x:l}).reshape(m)}}),FD=P({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=R(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=M.runKernelFunc(function(a){return a.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),MD=P({scatterND_:function(e,t,n){var r=R(e,"indices","scatterND","int32"),o=R(t,"updates","scatterND");return zk(o,r,n),M.runKernelFunc(function(i){return i.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Vp=P({fft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return M.runKernelFunc(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}}),Zl=P({ifft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return M.runKernelFunc(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}}),Hp=P({rfft_:function(e,t){I(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(t!=null&&t<r){var i=e.shape.map(function(v){return 0}),a=e.shape.map(function(v){return v});a[e.shape.length-1]=t,n=e.slice(i,a),r=t}else if(t!=null&&t>r){var s=e.shape.map(function(v){return v});s[e.shape.length-1]=t-r,n=e.concat(Je(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=Mt(n,u).as2D(o,r),c=Vp(l),f=Math.floor(r/2)+1,d=Ln(c),h=gr(c),p=d.split([f,r-f],d.shape.length-1),m=h.split([f,r-f],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=f,Mt(p[0],m[0]).reshape(g)}}),Ew=P({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=Zl(r);return Ln(o)}var i=[n,2*(t-1)],a=Ln(e).as2D(n,t),s=gr(e).as2D(n,t),u=a.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(te(-1)),c=a.concat(u,1),f=s.concat(l,1);return r=Mt(c,f).as2D(i[0],i[1]),o=Zl(r),Ln(o)}}),OD=Object.freeze({fft:Vp,ifft:Zl,rfft:Hp,irfft:Ew}),LD=P({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var o=R(e,"sparseIndices","sparseToDense","int32"),i=R(t,"sparseValues","sparseToDense"),a=R(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var f=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(l.length!==d)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+d+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==f))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+f+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),M.runKernelFunc(function(s){return s.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),BD=P({gatherND_:function(e,t){var n=R(t,"indices","gatherND","int32"),r=R(e,"x","gatherND");return M.runKernelFunc(function(o){return o.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),WD=P({diag_:function(e){var t=R(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return M.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),$D=P({dropout_:function(e,t,n,r){var o=R(e,"x","dropout");if(I(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),I(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof rt?o.clone():o;var i=function(u,l){if(l==null)return u.shape.slice();if(Pt(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],f=0;f<u.shape.length;f++)l[f]==null&&u.shape[f]!=null?c.push(u.shape[f]):c.push(l[f]);return c}return l}(o,n),a=1-t,s=xx(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function Cw(e,t,n){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=t-n*Math.cos(a)}return yt(o,"float32")}var Gp=P({hannWindow_:function(e){return Cw(e,.5,.5)}}),_w=P({hammingWindow_:function(e){return Cw(e,.54,.46)}}),Kp=P({frame_:function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+t<=e.size;)a.push(Sr(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Et([Sr(e,i,t-s),Cr([s],o)]);a.push(u),i+=n}return a.length===0?Ro([],[0,t]):Et(a).as2D(a.length,t)}}),Sw=P({stft_:function(e,t,n,r,o){var i;o===void 0&&(o=Gp),r==null&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Kp(e,t,n),s=qt(a,o(t)),u=[],l=0;l<a.shape[0];l++)u.push(Hp(s.slice([l,0],[1,t]),r));return Et(u)}}),zD=Object.freeze({hannWindow:Gp,hammingWindow:_w,frame:Kp,stft:Sw}),Kt,UD=function(e,t,n){return n===void 0&&(n=1),se(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,f,d,h,p,m,g;return ue(this,function(v){switch(v.label){case 0:return r=R(e,"predictions","inTopK"),o=R(t,"targets","inTopK"),I(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),I(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Ue(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],I(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],c=u[1],f=As("bool",l=u[0]),d=0;d<l;d++){for(h=d*c,p=a.subarray(h,h+c),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(y,x){return x.value-y.value}),f[d]=0,g=0;g<n;g++)if(m[g].index===s[d]){f[d]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,Lt(f,o.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Kt||(Kt={}));var jD=P({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Kt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","absoluteDifference"),i=R(t,"predictions","absoluteDifference"),a=null;n!=null&&(a=R(n,"weights","absoluteDifference")),Ue(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Yr(s,a,r)}}),Yr=P({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Kt.SUM_BY_NONZERO_WEIGHTS);var r=R(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=R(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(n===Kt.NONE)return i;if(n===Kt.SUM)return i.sum();if(n===Kt.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(te(a)):s}if(n===Kt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(te(r.size));var u=o.mul(Ra(r.shape)).notEqual(te(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),VD=P({cosineDistance_:function(e,t,n,r,o){o===void 0&&(o=Kt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","cosineDistance"),a=R(t,"predictions","cosineDistance"),s=null;r!=null&&(s=R(r,"weights","cosineDistance")),Ue(i.shape,a.shape,"Error in cosineDistance: ");var u=te(1).sub(i.mul(a).sum(n,!0));return Yr(u,s,o)}}),HD=P({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Kt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","hingeLoss"),i=R(t,"predictions","hingeLoss"),a=null;n!=null&&(a=R(n,"weights","hingeLoss")),Ue(o.shape,i.shape,"Error in hingeLoss: ");var s=te(1);o=te(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Yr(u,a,r)}}),GD=P({huberLoss_:function(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Kt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","huberLoss"),a=R(t,"predictions","huberLoss"),s=null;n!=null&&(s=R(n,"weights","huberLoss")),Ue(i.shape,a.shape,"Error in huberLoss: ");var u=te(r),l=a.sub(i).abs(),c=ow(l,u),f=l.sub(c),d=te(.5).mul(c.square()).add(u.mul(f));return Yr(d,s,o)}}),KD=P({logLoss_:function(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Kt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","logLoss"),a=R(t,"predictions","logLoss"),s=null;n!=null&&(s=R(n,"weights","logLoss")),Ue(i.shape,a.shape,"Error in logLoss: ");var u=te(1),l=te(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return Yr(c,s,o)}}),qD=P({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Kt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","meanSquaredError"),i=R(t,"predictions","meanSquaredError"),a=null;n!=null&&(a=R(n,"weights","meanSquaredError")),Ue(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Yr(s,a,r)}}),XD=P({sigmoidCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Kt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"multiClassLabels","sigmoidCrossEntropy"),a=R(t,"logits","sigmoidCrossEntropy"),s=null;if(n!=null&&(s=R(n,"weights","sigmoidCrossEntropy")),Ue(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=te(r),l=te(1),c=te(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var f=function(d,h){var p=R(d,"labels","sigmoidCrossEntropyWithLogits"),m=R(h,"logits","sigmoidCrossEntropyWithLogits");Ue(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),y=m.abs().neg().exp().log1p();return g.sub(v).add(y)}(i,a);return Yr(f,s,o)}}),YD=P({softmaxCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Kt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"onehotLabels","softmaxCrossEntropy"),a=R(t,"logits","softmaxCrossEntropy"),s=null;if(n!=null&&(s=R(n,"weights","softmaxCrossEntropy")),Ue(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=te(r),l=te(1),c=te(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var f=function(d,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return Nc(function(m,g,v){var y=g.logSumExp([p],!0),x=g.toFloat().sub(y);return v([m,x]),{value:x.mul(m).neg().sum([p]),gradFunc:function(w,b){var C=b[0],S=b[1],E=dn(w.shape,[p]);return[w.reshape(E).mul(C.toFloat().sub(S.exp())),w.reshape(E).mul(S.exp().sub(C.toFloat()))]}}})(d,h)}(i,a);return Yr(f,s,o)}}),QD=Object.freeze({get Reduction(){return Kt},absoluteDifference:jD,computeWeightedLoss:Yr,cosineDistance:VD,hingeLoss:HD,huberLoss:GD,logLoss:KD,meanSquaredError:qD,sigmoidCrossEntropy:XD,softmaxCrossEntropy:YD});function Jg(e,t){return t===void 0&&(t=!1),M.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=yx(n),i=e.clone(),a=Ro([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(f){var d,h=i,p=s,m=o;d=M.tidy(function(){var g=i.slice([f,f],[n-f,1]),v=g.norm(),y=i.slice([f,f],[1,1]),x=Ro([[-1]]).where(y.greater(0),Ro([[1]])),w=y.sub(x.mul(v)),b=g.div(w);s=b.shape[0]===1?a.clone():a.concat(b.slice([1,0],[b.shape[0]-1,b.shape[1]]),0);var C=x.matMul(w).div(v).neg(),S=i.slice([f,0],[n-f,r]),E=C.mul(s);if(f===0)i=S.sub(E.matMul(s.transpose().matMul(S)));else{var k=S.sub(E.matMul(s.transpose().matMul(S)));i=i.slice([0,0],[f,r]).concat(k,0)}var _=o.slice([0,f],[n,o.shape[1]-f]);if(f===0)o=_.sub(_.matMul(s).matMul(E.transpose()));else{var T=_.sub(_.matMul(s).matMul(E.transpose()));o=o.slice([0,0],[n,f]).concat(T,1)}return[s,i,o]}),s=d[0],i=d[1],o=d[2],fn([h,p,m])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var JD=P({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=R(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),n<0&&(n=s);var u=jl(0,a,1,"int32").reshape([-1,1]),l=jl(0,s,1,"int32"),c=St(u,l),f=Ac(c.lessEqual(te(+t,"int32")),c.greaterEqual(te(-n,"int32"))),d=Je([a,s],r.dtype);return Sn(Ct(r.reshape([-1,a,s])).map(function(h){return mi(f,h,d)})).reshape(o)}}),ZD=P({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,I(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(u){I(e[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Tp(e,e.shape[0],0).map(function(u){return bx(u,[0])});I(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],a=e,s=function(u){i.push(M.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var f=gw(i[c].mulStrict(l)).mul(i[c]);l=l.sub(f)}return l.div(bw(l,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Sn(i,0):i}}),eN=P({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return Jg(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(a,s){return a*s}),r=Ct(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=Jg(a,t),u=s[0],l=s[1];o.push(u),i.push(l)}),[Sn(o,0).reshape(e.shape),Sn(i,0).reshape(e.shape)]}}),tN=Object.freeze({bandPart:JD,gramSchmidt:ZD,qr:eN});function Lc(e,t,n,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=e.shape[0];return n=Math.min(n,a),I(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),I(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),I(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),I(t.rank===1,function(){return"scores must be a 1D tensor"}),I(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),I(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var nN=P({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=R(e,"images","resizeBilinear");I(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=M.runKernelFunc(function(l,c){return c([o]),l.resizeBilinear(o,a,s,n)},{x:o},function(l,c){return{x:function(){return M.runKernelFunc(function(f){return f.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),rN=P({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=R(e,"images","resizeNearestNeighbor");I(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),I(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=M.runKernelFunc(function(l,c){return c([o]),l.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(l,c){return{batchImages:function(){return M.runKernelFunc(function(f){return f.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),oN=P({nonMaxSuppression_:function(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=R(e,"boxes","nonMaxSuppression"),a=R(t,"scores","nonMaxSuppression"),s=Lc(i,a,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return M.runKernelFunc(function(l){return l.nonMaxSuppression(i,a,n,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),iN=function(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),se(this,void 0,void 0,function(){var i,a,s,u,l,c,f;return ue(this,function(d){switch(d.label){case 0:return i=R(e,"boxes","nonMaxSuppressionAsync"),a=R(t,"scores","nonMaxSuppressionAsync"),s=Lc(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],f=Ap(l,c,n,r,o),i!==e&&i.dispose(),a!==t&&a.dispose(),[2,f]}})})},aN=P({nonMaxSuppressionWithScore_:function(e,t,n,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=R(e,"boxes","nonMaxSuppression"),s=R(t,"scores","nonMaxSuppression"),u=Lc(a,s,n,r,o,i),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},c=M.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),sN=function(e,t,n,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),se(this,void 0,void 0,function(){var a,s,u,l,c,f,d;return ue(this,function(h){switch(h.label){case 0:return a=R(e,"boxes","nonMaxSuppressionAsync"),s=R(t,"scores","nonMaxSuppressionAsync"),u=Lc(a,s,n,r,o,i),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=h.sent(),c=l[0],f=l[1],d=Fp(c,f,n,r,o,i),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,d]}})})},uN=P({cropAndResize_:function(e,t,n,r,o,i){var a=R(e,"image","cropAndResize"),s=R(t,"boxes","cropAndResize","float32"),u=R(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return I(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),I(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),I(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),I(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),I(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),I(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),M.runKernelFunc(function(c,f){return c.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),qp=Object.freeze({resizeBilinear:nN,resizeNearestNeighbor:rN,nonMaxSuppression:oN,nonMaxSuppressionAsync:iN,nonMaxSuppressionWithScore:aN,nonMaxSuppressionWithScoreAsync:sN,cropAndResize:uN}),Xp=function(e,t){return!(e>0)||t==="linear"},Yp=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Qp=function(e,t){var n=t,r=_t(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Jp=function(e,t,n){if(t==="linear")return e;if(t==="relu")return ot(e);if(t==="elu")return yw(e);if(t==="relu6")return ww(e);if(t==="prelu")return xw(e,n);throw new Error("Unknown fused activation "+t+".")},lN=P({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,i=o!==void 0&&o,a=e.transposeB,s=a!==void 0&&a,u=e.bias,l=e.activation,c=l===void 0?"linear":l,f=e.preluActivationWeights;if(Xp(M.state.gradientDepth,c)===!1){var d=Mc(n,r,i,s);return u!=null&&(d=Te(d,u)),Jp(d,c,f)}var h=R(n,"a","fused matMul"),p=R(r,"b","fused matMul");t=st(h,p),h=t[0],p=t[1];var m=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),w=p.shape.slice(0,-2),b=le(x),C=le(w);I(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),I(Pt(x,w),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+w+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),I(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var S,E,k=h.shape.slice(0,-2).concat([v,y]),_=i?h.as3D(b,m,v):h.as3D(b,v,m),T=s?p.as3D(C,y,g):p.as3D(C,g,y);u!=null&&Ne(k,(S=st(S=R(u,"bias","fused matMul"),h)[0]).shape),f!=null&&(E=R(f,"prelu weights","fused matMul"));var D={a:_,b:T};u!=null&&(D.bias=S),f!=null&&(D.preluActivationWeights=E);var z=[_,T];return M.runKernelFunc(function(W,V){var K=W.fusedBatchMatMul({a:_,b:T,transposeA:i,transposeB:s,bias:S,activation:c,preluActivationWeights:E});return V([_,T,K]),K},D,function(W,V){var K=V[0],G=V[1],N=V[2],O=Yp(W,N,c),B={};return u!=null&&(B={bias:function(){return Qp(S,O)}}),Object.assign(i||s?!i&&s?{a:function(){return O.matMul(G,!1,!1)},b:function(){return O.matMul(K,!0,!1)}}:i&&!s?{a:function(){return G.matMul(O,!1,!0)},b:function(){return K.matMul(O,!1,!1)}}:{a:function(){return G.matMul(O,!0,!0)},b:function(){return O.matMul(K,!0,!0)}}:{a:function(){return O.matMul(G,!1,!0)},b:function(){return K.matMul(O,!0,!1)}},B)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:c},z,[!0]).reshape(k)}}),cN=P({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=f===void 0?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",Xp(M.state.gradientDepth,d)===!1){var p=jn(t,n,r,o,a,u,l);return c!=null&&(p=Te(p,c)),Jp(p,d,h)}var m=R(t,"x","conv2d"),g=R(n,"filter","conv2d"),v=m,y=!1;m.rank===3&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),I(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),I(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),l!=null&&I(ht(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),I(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),I(hn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),I(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,w,b=Ei(v.shape,g.shape,r,u,o,l);c!=null&&(x=st(x=R(c,"bias","fused conv2d"),m)[0],Ne(b.outShape,x.shape)),h!=null&&(w=R(h,"prelu weights","fused conv2d"));var C={x:v,filter:g};c!=null&&(C.bias=x),h!=null&&(C.preluActivationWeights=w);var S=[g,v],E=M.runKernelFunc(function(k,_){var T=k.fusedConv2d({input:v,filter:g,convInfo:b,bias:x,activation:d,preluActivationWeights:w});return _([g,v,T]),T},C,function(k,_){var T=_,D=T[0],z=T[1],W=T[2],V=Yp(k,W,d);I(xa(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var K={};return c!=null&&(K={bias:function(){return Qp(x,V)}}),Object.assign({x:function(){return cw(z.shape,V,D,r,o)},filter:function(){return Up(z,V,D.shape,r,o)}},K)},"FusedConv2D",{convInfo:b,activation:d},S,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),fN=P({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=f===void 0?"linear":f,h=e.preluActivationWeights;if(Xp(M.state.gradientDepth,d)===!1){var p=Fc(t,n,r,o,a,u,l);return c!=null&&(p=Te(p,c)),Jp(p,d,h)}var m=R(t,"x","depthwiseConv2d"),g=R(n,"filter","depthwiseConv2d"),v=m,y=!1;m.rank===3&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),I(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),I(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),I(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),I(hn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&I(ht(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var x,w,b=Ei(v.shape,g.shape,r,u,o,l,!0);c!=null&&(x=st(x=R(c,"bias","fused conv2d"),m)[0],Ne(b.outShape,x.shape)),h!=null&&(w=R(h,"prelu weights","fused depthwiseConv2d"));var C={x:v,filter:g};c!=null&&(C.bias=x),h!=null&&(C.preluActivationWeights=w);var S=[g,v],E=M.runKernelFunc(function(k,_){var T=k.fusedDepthwiseConv2D({input:v,filter:g,convInfo:b,bias:x,activation:d,preluActivationWeights:w});return _([g,v,T]),T},C,function(k,_){I(xa(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var T=_[0],D=_[1],z=_[2],W=Yp(k,z,d),V={};return c!=null&&(V={bias:function(){return Qp(x,W)}}),Object.assign({x:function(){return fw(D.shape,W,T,b)},filter:function(){return dw(D,W,T.shape,b)}},V)},"FusedDepthwiseConv2D",{convInfo:b,activation:d},S,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),dN=Object.freeze({matMul:lN,conv2d:cN,depthwiseConv2d:fN}),hN=Object.freeze({image:qp,linalg:tN,losses:QD,spectral:OD,fused:dN,signal:zD,square:KI,squaredDifference:qx,conv1d:nD,conv2d:jn,conv3d:rD,depthwiseConv2d:Fc,separableConv2d:jp,conv2dTranspose:oD,conv3dTranspose:iD,op:P,batchNormalization2d:CT,batchNormalization3d:_T,batchNormalization4d:ST,batchNormalization:kT,batchNorm:ew,batchNorm2d:RT,batchNorm3d:IT,batchNorm4d:TT,booleanMaskAsync:tD,complex:Mt,real:Ln,imag:gr,concat:Et,concat1d:dk,concat2d:hk,concat3d:pk,concat4d:vk,split:Tp,matMul:Mc,dot:aD,outerProduct:sD,reverse:Js,reverse1d:uD,reverse2d:lD,reverse3d:cD,reverse4d:fD,maxPool:Tt,avgPool:Zs,pool:dD,maxPool3d:hD,avgPool3d:pD,slice:Sr,slice1d:vD,slice2d:mD,slice3d:vw,slice4d:gD,abs:qI,acos:XI,acosh:YI,asin:QI,asinh:JI,atan:ZI,atanh:eT,ceil:tT,clipByValue:Wp,cos:nT,cosh:rT,erf:oT,exp:hh,expm1:iT,floor:aT,log:sT,log1p:uT,logSigmoid:lT,neg:Ql,reciprocal:cT,round:fT,rsqrt:Xx,sigmoid:Yx,sign:dT,isNaN:hT,isInf:pT,isFinite:vT,sin:mT,sinh:gT,softplus:yT,sqrt:xT,step:wT,tan:bT,tanh:ET,all:yD,any:xD,argMax:wD,argMin:bD,logSumExp:ED,max:Oc,mean:CD,min:_D,moments:SD,sum:gw,prod:kD,equal:iw,equalStrict:HT,greater:GT,greaterEqual:aw,greaterEqualStrict:KT,greaterStrict:qT,less:XT,lessEqual:YT,lessEqualStrict:QT,lessStrict:JT,notEqual:ZT,notEqualStrict:eD,add:Te,addN:PT,addStrict:AT,atan2:FT,div:Zn,divNoNan:MT,divStrict:OT,floorDiv:rw,maximum:$p,maximumStrict:LT,minimum:ow,minimumStrict:BT,mod:WT,modStrict:$T,mul:qt,mulStrict:zT,pow:Jl,powStrict:UT,squaredDifferenceStrict:jT,sub:St,subStrict:VT,elu:yw,leakyRelu:RD,prelu:xw,relu:ot,relu6:ww,selu:ID,logicalAnd:Ac,logicalNot:DT,logicalOr:tw,logicalXor:NT,where:mi,whereAsync:nw,buffer:Ce,print:_k,batchToSpaceND:gx,broadcastTo:Sk,cast:kk,clone:Rk,cumsum:Ik,depthToSpace:Tk,expandDims:Mn,eye:yx,multinomial:Dk,oneHot:lh,pad:bi,pad1d:Nk,pad2d:Pk,pad3d:Ak,pad4d:Fk,rand:Mk,randomNormal:Ok,randomGamma:Lk,randomUniform:xx,reshape:er,spaceToBatchND:wx,squeeze:bx,stack:Sn,tile:na,truncatedNormal:Bk,unstack:Ct,setdiff1dAsync:Wk,fill:Cr,linspace:fk,ones:Ra,range:jl,scalar:te,tensor:Lt,tensor1d:yt,tensor2d:Ro,tensor3d:Ip,tensor4d:on,tensor5d:uk,tensor6d:lk,variable:ck,zeros:Je,onesLike:mx,zerosLike:Fe,transpose:Po,softmax:Xr,logSoftmax:Gk,localResponseNormalization:TD,norm:bw,gather:zp,unsortedSegmentSum:sw,basicLSTMCell:DD,multiRNNCell:ND,movingAverage:PD,stridedSlice:AD,topk:FD,scatterND:MD,fft:Vp,ifft:Zl,rfft:Hp,irfft:Ew,sparseToDense:LD,gatherND:BD,diag:WD,dropout:$D,hannWindow:Gp,hammingWindow:_w,frame:Kp,stft:Sw,inTopKAsync:UD});function X(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&I(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function jf(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var pN=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new Ix(n,M),n}return ir(t,e),t.prototype.write=function(n,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&zl(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:n,dtype:o}),i},t.prototype.move=function(n,r,o,i){this.data.set(n,{values:r,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),o=r.dtype,i=r.complexTensors;return o==="complex64"?dh(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),o=r;if(n.dtype==="string")try{o=r.map(function(i){return Bl(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ce(n.shape,n.dtype,o)},t.prototype.makeOutput=function(n,r,o){var i=this.write(n,r,o);return M.makeTensorFromDataId(i,r,o,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){return r=pr(),n(),[2,{kernelMs:pr()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var o=this.makeOutput(null,n.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:M.keep(n.clone()),imag:M.keep(r.clone())},o},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(X(n,"slice"),kx(n.shape,r,o)){var i=Rx(r,n.strides),a=le(o);return Lt(this.readSync(n.dataId).subarray(i,i+a),o,n.dtype)}for(var s=Ce(o,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(f,d){return f+r[d]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(n,r,o,i){X(n,"stridedSlice");var a=Np(r,o,i);if(a.some(function(h){return h===0}))return Lt([],a);for(var s=Ce(a,n.dtype),u=this.bufferSync(n),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),f=new Array(c.length),d=0;d<f.length;d++)f[d]=c[d]*i[d]+r[d];s.set.apply(s,[u.get.apply(u,f)].concat(c))}return s.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),o=Ce([n.size,n.size],n.dtype),i=o.values,a=0;a<r.length;a++)i[a*n.size+a]=r[a];return o.toTensor()},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.reverse=function(n,r){X(n,"reverse");for(var o=Ce(n.shape,n.dtype),i=this.bufferSync(n),a=function(u){var l=o.indexToLoc(u),c=l.slice();r.forEach(function(f){return c[f]=n.shape[f]-1-c[f]}),o.set.apply(o,[i.get.apply(i,c)].concat(l))},s=0;s<o.size;s++)a(s);return o.toTensor()},t.prototype.concat=function(n,r){var o=this;if(n[0].dtype==="complex64"){var i=n.map(function(h){return Ln(h)}),a=n.map(function(h){return gr(h)});return Mt(this.concat(i,r),this.concat(a,r))}var s=n.map(function(h){var p=le(h.shape.slice(r));return h.as2D(-1,p)}),u=ya(s.map(function(h){return h.shape}),1),l=Ce(u,n[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(h){l.set(o.readSync(h.dataId),c),c+=h.size})}else{var f=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),m=0,g=0;g<h.shape[0];++g)for(var v=g*u[1]+f,y=0;y<h.shape[1];++y)l[v+y]=p[m++];f+=h.shape[1]})}var d=ya(n.map(function(h){return h.shape}),r);return Lt(l,d,n[0].dtype)},t.prototype.neg=function(n){return X(n,"neg"),this.multiply(te(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(n,r,Ot(n.dtype,r.dtype),function(o,i){return o+i})},t.prototype.addN=function(n){var r=this;X(n,"addN");for(var o=n.map(function(c){return r.readSync(c.dataId)}),i=Ce(n[0].shape,n[0].dtype),a=i.values,s=0;s<n.length;s++)for(var u=o[s],l=0;l<a.length;l++)a[l]+=u[l];return i.toTensor()},t.prototype.softmax=function(n,r){var o=kt([r],n.shape),i=this.max(n,o),a=dn(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(n,r,Ot(n.dtype,r.dtype),function(o,i){return o-i})},t.prototype.pow=function(n,r){return X([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.pow(o,i)})},t.prototype.batchMatMul=function(n,r,o,i){X([n,r],"matMul");for(var a=o?n.shape[1]:n.shape[2],s=o?n.shape[2]:n.shape[1],u=i?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),f=this.readSync(r.dataId),d=o?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],h=d[0],p=d[1],m=d[2],g=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=g[0],y=g[1],x=g[2],w=s*u,b=Ce([l,s,u],n.dtype),C=b.values,S=this.blockSize,E=0;E<l;E++)for(var k=0;k<s;k+=S)for(var _=0;_<u;_+=S)for(var T=0;T<a;T+=S)for(var D=Math.min(k+S,s),z=Math.min(_+S,u),W=Math.min(T+S,a),V=k;V<D;V++)for(var K=_;K<z;K++){for(var G=0,N=T;N<W;N++)G+=c[E*h+V*p+N*m]*f[N*v+K*y+E*x];C[E*w+(V*u+K)]+=G}return b.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,o,i,a);return s&&(c=this.add(c,s)),u&&(c=jf(this,c,u,l)),c},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(n,r,Ot(n.dtype,r.dtype),function(o,i){return o*i})},t.prototype.realDivide=function(n,r){return X([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(o,i){return o/i})},t.prototype.floorDiv=function(n,r){return X([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(o,i){return Math.floor(o/i)})},t.prototype.sum=function(n,r){X(n,"sum"),yn("sum",r,n.rank);for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,Ot(n.dtype,"int32")),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=0,p=0;p<u;++p)h+=c[d+p];l[f]=h}return s},t.prototype.prod=function(n,r){X(n,"sum");for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,Ot(n.dtype,"int32")),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=1,p=0;p<u;++p)h*=c[d+p];l[f]=h}return s},t.prototype.unsortedSegmentSum=function(n,r,o){X(n,"unsortedSegmentSum");for(var i=[],a=n.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=te(s,"int32"),l=iw(u,r).asType("float32").mul(n).sum(0);i.push(l)}return Sn(i)},t.prototype.argMin=function(n,r){X(n,"argMin");var o=[r];yn("argMin",o,n.rank);for(var i=jt(n.shape,o),a=i[0],s=i[1],u=Je(a,"int32"),l=le(s),c=this.readSync(u.dataId),f=this.readSync(n.dataId),d=0;d<c.length;++d){for(var h=d*l,p=f[h],m=0,g=0;g<l;++g){var v=f[h+g];v<p&&(p=v,m=g)}c[d]=m}return u},t.prototype.argMax=function(n,r){X(n,"argMax");var o=[r];yn("argMax",o,n.rank);for(var i=jt(n.shape,o),a=i[0],s=i[1],u=Je(a,"int32"),l=le(s),c=this.readSync(u.dataId),f=this.readSync(n.dataId),d=0;d<c.length;++d){for(var h=d*l,p=f[h],m=0,g=0;g<l;++g){var v=f[h+g];v>p&&(p=v,m=g)}c[d]=m}return u},t.prototype.cumsum=function(n,r,o,i){if(X(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var a=Ot(n.dtype,"int32"),s=Je(n.shape,a),u=this.readSync(s.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],f=i?function(g,v){return g+c-v-1}:function(g,v){return g+v},d=0;d<l.length;d+=c)for(var h=0;h<c;h++){var p=f(d,h);if(h===0)u[p]=o?0:l[p];else{var m=f(d,h-1);u[p]=o?l[m]+u[m]:l[p]+u[m]}}return s},t.prototype.equal=function(n,r){return X([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o===i?1:0})},t.prototype.notEqual=function(n,r){return X([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o!==i?1:0})},t.prototype.less=function(n,r){return X([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<i?1:0})},t.prototype.lessEqual=function(n,r){return X([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<=i?1:0})},t.prototype.greater=function(n,r){return X([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>i?1:0})},t.prototype.greaterEqual=function(n,r){return X([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>=i?1:0})},t.prototype.logicalNot=function(n){X(n,"logicalNot");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return X([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o&&i})},t.prototype.logicalOr=function(n,r){return X([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o||i})},t.prototype.select=function(n,r,o){X([n,r,o],"select");for(var i=this.readSync(n.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Je(r.shape,Ot(r.dtype,o.dtype)),l=this.readSync(u.dataId),c=0,f=n.rank===0||n.rank>1||r.rank===1?1:le(r.shape.slice(1)),d=0;d<i.length;d++)for(var h=0;h<f;h++)i[d]===1?l[c++]=a[d]:l[c++]=s[d];return u},t.prototype.where=function(n){X([n],"where");var r=this.readSync(n.dataId);return Mp(n.shape,r)},t.prototype.topk=function(n,r,o){return X(n,"topk"),Ox(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){X(n,"min"),yn("min",r,n.rank);for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,n.dtype),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=c[d],p=0;p<u;++p){var m=c[d+p];m<h&&(h=m)}l[f]=h}return s},t.prototype.minimum=function(n,r){return X([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.min(o,i)})},t.prototype.mod=function(n,r){return X([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},t.prototype.max=function(n,r){X(n,"max"),yn("max",r,n.rank);for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,n.dtype),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=c[d],p=0;p<u;++p){var m=c[d+p];m>h&&(h=m)}l[f]=h}return s},t.prototype.maximum=function(n,r){return X([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.max(o,i)})},t.prototype.all=function(n,r){X(n,"all"),yn("all",r,n.rank);for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,n.dtype),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=c[d],p=0;p<u;++p){var m=c[d+p];h=h&&m}l[f]=h}return s},t.prototype.any=function(n,r){X(n,"any"),yn("any",r,n.rank);for(var o=jt(n.shape,r),i=o[0],a=o[1],s=Je(i,n.dtype),u=le(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),f=0;f<l.length;++f){for(var d=f*u,h=c[d],p=0;p<u;++p){var m=c[d+p];h=h||m}l[f]=h}return s},t.prototype.squaredDifference=function(n,r){return X([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o-i;return a*a})},t.prototype.ceil=function(n){X(n,"ceil");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.floor=function(n){X(n,"floor");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.sign=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,n.shape,"float32")},t.prototype.isNaN=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isInf=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isFinite=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.round=function(n){X(n,"round");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,n.shape,"float32")},t.prototype.exp=function(n){X(n,"exp");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.expm1=function(n){X(n,"expm1");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.log=function(n){X(n,"log");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.log1p=function(n){X(n,"log1p");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.sqrt=function(n){X(n,"sqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.rsqrt=function(n){X(n,"rsqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.reciprocal=function(n){X(n,"reciprocal");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){X(n,"relu");for(var r=Je(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},t.prototype.relu6=function(n){X(n,"relu");for(var r=Je(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},t.prototype.prelu=function(n,r){return X([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return o<0?i*o:o})},t.prototype.elu=function(n){X(n,"elu");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){X([n,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(n.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(n){X(n,"selu");for(var r=Lp,o=Bp,i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,n.shape,"float32")},t.prototype.clip=function(n,r,o){X(n,"clip");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<n.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){X(n,"int");for(var r=new Int32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){X(n,"sigmoid");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){X(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,l=Math.exp(i[a]),c=void 0;c=u?l:s?i[a]:Math.log(1+l),o[a]=c}return this.makeOutput(o,n.shape,"float32")},t.prototype.sin=function(n){X(n,"sin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){X(n,"cos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){X(n,"tan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){X(n,"asin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){X(n,"acos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){X(n,"atan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return X([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.atan2(o,i)})},t.prototype.sinh=function(n){X(n,"sinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){X(n,"cosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){X(n,"tanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=vS(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){X(n,"asinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){X(n,"acosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){X(n,"atanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){X(n,"erf");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),X(n,"step");for(var o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,o,i);return a&&(l=this.add(l,a)),s&&(l=jf(this,l,s,u)),l},t.prototype.conv2d=function(n,r,o){X([n,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,f=o.dataFormat==="channelsLast",d=Ce(o.outShape,n.dtype),h=n.strides[0],p=f?n.strides[1]:n.strides[2],m=f?n.strides[2]:1,g=f?1:n.strides[1],v=d.strides[0],y=f?d.strides[1]:d.strides[2],x=f?d.strides[2]:1,w=f?1:d.strides[1],b=this.readSync(n.dataId),C=this.readSync(r.dataId),S=d.values,E=0;E<o.batchSize;++E)for(var k=E*h,_=E*v,T=0;T<o.outHeight;++T)for(var D=_+T*y,z=T*o.strideHeight-c,W=0;W<i;W++){var V=z+W*s;if(!(V<0||V>=o.inHeight))for(var K=W*r.strides[0],G=k+V*p,N=0;N<o.outWidth;++N)for(var O=D+N*x,B=N*o.strideWidth-l,q=0;q<a;q++){var Q=B+q*u;if(!(Q<0||Q>=o.inWidth))for(var ne=G+Q*m,re=K+q*r.strides[1],ve=0;ve<o.inChannels;++ve){for(var me=b[ne+ve*g],xe=0;xe<o.outChannels;++xe)S[O+xe*w]+=me*C[re+xe];re+=o.outChannels}}}return d.toTensor()},t.prototype.conv3d=function(n,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,l=o.dilationHeight,c=o.dilationWidth,f=o.padInfo.front,d=o.padInfo.left,h=o.padInfo.top,p=Ce(o.outShape,n.dtype),m=this.readSync(n.dataId),g=this.readSync(r.dataId),v=p.values,y=0;y<o.batchSize;++y)for(var x=y*n.strides[0],w=y*p.strides[0],b=0;b<o.outDepth;++b)for(var C=w+b*p.strides[1],S=b*o.strideDepth-f,E=0;E<i;E++){var k=S+E*u;if(!(k<0||k>=o.inDepth))for(var _=E*r.strides[0],T=x+k*n.strides[1],D=0;D<o.outHeight;++D)for(var z=C+D*p.strides[2],W=D*o.strideHeight-h,V=0;V<a;V++){var K=W+V*l;if(!(K<0||K>=o.inHeight))for(var G=_+V*r.strides[1],N=T+K*n.strides[2],O=0;O<o.outWidth;++O)for(var B=z+O*o.outChannels,q=O*o.strideWidth-d,Q=0;Q<s;Q++){var ne=q+Q*c;if(!(ne<0||ne>=o.inWidth))for(var re=G+Q*r.strides[2],ve=N+ne*o.inChannels,me=re,xe=0;xe<o.inChannels;++xe){for(var _e=m[ve+xe],Ae=0;Ae<o.outChannels;++Ae)v[B+Ae]+=_e*g[me+Ae];me+=o.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(n,r,o){X([n,r],"conv2dDerInput");for(var i=Ce(o.inShape,"float32"),a=i.values,s=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],f=l[1],d=l[2],h=o.batchSize,p=o.filterHeight,m=o.filterWidth,g=o.inChannels,v=o.inHeight,y=o.inWidth,x=o.outChannels,w=o.outHeight,b=o.outWidth,C=o.strideHeight,S=o.strideWidth,E=o.dataFormat,k=p-1-o.padInfo.top,_=m-1-o.padInfo.left,T=E==="channelsLast",D=i.strides[0],z=T?i.strides[1]:i.strides[2],W=T?i.strides[2]:1,V=T?1:i.strides[1],K=n.strides[0],G=T?n.strides[1]:n.strides[2],N=T?n.strides[2]:1,O=T?1:n.strides[1],B=0;B<h;++B)for(var q=0;q<g;++q)for(var Q=0;Q<v;++Q)for(var ne=Q-k,re=Math.max(0,Math.ceil(ne/C)),ve=Math.min(w,(p+ne)/C),me=0;me<y;++me){for(var xe=me-_,_e=Math.max(0,Math.ceil(xe/S)),Ae=Math.min(b,(m+xe)/S),Ge=0,De=re;De<ve;++De)for(var $e=De*C-ne,Me=_e;Me<Ae;++Me)for(var Ie=K*B+G*De+N*Me,ze=c*(p-1-$e)+f*(m-1-(Me*S-xe))+d*q,Ke=0;Ke<x;++Ke)Ge+=s[Ie+O*Ke]*u[ze+Ke];a[D*B+z*Q+W*me+V*q]=Ge}return i.toTensor()},t.prototype.conv3dDerInput=function(n,r,o){for(var i=Ce(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],f=s[3],d=this.readSync(n.dataId),h=n.strides,p=h[0],m=h[1],g=h[2],v=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],C=x[2],S=x[3],E=o.batchSize,k=o.filterDepth,_=o.filterHeight,T=o.filterWidth,D=o.inChannels,z=o.inDepth,W=o.inHeight,V=o.inWidth,K=o.outChannels,G=o.outDepth,N=o.outHeight,O=o.outWidth,B=o.strideDepth,q=o.strideHeight,Q=o.strideWidth,ne=k-1-o.padInfo.front,re=_-1-o.padInfo.top,ve=T-1-o.padInfo.left,me=0;me<E;++me)for(var xe=0;xe<D;++xe)for(var _e=0;_e<z;++_e)for(var Ae=_e-ne,Ge=Math.max(0,Math.ceil(Ae/B)),De=Math.min(G,(k+Ae)/B),$e=0;$e<W;++$e)for(var Me=$e-re,Ie=Math.max(0,Math.ceil(Me/q)),ze=Math.min(N,(_+Me)/q),Ke=0;Ke<V;++Ke){for(var Tn=Ke-ve,Rt=Math.max(0,Math.ceil(Tn/Q)),Yt=Math.min(O,(T+Tn)/Q),eo=0,Dn=Ge;Dn<De;++Dn)for(var ur=Dn*B-Ae,Vn=Ie;Vn<ze;++Vn)for(var to=Vn*q-Me,Hn=Rt;Hn<Yt;++Hn)for(var Gn=p*me+m*Dn+g*Vn+v*Hn,Nn=w*(k-1-ur)+b*(_-1-to)+C*(T-1-(Hn*Q-Tn))+S*xe,pn=0;pn<K;++pn)eo+=d[Gn+pn]*y[Nn+pn];a[u*me+l*_e+c*$e+f*Ke+xe]=eo}return i.toTensor()},t.prototype.conv2dDerFilter=function(n,r,o){X([n,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dataFormat==="channelsLast",c=Ce(o.filterShape,"float32"),f=o.padInfo.left,d=o.padInfo.top,h=this.bufferSync(n),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/i)),v=Math.min(o.outHeight,(o.inHeight+d-m)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((f-y)/a)),w=Math.min(o.outWidth,(o.inWidth+f-y)/a),b=0;b<o.inChannels;++b)for(var C=0;C<o.outChannels;++C){for(var S=0,E=0;E<o.batchSize;++E)for(var k=g;k<v;++k)for(var _=m+k*i-d,T=x;T<w;++T){var D=y+T*a-f;S+=l?h.get(E,_,D,b)*p.get(E,k,T,C):h.get(E,b,_,D)*p.get(E,C,k,T)}c.set(S,m,y,b,C)}return c.toTensor()},t.prototype.conv3dDerFilter=function(n,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,f=Ce(o.filterShape,"float32"),d=f.values,h=f.strides,p=h[0],m=h[1],g=h[2],v=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],C=x[2],S=x[3],E=this.readSync(n.dataId),k=n.strides,_=k[0],T=k[1],D=k[2],z=k[3],W=o.padInfo.front,V=o.padInfo.left,K=o.padInfo.top,G=0;G<u;++G)for(var N=Math.max(0,Math.ceil((W-G)/i)),O=Math.min(o.outDepth,(o.inDepth+W-G)/i),B=G*p,q=0;q<l;++q)for(var Q=Math.max(0,Math.ceil((K-q)/a)),ne=Math.min(o.outHeight,(o.inHeight+K-q)/a),re=q*m+B,ve=0;ve<c;++ve)for(var me=Math.max(0,Math.ceil((V-ve)/s)),xe=Math.min(o.outWidth,(o.inWidth+V-ve)/s),_e=ve*g+re,Ae=0;Ae<o.inChannels;++Ae)for(var Ge=Ae*v+_e,De=0;De<o.outChannels;++De){for(var $e=0,Me=0;Me<o.batchSize;++Me)for(var Ie=Me*_,ze=Me*w,Ke=N;Ke<O;++Ke)for(var Tn=(G+Ke*i-W)*T+Ie,Rt=Ke*b+ze,Yt=Q;Yt<ne;++Yt)for(var eo=(q+Yt*a-K)*D+Tn,Dn=Yt*C+Rt,ur=me;ur<xe;++ur){var Vn=ur*S+Dn;$e+=E[(ve+ur*s-V)*z+eo+Ae]*y[Vn+De]}d[Ge+De]=$e}return f.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,o,i);return a&&(l=this.add(l,a)),s&&(l=jf(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(n,r,o){X([n,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,f=o.outChannels/o.inChannels,d=Ce(o.outShape,n.dtype),h=this.readSync(n.dataId),p=this.readSync(r.dataId),m=d.values,g=0;g<o.batchSize;++g)for(var v=g*n.strides[0],y=g*d.strides[0],x=0;x<o.outHeight;++x)for(var w=y+x*d.strides[1],b=x*o.strideHeight-l,C=0;C<i;++C){var S=b+C*s;if(!(S<0||S>=o.inHeight))for(var E=C*r.strides[0],k=v+S*n.strides[1],_=0;_<o.outWidth;++_)for(var T=w+_*d.strides[2],D=_*o.strideWidth-c,z=0;z<a;++z){var W=D+z*u;if(!(W<0||W>=o.inWidth))for(var V=E+z*r.strides[1],K=k+W*o.inChannels,G=T,N=V,O=0;O<o.inChannels;++O){for(var B=h[K+O],q=0;q<f;++q)m[G+q]+=B*p[N+q];G+=f,N+=f}}}return d.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,o){X([n,r],"depthwiseConv2DDerInput");for(var i=Ce(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],f=this.readSync(n.dataId),d=n.strides,h=d[0],p=d[1],m=d[2],g=this.readSync(r.dataId),v=r.strides,y=v[0],x=v[1],w=v[2],b=o.batchSize,C=o.filterHeight,S=o.filterWidth,E=o.inChannels,k=o.inHeight,_=o.inWidth,T=o.outChannels,D=o.outHeight,z=o.outWidth,W=o.strideHeight,V=o.strideWidth,K=C-1-o.padInfo.top,G=S-1-o.padInfo.left,N=T/E,O=0;O<b;++O)for(var B=0;B<E;++B)for(var q=0;q<k;++q)for(var Q=q-K,ne=Math.max(0,Math.ceil(Q/W)),re=Math.min(D,(C+Q)/W),ve=0;ve<_;++ve){for(var me=ve-G,xe=Math.max(0,Math.ceil(me/V)),_e=Math.min(z,(S+me)/V),Ae=0,Ge=ne;Ge<re;++Ge)for(var De=Ge*W-Q,$e=xe;$e<_e;++$e)for(var Me=h*O+p*Ge+m*$e,Ie=y*(C-1-De)+x*(S-1-($e*V-me))+w*B,ze=0;ze<N;++ze)Ae+=f[Me+(B*N+ze)]*g[Ie+ze];a[u*O+l*q+c*ve+B]=Ae}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){X([n,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=Ce(o.filterShape,"float32"),c=o.padInfo.left,f=o.padInfo.top,d=o.outChannels/o.inChannels,h=this.bufferSync(n),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((f-m)/i)),v=Math.min(o.outHeight,(o.inHeight+f-m)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((c-y)/a)),w=Math.min(o.outWidth,(o.inWidth+c-y)/a),b=0;b<o.outChannels;++b){for(var C=Math.trunc(b/d),S=b%d,E=0,k=0;k<o.batchSize;++k)for(var _=g;_<v;++_)for(var T=m+_*i-f,D=x;D<w;++D){var z=y+D*a-c;E+=h.get(k,T,z,C)*p.get(k,_,D,b)}l.set(E,m,y,C,S)}return l.toTensor()},t.prototype.tile=function(n,r){return X(n,"tile"),Mx(this.bufferSync(n),r)},t.prototype.pad=function(n,r,o){X(n,"pad");var i=r.map(function(d,h){return d[0]+n.shape[h]+d[1]}),a=r.map(function(d){return d[0]}),s=this.bufferSync(n),u=Ce(i,n.dtype);o!==0&&u.values.fill(o);for(var l=0;l<n.size;l++){var c=s.indexToLoc(l),f=c.map(function(d,h){return d+a[h]});u.set.apply(u,[s.get.apply(s,c)].concat(f))}return u.toTensor()},t.prototype.transpose=function(n,r){X(n,"transpose");for(var o=new Array(n.rank),i=0;i<o.length;i++)o[i]=n.shape[r[i]];var a=this.readSync(n.dataId),s=Ce(o,n.dtype),u=this.bufferSync(n);for(i=0;i<n.size;++i){for(var l=u.indexToLoc(i),c=new Array(l.length),f=0;f<c.length;f++)c[f]=l[r[f]];var d=s.locToIndex(c);s.values[d]=a[i]}return s.toTensor()},t.prototype.gather=function(n,r,o){X([n,r],"gather");var i=n.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Ce(i,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l),f=c.slice();f[o]=a[c[o]];var d=u.locToIndex(f);s.values[l]=u.values[d]}return s.toTensor()},t.prototype.batchToSpaceND=function(n,r,o){X([n],"batchToSpaceND");var i=r.reduce(function(f,d){return f*d}),a=Vl(n.shape,r,i),s=Hl(a.length,r.length),u=Gl(n.shape,r,i),l=Ex(o,r.length),c=Cx(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){X([n],"spaceToBatchND");var i=r.reduce(function(d,h){return d*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=Vl(u.shape,r,i,!1),c=Hl(l.length,r.length,!1),f=Gl(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(f)},t.prototype.pool=function(n,r,o){X(n,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,h=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(n.dataId),m=Ce(r.outShape,n.dtype),g=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],x=r.outShape[3],w=0;w<r.batchSize;++w)for(var b=w*v,C=w*n.strides[0],S=0;S<r.inChannels;++S)for(var E=0;E<r.outHeight;++E)for(var k=E*i-f,_=Math.max(0,k),T=Math.min(r.inHeight,l+k),D=b+E*y,z=0;z<r.outWidth;++z){for(var W=z*a-d,V=Math.max(0,W),K=Math.min(r.inWidth,c+W),G=h,N=0,O=0,B=_;B<T;B+=s){for(var q=C+B*n.strides[1],Q=V;Q<K;Q+=u){var ne=p[q+Q*n.strides[2]+S];o==="max"&&ne>G?G=ne:o==="avg"&&(N+=ne,O++)}if(isNaN(G))break}g[D+z*x+S]=o==="avg"?N/O:G}return m.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var o=Ce(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,h=this.bufferSync(n),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var g=0;g<r.outHeight;++g){for(var v=g*i-f,y=v;y<0;)y+=s;for(var x=Math.min(r.inHeight,l+v),w=0;w<r.outWidth;++w){for(var b=w*a-d,C=b;C<0;)C+=u;for(var S=Math.min(r.inWidth,c+b),E=Number.NEGATIVE_INFINITY,k=-1,_=y;_<x;_+=s)for(var T=_-v,D=C;D<S;D+=u){var z=D-b,W=h.get(p,_,D,m);W>E&&(E=W,k=T*c+z)}o.set(k,p,g,w,m)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(n,r,o,i){X([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,f=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=d-1-i.padInfo.left,p=f-1-i.padInfo.top,m=Ce(r.shape,"float32"),g=this.bufferSync(a),v=this.bufferSync(n),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var w=0;w<i.inHeight;++w)for(var b=0;b<i.inWidth;++b){for(var C=w-p,S=b-h,E=0,k=0;k<f;k+=l){var _=(C+k)/s;if(!(_<0||_>=i.outHeight||Math.floor(_)!==_))for(var T=0;T<d;T+=c){var D=(S+T)/u;if(!(D<0||D>=i.outWidth||Math.floor(D)!==D)){var z=f*d-1-g.get(y,_,D,x)===k*d+T?1:0;z!==0&&(E+=v.get(y,_,D,x)*z)}}}m.set(E,y,w,b,x)}return m.toTensor()},t.prototype.avgPoolBackprop=function(n,r,o){X([n,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dilationHeight,c=o.dilationWidth,f=o.effectiveFilterHeight,d=o.effectiveFilterWidth,h=d-1-o.padInfo.left,p=f-1-o.padInfo.top,m=Ce(r.shape,"float32"),g=1/(s*u),v=this.bufferSync(n),y=0;y<o.batchSize;++y)for(var x=0;x<o.inChannels;++x)for(var w=0;w<o.inHeight;++w)for(var b=0;b<o.inWidth;++b){for(var C=w-p,S=b-h,E=0,k=0;k<f;k+=l){var _=(C+k)/i;if(!(_<0||_>=o.outHeight||Math.floor(_)!==_))for(var T=0;T<d;T+=c){var D=(S+T)/a;D<0||D>=o.outWidth||Math.floor(D)!==D||(E+=v.get(y,_,D,x))}}m.set(E*g,y,w,b,x)}return m.toTensor()},t.prototype.pool3d=function(n,r,o){X(n,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(n.dataId),x=Ce(r.outShape,n.dtype),w=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],E=r.outShape[4],k=0;k<r.batchSize;++k)for(var _=k*b,T=k*n.strides[0],D=0;D<r.inChannels;++D)for(var z=0;z<r.outDepth;++z){for(var W=z*i-p,V=W;V<0;)V+=u;for(var K=Math.min(r.inDepth,f+W),G=_+z*C,N=0;N<r.outHeight;++N){for(var O=N*a-m,B=O;B<0;)B+=l;for(var q=Math.min(r.inHeight,d+O),Q=G+N*S,ne=0;ne<r.outWidth;++ne){for(var re=ne*s-g,ve=re;ve<0;)ve+=c;for(var me=Math.min(r.inWidth,h+re),xe=Q+ne*E,_e=v,Ae=0,Ge=0,De=V;De<K;De+=u){for(var $e=T+De*n.strides[1],Me=B;Me<q;Me+=l){for(var Ie=$e+Me*n.strides[2],ze=ve;ze<me;ze+=c){var Ke=y[Ie+ze*n.strides[3]+D];if(o==="max"&&Ke>_e?_e=Ke:o==="avg"&&(Ae+=Ke,Ge++),isNaN(_e))break}if(isNaN(_e))break}if(isNaN(_e))break}w[xe+D]=o==="avg"?Ae/Ge:_e}}}return x.toTensor()},t.prototype.avgPool3d=function(n,r){return X(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,o){X([n,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,f=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,v=p-1-o.padInfo.front,y=g-1-o.padInfo.left,x=m-1-o.padInfo.top,w=Ce(r.shape,"float32"),b=1/(u*l*c),C=this.bufferSync(n),S=0;S<o.batchSize;++S)for(var E=0;E<o.inChannels;++E)for(var k=0;k<o.inDepth;++k)for(var _=0;_<o.inHeight;++_)for(var T=0;T<o.inWidth;++T){for(var D=k-v,z=_-x,W=T-y,V=0,K=0;K<p;K+=f){var G=(D+K)/i;if(!(G<0||G>=o.outDepth||Math.floor(G)!==G))for(var N=0;N<m;N+=d){var O=(z+N)/a;if(!(O<0||O>=o.outHeight||Math.floor(O)!==O))for(var B=0;B<g;B+=h){var q=(W+B)/s;q<0||q>=o.outWidth||Math.floor(q)!==q||(V+=C.get(S,G,O,q,E))}}}w.set(V*b,S,k,_,T,E)}return w.toTensor()},t.prototype.maxPool3d=function(n,r){return X(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var o=Ce(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(n),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var w=0;w<r.outDepth;++w){for(var b=w*i-p,C=b;C<0;)C+=u;for(var S=Math.min(r.inDepth,f+b),E=0;E<r.outHeight;++E){for(var k=E*a-m,_=k;_<0;)_+=l;for(var T=Math.min(r.inHeight,d+k),D=0;D<r.outWidth;++D){for(var z=D*s-g,W=z;W<0;)W+=c;for(var V=Math.min(r.inWidth,h+z),K=Number.NEGATIVE_INFINITY,G=-1,N=C;N<S;N+=u)for(var O=N-b,B=_;B<T;B+=l)for(var q=B-k,Q=W;Q<V;Q+=c){var ne=Q-z,re=v.get(y,N,B,Q,x);re>=K&&(K=re,G=O*d*h+q*d+ne)}o.set(G,y,w,E,D,x)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,o,i){X([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,f=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,g=h-1-i.padInfo.front,v=m-1-i.padInfo.left,y=p-1-i.padInfo.top,x=Ce(r.shape,"float32"),w=this.bufferSync(a),b=this.bufferSync(n),C=0;C<i.batchSize;++C)for(var S=0;S<i.inChannels;++S)for(var E=0;E<i.inDepth;++E)for(var k=0;k<i.inHeight;++k)for(var _=0;_<i.inWidth;++_){for(var T=E-g,D=k-y,z=_-v,W=0,V=0;V<h;V+=c){var K=(T+V)/s;if(!(K<0||K>=i.outDepth||Math.floor(K)!==K))for(var G=0;G<p;G+=f){var N=(D+G)/u;if(!(N<0||N>=i.outHeight||Math.floor(N)!==N))for(var O=0;O<m;O+=d){var B=(z+O)/l;if(!(B<0||B>=i.outWidth||Math.floor(B)!==B)){var q=h*p*m-1-w.get(C,K,N,B,S)===V*p*m+G*m+O?1:0;q!==0&&(W+=b.get(C,K,N,B,S)*q)}}}}x.set(W,C,E,k,_,S)}return x.toTensor()},t.prototype.cast=function(n,r){return Nx(n,r,this)},t.prototype.reshape=function(n,r){return fh(n,r)},t.prototype.avgPool=function(n,r){return X(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,o,i){X(n,"resizeBilinear");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],f=this.readSync(n.dataId),d=new Float32Array(le([s,r,o,c])),h=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=0,g=h[0]/p[0],v=h[1]/p[1],y=0;y<s;y++)for(var x=0;x<r;x++)for(var w=g*x,b=Math.floor(w),C=w-b,S=Math.min(u-1,Math.ceil(w)),E=y*n.strides[0]+b*n.strides[1],k=y*n.strides[0]+S*n.strides[1],_=0;_<o;_++)for(var T=v*_,D=Math.floor(T),z=T-D,W=Math.min(l-1,Math.ceil(T)),V=E+D*n.strides[2],K=k+D*n.strides[2],G=E+W*n.strides[2],N=k+W*n.strides[2],O=0;O<c;O++){var B=f[V+O],q=f[K+O],Q=B+(f[G+O]-B)*z,ne=Q+(q+(f[N+O]-q)*z-Q)*C;d[m++]=ne}return Lt(d,[s,r,o,c])},t.prototype.resizeBilinearBackprop=function(n,r,o){X([n,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,f=c[1],d=c[2],h=new Float32Array(a*s*u*l),p=[o&&f>1?s-1:s,o&&d>1?u-1:u],m=[o&&f>1?f-1:f,o&&d>1?d-1:d],g=p[0]/m[0],v=p[1]/m[1],y=this.readSync(n.dataId),x=0,w=0;w<a;w++)for(var b=w*r.strides[0],C=0;C<f;C++)for(var S=C*g,E=Math.floor(S),k=Math.min(Math.ceil(S),s-1),_=b+E*r.strides[1],T=b+k*r.strides[1],D=S-E,z=1-D,W=0;W<d;W++)for(var V=W*v,K=Math.floor(V),G=Math.min(Math.ceil(V),u-1),N=V-K,O=1-N,B=_+K*r.strides[2],q=_+G*r.strides[2],Q=T+K*r.strides[2],ne=T+G*r.strides[2],re=z*O,ve=z*N,me=D*O,xe=D*N,_e=0;_e<l;_e++){var Ae=y[x++];h[B+_e]+=Ae*re,h[q+_e]+=Ae*ve,h[Q+_e]+=Ae*me,h[ne+_e]+=Ae*xe}return on(h,[a,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,o,i){X(n,"resizeNearestNeighbor");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],f=this.readSync(n.dataId),d=new Float32Array(s*r*o*c),h=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=h[0]/p[0],g=h[1]/p[1],v=0,y=0;y<s;y++)for(var x=y*n.strides[0],w=0;w<r;w++)for(var b=m*w,C=x+Math.min(u-1,i?Math.round(b):Math.floor(b))*n.strides[1],S=0;S<o;S++)for(var E=g*S,k=C+Math.min(l-1,i?Math.round(E):Math.floor(E))*n.strides[2],_=0;_<c;_++){var T=f[k+_];d[v++]=T}return Lt(d,[s,r,o,c],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){X([n,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,f=c[1],d=c[2],h=new Float32Array(a*s*u*l),p=this.readSync(n.dataId),m=[o&&f>1?s-1:s,o&&d>1?u-1:u],g=[o&&f>1?f-1:f,o&&d>1?d-1:d],v=m[0]/g[0],y=m[1]/g[1],x=1/v,w=1/y,b=2*Math.ceil(x)+2,C=2*Math.ceil(w)+2,S=0;S<a;S++)for(var E=S*r.strides[0],k=0;k<s;k++)for(var _=E+k*r.strides[1],T=Math.floor(k*x),D=Math.floor(T-b/2),z=0;z<u;z++)for(var W=_+z*r.strides[2],V=Math.floor(z*w),K=Math.floor(V-C/2),G=0;G<l;G++){for(var N=0,O=0;O<b;O++){var B=O+D;if(!(B<0||B>=f)){var q=E+B*n.strides[1],Q=B*v;if(k===Math.min(s-1,o?Math.round(Q):Math.floor(Q)))for(var ne=0;ne<C;ne++){var re=ne+K;if(!(re<0||re>=d)){var ve=q+re*n.strides[2],me=re*y;z===Math.min(u-1,o?Math.round(me):Math.floor(me))&&(N+=p[ve+G])}}}}h[W+G]=N}return on(h,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){X([n,r,o,a,s],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(o.dataId),f=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=d.length,m=f.length,g=c.length,v=l.length,y=0,x=0,w=0,b=0,C=0;C<u.length;++C)h[C]=d[y++]+(u[C]-l[x++])*f[w++]/Math.sqrt(c[b++]+i),y>=p&&(y=0),x>=v&&(x=0),w>=m&&(w=0),b>=g&&(b=0);return on(h,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){X(n,"localResponseNormalization4D");var s=n.shape[3],u=s-1,l=this.readSync(n.dataId),c=n.size,f=new Float32Array(c);function d(g){for(var v=g%s,y=g-v+Math.max(0,v-r),x=g-v+Math.min(v+r,u),w=0;y<=x;y++){var b=l[y];w+=b*b}return w}for(var h=0;h<c;h++){var p=d(h),m=l[h]*Math.pow(o+i*p,-a);f[h]=m}return on(f,n.shape)},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){X(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),f=this.readSync(r.dataId),d=this.readSync(o.dataId),h=new Float32Array(n.size),p=n.size,m=0;m<p;m++){for(var g=m%l,v=m-g+Math.max(0,g-i),y=m-g+Math.min(l,g+i+1),x=0,w=v;w<y;w++)x+=Math.pow(f[w],2);for(x=s*x+a,w=v;w<y;w++){var b=-2*s*u*f[w]*d[m]/x;m===w&&(b+=Math.pow(x,-u)),b*=c[m],h[w]+=b}}return on(h,n.shape)},t.prototype.multinomial=function(n,r,o,i){X(n,"multinomial");for(var a=r?n:Xr(n),s=a.shape[0],u=a.shape[1],l=Je([s,o],"int32"),c=this.readSync(l.dataId),f=this.readSync(a.dataId),d=0;d<s;++d){var h=d*u,p=new Float32Array(u-1);p[0]=f[h];for(var m=1;m<p.length;++m)p[m]=p[m-1]+f[h+m];for(var g=Dc(i.toString()),v=d*o,y=0;y<o;++y){var x=g();c[v+y]=p.length;for(var w=0;w<p.length;w++)if(x<p[w]){c[v+y]=w;break}}}return l},t.prototype.oneHot=function(n,r,o,i){X(n,"oneHot");var a=new Float32Array(n.size*r);a.fill(i);for(var s=this.readSync(n.dataId),u=0;u<n.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Ro(a,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return X(n,"nonMaxSuppression"),Ap(this.readSync(n.dataId),this.readSync(r.dataId),o,i,a)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var o=n.shape[0],i=n.shape[1],a=Ce(n.shape,"float32"),s=Ce(n.shape,"float32"),u=Ln(n).as2D(o,i),l=gr(n).as2D(o,i),c=0;c<o;c++)for(var f=u.slice([c,0],[1,i]),d=l.slice([c,0],[1,i]),h=Mt(f,d),p=this.readSync(this.fftImpl(h,r).dataId),m=0;m<i;m++){var g=Ng(p,m);a.values[c*i+m]=g.real,s.values[c*i+m]=g.imag}return Mt(a.toTensor(),s.toTensor()).as2D(o,i)},t.prototype.fftImpl=function(n,r){var o=n.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(n.shape[0],n.shape[1]);return r&&(a=Mt(Ln(a).div(te(i)),gr(a).div(te(i)))),a}var s=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),f=new Float32Array(l.length/2),d=0;d<l.length;d+=2)c[d/2]=l[d],f[d/2]=l[d+1];return{real:c,imag:f}}(this.fourierTransformByMatmul(s,i,r));return Mt(u.real,u.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,o){if(r===1)return n;var i=this.readSync(n.dataId),a=r/2,s=function(v){for(var y=Math.ceil(v.length/4),x=new Float32Array(y),w=new Float32Array(y),b=0;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],w[Math.floor(b/4)]=v[b+1];return{real:x,imag:w}}(i),u=Mt(s.real,s.imag).as1D(),l=function(v){for(var y=Math.floor(v.length/4),x=new Float32Array(y),w=new Float32Array(y),b=2;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],w[Math.floor(b/4)]=v[b+1];return{real:x,imag:w}}(i),c=Mt(l.real,l.imag).as1D();u=this.fftRadix2(u,a,o),c=this.fftRadix2(c,a,o);var f=function(v,y){for(var x=new Float32Array(v/2),w=new Float32Array(v/2),b=0;b<Math.ceil(v/2);b++){var C=(y?2:-2)*Math.PI*(b/v);x[b]=Math.cos(C),w[b]=Math.sin(C)}return{real:x,imag:w}}(r,o),d=Mt(f.real,f.imag).mul(c),h=u.add(d),p=u.sub(d),m=Ln(h).concat(Ln(p)),g=gr(h).concat(gr(p));return Mt(m,g).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=qk(a*l,r,o),f=Ng(n,l);s+=f.real*c.real-f.imag*c.imag,u+=f.real*c.imag+f.imag*c.real}o&&(s/=r,u/=r),Kk(i,s,u,a)}return i},t.prototype.depthToSpace=function(n,r,o){I(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=n.shape[0],a=n.shape[1],s=n.shape[2],u=n.shape[3],l=a*r,c=s*r,f=u/(r*r),d=this.readSync(n.dataId),h=new Float32Array(i*l*c*f),p=0,m=0;m<i;++m)for(var g=0;g<l;++g)for(var v=Math.floor(g/r),y=g%r,x=0;x<c;++x)for(var w=Math.floor(x/r),b=(y*r+x%r)*f,C=0;C<f;++C){var S=C+b+u*(w+s*(v+a*m));h[p++]=d[S]}return on(h,[i,l,c,f])},t.prototype.broadcastedBinaryOp=function(n,r,o,i){var a=Ne(n.shape,r.shape),s=Ce(a,o),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=mo(n.shape,a),f=mo(r.shape,a),d=s.values;if(c.length+f.length===0)for(var h=0;h<d.length;++h)d[h]=i(u[h%u.length],l[h%l.length]);else{var p=this.bufferSync(n),m=this.bufferSync(r),g=function(v){var y=s.indexToLoc(v),x=y.slice(-n.rank);c.forEach(function(S){return x[S]=0});var w=p.locToIndex(x),b=y.slice(-r.rank);f.forEach(function(S){return b[S]=0});var C=m.locToIndex(b);d[v]=i(u[w],l[C])};for(h=0;h<d.length;++h)g(h)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,o){var i=Ne(n.shape,r.shape),a=Ce(i,"float32"),s=Ce(i,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=mo(n.shape,i),f=mo(r.shape,i),d=a.values,h=s.values;if(c.length+f.length===0)for(var p=0;p<d.length;p++){var m=p%u.length,g=p%l.length,v=o(u[2*m],u[2*m+1],l[2*g],l[2*g+1]);d[p]=v.real,h[p]=v.imag}else{var y=this.bufferSync(this.data.get(n.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(b){var C=a.indexToLoc(b),S=C.slice(-n.rank);c.forEach(function(D){return S[D]=0});var E=y.locToIndex(S),k=C.slice(-r.rank);f.forEach(function(D){return k[D]=0});var _=x.locToIndex(k),T=o(u[2*E],u[2*E+1],l[2*_],l[2*_+1]);d[b]=T.real,h[b]=T.imag};for(p=0;p<d.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},t.prototype.split=function(n,r,o){return Fx(n,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,o,i,a,s){for(var u=n.shape,l=u[0],c=u[1],f=u[2],d=u[3],h=r.shape[0],p=i[0],m=i[1],g=Ce([h,p,m,d],"float32"),v=this.readSync(r.dataId),y=this.readSync(o.dataId),x=this.readSync(n.dataId),w=n.strides,b=g.strides,C=0;C<h;C++){var S=4*C,E=v[S],k=v[S+1],_=v[S+2],T=v[S+3],D=y[C];if(!(D>=l))for(var z=p>1?(_-E)*(c-1)/(p-1):0,W=m>1?(T-k)*(f-1)/(m-1):0,V=0;V<p;V++){var K=p>1?E*(c-1)+V*z:.5*(E+_)*(c-1);if(K<0||K>c-1)for(var G=0;G<m;G++)for(var N=0;N<d;N++){var O=N+G*b[2]+V*b[1]+C*b[0];g.values[O]=s}else if(a==="bilinear"){var B=Math.floor(K),q=Math.ceil(K),Q=K-B;for(G=0;G<m;G++)if((De=m>1?k*(f-1)+G*W:.5*(k+T)*(f-1))<0||De>f-1)for(N=0;N<d;N++)O=N+G*b[2]+V*b[1]+C*b[0],g.values[O]=s;else{var ne=Math.floor(De),re=Math.ceil(De),ve=De-ne;for(N=0;N<d;N++){var me=x[O=N+ne*w[2]+B*w[1]+D*w[0]],xe=x[O=N+re*w[2]+B*w[1]+D*w[0]],_e=x[O=N+ne*w[2]+q*w[1]+D*w[0]],Ae=me+(xe-me)*ve,Ge=_e+(x[O=N+re*w[2]+q*w[1]+D*w[0]]-_e)*ve;O=N+G*b[2]+V*b[1]+C*b[0],g.values[O]=Ae+(Ge-Ae)*Q}}}else for(G=0;G<m;++G){var De;if((De=m>1?k*(f-1)+G*W:.5*(k+T)*(f-1))<0||De>f-1)for(N=0;N<d;N++)O=N+G*b[2]+V*b[1]+C*b[0],g.values[O]=s;else{var $e=Math.round(De),Me=Math.round(K);for(N=0;N<d;N++){var Ie=N+$e*w[2]+Me*w[1]+D*w[0],ze=N+G*b[2]+V*b[1]+C*b[0];g.values[ze]=x[Ie]}}}}}return g.toTensor()},t.prototype.sparseToDense=function(n,r,o,i){var a=Kl(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,f=a.outputSize;return this.scatter(n,r,o,f,l,u,s,c,i,!1)},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=_x(n,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return Lt([],s,n.dtype);for(var f=new Fs([u,l],n.dtype),d=this.readSync(r.dataId),h=this.readSync(n.dataId),p=0;p<u;p++){for(var m=[],g=0,v=0;v<i;v++){var y=d[p*i+v];g+=y*c[v],m.push(y)}if(g<0||g>=n.size/l)throw new Error("Invalid indices: "+m+" does not index into "+n.shape);for(var x=0;x<l;x++)f.values[p*l+x]=h[g*l+x]}return f.toTensor().reshape(s)},t.prototype.scatterND=function(n,r,o){var i=Kl(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,f=te(0);return this.scatter(n,r,o,c,u,s,a,l,f,!0)},t.prototype.fill=function(n,r,o){var i=Ll(o=o||Ks(r),le(n));return i.fill(r),M.makeTensor(i,n,o,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=Ll(n.dtype,le(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,o){return Px(n,r,o)},t.prototype.scatter=function(n,r,o,i,a,s,u,l,c,f){var d=[i/a,a],h=this.readSync(n.dataId),p=this.readSync(r.dataId);if(i===0)return Lt([],o,r.dtype);var m=new Fs(d,r.dtype);m.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<s;g++){for(var v=[],y=0,x=0;x<u;x++){var w=h[g*u+x];v.push(w),y+=w*l[x]}if(y<0||y>=i/a)throw new Error("Invalid indices: "+v+" does not index into "+o);for(var b=0;b<a;b++)f?m.values[y*a+b]+=p[g*a+b]:m.values[y*a+b]=r.rank===0?p[0]:p[g*a+b]}return m.toTensor().reshape(o)},t}(Tx);M.registerBackend("cpu",function(){return new pN},1);for(var Vf=0,Zg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n;X(i,"NonMaxSuppressionWithScore");var h=Fp(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,l,c,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;X(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Ls,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n;X([o,i],Ls);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,l=function(d,h,p,m,g,v){var y=Ne(d,h),x=y.length,w=Er(y),b=As(g,le(y)),C=d.length,S=h.length,E=Er(d),k=Er(h),_=mo(d,y),T=mo(h,y);if(_.length+T.length===0)for(var D=0;D<b.length;++D)b[D]=v(p[D%p.length],m[D%m.length]);else{var z=function(W){var V=_S(W,x,w),K=V.slice(-C);_.forEach(function(B){return K[B]=0});var G=Eg(K,C,E),N=V.slice(-S);T.forEach(function(B){return N[B]=0});var O=Eg(N,S,k);b[W]=v(p[G],m[O])};for(D=0;D<b.length;++D)z(D)}return[b,y]}(o.shape,i.shape,s,u,o.dtype,function(d,h){var p=d-h;return p*p}),c=l[0],f=l[1];return{dataId:a.write(c,f,o.dtype),shape:f,dtype:o.dtype}}}];Vf<Zg.length;Vf++)rx(Zg[Vf]);var Ti,vN=function(e){this.variableNames=["A"];var t=Gt(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},mN=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Gt(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var Hf=0,e0=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],f=[c,l],d=[c,l,i];(s||a)&&(Ti==null&&(Ti=document.createElement("canvas").getContext("2d")),Ti.canvas.width=l,Ti.canvas.height=c,Ti.drawImage(o,0,0,l,c),o=Ti.canvas);var h=n.makeTensorInfo(f,"int32");n.texData.get(h.dataId).usage=bn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),o);var p=H().getBool("WEBGL_PACK")?new mN(d):new vN(d),m=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;zl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n,h=Fp(d.readSync(i.dataId),d.readSync(a.dataId),u,l,c,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,i=new Se(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Ls,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n,s=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ar("return (a - b) * (a - b);",o.shape,i.shape):new ct("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Hf<e0.length;Hf++)rx(e0[Hf]);for(var Gf=0,t0=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Ls,gradFunc:function(e,t){var n=t[0],r=t[1],o=te(2);return{a:function(){return qt(e,qt(o,St(n,r)))},b:function(){return qt(e,qt(o,St(r,n)))}}}}];Gf<t0.length;Gf++)hS(t0[Gf]);var gN=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();H().get("IS_BROWSER")&&H().setPlatform("browser",new gN);var Kf,yN=function(){return require("node-fetch")},xN=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return H().global.fetch!=null?H().global.fetch(t,n):(Kf==null&&(Kf=yN()),Kf(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();H().get("IS_NODE")&&H().setPlatform("node",new xN);var ph={float32:4,int32:4,uint16:2,uint8:1,bool:1},ec=4;function kw(e,t){for(var n={},r=0,o=function(s){var u=s.name,l=s.dtype,c=s.shape,f=le(c),d=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=ph[h.dtype],m=e.slice(r,r+f*p),g=h.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(l==="float32")d=Float32Array.from(g,function(C){return C*h.scale+h.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=Int32Array.from(g,function(C){return Math.round(C*h.scale+h.min)})}r+=f*p}else if(l==="string"){var v=le(s.shape);d=[];for(var y=0;y<v;y++){var x=new Uint32Array(e.slice(r,r+ec))[0];r+=ec;var w=new Uint8Array(e.slice(r,r+x));d.push(w),r+=x}}else{var b=ph[l];if(m=e.slice(r,r+f*b),l==="float32")d=new Float32Array(m);else if(l==="int32")d=new Int32Array(m);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=new Uint8Array(m)}r+=f*b}n[u]=Lt(d,c,l)},i=0,a=t;i<a.length;i++)o(a[i]);return n}function wN(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(i){if(t+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var vh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function n0(e){return vh?Buffer.byteLength(e):new Blob([e]).size}function Zp(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function r0(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function eu(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:n0(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:n0(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var En=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(i){var a=i(t,r);a!==null&&o.push(a)}),o},e}(),oa="://",Io=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){I(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(oa)&&(t=t.slice(0,t.indexOf(oa))),I(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();I(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function ul(e){if(e.indexOf(oa)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Io.getSchemes().join(","));return{scheme:e.split(oa)[0],path:e.split(oa)[1]}}function o0(e,t,n){return n===void 0&&(n=!1),se(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,f;return ue(this,function(d){switch(d.label){case 0:return I(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),I((r=En.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),I(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],I((i=En.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),I(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),a=i[0],s=ul(e).scheme,u=ul(e).path,l=s===ul(e).scheme,[4,o.load()];case 1:return c=d.sent(),n&&l?[4,Io.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(c)];case 4:return f=d.sent(),!n||l?[3,6]:[4,Io.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var oi="models_store",go="model_info_store";function Rw(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function mh(e){var t=e.result;t.createObjectStore(oi,{keyPath:"modelPath"}),t.createObjectStore(go,{keyPath:"modelPath"})}var ia=function(){function e(t){if(this.indexedDB=Rw(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return se(this,void 0,void 0,function(){return ue(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return se(this,void 0,void 0,function(){return ue(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return mh(a)},a.onsuccess=function(){var s=a.result;if(n==null){var u=s.transaction(oi,"readonly"),l=u.objectStore(oi).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var c,f=eu(n),d=s.transaction(go,"readwrite"),h=d.objectStore(go),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:f});p.onsuccess=function(){var m=(c=s.transaction(oi,"readwrite")).objectStore(oi).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:f});m.onsuccess=function(){return o({modelArtifactsInfo:f})},m.onerror=function(g){var v=(h=d.objectStore(go)).delete(r.modelPath);v.onsuccess=function(){return s.close(),i(m.error)},v.onerror=function(y){return s.close(),i(m.error)}}},p.onerror=function(m){return s.close(),i(p.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),i0=function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ia.URL_SCHEME)?(t=e.slice(ia.URL_SCHEME.length),new ia(t)):null;var t};En.registerSaveRouter(i0),En.registerLoadRouter(i0);var bN=function(){function e(){this.indexedDB=Rw()}return e.prototype.listModels=function(){return se(this,void 0,void 0,function(){var t=this;return ue(this,function(n){return[2,new Promise(function(r,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return mh(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(go,"readonly"),u=s.objectStore(go).getAll();u.onsuccess=function(){for(var l={},c=0,f=u.result;c<f.length;c++){var d=f[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},e.prototype.removeModel=function(t){return se(this,void 0,void 0,function(){var n=this;return ue(this,function(r){var o;return t=(o=t).startsWith(ia.URL_SCHEME)?o.slice(ia.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return mh(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(go,"readwrite"),f=c.objectStore(go),d=f.get(t);d.onsuccess=function(){if(d.result==null)return l.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var h=f.delete(t),p=function(){var m=(u=l.transaction(oi,"readwrite")).objectStore(oi).delete(t);m.onsuccess=function(){return i(d.result.modelArtifactsInfo)},m.onerror=function(g){return a(d.error)}};h.onsuccess=p,h.onerror=function(m){return p(),l.close(),a(d.error)}},d.onerror=function(h){return l.close(),a(d.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},e}();if(H().getBool("IS_BROWSER"))try{Io.registerManager(ia.URL_SCHEME,new bN)}catch{}var Or="/",Mi="tensorflowjs_models",Iw="info",EN="model_topology",CN="weight_specs",_N="weight_data",SN="model_metadata";function Tw(e){return{info:[Mi,e,Iw].join(Or),topology:[Mi,e,EN].join(Or),weightSpecs:[Mi,e,CN].join(Or),weightData:[Mi,e,_N].join(Or),modelMetadata:[Mi,e,SN].join(Or)}}function kN(e){var t=e.split(Or);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Or)}var aa=function(){function e(t){if(!H().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Tw(this.modelPath)}return e.prototype.save=function(t){return se(this,void 0,void 0,function(){var n,r,o;return ue(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=eu(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(vh)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return se(this,void 0,void 0,function(){var t,n,r,o,i,a,s;return ue(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,n.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(vh){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var f=atob(l),d=new Uint8Array(f.length),h=0;h<f.length;++h)d.set([f.charCodeAt(h)],h);return d.buffer}(s),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),a0=function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(aa.URL_SCHEME)?(t=e.slice(aa.URL_SCHEME.length),new aa(t)):null;var t};En.registerSaveRouter(a0),En.registerLoadRouter(a0);var RN=function(){function e(){I(H().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),I(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return se(this,void 0,void 0,function(){var t,n,r,o,i,a;return ue(this,function(s){for(t={},n=Mi+Or,r=Or+Iw,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(n)&&i.endsWith(r)&&(a=kN(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},e.prototype.removeModel=function(t){return se(this,void 0,void 0,function(){var n,r;return ue(this,function(o){var i;if(t=(i=t).startsWith(aa.URL_SCHEME)?i.slice(aa.URL_SCHEME.length):i,n=Tw(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(H().getBool("IS_BROWSER"))try{Io.registerManager(aa.URL_SCHEME,new RN)}catch{}var IN="model",TN=".json",DN=".weights.bin";function s0(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var qf=function(){function e(t){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=IN),this.modelTopologyFileName=t+TN,this.weightDataFileName=t+DN}return e.prototype.save=function(t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s;return ue(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,s0(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,[4,s0(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:eu(t)}]}})})},e.URL_SCHEME="downloads://",e}(),NN=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return se(this,void 0,void 0,function(){var t,n,r=this;return ue(this,function(o){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&i({modelTopology:c});var f=l.weightsManifest;if(f!=null){var d;try{d=r.checkManifestAndWeightFiles(f,n)}catch(g){return void a(g)}var h=[],p=[],m=[];f.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),h.push.apply(h,g.weights)}),f.forEach(function(g){g.paths.forEach(function(v){var y=new FileReader;y.onload=function(x){var w=x.target.result,b=p.indexOf(v);m[b]=w,m.indexOf(null)===-1&&i({modelTopology:c,weightSpecs:h,weightData:Zp(m),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},y.onerror=function(x){return a("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(d[v])})})}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],o=n.map(function(u){return r0(u.name)}),i={},a=0,s=t;a<s.length;a++)s[a].paths.forEach(function(u){var l=r0(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");i[u]=n[o.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return i},e}();function u0(e,t,n,r){(function(i){I(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(e),function(i,a){I(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),I(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),I(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(n=n??0,r=r??1);var o=0;return Promise.all(e.map(function(i){return i.then(function(a){var s=n+ ++o/e.length*(r-n);return t(s),a}),i}))}function Dw(e,t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return ue(this,function(f){switch(f.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?H().platform.fetch:t.fetchFunc,r=e.map(function(d){return n(d,t.requestInit,{isBinary:!0})}),o=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=f.sent(),[3,4];case 2:return[4,u0(r,t.onProgress,o,i)];case 3:a=f.sent(),f.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,u0(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function l0(e){var t=this;return function(n,r,o){return r===void 0&&(r=""),se(t,void 0,void 0,function(){var i,a,s,u,l,c,f,d,h,p;return ue(this,function(m){switch(m.label){case 0:if(i=n.map(function(){return!1}),a={},s=o!=null?o.map(function(){return!1}):[],u=[],n.forEach(function(g,v){var y=0;g.weights.forEach(function(x){var w="quantization"in x?x.quantization.dtype:x.dtype,b=ph[w]*le(x.shape),C=function(){i[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:x,groupOffset:y,sizeBytes:b})};o!=null?o.forEach(function(S,E){S===x.name&&(C(),s[E]=!0)}):C(),u.push(x.name),y+=b})}),!s.every(function(g){return g}))throw l=o.filter(function(g,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=i.reduce(function(g,v,y){return v&&g.push(y),g},[]),f=[],c.forEach(function(g){n[g].paths.forEach(function(v){var y=r+(r.endsWith("/")?"":"/")+v;f.push(y)})}),[4,e(f)];case 1:return d=m.sent(),h={},p=0,c.forEach(function(g){for(var v=n[g].paths.length,y=0,x=0;x<v;x++)y+=d[p+x].byteLength;for(var w=new ArrayBuffer(y),b=new Uint8Array(w),C=0,S=0;S<v;S++){var E=new Uint8Array(d[p+S]);b.set(E,C),C+=E.byteLength}a[g].forEach(function(k){var _=kw(w.slice(k.groupOffset,k.groupOffset+k.sizeBytes),[k.manifestEntry]);for(var T in _)h[T]=_[T]}),p+=v}),[2,h]}})})}}En.registerSaveRouter(function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(qf.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new qf(t)}(e.slice(qf.URL_SCHEME.length)):null});var Nw=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(I(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=H().platform.fetch,I(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&I(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return se(this,void 0,void 0,function(){var n,r,o,i;return ue(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:eu(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return se(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,l,c,f,d;return ue(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,t.json()];case 3:return n=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=n.modelTopology,i=n.weightsManifest,a=n.generatedBy,s=n.convertedBy,u=n.format,l=n.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:d=h.sent(),c=d[0],f=d[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:c,weightData:f,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},e.prototype.loadWeights=function(t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,f,d;return ue(this,function(h){switch(h.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),v=p.substring(0,m),y=g>m?p.substring(g):"";return[v+"/",y]}(n),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return f=[],t.forEach(function(p){p.paths.forEach(function(m){f.push(a+m+i)})}),[4,Dw(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[s,Zp(d)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function gh(e){return e.match(Nw.URL_SCHEME_REGEX)!=null}var c0=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return gh(n)}):gh(e))?yh(e,{onProgress:t}):null};function yh(e,t){return new Nw(e,t)}En.registerSaveRouter(c0),En.registerLoadRouter(c0);var Xf=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return se(this,void 0,void 0,function(){return ue(this,function(t){return[2,this.modelArtifacts]})})},e}(),PN=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return se(this,void 0,void 0,function(){return ue(this,function(n){return[2,this.saveHandler(t)]})})},e}(),Pw=Object.freeze({browserFiles:function(e){return new NN(e)},browserHTTPRequest:function(e,t){return yh(e,t)},concatenateArrayBuffers:Zp,decodeWeights:kw,encodeWeights:function(e,t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(l){return l.name}):Object.keys(e),i=function(l){var c=o[l],f=Array.isArray(e)?e[l].tensor:e[c];if(f.dtype!=="float32"&&f.dtype!=="int32"&&f.dtype!=="bool"&&f.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+f.dtype);var d={name:c,shape:f.shape,dtype:f.dtype};if(f.dtype==="string"){var h=new Promise(function(p){return se(s,void 0,void 0,function(){var m,g,v,y,x,w,b;return ue(this,function(C){switch(C.label){case 0:return[4,f.bytes()];case 1:for(m=C.sent(),g=m.reduce(function(S,E){return S+E.length},0)+ec*m.length,v=new Uint8Array(g),y=0,x=0;x<m.length;x++)w=m[x],b=new Uint8Array(new Uint32Array([w.length]).buffer),v.set(b,y),y+=ec,v.set(w,y),y+=w.length;return p(v),[2]}})})});r.push(h)}else r.push(f.data());t!=null&&(d.group=t),n.push(d)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:wN(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Xf(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Xf({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Xf({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return En.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:eu,getSaveHandlers:function(e){return En.getSaveHandlers(e)},http:yh,isHTTPScheme:gh,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),se(this,void 0,void 0,function(){return ue(this,function(o){return[2,l0(function(i){return Dw(i,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return En.registerLoadRouter(e)},registerSaveRouter:function(e){return En.registerSaveRouter(e)},weightsLoaderFactory:l0,withSaveHandler:function(e){return new PN(e)},copyModel:function(e,t){return se(this,void 0,void 0,function(){return ue(this,function(n){return[2,o0(e,t,!1)]})})},listModels:function(){return se(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return ue(this,function(s){switch(s.label){case 0:e=Io.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,Io.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())t[o+oa+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return se(this,void 0,void 0,function(){return ue(this,function(n){return[2,o0(e,t,!0)]})})},removeModel:function(e){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){return t=ul(e),[2,Io.getManager(t.scheme).removeModel(t.path)]})})}}),Di;P({confusionMatrix_:function(e,t,n){var r=R(e,"labels","confusionMatrix"),o=R(t,"predictions","confusionMatrix");I(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),I(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),I(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),I(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),I(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=lh(r.asType("int32"),n),a=lh(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}});var AN=P({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(nx("FromPixels",M.backendName)!=null)return M.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],f=l[1];if(a?s=e.getContext("2d").getImageData(0,0,c,f).data:r||n?s=e.data:(i||o)&&(Di==null&&(Di=document.createElement("canvas").getContext("2d")),Di.canvas.width=c,Di.canvas.height=f,Di.drawImage(e,0,0,c,f),s=Di.getImageData(0,0,c,f).data),t===4)u=new Int32Array(s);else{var d=c*f;u=new Int32Array(d*t);for(var h=0;h<d;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return Ip(u,[f,c,t],"int32")}}),ev=Object.freeze({toPixels:function(e,t){return se(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,f,d,h,p,m,g,v,y,x,w,b,C,S,E;return ue(this,function(k){switch(k.label){case 0:if(n=R(e,"img","toPixels"),e instanceof rt||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=n.rank===2?1:n.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=k.sent(),f=c[0],d=c[1],h=f[0],p=d[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(m=n.dtype==="float32"?255:1,g=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)y=void 0,x=void 0,w=void 0,b=void 0,a===1?(y=s[v]*m,x=s[v]*m,w=s[v]*m,b=255):a===3?(y=s[3*v]*m,x=s[3*v+1]*m,w=s[3*v+2]*m,b=255):a===4&&(y=s[4*v]*m,x=s[4*v+1]*m,w=s[4*v+2]*m,b=s[4*v+3]*m),g[(C=4*v)+0]=Math.round(y),g[C+1]=Math.round(x),g[C+2]=Math.round(w),g[C+3]=Math.round(b);return t!=null&&(t.width=i,t.height=o,S=t.getContext("2d"),E=new ImageData(g,i,o),S.putImageData(E,0,0)),n!==e&&n.dispose(),[2,g]}})})},fromPixels:AN}),FN=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),MN=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Ci(e){I(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),I(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),I(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),MN.register(e)}var _i=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return ir(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var i=this.computeGradients(n,o),a=i.value,s=i.grads;if(o!=null){var u=o.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return fn(s),r?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return Hk(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&fn(this.iterations_)},t.prototype.saveIterations=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:te(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,n.slice(1)]}})})},t}(FN);Object.defineProperty(_i,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var ON=function(e){function t(n,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=n,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=M.backend.epsilon()),i}return ir(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=M.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:oe(function(){return Fe(a).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:oe(function(){return Fe(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable,l=r.accumulatedUpdates[i].variable;oe(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),f=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=l.mul(r.rho).add(f.square().mul(1-r.rho));u.assign(c),l.assign(d);var h=f.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(fn(this.accumulatedGrads.map(function(n){return n.variable})),fn(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){var n;return ue(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(_i);Ci(ON);var LN=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return ir(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=M.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:oe(function(){return Cr(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable;oe(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(M.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&fn(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(_i);Ci(LN);var BN=function(e){function t(n,r,o,i){i===void 0&&(i=null);var a=e.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],oe(function(){a.accBeta1=te(r).variable(),a.accBeta2=te(o).variable()}),i==null&&(a.epsilon=M.backend.epsilon()),a}return ir(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);oe(function(){var i=St(1,r.accBeta1),a=St(1,r.accBeta2);o.forEach(function(s,u){var l=M.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:oe(function(){return Fe(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:oe(function(){return Fe(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,h=f.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2).add(c.square().mul(1-r.beta2)),m=h.div(i),g=p.div(a);f.assign(h),d.assign(p);var v=m.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&fn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&fn(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){var n;return ue(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){var r,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),oe(function(){o.accBeta1.assign(Jl(o.beta1,o.iterations_+1)),o.accBeta2.assign(Jl(o.beta2,o.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(_i);Ci(BN);var WN=function(e){function t(n,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],oe(function(){s.iteration=te(0).variable(),s.accBeta1=te(r).variable()}),i==null&&(s.epsilon=M.backend.epsilon()),s}return ir(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);oe(function(){var i=St(1,r.accBeta1),a=Zn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var l=M.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Fe(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Fe(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,h=f.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2),m=c.abs(),g=p.maximum(m);f.assign(h),d.assign(g);var v=a.div(i).mul(h.div(g.add(r.epsilon))).add(l);l.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&fn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&fn(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(_i);Ci(WN);var Aw=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return ir(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=Array.isArray(n)?n[i].tensor:n[o];if(a!=null){var s=M.registeredVariables[o];oe(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=ik(te(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(_i);Ci(Aw);var $N=function(e){function t(n,r,o){o===void 0&&(o=!1);var i=e.call(this,n)||this;return i.learningRate=n,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=te(i.momentum),i}return ir(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=M.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:oe(function(){return Fe(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(n)?n[i].tensor:n[o];u!=null&&oe(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&fn(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){return ue(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(Aw);Ci($N);var zN=function(e){function t(n,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=n,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=M.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return ir(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=M.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:oe(function(){return Fe(a).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:oe(function(){return Fe(a).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:oe(function(){return Fe(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,l=r.accumulatedMoments[i].variable;oe(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var f=r.accumulatedMeanGrads[i].variable,d=f.mul(r.decay).add(s.mul(1-r.decay)),h=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(d.square().add(r.epsilon)).sqrt()));u.assign(c),f.assign(d),l.assign(h);var p=a.sub(h);a.assign(p)}else{var m=u.mul(r.decay).add(s.square().mul(1-r.decay));h=l.mul(r.momentum).add(s.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),l.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&fn(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&fn(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&fn(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return se(this,void 0,void 0,function(){var n;return ue(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(_i);Ci(zN);rt.prototype.squaredDifference=function(e){return qx(this,e)},j=hN;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xh=function(e,t){return xh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},xh(e,t)};function Ee(e,t){xh(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Ht=function(){return Ht=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ht.apply(this,arguments)};function ce(e,t,n,r){function o(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function s(c){try{l(r.next(c))}catch(f){a(f)}}function u(c){try{l(r.throw(c))}catch(f){a(f)}}function l(c){c.done?i(c.value):o(c.value).then(s,u)}l((r=r.apply(e,[])).next())})}function fe(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1],i=l;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(l);break}i[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(c){l=[6,c],o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function fs(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var ui=function(){function e(t,n){if(!li(t)||!li(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Bc(e,t){return e instanceof rt&&e.shape.length===t}function UN(e){return Bc(e,2)}function Wc(e){return Bc(e,3)}function To(e){return Bc(e,4)}function jN(e){return e%1!==0}function f0(e){return e%2===0}function VN(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function d0(e){return e&&e.width&&e.height}function HN(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new ui(Math.round(n*o),Math.round(r*o))}function tv(e){return e.reduce(function(t,n){return t.add(n)},new We(0,0)).div(new We(e.length,e.length))}function Bs(e,t,n){return Array(e).fill(0).map(function(r,o){return t+o*n})}function li(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function h0(e){return li(e)&&0<=e&&e<=1}var We=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Hr=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(li),i=[r.x,r.y,r.width,r.height].every(li);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(li)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new We(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new We(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new We(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new We(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,i=t.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:n,y:r,width:o,height:i})},e.prototype.rescale=function(t){var n=d0(t)?t.width:t,r=d0(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],o=r[0],i=r[1],a=r[2],s=r[3];return new e({x:o,y:i,width:a,height:s})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(i,0),c=a-u,f=s-l,d=Math.min(c,t-u),h=Math.min(f,n-l);return new e({x:u,y:l,width:d,height:h}).floor()},e.prototype.shift=function(t,n){var r=this,o=r.width,i=r.height,a=this.x+t,s=this.y+n;return new e({x:a,y:s,width:o,height:i})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,l=this.left,c=this.top,f=this.right,d=this.bottom;return f>n&&(s=-f+n+r,f=n),d>t&&(u=-d+t+o,d=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:i,edx:s,y:c,ey:d,x:l,ex:f,w:r,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),$c=function(e){Ee(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{left:n,top:r,right:o,bottom:i},a)||this}return t}(Hr),Fw=function(){function e(t,n,r,o,i){this._imageDims=new ui(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new Hr(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Hr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),sr=function(e){Ee(t,e);function t(n,r,o){return e.call(this,n,n,"",r,o)||this}return t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new t(i,a,s)},t}(Fw);function GN(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*o;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function KN(e){var t=e.map(function(s){return s.x}),n=e.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=n.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return s<u?u:s},0),a=n.reduce(function(s,u){return s<u?u:s},0);return new $c(r,o,i,a)}function Ws(e,t,n,r){r===void 0&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,l=[],c=0;c<u.length;c++){var f=u[c],d=e[s],h=e[f];l.push(GN(d,h,r))}o=o.filter(function(p,m){return l[m]<=n})};o.length>0;)a();return i}function tu(e,t){return oe(function(){var n=t[0],r=t[1],o=t[2],i=Cr(fs(e.shape.slice(0,3),[1]),n),a=Cr(fs(e.shape.slice(0,3),[1]),r),s=Cr(fs(e.shape.slice(0,3),[1]),o),u=Et([i,a,s],3);return St(e,u)})}function qN(e,t){return t===void 0&&(t=!1),oe(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(t?.5:1)),s=r>o?2:1,u=function(h){var p=e.shape.slice();return p[s]=h,Cr(p,0)},l=u(a),c=i-l.shape[s],f=t&&c?u(c):null,d=[f,e,l].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Et(d,s)})}function Yf(e){return 1/(1+Math.exp(-e))}var nv=function(e){Ee(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{x:n,y:r,width:o,height:i},a)||this}return t}(Hr),XN=.5,YN=.43,QN=.45,$s=function(){function e(t,n,r){r===void 0&&(r=new We(0,0));var o=n.width,i=n.height;this._imgDims=new ui(o,i),this._shift=r,this._positions=t.map(function(a){return a.mul(new We(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new We(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new We(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new We(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof sr?t.box.floor():new Hr(t);return this.shiftBy(r.x,r.y).align(null,n)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],o=t[2],i=function(f){return o.sub(f).magnitude()},a=(i(n)+i(r))/2,s=Math.floor(a/QN),u=tv(t),l=Math.floor(Math.max(0,u.x-XN*s)),c=Math.floor(Math.max(0,u.y-YN*s));return new nv(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},e.prototype.alignMinBbox=function(t){var n=KN(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),JN=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],tv([n[3],n[4]])]},t}($s),ZN=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(tv)},t}($s),p0=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+VN(this.distance)+")":"")},e}(),v0=function(e){Ee(t,e);function t(n,r){var o=e.call(this,n)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(n,r){if(Hr.assertIsValidBox(n,r),!li(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Hr),Ja=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){Ee(t,e);function t(n,r,o,i){var a=e.call(this,n,r)||this;return a._score=o,a._classScore=i,a}return t.assertIsValidPredictedBox=function(n,r){if(v0.assertIsValidLabeledBox(n,r),!h0(n.score)||!h0(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(v0);function Mw(e){return e.detection instanceof sr}function zs(e,t){var n={detection:t};return Object.assign({},e,n)}function Ow(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function Lw(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(o,i){e.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function Bw(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=Lw();return Ht({Canvas:e||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:t||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:n,createImageElement:r,fetch:o},i)}function Ww(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function $w(){return typeof global=="object"&&typeof require=="function"&&typeof Gb<"u"&&typeof process<"u"&&!!process.version}var xt;function e3(){if(!xt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return xt}function wh(e){xt=e}function rv(){Ww()&&wh(Ow()),$w()&&wh(Bw())}function t3(e){if(xt||rv(),!xt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?xt.Canvas:t,r=e.Image,o=r===void 0?xt.Image:r;xt.Canvas=n,xt.Image=o,xt.createCanvasElement=e.createCanvasElement||function(){return new n},xt.createImageElement=e.createImageElement||function(){return new o},xt.ImageData=e.ImageData||xt.ImageData,xt.Video=e.Video||xt.Video,xt.fetch=e.fetch||xt.fetch,xt.readFile=e.readFile||xt.readFile}var $t={getEnv:e3,setEnv:wh,initialize:rv,createBrowserEnv:Ow,createFileSystem:Lw,createNodejsEnv:Bw,monkeyPatch:t3,isBrowser:Ww,isNodejs:$w};rv();function ov(e){return!$t.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Gr(e){var t=$t.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var o=ov(e);if(!(o instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var yo;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(yo||(yo={}));var zw=function(){function e(t){t===void 0&&(t={});var n=t.anchorPosition,r=t.backgroundColor,o=t.fontColor,i=t.fontSize,a=t.fontStyle,s=t.padding;this.anchorPosition=n||yo.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4}return e}(),n3=function(){function e(t,n,r){r===void 0&&(r={}),this.text=typeof t=="string"?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new zw(r)}return e.prototype.measureWidth=function(t){var n=this.options.padding;return this.text.map(function(r){return t.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*n},e.prototype.measureHeight=function(){var t=this.options,n=t.fontSize,r=t.padding;return this.text.length*n+2*r},e.prototype.getUpperLeft=function(t,n){var r=this.options.anchorPosition,o=r===yo.BOTTOM_RIGHT||r===yo.TOP_RIGHT,i=r===yo.BOTTOM_LEFT||r===yo.BOTTOM_RIGHT,a=this.measureWidth(t),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,l=i?this.anchor.y-s:this.anchor.y;if(n){var c=n.width,f=n.height,d=Math.max(Math.min(u,c-a),0),h=Math.max(Math.min(l,f-s),0);return{x:d,y:h}}return{x:u,y:l}},e.prototype.draw=function(t){var n=ov(t),r=Gr(n),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,u=o.fontStyle,l=o.padding;r.font=s+"px "+u;var c=this.measureWidth(r),f=this.measureHeight();r.fillStyle=i;var d=this.getUpperLeft(r,n);r.fillRect(d.x,d.y,c,f),r.fillStyle=a,this.text.forEach(function(h,p){var m=l+d.x,g=l+d.y+(p+1)*s;r.fillText(h,m,g)})},e}(),r3=function(){function e(t){t===void 0&&(t={});var n=t.boxColor,r=t.lineWidth,o=t.label,i=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o;var a={anchorPosition:yo.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new zw(Object.assign({},a,i))}return e}(),o3=function(){function e(t,n){n===void 0&&(n={}),this.box=new Hr(t),this.options=new r3(n)}return e.prototype.draw=function(t){var n=Gr(t),r=this.options,o=r.boxColor,i=r.lineWidth,a=this.box,s=a.x,u=a.y,l=a.width,c=a.height;n.strokeStyle=o,n.lineWidth=i,n.strokeRect(s,u,l,c);var f=this.options.label;f&&new n3([f],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(t)},e}();function Uw(e){var t=$t.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function i3(e){return new Promise(function(t,n){if(e instanceof $t.getEnv().Canvas||Uw(e))return t();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function a3(e){return new Promise(function(t,n){if(!(e instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if(typeof r.result!="string")return n("bufferToImage - expected reader.result to be a string, in onload");var o=$t.getEnv().createImageElement();o.onload=function(){return t(o)},o.onerror=n,o.src=r.result},r.onerror=n,r.readAsDataURL(e)})}function iv(e){var t=$t.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new ui(e.naturalWidth,e.naturalHeight):e instanceof r?new ui(e.videoWidth,e.videoHeight):new ui(e.width,e.height)}function zc(e){var t=e.width,n=e.height,r=$t.getEnv().createCanvasElement,o=r();return o.width=t,o.height=n,o}function av(e,t){var n=$t.getEnv().ImageData;if(!(e instanceof n)&&!Uw(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=iv(e),o=r.width,i=r.height,a=zc({width:o,height:i});return e instanceof n?Gr(a).putImageData(e,0,0):Gr(a).drawImage(e,0,0,o,i),a}function s3(e,t){return ce(this,void 0,void 0,function(){var n,r,o,i,a,s;return fe(this,function(u){switch(u.label){case 0:return n=$t.getEnv().createCanvasElement(),r=e.shape.slice(To(e)?1:0),o=r[0],i=r[1],a=r[2],s=oe(function(){return e.as3D(o,i,a).toInt()}),[4,ev.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function m0(e){var t=$t.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function u3(e,t,n){n===void 0&&(n=!1);var r=$t.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=iv(e),s=t/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=zc({width:t,height:t}),f=e instanceof i?e:av(e),d=Math.abs(u-l)/2,h=n&&u<l?d:0,p=n&&l<u?d:0;return Gr(c).drawImage(f,h,p,u,l),c}var tc=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(o,i){if(Wc(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(To(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof $t.getEnv().Canvas?o:av(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Bs(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return HN({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,oe(function(){var o=Bs(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof rt){var u=To(s)?s:s.expandDims();return u=qN(u,n),(u.shape[1]!==t||u.shape[2]!==t)&&(u=qp.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof $t.getEnv().Canvas)return ev.fromPixels(u3(s,t,n));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=Sn(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,t,t,3);return i})},e}();function At(e){return ce(this,void 0,void 0,function(){var t,n,r;return fe(this,function(o){switch(o.label){case 0:if(e instanceof tc)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=t.map(ov),r.forEach(function(i,a){if(!m0(i)&&!Wc(i)&&!To(i))throw typeof t[a]=="string"?new Error("toNetInput -"+n(a)+" string passed, but could not resolve HTMLElement for element id "+t[a]):new Error("toNetInput -"+n(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(To(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+n(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return m0(i)&&i3(i)}))];case 1:return o.sent(),[2,new tc(r,Array.isArray(e))]}})})}function sv(e,t){return ce(this,void 0,void 0,function(){var n,r,o,i,a,s,u;return fe(this,function(l){switch(l.label){case 0:return n=$t.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,At(e)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,s3(i)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=Gr(r),u=t.map(function(c){return c instanceof sr?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var f=c.x,d=c.y,h=c.width,p=c.height,m=zc({width:h,height:p});return Gr(m).putImageData(s.getImageData(f,d,h,p),0,0),m})]}})})}function uv(e,t){return ce(this,void 0,void 0,function(){return fe(this,function(n){if(!Wc(e)&&!To(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(To(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,oe(function(){var r=e.shape.slice(To(e)?1:0),o=r[0],i=r[1],a=r[2],s=t.map(function(l){return l instanceof sr?l.forSize(i,o).box:l}).map(function(l){return l.clipAtImageBorders(i,o)}),u=s.map(function(l){var c=l.x,f=l.y,d=l.width,h=l.height;return vw(e.as3D(o,i,a),[f,c,0],[h,d,a])});return u})]})})}function jw(e,t){return ce(this,void 0,void 0,function(){var n,r;return fe(this,function(o){switch(o.label){case 0:return n=$t.getEnv().fetch,[4,n(e,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function l3(e){return ce(this,void 0,void 0,function(){var t,n;return fe(this,function(r){switch(r.label){case 0:return[4,jw(e)];case 1:return t=r.sent(),[4,t.blob()];case 2:if(n=r.sent(),!n.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+t.url);return[2,a3(n)]}})})}function c3(e){return ce(this,void 0,void 0,function(){return fe(this,function(t){switch(t.label){case 0:return[4,jw(e)];case 1:return[2,t.sent().json()]}})})}function Vw(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),i=e.endsWith(".json")?o[o.length-1]:n,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function f3(e,t){return ce(this,void 0,void 0,function(){var n,r,o,i;return fe(this,function(a){switch(a.label){case 0:return n=Vw(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,c3(r)];case 1:return i=a.sent(),[2,Pw.loadWeights(i,o)]}})})}function d3(e,t,n){n===void 0&&(n=!1);var r=n?iv(t):t,o=r.width,i=r.height;return e.width=o,e.height=i,{width:o,height:i}}var Qr=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;return r[o]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof ga})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof ga)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,o=n.tensor;t.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,o=n.tensor,i=Lt(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return ce(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return ce(this,void 0,void 0,function(){var n;return fe(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,f3(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return ce(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,f;return fe(this,function(d){switch(d.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=$t.getEnv().readFile,r=Vw(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(h){return Promise.all(h.map(function(p){return n(p).then(function(m){return m.buffer})}))},s=Pw.weightsLoaderFactory(a),c=(l=JSON).parse,[4,n(o)];case 1:return u=c.apply(l,[d.sent().toString()]),[4,s(u,i)];case 2:return f=d.sent(),this.loadFromWeightMap(f),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+t);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=n.obj,o=n.objProp;if(!r||!o||!(r[o]instanceof rt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},e}();function Cn(e,t,n){return oe(function(){var r=jp(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Te(r,t.bias),r})}function Qf(e,t,n){return n===void 0&&(n=!1),oe(function(){var r=ot(n?Te(jn(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Cn(e,t.conv0,[2,2])),o=Cn(r,t.conv1,[1,1]),i=ot(Te(r,o)),a=Cn(i,t.conv2,[1,1]);return ot(Te(r,Te(o,a)))})}function Vu(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),oe(function(){var o=ot(n?Te(jn(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Cn(e,t.conv0,r?[2,2]:[1,1])),i=Cn(o,t.conv1,[1,1]),a=ot(Te(o,i)),s=Cn(a,t.conv2,[1,1]),u=ot(Te(o,Te(i,s))),l=Cn(u,t.conv3,[1,1]);return ot(Te(o,Te(i,Te(s,l))))})}function rr(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),oe(function(){var o=Te(jn(e,t.filters,[1,1],n),t.bias);return r?ot(o):o})}function Jr(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function Uc(e,t){return function(n,r,o,i){var a=on(e(n*r*o*o),[o,o,n,r]),s=yt(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function lv(e,t){return function(n,r,o){var i=Ro(e(n*r),[n,r]),a=yt(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var Hw=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function cv(e,t){return function(n,r,o){var i=on(e(9*n),[3,3,n,1]),a=on(e(n*r),[1,1,n,r]),s=yt(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Hw(i,a,s)}}function fv(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new Hw(n,r,o)}}function zo(e,t){return function(n,r,o){var i=e[n];if(!Bc(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:o||n}),i}}function Zr(e){var t=e;function n(o){var i=t.slice(0,o);return t=t.slice(o),i}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function Gw(e,t){var n=Uc(e,t),r=cv(e,t);function o(a,s,u,l){l===void 0&&(l=!1);var c=l?n(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),f=r(s,s,u+"/conv1"),d=r(s,s,u+"/conv2");return{conv0:c,conv1:f,conv2:d}}function i(a,s,u,l){l===void 0&&(l=!1);var c=o(a,s,u,l),f=c.conv0,d=c.conv1,h=c.conv2,p=r(s,s,u+"/conv3");return{conv0:f,conv1:d,conv2:h,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function h3(e){var t=[],n=Zr(e),r=n.extractWeights,o=n.getRemainingWeights,i=Gw(r,t).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),l=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function Kw(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function qw(e,t){var n=zo(e,t),r=Kw(n),o=fv(n);function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),f=o(s+"/conv2");return{conv0:l,conv1:c,conv2:f}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),f=o(s+"/conv2"),d=o(s+"/conv3");return{conv0:l,conv1:c,conv2:f,conv3:d}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function p3(e){var t=[],n=qw(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Jr(e,t),{params:r,paramMappings:t}}var Xw=function(e){Ee(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return oe(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=tu(o,i).div(te(255)),s=Vu(a,r.dense0,!0);return s=Vu(s,r.dense1),s=Vu(s,r.dense2),s=Vu(s,r.dense3),s=Zs(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return p3(n)},t.prototype.extractParams=function(n){return h3(n)},t}(Qr);function yr(e,t){return oe(function(){return Te(Mc(e,t.weights),t.bias)})}function v3(e,t,n){var r=[],o=Zr(e),i=o.extractWeights,a=o.getRemainingWeights,s=lv(i,r),u=s(t,n,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function m3(e){var t=[],n=zo(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return Jr(e,t),{params:o,paramMappings:t}}function Yw(e){var t={},n={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?n:t;o[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Qw=function(e){Ee(t,e);function t(n,r){var o=e.call(this,n)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return oe(function(){var i=n instanceof tc?r.faceFeatureExtractor.forwardInput(n):n;return yr(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return v3(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=Yw(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),m3(i)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=n.slice(0,n.length-i),s=n.slice(n.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(Qr),g0=["neutral","happy","sad","angry","fearful","disgusted","surprised"],g3=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);g0.forEach(function(r,o){n[r]=t[o]})}return e.prototype.asSortedArray=function(){var t=this;return g0.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),y3=function(e){Ee(t,e);function t(n){return n===void 0&&(n=new Xw),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return oe(function(){return Xr(r.runNet(n))})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(n){return ce(this,void 0,void 0,function(){var r,o,i,a,s=this;return fe(this,function(u){switch(u.label){case 0:return[4,At(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(Ct(o).map(function(l){return ce(s,void 0,void 0,function(){var c;return fe(this,function(f){switch(f.label){case 0:return[4,l.data()];case 1:return c=f.sent(),l.dispose(),[2,c]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(l){return new g3(l)}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Qw);function Jw(e,t){var n={expressions:t};return Object.assign({},e,n)}function Zw(e){return Mw(e)&&e.landmarks instanceof $s&&e.unshiftedLandmarks instanceof $s&&e.alignedRect instanceof sr}function jc(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),i=e.detection.imageDims,a=new sr(e.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:t,alignedRect:a};return Object.assign({},e,s)}function x3(e,t){var n=Uc(e,t),r=cv(e,t);function o(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),f=n(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:f}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function w3(e,t){var n=[],r=Zr(e),o=r.extractWeights,i=r.getRemainingWeights,a=x3(o,n),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,f=s(3,32,3,"entry_flow/conv_in"),d=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:f,reduction_block_0:d,reduction_block_1:h},m={};Bs(t,0,1).forEach(function(x){m["main_block_"+x]=c(128,"middle_flow/main_block_"+x)});var g=l(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),y={reduction_block:g,separable_conv:v};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:p,middle_flow:m,exit_flow:y}}}function b3(e,t){var n=zo(e,t),r=Kw(n),o=fv(n);function i(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function E3(e,t){var n=[],r=b3(e,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),f={conv_in:u,reduction_block_0:l,reduction_block_1:c},d={};Bs(t,0,1).forEach(function(g){d["main_block_"+g]=s("middle_flow/main_block_"+g)});var h=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),m={reduction_block:h,separable_conv:p};return Jr(e,n),{params:{entry_flow:f,middle_flow:d,exit_flow:m},paramMappings:n}}function eb(e,t,n){return Te(jn(e,t.filters,n,"same"),t.bias)}function Jf(e,t,n){n===void 0&&(n=!0);var r=n?ot(e):e;return r=Cn(r,t.separable_conv0,[1,1]),r=Cn(ot(r),t.separable_conv1,[1,1]),r=Tt(r,[3,3],[2,2],"same"),r=Te(r,eb(e,t.expansion_conv,[2,2])),r}function C3(e,t){var n=Cn(ot(e),t.separable_conv0,[1,1]);return n=Cn(ot(n),t.separable_conv1,[1,1]),n=Cn(ot(n),t.separable_conv2,[1,1]),n=Te(n,e),n}var _3=function(e){Ee(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return oe(function(){var i=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=tu(i,a).div(te(256)),u=ot(eb(s,o.entry_flow.conv_in,[2,2]));return u=Jf(u,o.entry_flow.reduction_block_0,!1),u=Jf(u,o.entry_flow.reduction_block_1),Bs(r._numMainBlocks,0,1).forEach(function(l){u=C3(u,o.middle_flow["main_block_"+l])}),u=Jf(u,o.exit_flow.reduction_block),u=ot(Cn(u,o.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return E3(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return w3(n,this._numMainBlocks)},t}(Qr);function S3(e){var t=[],n=Zr(e),r=n.extractWeights,o=n.getRemainingWeights,i=lv(r,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}function k3(e){var t=[],n=zo(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Jr(e,t),{params:o,paramMappings:t}}var nc;(function(e){e.FEMALE="female",e.MALE="male"})(nc||(nc={}));var R3=function(e){Ee(t,e);function t(n){n===void 0&&(n=new _3(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return oe(function(){var i=n instanceof tc?r.faceFeatureExtractor.forwardInput(n):n,a=Zs(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=yr(a,o.fc.age).as1D(),u=yr(a,o.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(n){var r=this;return oe(function(){var o=r.runNet(n),i=o.age,a=o.gender;return{age:i,gender:Xr(a)}})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return ce(this,void 0,void 0,function(){var r,o,i,a,s,u,l=this;return fe(this,function(c){switch(c.label){case 0:return[4,At(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),i=Ct(o.age),a=Ct(o.gender),s=i.map(function(f,d){return{ageTensor:f,genderTensor:a[d]}}),[4,Promise.all(s.map(function(f){var d=f.ageTensor,h=f.genderTensor;return ce(l,void 0,void 0,function(){var p,m,g,v,y;return fe(this,function(x){switch(x.label){case 0:return[4,d.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return m=x.sent()[0],g=m>.5,v=g?nc.MALE:nc.FEMALE,y=g?m:1-m,d.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return u=c.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return S3(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=Yw(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),k3(i)},t.prototype.extractParams=function(n){var r=1539,o=n.slice(0,n.length-r),i=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(Qr),tb=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,o){var i=o.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=i.length;return oe(function(){var s=function(d,h){return Sn([Cr([68],d),Cr([68],h)],1).as2D(1,136).as1D()},u=function(d,h){var p=i[d],m=p.width,g=p.height;return h(m,g)?Math.abs(m-g)/2:0},l=function(d){return u(d,function(h,p){return h<p})},c=function(d){return u(d,function(h,p){return p<h})},f=n.mul(Cr([a,136],r)).sub(Sn(Array.from(Array(a),function(d,h){return s(l(h),c(h))}))).div(Sn(Array.from(Array(a),function(d,h){return s(i[h].width,i[h].height)})));return f})},t.prototype.forwardInput=function(n){var r=this;return oe(function(){var o=r.runNet(n);return r.postProcess(o,n.inputSize,n.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(n){return ce(this,void 0,void 0,function(){var r,o,i,a=this;return fe(this,function(s){switch(s.label){case 0:return[4,At(n)];case 1:return r=s.sent(),o=oe(function(){return Ct(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,l){return ce(a,void 0,void 0,function(){var c,f,d,h,p;return fe(this,function(m){switch(m.label){case 0:return d=(f=Array).from,[4,u.data()];case 1:return c=d.apply(f,[m.sent()]),h=c.filter(function(g,v){return f0(v)}),p=c.filter(function(g,v){return!f0(v)}),[2,new ZN(Array(68).fill(0).map(function(g,v){return new We(h[v],p[v])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Qw),nb=function(e){Ee(t,e);function t(n){return n===void 0&&(n=new Xw),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(tb);function I3(e){var t=[],n=qw(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Jr(e,t),{params:r,paramMappings:t}}function T3(e){var t=[],n=Zr(e),r=n.extractWeights,o=n.getRemainingWeights,i=Gw(r,t).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u}}}var D3=function(e){Ee(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return oe(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=tu(o,i).div(te(255)),s=Qf(a,r.dense0,!0);return s=Qf(s,r.dense1),s=Qf(s,r.dense2),s=Zs(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return I3(n)},t.prototype.extractParams=function(n){return T3(n)},t}(Qr),N3=function(e){Ee(t,e);function t(n){return n===void 0&&(n=new D3),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(tb);(function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(nb);function P3(e,t){return Te(qt(e,t.weights),t.biases)}function dv(e,t,n,r,o){o===void 0&&(o="same");var i=t.conv,a=i.filters,s=i.bias,u=jn(e,a,n,o);return u=Te(u,s),u=P3(u,t.scale),r?ot(u):u}function A3(e,t){return dv(e,t,[1,1],!0)}function rb(e,t){return dv(e,t,[1,1],!1)}function ob(e,t){return dv(e,t,[2,2],!0,"valid")}function F3(e,t){function n(s,u,l){var c=e(s),f=c.length/(u*l*l);if(jN(f))throw new Error("depth has to be an integer: "+f+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return oe(function(){return Po(on(c,[u,f,l,l]),[2,3,1,0])})}function r(s,u,l,c){var f=n(s,u,l),d=yt(e(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:f,bias:d}}function o(s,u){var l=yt(e(s)),c=yt(e(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function i(s,u,l,c){var f=r(s,u,l,c+"/conv"),d=o(u,c+"/scale");return{conv:f,scale:d}}function a(s,u,l,c,f){f===void 0&&(f=!1);var d=i((f?.5:1)*s,u,l,c+"/conv1"),h=i(s,u,l,c+"/conv2");return{conv1:d,conv2:h}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function M3(e){var t=Zr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=F3(n,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),b=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),S=oe(function(){return Po(Ro(n(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:x,conv256_1:w,conv256_2:b,conv256_down_out:C,fc:S};return{params:E,paramMappings:o}}function O3(e,t){var n=zo(e,t);function r(a){var s=n(a+"/scale/weights",1),u=n(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=n(a+"/conv/filters",4),u=n(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function L3(e){var t=[],n=O3(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),f=o("conv64_2"),d=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),v=o("conv256_1"),y=o("conv256_2"),x=o("conv256_down_out"),w=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!UN(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var b={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:x,fc:w};return Jr(e,t),{params:b,paramMappings:t}}function fr(e,t){var n=A3(e,t.conv1);return n=rb(n,t.conv2),n=Te(n,e),n=ot(n),n}function Hu(e,t){var n=ob(e,t.conv1);n=rb(n,t.conv2);var r=Zs(e,2,2,"valid"),o=Je(r.shape),i=r.shape[3]!==n.shape[3],a=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(a){var s=fs(n.shape);s[1]=1;var u=Je(s);n=Et([n,u],1);var l=fs(n.shape);l[2]=1;var c=Je(l);n=Et([n,c],2)}return r=i?Et([r,o],3):r,n=Te(r,n),n=ot(n),n}var B3=function(e){Ee(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return oe(function(){var o=n.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=tu(o,i).div(te(256)),s=ob(a,r.conv32_down);s=Tt(s,3,2,"valid"),s=fr(s,r.conv32_1),s=fr(s,r.conv32_2),s=fr(s,r.conv32_3),s=Hu(s,r.conv64_down),s=fr(s,r.conv64_1),s=fr(s,r.conv64_2),s=fr(s,r.conv64_3),s=Hu(s,r.conv128_down),s=fr(s,r.conv128_1),s=fr(s,r.conv128_2),s=Hu(s,r.conv256_down),s=fr(s,r.conv256_1),s=fr(s,r.conv256_2),s=Hu(s,r.conv256_down_out);var u=s.mean([1,2]),l=Mc(u,r.fc);return l})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return ce(this,void 0,void 0,function(){var r,o,i,a=this;return fe(this,function(s){switch(s.label){case 0:return[4,At(n)];case 1:return r=s.sent(),o=oe(function(){return Ct(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return L3(n)},t.prototype.extractParams=function(n){return M3(n)},t}(Qr);function ib(e,t){var n={descriptor:t};return Object.assign({},e,n)}function ab(e,t){var n={age:t};return Object.assign({},e,n)}function sb(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var ub=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,o=n.scaleFactor,i=n.maxNumScales,a=n.scoreThresholds,s=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function W3(e,t){function n(u,l){var c=on(e(9*u),[3,3,u,1]),f=yt(e(u)),d=yt(e(u)),h=yt(e(u)),p=yt(e(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:f,batch_norm_offset:d,batch_norm_mean:h,batch_norm_variance:p}}function r(u,l,c,f,d){var h=on(e(u*l*c*c),[c,c,u,l]),p=yt(e(l));return t.push({paramPath:f+"/filters"},{paramPath:f+"/"+(d?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,l,c,f){var d=r(u,l,c,f,!0),h=d.filters,p=d.bias;return{filters:h,batch_norm_offset:p}}function i(u,l,c){var f=n(u,c+"/depthwise_conv"),d=o(u,l,1,c+"/pointwise_conv");return{depthwise_conv:f,pointwise_conv:d}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),l=i(32,64,"mobilenetv1/conv_1"),c=i(64,128,"mobilenetv1/conv_2"),f=i(128,128,"mobilenetv1/conv_3"),d=i(128,256,"mobilenetv1/conv_4"),h=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),m=i(512,512,"mobilenetv1/conv_7"),g=i(512,512,"mobilenetv1/conv_8"),v=i(512,512,"mobilenetv1/conv_9"),y=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),w=i(512,1024,"mobilenetv1/conv_12"),b=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:f,conv_4:d,conv_5:h,conv_6:p,conv_7:m,conv_8:g,conv_9:v,conv_10:y,conv_11:x,conv_12:w,conv_13:b}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),c=o(512,128,1,"prediction_layer/conv_2"),f=o(128,256,3,"prediction_layer/conv_3"),d=o(256,128,1,"prediction_layer/conv_4"),h=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),m=o(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),b=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),_=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),T=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),D={box_encoding_predictor:g,class_predictor:v},z={box_encoding_predictor:y,class_predictor:x},W={box_encoding_predictor:w,class_predictor:b},V={box_encoding_predictor:C,class_predictor:S},K={box_encoding_predictor:E,class_predictor:k},G={box_encoding_predictor:_,class_predictor:T};return{conv_0:u,conv_1:l,conv_2:c,conv_3:f,conv_4:d,conv_5:h,conv_6:p,conv_7:m,box_predictor_0:D,box_predictor_1:z,box_predictor_2:W,box_predictor_3:V,box_predictor_4:K,box_predictor_5:G}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function $3(e){var t=[],n=Zr(e),r=n.extractWeights,o=n.getRemainingWeights,i=W3(r,t),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),l=s(),c=Ip(r(5118*4),[1,5118,4]),f={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:f},paramMappings:t}}function z3(e,t){var n=zo(e,t);function r(l,c,f){var d=n(l+"/Conv2d_"+c+"_pointwise/weights",4,f+"/filters"),h=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,f+"/batch_norm_offset");return{filters:d,batch_norm_offset:h}}function o(l){var c="mobilenetv1/conv_"+l,f="MobilenetV1/Conv2d_"+l+"_depthwise",d=c+"/depthwise_conv",h=c+"/pointwise_conv",p=n(f+"/depthwise_weights",4,d+"/filters"),m=n(f+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),g=n(f+"/BatchNorm/beta",1,d+"/batch_norm_offset"),v=n(f+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),y=n(f+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",l,h)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(l,c){var f=n(l+"/weights",4,c+"/filters"),d=n(l+"/biases",1,c+"/bias");return{filters:f,bias:d}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),f=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:f}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function U3(e){var t=[],n=z3(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Wc(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Jr(e,t),{params:a,paramMappings:t}}function hr(e,t,n){return oe(function(){var r=jn(e,t.filters,n,"same");return r=Te(r,t.batch_norm_offset),Wp(r,0,6)})}var j3=.0010000000474974513;function V3(e,t,n){return oe(function(){var r=Fc(e,t.filters,n,"same");return r=ew(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,j3),Wp(r,0,6)})}function H3(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function G3(e,t){return oe(function(){var n=null,r=hr(e,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(i,a){var s=a+1,u=H3(s);r=V3(r,i.depthwise_conv,u),r=hr(r,i.pointwise_conv,[1,1]),s===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function K3(e,t,n,r,o){var i=e.shape[0],a=Math.min(n,i),s=t.map(function(c,f){return{score:c,boxIndex:f}}).filter(function(c){return c.score>o}).sort(function(c,f){return f.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var f=c.score,d=l.length-1;d>=0;--d){var h=q3(e,c.boxIndex,l[d]);if(h!==0&&(c.score*=u(h),c.score<=o))break}f===c.score&&l.push(c.boxIndex)}}),l}function q3(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),d=(a-o)*(s-i),h=(c-u)*(f-l);if(d<=0||h<=0)return 0;var p=Math.max(o,u),m=Math.max(i,l),g=Math.min(a,c),v=Math.min(s,f),y=Math.max(g-p,0)*Math.max(v-m,0);return y/(d+h-y)}function X3(e){var t=Ct(Po(e,[1,0])),n=[St(t[2],t[0]),St(t[3],t[1])],r=[Te(t[0],Zn(n[0],te(2))),Te(t[1],Zn(n[1],te(2)))];return{sizes:n,centers:r}}function Y3(e,t){var n=X3(e),r=n.sizes,o=n.centers,i=Ct(Po(t,[1,0])),a=Zn(qt(hh(Zn(i[2],te(5))),r[0]),te(2)),s=Te(qt(Zn(i[0],te(10)),r[0]),o[0]),u=Zn(qt(hh(Zn(i[3],te(5))),r[1]),te(2)),l=Te(qt(Zn(i[1],te(10)),r[1]),o[1]);return Po(Sn([St(s,a),St(l,u),Te(s,a),Te(l,u)]),[1,0])}function Q3(e,t,n){return oe(function(){var r=e.shape[0],o=Y3(er(na(n.extra_dim,[r,1,1]),[-1,4]),er(e,[-1,4]));o=er(o,[r,o.shape[0]/r,4]);var i=Yx(Sr(t,[0,0,1],[-1,-1,-1])),a=Sr(i,[0,0,0],[-1,-1,1]);a=er(a,[r,a.shape[1]]);var s=Ct(o),u=Ct(a);return{boxes:s,scores:u}})}function Ni(e,t){return oe(function(){var n=e.shape[0],r=er(rr(e,t.box_encoding_predictor),[n,-1,1,4]),o=er(rr(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function J3(e,t,n){return oe(function(){var r=hr(e,n.conv_0,[1,1]),o=hr(r,n.conv_1,[2,2]),i=hr(o,n.conv_2,[1,1]),a=hr(i,n.conv_3,[2,2]),s=hr(a,n.conv_4,[1,1]),u=hr(s,n.conv_5,[2,2]),l=hr(u,n.conv_6,[1,1]),c=hr(l,n.conv_7,[2,2]),f=Ni(t,n.box_predictor_0),d=Ni(e,n.box_predictor_1),h=Ni(o,n.box_predictor_2),p=Ni(a,n.box_predictor_3),m=Ni(u,n.box_predictor_4),g=Ni(c,n.box_predictor_5),v=Et([f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),y=Et([f.classPrediction,d.classPrediction,h.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:v,classPredictions:y}})}var nu=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,o=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),lb=function(e){Ee(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return oe(function(){var o=n.toBatchTensor(512,!1).toFloat(),i=St(qt(o,te(.007843137718737125)),te(1)),a=G3(i,r.mobilenetv1),s=J3(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return Q3(u,l,r.output_layer)})},t.prototype.forward=function(n){return ce(this,void 0,void 0,function(){var r;return fe(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),ce(this,void 0,void 0,function(){var o,i,a,s,u,l,c,f,d,h,p,m,g,v,y,x,w,b,C,S,E;return fe(this,function(k){switch(k.label){case 0:return o=new nu(r),i=o.maxResults,a=o.minConfidence,[4,At(n)];case 1:for(s=k.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,f=l[0],d=c[0],h=1;h<l.length;h++)l[h].dispose(),c[h].dispose();return g=(m=Array).from,[4,d.data()];case 2:return p=g.apply(m,[k.sent()]),v=.5,y=K3(f,p,i,v,a),x=s.getReshapedInputDimensions(0),w=s.inputSize,b=w/x.width,C=w/x.height,S=f.arraySync(),E=y.map(function(_){var T=[Math.max(0,S[_][0]),Math.min(1,S[_][2])].map(function(G){return G*C}),D=T[0],z=T[1],W=[Math.max(0,S[_][1]),Math.min(1,S[_][3])].map(function(G){return G*b}),V=W[0],K=W[1];return new sr(p[_],new nv(V,D,K-V,z-D),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),f.dispose(),d.dispose(),[2,E]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return U3(n)},t.prototype.extractParams=function(n){return $3(n)},t}(Qr);(function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(lb);var Z3=.4,eP=[new We(.738768,.874946),new We(2.42204,2.65704),new We(4.30971,7.04493),new We(10.246,4.59428),new We(12.6868,11.8741)],tP=[new We(1.603231,2.094468),new We(6.041143,7.080126),new We(2.882459,3.518061),new We(4.266906,5.178857),new We(9.041765,10.66308)],nP=[117.001,114.697,97.404],rP="tiny_yolov2_model",oP="tiny_yolov2_separable_conv_model",Gu=function(e){return typeof e=="number"};function iP(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Gu(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return Gu(t.x)&&Gu(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Gu)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function hv(e){return oe(function(){var t=qt(e,te(.10000000149011612));return Te(ot(St(e,t)),t)})}function io(e,t){return oe(function(){var n=bi(e,[[0,0],[1,1],[1,1],[0,0]]);return n=jn(n,t.conv.filters,[1,1],"valid"),n=St(n,t.bn.sub),n=qt(n,t.bn.truediv),n=Te(n,t.conv.bias),hv(n)})}function ao(e,t){return oe(function(){var n=bi(e,[[0,0],[1,1],[1,1],[0,0]]);return n=jp(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Te(n,t.bias),hv(n)})}function aP(e,t){var n=Uc(e,t);function r(a,s){var u=yt(e(a)),l=yt(e(a));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function o(a,s,u){var l=n(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var i=cv(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function sP(e,t,n,r){var o=Zr(e),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=aP(i,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams,d;if(t.withSeparableConvs){var h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],x=r[6],w=r[7],b=r[8],C=t.isFirstLayerConv2d?l(h,p,3,"conv0"):f(h,p,"conv0"),S=f(p,m,"conv1"),E=f(m,g,"conv2"),k=f(g,v,"conv3"),_=f(v,y,"conv4"),T=f(y,x,"conv5"),D=w?f(x,w,"conv6"):void 0,z=b?f(w,b,"conv7"):void 0,W=l(b||w||x,5*n,1,"conv8");d={conv0:C,conv1:S,conv2:E,conv3:k,conv4:_,conv5:T,conv6:D,conv7:z,conv8:W}}else{var h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],x=r[6],w=r[7],b=r[8],C=c(h,p,"conv0"),S=c(p,m,"conv1"),E=c(m,g,"conv2"),k=c(g,v,"conv3"),_=c(v,y,"conv4"),T=c(y,x,"conv5"),D=c(x,w,"conv6"),z=c(w,b,"conv7"),W=l(b,5*n,1,"conv8");d={conv0:C,conv1:S,conv2:E,conv3:k,conv4:_,conv5:T,conv6:D,conv7:z,conv8:W}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function uP(e,t){var n=zo(e,t);function r(s){var u=n(s+"/sub",1),l=n(s+"/truediv",1);return{sub:u,truediv:l}}function o(s){var u=n(s+"/filters",4),l=n(s+"/bias",1);return{filters:u,bias:l}}function i(s){var u=o(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=fv(n);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function lP(e,t){var n=[],r=uP(e,n),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return Jr(e,n),{params:s,paramMappings:n}}var y0;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(y0||(y0={}));var pv=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,o=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),cb=function(e){Ee(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return iP(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var o=io(n,r.conv0);return o=Tt(o,[2,2],[2,2],"same"),o=io(o,r.conv1),o=Tt(o,[2,2],[2,2],"same"),o=io(o,r.conv2),o=Tt(o,[2,2],[2,2],"same"),o=io(o,r.conv3),o=Tt(o,[2,2],[2,2],"same"),o=io(o,r.conv4),o=Tt(o,[2,2],[2,2],"same"),o=io(o,r.conv5),o=Tt(o,[2,2],[1,1],"same"),o=io(o,r.conv6),o=io(o,r.conv7),rr(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var o=this.config.isFirstLayerConv2d?hv(rr(n,r.conv0,"valid",!1)):ao(n,r.conv0);return o=Tt(o,[2,2],[2,2],"same"),o=ao(o,r.conv1),o=Tt(o,[2,2],[2,2],"same"),o=ao(o,r.conv2),o=Tt(o,[2,2],[2,2],"same"),o=ao(o,r.conv3),o=Tt(o,[2,2],[2,2],"same"),o=ao(o,r.conv4),o=Tt(o,[2,2],[2,2],"same"),o=ao(o,r.conv5),o=Tt(o,[2,2],[1,1],"same"),o=r.conv6?ao(o,r.conv6):o,o=r.conv7?ao(o,r.conv7):o,rr(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return oe(function(){var a=n.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?tu(a,o.config.meanRgb):a,a=a.div(te(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},t.prototype.forward=function(n,r){return ce(this,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,At(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),ce(this,void 0,void 0,function(){var o,i,a,s,u,l,c,f,d,h,p,m,g,v,y=this;return fe(this,function(x){switch(x.label){case 0:return o=new pv(r),i=o.inputSize,a=o.scoreThreshold,[4,At(n)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),l=oe(function(){return Ct(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return f=x.sent(),u.dispose(),l.dispose(),d=f.map(function(w){return w.box}),h=f.map(function(w){return w.score}),p=f.map(function(w){return w.classScore}),m=f.map(function(w){return y.config.classes[w.label]}),g=Ws(d.map(function(w){return w.rescale(i)}),h,this.config.iouThreshold,!0),v=g.map(function(w){return new Fw(h[w],p[w],m[w],d[w],c)}),[2,v]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return lP(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return sP(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,o){return ce(this,void 0,void 0,function(){var i,a,s,u,l,c,f,d,h,p,m,g,v,y,x,w,b,C,S,E,k,_,T,D,z,W,V,K,G,N=this;return fe(this,function(O){switch(O.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,l=s/a,c=n.shape[1],f=this.config.anchors.length,d=oe(function(){var B=n.reshape([c,c,f,N.boxEncodingSize]),q=B.slice([0,0,0,0],[c,c,f,4]),Q=B.slice([0,0,0,4],[c,c,f,1]),ne=N.withClassScores?Xr(B.slice([0,0,0,5],[c,c,f,N.config.classes.length]),3):te(0);return[q,Q,ne]}),h=d[0],p=d[1],m=d[2],g=[],[4,p.array()];case 1:return v=O.sent(),[4,h.array()];case 2:y=O.sent(),x=0,O.label=3;case 3:if(!(x<c))return[3,12];w=0,O.label=4;case 4:if(!(w<c))return[3,11];b=0,O.label=5;case 5:return b<f?(C=Yf(v[x][w][b][0]),!o||C>o?(S=(w+Yf(y[x][w][b][0]))/c*u,E=(x+Yf(y[x][w][b][1]))/c*l,k=Math.exp(y[x][w][b][2])*this.config.anchors[b].x/c*u,_=Math.exp(y[x][w][b][3])*this.config.anchors[b].y/c*l,T=S-k/2,D=E-_/2,z={row:x,col:w,anchor:b},this.withClassScores?[4,this.extractPredictedClass(m,z)]:[3,7]):[3,9]):[3,10];case 6:return G=O.sent(),[3,8];case 7:G={classScore:1,label:0},O.label=8;case 8:W=G,V=W.classScore,K=W.label,g.push(Ht({box:new $c(T,D,T+k,D+_),score:C,classScore:C*V,label:K},z)),O.label=9;case 9:return b++,[3,5];case 10:return w++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),m.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(n,r){return ce(this,void 0,void 0,function(){var o,i,a,s;return fe(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,n.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[o][i][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Qr),cP=function(e){Ee(t,e);function t(n){n===void 0&&(n=!0);var r=this,o=Object.assign({},{withSeparableConvs:n,iouThreshold:Z3,classes:["face"]},n?{anchors:tP,meanRgb:nP}:{anchors:eP,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return ce(this,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new sr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?oP:rP},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(cb),fP=function(e){Ee(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(pv),ru=function(){function e(){}return e.prototype.then=function(t){return ce(this,void 0,void 0,function(){var n;return fe(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return fe(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Vc(e,t,n,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),ce(this,void 0,void 0,function(){var i,a,s,u,l;return fe(this,function(c){switch(c.label){case 0:return i=e.map(function(f){return Zw(f)?o(f):f.detection}),s=r,s?[3,5]:t instanceof rt?[4,uv(t,i)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,sv(t,i)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,n(a)];case 6:return l=c.sent(),a.forEach(function(f){return f instanceof rt&&f.dispose()}),[2,l]}})})}function vv(e,t,n,r,o){return ce(this,void 0,void 0,function(){var i=this;return fe(this,function(a){return[2,Vc([e],t,function(s){return ce(i,void 0,void 0,function(){return fe(this,function(u){return[2,n(s[0])]})})},r,o)]})})}function dP(e){return oe(function(){return Sn(Ct(e,3).reverse(),3)})}var Ku=2,rc=12;function hP(e,t){var n=Uc(e,t),r=lv(e,t);function o(l,c){var f=yt(e(l));return t.push({paramPath:c}),f}function i(l,c,f){f===void 0&&(f=!1);var d=n(l[0],l[1],3,c+"/conv1"),h=o(l[1],c+"/prelu1_alpha"),p=n(l[1],l[2],3,c+"/conv2"),m=o(l[2],c+"/prelu2_alpha"),g=n(l[2],l[3],f?2:3,c+"/conv3"),v=o(l[3],c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function a(){var l=i([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),f=n(32,4,1,"pnet/conv4_2");return Ht(Ht({},l),{conv4_1:c,conv4_2:f})}function s(){var l=i([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),f=o(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Ht(Ht({},l),{fc1:c,prelu4_alpha:f,fc2_1:d,fc2_2:h})}function u(){var l=i([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),f=o(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return Ht(Ht({},l),{conv4:c,prelu4_alpha:f,fc1:d,prelu5_alpha:h,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function pP(e){var t=Zr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=hP(n,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,l=a(),c=s(),f=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:f},paramMappings:o}}function vP(e,t){var n=zo(e,t);function r(c){var f=n(c+"/weights",4,c+"/filters"),d=n(c+"/bias",1);return{filters:f,bias:d}}function o(c){var f=n(c+"/weights",2),d=n(c+"/bias",1);return{weights:f,bias:d}}function i(c){return n(c,1)}function a(c){var f=r(c+"/conv1"),d=i(c+"/prelu1_alpha"),h=r(c+"/conv2"),p=i(c+"/prelu2_alpha"),m=r(c+"/conv3"),g=i(c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:h,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function s(){var c=a("pnet"),f=r("pnet/conv4_1"),d=r("pnet/conv4_2");return Ht(Ht({},c),{conv4_1:f,conv4_2:d})}function u(){var c=a("rnet"),f=o("rnet/fc1"),d=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Ht(Ht({},c),{fc1:f,prelu4_alpha:d,fc2_1:h,fc2_2:p})}function l(){var c=a("onet"),f=r("onet/conv4"),d=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),m=o("onet/fc2_1"),g=o("onet/fc2_2"),v=o("onet/fc2_3");return Ht(Ht({},c),{conv4:f,prelu4_alpha:d,fc1:h,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function mP(e){var t=[],n=vP(e,t),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),u=i();return Jr(e,t),{params:{pnet:a,rnet:s,onet:u},paramMappings:t}}function bh(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function gP(e,t,n){for(var r=n[0],o=n[1],i=rc/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(t,u)),s=s*t,u+=1;return a}var mv=function(e){Ee(t,e);function t(n,r,o,i){return e.call(this,{left:n,top:r,right:o,bottom:i},!0)||this}return t}(Hr);function fb(e){return oe(function(){return qt(St(e,te(127.5)),te(.0078125))})}function sa(e,t){return oe(function(){return Te(ot(e),qt(t,Ql(ot(Ql(e)))))})}function gv(e,t,n){return n===void 0&&(n=!1),oe(function(){var r=rr(e,t.conv1,"valid");return r=sa(r,t.prelu1_alpha),r=Tt(r,n?[2,2]:[3,3],[2,2],"same"),r=rr(r,t.conv2,"valid"),r=sa(r,t.prelu2_alpha),r=n?r:Tt(r,[3,3],[2,2],"valid"),r=rr(r,t.conv3,"valid"),r=sa(r,t.prelu3_alpha),r})}function yP(e,t){return oe(function(){var n=gv(e,t,!0),r=rr(n,t.conv4_1,"valid"),o=Mn(Oc(r,3),3),i=Xr(St(r,o),3),a=rr(n,t.conv4_2,"valid");return{prob:i,regions:a}})}function xP(e,t){return oe(function(){var n=bh(t,e.shape.slice(1)),r=n.height,o=n.width,i=qp.resizeBilinear(e,[r,o]),a=fb(i);return Po(a,[0,2,1,3])})}function wP(e,t,n,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new We(s,a));var u=o.map(function(l){var c=new $c(Math.round((l.y*Ku+1)/n),Math.round((l.x*Ku+1)/n),Math.round((l.y*Ku+rc)/n),Math.round((l.x*Ku+rc)/n)),f=i[l.y][l.x],d=t.arraySync(),h=new mv(d[l.y][l.x][0],d[l.y][l.x][1],d[l.y][l.x][2],d[l.y][l.x][3]);return{cell:c,score:f,region:h}});return u}function bP(e,t,n,r,o){o.stage1=[];var i=t.map(function(d){return oe(function(){var h={scale:d},p=xP(e,d),m=Date.now(),g=yP(p,r),v=g.prob,y=g.regions;h.pnet=Date.now()-m;var x=Ct(Ct(v,3)[1])[0],w=Ct(y)[0];return{scoresTensor:x,regionsTensor:w,scale:d,statsForScale:h}})}),a=i.map(function(d){var h=d.scoresTensor,p=d.regionsTensor,m=d.scale,g=d.statsForScale,v=wP(h,p,m,n);if(h.dispose(),p.dispose(),!v.length)return o.stage1.push(g),[];var y=Date.now(),x=Ws(v.map(function(w){return w.cell}),v.map(function(w){return w.score}),.5);return g.nms=Date.now()-y,g.numBoxes=x.length,o.stage1.push(g),x.map(function(w){return v[w]})}),s=a.reduce(function(d,h){return d.concat(h)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),f=Ws(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);o.stage1_nms=Date.now()-c,l=f.map(function(d){return s[d].score}),u=f.map(function(d){return s[d]}).map(function(d){var h=d.cell,p=d.region;return new $c(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:l}}function db(e,t,n){var r=n.width,o=n.height;return ce(this,void 0,void 0,function(){var i,a,s,u=this;return fe(this,function(l){switch(l.label){case 0:return i=Gr(e),[4,Promise.all(t.map(function(c){return ce(u,void 0,void 0,function(){var f,d,h,p,m,g,v,y;return fe(this,function(x){return f=c.padAtBorders(e.height,e.width),d=f.y,h=f.ey,p=f.x,m=f.ex,g=p-1,v=d-1,y=i.getImageData(g,v,m-g,h-v),[2,$t.isNodejs()?av(y):createImageBitmap(y)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var f=zc({width:r,height:o}),d=Gr(f);d.drawImage(c,0,0,r,o);for(var h=d.getImageData(0,0,r,o).data,p=[],m=0;m<h.length;m+=4)p.push(h[m+2]),p.push(h[m+1]),p.push(h[m]);s.push(p)}),[2,s.map(function(c){var f=oe(function(){var d=Po(on(c,[1,r,o,3]),[0,2,1,3]).toFloat();return fb(d)});return f})]}})})}function EP(e,t){return oe(function(){var n=gv(e,t),r=er(n,[n.shape[0],t.fc1.weights.shape[0]]),o=yr(r,t.fc1),i=sa(o,t.prelu4_alpha),a=yr(i,t.fc2_1),s=Mn(Oc(a,1),1),u=Xr(St(a,s),1),l=yr(i,t.fc2_2),c=Ct(u,1)[1];return{scores:c,regions:l}})}function CP(e,t,n,r,o){return ce(this,void 0,void 0,function(){var i,a,s,u,l,c,f,d,h,p,m,g,v,y;return fe(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,db(e,t,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var b=EP(w,r);return w.dispose(),b}),o.stage2_rnet=Date.now()-i,u=s.length>1?Et(s.map(function(w){return w.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[x.sent()]),u.dispose(),d=l.map(function(w,b){return{score:w,idx:b}}).filter(function(w){return w.score>n}).map(function(w){var b=w.idx;return b}),h=d.map(function(w){return t[w]}),p=d.map(function(w){return l[w]}),m=[],g=[],h.length>0&&(i=Date.now(),v=Ws(h,p,.7),o.stage2_nms=Date.now()-i,y=v.map(function(w){var b=s[d[w]].regions.arraySync();return new mv(b[0][0],b[0][1],b[0][2],b[0][3])}),g=v.map(function(w){return p[w]}),m=v.map(function(w,b){return h[w].calibrate(y[b])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function _P(e,t){return oe(function(){var n=gv(e,t);n=Tt(n,[2,2],[2,2],"same"),n=rr(n,t.conv4,"valid"),n=sa(n,t.prelu4_alpha);var r=er(n,[n.shape[0],t.fc1.weights.shape[0]]),o=yr(r,t.fc1),i=sa(o,t.prelu5_alpha),a=yr(i,t.fc2_1),s=Mn(Oc(a,1),1),u=Xr(St(a,s),1),l=yr(i,t.fc2_2),c=yr(i,t.fc2_3),f=Ct(u,1)[1];return{scores:f,regions:l,points:c}})}function SP(e,t,n,r,o){return ce(this,void 0,void 0,function(){var i,a,s,u,l,c,f,d,h,p,m,g,v,y,x;return fe(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,db(e,t,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(b){var C=_P(b,r);return b.dispose(),C}),o.stage3_onet=Date.now()-i,u=s.length>1?Et(s.map(function(b){return b.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[w.sent()]),u.dispose(),d=l.map(function(b,C){return{score:b,idx:C}}).filter(function(b){return b.score>n}).map(function(b){var C=b.idx;return C}),h=d.map(function(b){var C=s[b].regions.arraySync();return new mv(C[0][0],C[0][1],C[0][2],C[0][3])}),p=d.map(function(b,C){return t[b].calibrate(h[C])}),m=d.map(function(b){return l[b]}),g=[],v=[],y=[],p.length>0&&(i=Date.now(),x=Ws(p,m,.7,!1),o.stage3_nms=Date.now()-i,g=x.map(function(b){return p[b]}),v=x.map(function(b){return m[b]}),y=x.map(function(b,C){return Array(5).fill(0).map(function(S,E){var k=s[b].points.arraySync();return new We(k[0][E]*(g[C].width+1)+g[C].left,k[0][E+5]*(g[C].height+1)+g[C].top)})})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose(),b.points.dispose()}),[2,{boxes:g,scores:v,points:y}]}})})}var kP=function(e){Ee(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return ce(this,void 0,void 0,function(){return fe(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return ce(this,void 0,void 0,function(){return fe(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),ce(this,void 0,void 0,function(){var o,i,a,s,u,l,c,f,d,h,p,m,g,v,y,x,w,b,C,S,E;return fe(this,function(k){switch(k.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=n.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=oe(function(){return dP(Mn(ev.fromPixels(i)).toFloat())}),l=function(_){return u.dispose(),a.total=Date.now()-s,_},c=u.shape.slice(1),f=c[0],d=c[1],h=new ub(r),p=h.minFaceSize,m=h.scaleFactor,g=h.maxNumScales,v=h.scoreThresholds,y=h.scaleSteps,x=(y||gP(p,m,[f,d])).filter(function(_){var T=bh(_,[f,d]);return Math.min(T.width,T.height)>rc}).slice(0,g),a.scales=x,a.pyramid=x.map(function(_){return bh(_,[f,d])}),w=Date.now(),[4,bP(u,x,v[0],o.pnet,a)];case 1:return b=k.sent(),a.total_stage1=Date.now()-w,b.boxes.length?(a.stage2_numInputBoxes=b.boxes.length,w=Date.now(),[4,CP(i,b.boxes,v[1],o.rnet,a)]):[2,l({results:[],stats:a})];case 2:return C=k.sent(),a.total_stage2=Date.now()-w,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,w=Date.now(),[4,SP(i,C.boxes,v[2],o.onet,a)]):[2,l({results:[],stats:a})];case 3:return S=k.sent(),a.total_stage3=Date.now()-w,E=S.boxes.map(function(_,T){return jc(zs({},new sr(S.scores[T],new nv(_.left/d,_.top/f,_.width/d,_.height/f),{height:f,width:d})),new JN(S.points[T].map(function(D){return D.sub(new We(_.left,_.top)).div(new We(_.width,_.height))}),{width:_.width,height:_.height}))}),[2,l({results:E,stats:a})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),ce(this,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,At(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),ce(this,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,At(n)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return mP(n)},t.prototype.extractParams=function(n){return pP(n)},t}(Qr),RP=.4,IP=[new We(1.603231,2.094468),new We(6.041143,7.080126),new We(2.882459,3.518061),new We(4.266906,5.178857),new We(9.041765,10.66308)],TP=[117.001,114.697,97.404],DP=function(e){Ee(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:RP,classes:["face"],anchors:IP,meanRgb:TP,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return ce(this,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new sr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(cb),Zt={ssdMobilenetv1:new lb,tinyFaceDetector:new DP,tinyYolov2:new cP,mtcnn:new kP,faceLandmark68Net:new nb,faceLandmark68TinyNet:new N3,faceRecognitionNet:new B3,faceExpressionNet:new y3,ageGenderNet:new R3},hb=function(e){Ee(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(ru),yv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o=this;return fe(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,Vc(n,this.input,function(a){return ce(o,void 0,void 0,function(){return fe(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Zt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){return Jw(a,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new Ev(this,this.input)},t}(hb),xv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r;return fe(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,vv(n,this.input,function(i){return Zt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,Jw(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new Cv(this,this.input)},t}(hb),wv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new _v(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kv(this,this.input)},t}(yv),bv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Sv(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Rv(this,this.input)},t}(xv),pb=function(e){Ee(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(ru),Ev=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o=this;return fe(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,Vc(n,this.input,function(a){return ce(o,void 0,void 0,function(){return fe(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Zt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){var u=r[s],l=u.age,c=u.gender,f=u.genderProbability;return ab(sb(a,c,f),l)})]}})})},t.prototype.withFaceExpressions=function(){return new yv(this,this.input)},t}(pb),Cv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o,i,a;return fe(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?[4,vv(n,this.input,function(u){return Zt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,ab(sb(n,i,a),o)]}})})},t.prototype.withFaceExpressions=function(){return new xv(this,this.input)},t}(pb),_v=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new wv(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kv(this,this.input)},t}(Ev),Sv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new bv(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Rv(this,this.input)},t}(Cv),vb=function(e){Ee(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(ru),kv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r;return fe(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,Vc(n,this.input,function(i){return Promise.all(i.map(function(a){return Zt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return ib(n[a],i)})]}})})},t.prototype.withFaceExpressions=function(){return new wv(this,this.input)},t.prototype.withAgeAndGender=function(){return new _v(this,this.input)},t}(vb),Rv=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r;return fe(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,vv(n,this.input,function(i){return Zt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,ib(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new bv(this,this.input)},t.prototype.withAgeAndGender=function(){return new Sv(this,this.input)},t}(vb),mb=function(e){Ee(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Zt.faceLandmark68TinyNet:Zt.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(ru),NP=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return fe(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof rt?[4,uv(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,sv(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),o.forEach(function(l){return l instanceof rt&&l.dispose()}),[2,n.map(function(l,c){return jc(l,a[c])})]}})})},t.prototype.withFaceExpressions=function(){return new wv(this,this.input)},t.prototype.withAgeAndGender=function(){return new _v(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kv(this,this.input)},t}(mb),PP=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o,i,a;return fe(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?(r=n.detection,this.input instanceof rt?[4,uv(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,sv(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof rt&&u.dispose()}),[2,jc(n,a)]}})})},t.prototype.withFaceExpressions=function(){return new bv(this,this.input)},t.prototype.withAgeAndGender=function(){return new Sv(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Rv(this,this.input)},t}(mb),gb=function(e){Ee(t,e);function t(n,r){r===void 0&&(r=new nu);var o=e.call(this)||this;return o.input=n,o.options=r,o}return t}(ru),yb=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r,o,i;return fe(this,function(a){switch(a.label){case 0:return n=this,r=n.input,o=n.options,o instanceof ub?[4,Zt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof fP?function(s){return Zt.tinyFaceDetector.locateFaces(s,o)}:o instanceof nu?function(s){return Zt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof pv?function(s){return Zt.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return ce(n,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return zs({},a)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new NP(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new yv(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Ev(this.runAndExtendWithFaceDetections(),this.input)},t}(gb),AP=function(e){Ee(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ce(this,void 0,void 0,function(){var n,r;return fe(this,function(o){switch(o.label){case 0:return[4,new yb(this.input,this.options)];case 1:return n=o.sent(),r=n[0],n.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return ce(n,void 0,void 0,function(){var o;return fe(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?zs({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new PP(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new xv(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Cv(this.runAndExtendWithFaceDetection(),this.input)},t}(gb);function FP(e,t){return t===void 0&&(t=new nu),new AP(e,t)}function MP(e,t){return t===void 0&&(t=new nu),new yb(e,t)}function OP(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}var LP=function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Ja)return a;if(a instanceof Float32Array)return new Ja(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Ja(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return OP(r,t)}).reduce(function(r,o){return r+o},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new p0(i,n.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new p0("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return Ja.fromJSON(r)});return new e(n,t.distanceThreshold)},e}();function xb(e,t){var n=new ui(t.width,t.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(e))return e.map(function(s){return xb(s,{width:r,height:o})});if(Zw(e)){var i=e.detection.forSize(r,o),a=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return jc(zs(e,i),a)}return Mw(e)?zs(e,e.detection.forSize(r,o)):e instanceof $s||e instanceof sr?e.forSize(r,o):e}const BP="/assets/auth-face-_Vij8gTs.svg";function WP(){const[e,t]=F.useState(""),[n,r]=F.useState(null),[o,i]=F.useState(!1),[a,s]=F.useState(!1),[u,l]=F.useState("PENDING"),[c,f]=F.useState(!1),[d,h]=F.useState(null),[p,m]=F.useState(!1),[g,v]=F.useState("Initializing..."),[y,x]=F.useState(null),w=F.useRef(null),b=F.useRef(),C=F.useRef(),S=F.useRef(),E=640,k=360,_=Sa();Ic();const T=async()=>{const N="/models";await Zt.ssdMobilenetv1.loadFromUri(N),await Zt.faceLandmark68Net.loadFromUri(N),await Zt.faceRecognitionNet.loadFromUri(N)};F.useEffect(()=>{var N;t((N=_==null?void 0:_.state)==null?void 0:N.account)},[_]),F.useEffect(()=>{e&&T().then(async()=>{const N=await K();h(N)}).then(()=>i(!0))},[e]),F.useEffect(()=>{n&&w.current&&(w.current.srcObject=n)},[n]),F.useEffect(()=>()=>{S.current&&clearInterval(S.current)},[]);const D=async()=>{try{const N=await navigator.mediaDevices.getUserMedia({audio:!0}),O=new MediaRecorder(N);x(O),O.ondataavailable=async B=>{if(B.data.size>0){const q=B.data;await z(q)}},O.start(),v("Recording audio..."),setTimeout(()=>{O.stop(),v("Audio recording finished.")},5e3)}catch(N){console.error("Error accessing audio devices:",N)}},z=async N=>{if(!N){console.error("No audio data available");return}try{console.log("Sending recorded audio...");const O=new FormData;O.append("audio",N,"recording.wav");const B=await fetch("http://localhost:5000/start_audio_auth",{method:"POST",body:O});if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);const q=await B.json();console.log("Audio authentication result:",q),q.success?m(!0):m(!1)}catch(O){console.error("Error sending audio data:",O),m(!1)}},W=async()=>{v("Starting video and audio authentication..."),await V(),await D(),v("Finished authentication process.")},V=async()=>{try{const N=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0});r(N)}catch(N){console.error("Error accessing media devices:",N)}};async function K(){if(!e)return null;const N=[];let O;try{const q=`/temp-accounts/${e.picture}`;O=await l3(q)}catch{f(!0);return}const B=await FP(O).withFaceLandmarks().withFaceDescriptor();return B&&N.push(B.descriptor),new Ja(e.id,N)}const G=async()=>{if(!w.current||!b.current||!d){console.error("Required refs or labeledFaceDescriptors are not available");return}const N=w.current,O=b.current,B={width:N.width,height:N.height};d3(O,B),S.current=setInterval(async()=>{try{const q=await MP(N).withFaceLandmarks().withFaceDescriptors();if(console.log("Detections:",q),!q||q.length===0){console.log("No faces detected"),l("NO_FACE_DETECTED");return}const Q=xb(q,B);O.getContext("2d").clearRect(0,0,O.width,O.height),Q.forEach(ve=>{const me=ve.detection.box;new o3(me,{label:"Face"}).draw(O)});const re=new LP(d,.6).findBestMatch(q[0].descriptor);console.log("Best match:",re),re.label!=="unknown"?(l("SUCCESS"),clearInterval(S.current)):l("FAILED")}catch(q){console.error("Face detection error:",q),setFaceDetectionError(q.message),clearInterval(S.current)}},100),s(!0)};return J.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-[24px] max-w-[720px] mx-auto",children:[J.jsx("h2",{className:"text-center text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl",children:J.jsxs("span",{className:"block",children:["Loading Status: ",g]})}),c&&J.jsx("p",{className:"text-red-500",children:"Error loading profile image. Please try again or contact support."}),!n&&o&&d&&J.jsxs(J.Fragment,{children:[J.jsx("img",{alt:"ready for face scan",src:BP,className:"cursor-pointer my-8 mx-auto object-cover h-[272px]"}),J.jsx("button",{onClick:W,type:"button",className:"flex justify-center items-center w-full py-2.5 px-5 mr-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg",children:"Scan my face and record voice"})]}),n&&J.jsxs("div",{className:"relative",children:[J.jsx("video",{muted:!0,autoPlay:!0,ref:w,height:k,width:E,onPlay:G,style:{objectFit:"fill",height:"360px",borderRadius:"10px",display:n?"block":"none"}}),J.jsx("canvas",{ref:b,className:"absolute top-0 left-0"})]}),J.jsx("audio",{ref:C,style:{display:"none"}}),J.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["Debug Info: Models Loaded: ",o?"Yes":"No",", Face API Loaded: ",a?"Yes":"No",", Labeled Descriptors:"," ",d?"Yes":"No",", Login Result: ",u]})]})}const wb=typeof document<"u"?mt.useLayoutEffect:()=>{};function $P(e){const t=F.useRef(null);return wb(()=>{t.current=e},[e]),F.useCallback((...n)=>{const r=t.current;return r==null?void 0:r(...n)},[])}const ou=e=>{var t;return(t=e==null?void 0:e.ownerDocument)!==null&&t!==void 0?t:document},ii=e=>e&&"window"in e&&e.window===e?e:ou(e).defaultView||window;function zP(e){var t;return typeof window>"u"||window.navigator==null?!1:((t=window.navigator.userAgentData)===null||t===void 0?void 0:t.brands.some(n=>e.test(n.brand)))||e.test(window.navigator.userAgent)}function UP(e){var t;return typeof window<"u"&&window.navigator!=null?e.test(((t=window.navigator.userAgentData)===null||t===void 0?void 0:t.platform)||window.navigator.platform):!1}function bb(e){let t=null;return()=>(t==null&&(t=e()),t)}const jP=bb(function(){return UP(/^Mac/i)}),VP=bb(function(){return zP(/Android/i)});function HP(e){return e.mozInputSource===0&&e.isTrusted?!0:VP()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}class GP{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(t,n){this.nativeEvent=n,this.target=n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget,this.bubbles=n.bubbles,this.cancelable=n.cancelable,this.defaultPrevented=n.defaultPrevented,this.eventPhase=n.eventPhase,this.isTrusted=n.isTrusted,this.timeStamp=n.timeStamp,this.type=t}}function Eb(e){let t=F.useRef({isFocused:!1,observer:null});wb(()=>{const r=t.current;return()=>{r.observer&&(r.observer.disconnect(),r.observer=null)}},[]);let n=$P(r=>{e==null||e(r)});return F.useCallback(r=>{if(r.target instanceof HTMLButtonElement||r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||r.target instanceof HTMLSelectElement){t.current.isFocused=!0;let o=r.target,i=a=>{t.current.isFocused=!1,o.disabled&&n(new GP("blur",a)),t.current.observer&&(t.current.observer.disconnect(),t.current.observer=null)};o.addEventListener("focusout",i,{once:!0}),t.current.observer=new MutationObserver(()=>{if(t.current.isFocused&&o.disabled){var a;(a=t.current.observer)===null||a===void 0||a.disconnect();let s=o===document.activeElement?null:document.activeElement;o.dispatchEvent(new FocusEvent("blur",{relatedTarget:s})),o.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:s}))}}),t.current.observer.observe(o,{attributes:!0,attributeFilter:["disabled"]})}},[n])}function KP(e){let{isDisabled:t,onFocus:n,onBlur:r,onFocusChange:o}=e;const i=F.useCallback(u=>{if(u.target===u.currentTarget)return r&&r(u),o&&o(!1),!0},[r,o]),a=Eb(i),s=F.useCallback(u=>{const l=ou(u.target);u.target===u.currentTarget&&l.activeElement===u.target&&(n&&n(u),o&&o(!0),a(u))},[o,n,a]);return{focusProps:{onFocus:!t&&(n||o||r)?s:void 0,onBlur:!t&&(r||o)?i:void 0}}}let iu=null,Eh=new Set,ds=new Map,gi=!1,Ch=!1;const qP={Tab:!0,Escape:!0};function Iv(e,t){for(let n of Eh)n(e,t)}function XP(e){return!(e.metaKey||!jP()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function oc(e){gi=!0,XP(e)&&(iu="keyboard",Iv("keyboard",e))}function On(e){iu="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(gi=!0,Iv("pointer",e))}function Cb(e){HP(e)&&(gi=!0,iu="virtual")}function _b(e){e.target===window||e.target===document||(!gi&&!Ch&&(iu="virtual",Iv("virtual",e)),gi=!1,Ch=!1)}function Sb(){gi=!1,Ch=!0}function _h(e){if(typeof window>"u"||ds.get(ii(e)))return;const t=ii(e),n=ou(e);let r=t.HTMLElement.prototype.focus;t.HTMLElement.prototype.focus=function(){gi=!0,r.apply(this,arguments)},n.addEventListener("keydown",oc,!0),n.addEventListener("keyup",oc,!0),n.addEventListener("click",Cb,!0),t.addEventListener("focus",_b,!0),t.addEventListener("blur",Sb,!1),typeof PointerEvent<"u"?(n.addEventListener("pointerdown",On,!0),n.addEventListener("pointermove",On,!0),n.addEventListener("pointerup",On,!0)):(n.addEventListener("mousedown",On,!0),n.addEventListener("mousemove",On,!0),n.addEventListener("mouseup",On,!0)),t.addEventListener("beforeunload",()=>{kb(e)},{once:!0}),ds.set(t,{focus:r})}const kb=(e,t)=>{const n=ii(e),r=ou(e);t&&r.removeEventListener("DOMContentLoaded",t),ds.has(n)&&(n.HTMLElement.prototype.focus=ds.get(n).focus,r.removeEventListener("keydown",oc,!0),r.removeEventListener("keyup",oc,!0),r.removeEventListener("click",Cb,!0),n.removeEventListener("focus",_b,!0),n.removeEventListener("blur",Sb,!1),typeof PointerEvent<"u"?(r.removeEventListener("pointerdown",On,!0),r.removeEventListener("pointermove",On,!0),r.removeEventListener("pointerup",On,!0)):(r.removeEventListener("mousedown",On,!0),r.removeEventListener("mousemove",On,!0),r.removeEventListener("mouseup",On,!0)),ds.delete(n))};function YP(e){const t=ou(e);let n;return t.readyState!=="loading"?_h(e):(n=()=>{_h(e)},t.addEventListener("DOMContentLoaded",n)),()=>kb(e,n)}typeof document<"u"&&YP();function Rb(){return iu!=="pointer"}const QP=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function JP(e,t,n){var r;const o=typeof window<"u"?ii(n==null?void 0:n.target).HTMLInputElement:HTMLInputElement,i=typeof window<"u"?ii(n==null?void 0:n.target).HTMLTextAreaElement:HTMLTextAreaElement,a=typeof window<"u"?ii(n==null?void 0:n.target).HTMLElement:HTMLElement,s=typeof window<"u"?ii(n==null?void 0:n.target).KeyboardEvent:KeyboardEvent;return e=e||(n==null?void 0:n.target)instanceof o&&!QP.has(n==null||(r=n.target)===null||r===void 0?void 0:r.type)||(n==null?void 0:n.target)instanceof i||(n==null?void 0:n.target)instanceof a&&(n==null?void 0:n.target.isContentEditable),!(e&&t==="keyboard"&&n instanceof s&&!qP[n.key])}function ZP(e,t,n){_h(),F.useEffect(()=>{let r=(o,i)=>{JP(!!(n!=null&&n.isTextInput),o,i)&&e(Rb())};return Eh.add(r),()=>{Eh.delete(r)}},t)}function eA(e){let{isDisabled:t,onBlurWithin:n,onFocusWithin:r,onFocusWithinChange:o}=e,i=F.useRef({isFocusWithin:!1}),a=F.useCallback(l=>{i.current.isFocusWithin&&!l.currentTarget.contains(l.relatedTarget)&&(i.current.isFocusWithin=!1,n&&n(l),o&&o(!1))},[n,o,i]),s=Eb(a),u=F.useCallback(l=>{!i.current.isFocusWithin&&document.activeElement===l.target&&(r&&r(l),o&&o(!0),i.current.isFocusWithin=!0,s(l))},[r,o,s]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:u,onBlur:a}}}let ic=!1,Zf=0;function Sh(){ic=!0,setTimeout(()=>{ic=!1},50)}function x0(e){e.pointerType==="touch"&&Sh()}function tA(){if(!(typeof document>"u"))return typeof PointerEvent<"u"?document.addEventListener("pointerup",x0):document.addEventListener("touchend",Sh),Zf++,()=>{Zf--,!(Zf>0)&&(typeof PointerEvent<"u"?document.removeEventListener("pointerup",x0):document.removeEventListener("touchend",Sh))}}function Ib(e){let{onHoverStart:t,onHoverChange:n,onHoverEnd:r,isDisabled:o}=e,[i,a]=F.useState(!1),s=F.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;F.useEffect(tA,[]);let{hoverProps:u,triggerHoverEnd:l}=F.useMemo(()=>{let c=(h,p)=>{if(s.pointerType=p,o||p==="touch"||s.isHovered||!h.currentTarget.contains(h.target))return;s.isHovered=!0;let m=h.currentTarget;s.target=m,t&&t({type:"hoverstart",target:m,pointerType:p}),n&&n(!0),a(!0)},f=(h,p)=>{if(s.pointerType="",s.target=null,p==="touch"||!s.isHovered)return;s.isHovered=!1;let m=h.currentTarget;r&&r({type:"hoverend",target:m,pointerType:p}),n&&n(!1),a(!1)},d={};return typeof PointerEvent<"u"?(d.onPointerEnter=h=>{ic&&h.pointerType==="mouse"||c(h,h.pointerType)},d.onPointerLeave=h=>{!o&&h.currentTarget.contains(h.target)&&f(h,h.pointerType)}):(d.onTouchStart=()=>{s.ignoreEmulatedMouseEvents=!0},d.onMouseEnter=h=>{!s.ignoreEmulatedMouseEvents&&!ic&&c(h,"mouse"),s.ignoreEmulatedMouseEvents=!1},d.onMouseLeave=h=>{!o&&h.currentTarget.contains(h.target)&&f(h,"mouse")}),{hoverProps:d,triggerHoverEnd:f}},[t,n,r,o,s]);return F.useEffect(()=>{o&&l({currentTarget:s.target},s.pointerType)},[o]),{hoverProps:u,isHovered:i}}function Tb(e={}){let{autoFocus:t=!1,isTextInput:n,within:r}=e,o=F.useRef({isFocused:!1,isFocusVisible:t||Rb()}),[i,a]=F.useState(!1),[s,u]=F.useState(()=>o.current.isFocused&&o.current.isFocusVisible),l=F.useCallback(()=>u(o.current.isFocused&&o.current.isFocusVisible),[]),c=F.useCallback(h=>{o.current.isFocused=h,a(h),l()},[l]);ZP(h=>{o.current.isFocusVisible=h,l()},[],{isTextInput:n});let{focusProps:f}=KP({isDisabled:r,onFocusChange:c}),{focusWithinProps:d}=eA({isDisabled:!r,onFocusWithinChange:c});return{isFocused:i,isFocusVisible:s,focusProps:r?d:f}}var nA=Object.defineProperty,rA=(e,t,n)=>t in e?nA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ed=(e,t,n)=>(rA(e,typeof t!="symbol"?t+"":t,n),n);let oA=class{constructor(){ed(this,"current",this.detect()),ed(this,"handoffState","pending"),ed(this,"currentId",0)}set(t){this.current!==t&&(this.handoffState="pending",this.currentId=0,this.current=t)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Db=new oA;function iA(e){return Db.isServer?null:e instanceof Node?e.ownerDocument:e!=null&&e.hasOwnProperty("current")&&e.current instanceof Node?e.current.ownerDocument:document}function aA(e){typeof queueMicrotask=="function"?queueMicrotask(e):Promise.resolve().then(e).catch(t=>setTimeout(()=>{throw t}))}function Nb(){let e=[],t={addEventListener(n,r,o,i){return n.addEventListener(r,o,i),t.add(()=>n.removeEventListener(r,o,i))},requestAnimationFrame(...n){let r=requestAnimationFrame(...n);return t.add(()=>cancelAnimationFrame(r))},nextFrame(...n){return t.requestAnimationFrame(()=>t.requestAnimationFrame(...n))},setTimeout(...n){let r=setTimeout(...n);return t.add(()=>clearTimeout(r))},microTask(...n){let r={current:!0};return aA(()=>{r.current&&n[0]()}),t.add(()=>{r.current=!1})},style(n,r,o){let i=n.style.getPropertyValue(r);return Object.assign(n.style,{[r]:o}),this.add(()=>{Object.assign(n.style,{[r]:i})})},group(n){let r=Nb();return n(r),this.add(()=>r.dispose())},add(n){return e.includes(n)||e.push(n),()=>{let r=e.indexOf(n);if(r>=0)for(let o of e.splice(r,1))o()}},dispose(){for(let n of e.splice(0))n()}};return t}function sA(){let[e]=F.useState(Nb);return F.useEffect(()=>()=>e.dispose(),[e]),e}let au=(e,t)=>{Db.isServer?F.useEffect(e,t):F.useLayoutEffect(e,t)};function Tv(e){let t=F.useRef(e);return au(()=>{t.current=e},[e]),t}let _r=function(e){let t=Tv(e);return mt.useCallback((...n)=>t.current(...n),[t])},uA=F.createContext(void 0);function Hc(){return F.useContext(uA)}function w0(...e){return Array.from(new Set(e.flatMap(t=>typeof t=="string"?t.split(" "):[]))).filter(Boolean).join(" ")}function Dv(e,t,...n){if(e in t){let o=t[e];return typeof o=="function"?o(...n):o}let r=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(o=>`"${o}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Dv),r}var lA=(e=>(e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static",e))(lA||{}),cA=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(cA||{});function Ia({ourProps:e,theirProps:t,slot:n,defaultTag:r,features:o,visible:i=!0,name:a,mergeRefs:s}){s=s??fA;let u=Pb(t,e);if(i)return qu(u,n,r,a,s);let l=o??0;if(l&2){let{static:c=!1,...f}=u;if(c)return qu(f,n,r,a,s)}if(l&1){let{unmount:c=!0,...f}=u;return Dv(c?0:1,{0(){return null},1(){return qu({...f,hidden:!0,style:{display:"none"}},n,r,a,s)}})}return qu(u,n,r,a,s)}function qu(e,t={},n,r,o){let{as:i=n,children:a,refName:s="ref",...u}=td(e,["unmount","static"]),l=e.ref!==void 0?{[s]:e.ref}:{},c=typeof a=="function"?a(t):a;"className"in u&&u.className&&typeof u.className=="function"&&(u.className=u.className(t)),u["aria-labelledby"]&&u["aria-labelledby"]===u.id&&(u["aria-labelledby"]=void 0);let f={};if(t){let d=!1,h=[];for(let[p,m]of Object.entries(t))typeof m=="boolean"&&(d=!0),m===!0&&h.push(p.replace(/([A-Z])/g,g=>`-${g.toLowerCase()}`));if(d){f["data-headlessui-state"]=h.join(" ");for(let p of h)f[`data-${p}`]=""}}if(i===F.Fragment&&(Object.keys(Xo(u)).length>0||Object.keys(Xo(f)).length>0))if(!F.isValidElement(c)||Array.isArray(c)&&c.length>1){if(Object.keys(Xo(u)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${r} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(Xo(u)).concat(Object.keys(Xo(f))).map(d=>`  - ${d}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(d=>`  - ${d}`).join(`
`)].join(`
`))}else{let d=c.props,h=d==null?void 0:d.className,p=typeof h=="function"?(...v)=>w0(h(...v),u.className):w0(h,u.className),m=p?{className:p}:{},g=Pb(c.props,Xo(td(u,["ref"])));for(let v in f)v in g&&delete f[v];return F.cloneElement(c,Object.assign({},g,f,l,{ref:o(c.ref,l.ref)},m))}return F.createElement(i,Object.assign({},td(u,["ref"]),i!==F.Fragment&&l,i!==F.Fragment&&f),c)}function fA(...e){return e.every(t=>t==null)?void 0:t=>{for(let n of e)n!=null&&(typeof n=="function"?n(t):n.current=t)}}function Pb(...e){if(e.length===0)return{};if(e.length===1)return e[0];let t={},n={};for(let r of e)for(let o in r)o.startsWith("on")&&typeof r[o]=="function"?(n[o]!=null||(n[o]=[]),n[o].push(r[o])):t[o]=r[o];if(t.disabled||t["aria-disabled"])for(let r in n)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(r)&&(n[r]=[o=>{var i;return(i=o==null?void 0:o.preventDefault)==null?void 0:i.call(o)}]);for(let r in n)Object.assign(t,{[r](o,...i){let a=n[r];for(let s of a){if((o instanceof Event||(o==null?void 0:o.nativeEvent)instanceof Event)&&o.defaultPrevented)return;s(o,...i)}}});return t}function Ab(...e){if(e.length===0)return{};if(e.length===1)return e[0];let t={},n={};for(let r of e)for(let o in r)o.startsWith("on")&&typeof r[o]=="function"?(n[o]!=null||(n[o]=[]),n[o].push(r[o])):t[o]=r[o];for(let r in n)Object.assign(t,{[r](...o){let i=n[r];for(let a of i)a==null||a(...o)}});return t}function Ta(e){var t;return Object.assign(F.forwardRef(e),{displayName:(t=e.displayName)!=null?t:e.name})}function Xo(e){let t=Object.assign({},e);for(let n in t)t[n]===void 0&&delete t[n];return t}function td(e,t=[]){let n=Object.assign({},e);for(let r of t)r in n&&delete n[r];return n}function dA(e,t,n){let[r,o]=F.useState(n),i=e!==void 0,a=F.useRef(i),s=F.useRef(!1),u=F.useRef(!1);return i&&!a.current&&!s.current?(s.current=!0,a.current=i,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!i&&a.current&&!u.current&&(u.current=!0,a.current=i,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[i?e:r,_r(l=>(i||o(l),t==null?void 0:t(l)))]}function hA(e){let[t]=F.useState(e);return t}function Fb(e={},t=null,n=[]){for(let[r,o]of Object.entries(e))Ob(n,Mb(t,r),o);return n}function Mb(e,t){return e?e+"["+t+"]":t}function Ob(e,t,n){if(Array.isArray(n))for(let[r,o]of n.entries())Ob(e,Mb(t,r.toString()),o);else n instanceof Date?e.push([t,n.toISOString()]):typeof n=="boolean"?e.push([t,n?"1":"0"]):typeof n=="string"?e.push([t,n]):typeof n=="number"?e.push([t,`${n}`]):n==null?e.push([t,""]):Fb(n,t,e)}function pA(e){var t,n;let r=(t=e==null?void 0:e.form)!=null?t:e.closest("form");if(r){for(let o of r.elements)if(o!==e&&(o.tagName==="INPUT"&&o.type==="submit"||o.tagName==="BUTTON"&&o.type==="submit"||o.nodeName==="INPUT"&&o.type==="image")){o.click();return}(n=r.requestSubmit)==null||n.call(r)}}let vA="span";var Nv=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(Nv||{});function mA(e,t){var n;let{features:r=1,...o}=e,i={ref:t,"aria-hidden":(r&2)===2?!0:(n=o["aria-hidden"])!=null?n:void 0,hidden:(r&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return Ia({ourProps:i,theirProps:o,slot:{},defaultTag:vA,name:"Hidden"})}let Lb=Ta(mA),gA=F.createContext(null);function yA({children:e}){let t=F.useContext(gA);if(!t)return mt.createElement(mt.Fragment,null,e);let{target:n}=t;return n?Cc.createPortal(mt.createElement(mt.Fragment,null,e),n):null}function xA({data:e,form:t,disabled:n,onReset:r,overrides:o}){let[i,a]=F.useState(null),s=sA();return F.useEffect(()=>{if(r&&i)return s.addEventListener(i,"reset",r)},[i,t,r]),mt.createElement(yA,null,mt.createElement(wA,{setForm:a,formId:t}),Fb(e).map(([u,l])=>mt.createElement(Lb,{features:Nv.Hidden,...Xo({key:u,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:t,disabled:n,name:u,value:l,...o})})))}function wA({setForm:e,formId:t}){return F.useEffect(()=>{if(t){let n=document.getElementById(t);n&&e(n)}},[e,t]),t?null:mt.createElement(Lb,{features:Nv.Hidden,as:"input",type:"hidden",hidden:!0,readOnly:!0,ref:n=>{if(!n)return;let r=n.closest("form");r&&e(r)}})}let bA=F.createContext(void 0);function Bb(){return F.useContext(bA)}function Wb(e){let t=e.parentElement,n=null;for(;t&&!(t instanceof HTMLFieldSetElement);)t instanceof HTMLLegendElement&&(n=t),t=t.parentElement;let r=(t==null?void 0:t.getAttribute("disabled"))==="";return r&&EA(n)?!1:r}function EA(e){if(!e)return!1;let t=e.previousElementSibling;for(;t!==null;){if(t instanceof HTMLLegendElement)return!1;t=t.previousElementSibling}return!0}let CA=Symbol();function su(...e){let t=F.useRef(e);F.useEffect(()=>{t.current=e},[e]);let n=_r(r=>{for(let o of t.current)o!=null&&(typeof o=="function"?o(r):o.current=r)});return e.every(r=>r==null||(r==null?void 0:r[CA]))?void 0:n}let Gc=F.createContext(null);Gc.displayName="DescriptionContext";function $b(){let e=F.useContext(Gc);if(e===null){let t=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,$b),t}return e}function _A(){var e,t;return(t=(e=F.useContext(Gc))==null?void 0:e.value)!=null?t:void 0}function zb(){let[e,t]=F.useState([]);return[e.length>0?e.join(" "):void 0,F.useMemo(()=>function(n){let r=_r(i=>(t(a=>[...a,i]),()=>t(a=>{let s=a.slice(),u=s.indexOf(i);return u!==-1&&s.splice(u,1),s}))),o=F.useMemo(()=>({register:r,slot:n.slot,name:n.name,props:n.props,value:n.value}),[r,n.slot,n.name,n.props,n.value]);return mt.createElement(Gc.Provider,{value:o},n.children)},[t])]}let SA="p";function kA(e,t){let n=F.useId(),r=Hc(),{id:o=`headlessui-description-${n}`,...i}=e,a=$b(),s=su(t);au(()=>a.register(o),[o,a.register]);let u=r||!1,l=F.useMemo(()=>({...a.slot,disabled:u}),[a.slot,u]),c={ref:s,...a.props,id:o};return Ia({ourProps:c,theirProps:i,slot:l,defaultTag:SA,name:a.name||"Description"})}let RA=Ta(kA),IA=Object.assign(RA,{});var Yo=(e=>(e.Space=" ",e.Enter="Enter",e.Escape="Escape",e.Backspace="Backspace",e.Delete="Delete",e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.Home="Home",e.End="End",e.PageUp="PageUp",e.PageDown="PageDown",e.Tab="Tab",e))(Yo||{});let Kc=F.createContext(null);Kc.displayName="LabelContext";function Ub(){let e=F.useContext(Kc);if(e===null){let t=new Error("You used a <Label /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,Ub),t}return e}function jb(e){var t,n,r;let o=(n=(t=F.useContext(Kc))==null?void 0:t.value)!=null?n:void 0;return((r=void 0)!=null?r:0)>0?[o,...e].filter(Boolean).join(" "):o}function Vb({inherit:e=!1}={}){let t=jb(),[n,r]=F.useState([]),o=e?[t,...n].filter(Boolean):n;return[o.length>0?o.join(" "):void 0,F.useMemo(()=>function(i){let a=_r(u=>(r(l=>[...l,u]),()=>r(l=>{let c=l.slice(),f=c.indexOf(u);return f!==-1&&c.splice(f,1),c}))),s=F.useMemo(()=>({register:a,slot:i.slot,name:i.name,props:i.props,value:i.value}),[a,i.slot,i.name,i.props,i.value]);return mt.createElement(Kc.Provider,{value:s},i.children)},[r])]}let TA="label";function DA(e,t){var n;let r=F.useId(),o=Ub(),i=Bb(),a=Hc(),{id:s=`headlessui-label-${r}`,htmlFor:u=i??((n=o.props)==null?void 0:n.htmlFor),passive:l=!1,...c}=e,f=su(t);au(()=>o.register(s),[s,o.register]);let d=_r(g=>{let v=g.currentTarget;if(v instanceof HTMLLabelElement&&g.preventDefault(),o.props&&"onClick"in o.props&&typeof o.props.onClick=="function"&&o.props.onClick(g),v instanceof HTMLLabelElement){let y=document.getElementById(v.htmlFor);if(y){let x=y.getAttribute("disabled");if(x==="true"||x==="")return;let w=y.getAttribute("aria-disabled");if(w==="true"||w==="")return;(y instanceof HTMLInputElement&&(y.type==="radio"||y.type==="checkbox")||y.role==="radio"||y.role==="checkbox"||y.role==="switch")&&y.click(),y.focus({preventScroll:!0})}}}),h=a||!1,p=F.useMemo(()=>({...o.slot,disabled:h}),[o.slot,h]),m={ref:f,...o.props,id:s,htmlFor:u,onClick:d};return l&&("onClick"in m&&(delete m.htmlFor,delete m.onClick),"onClick"in c&&delete c.onClick),Ia({ourProps:m,theirProps:c,slot:p,defaultTag:u?TA:"div",name:o.name||"Label"})}let NA=Ta(DA),PA=Object.assign(NA,{});function AA(e,t){return e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&"id"in e&&"id"in t?e.id===t.id:e===t}function FA(e=AA){return F.useCallback((t,n)=>{if(typeof e=="string"){let r=e;return(t==null?void 0:t[r])===(n==null?void 0:n[r])}return e(t,n)},[e])}let MA=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),OA=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var Za=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(Za||{}),kh=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(kh||{}),LA=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(LA||{});function BA(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(MA)).sort((t,n)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(n.tabIndex||Number.MAX_SAFE_INTEGER)))}function WA(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(OA)).sort((t,n)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(n.tabIndex||Number.MAX_SAFE_INTEGER)))}var $A=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))($A||{}),zA=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(zA||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{e.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:e.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));let UA=["textarea","input"].join(",");function jA(e){var t,n;return(n=(t=e==null?void 0:e.matches)==null?void 0:t.call(e,UA))!=null?n:!1}function Hb(e,t=n=>n){return e.slice().sort((n,r)=>{let o=t(n),i=t(r);if(o===null||i===null)return 0;let a=o.compareDocumentPosition(i);return a&Node.DOCUMENT_POSITION_FOLLOWING?-1:a&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function b0(e,t,{sorted:n=!0,relativeTo:r=null,skipElements:o=[]}={}){let i=Array.isArray(e)?e.length>0?e[0].ownerDocument:document:e.ownerDocument,a=Array.isArray(e)?n?Hb(e):e:t&64?WA(e):BA(e);o.length>0&&a.length>1&&(a=a.filter(h=>!o.some(p=>p!=null&&"current"in p?(p==null?void 0:p.current)===h:p===h))),r=r??i.activeElement;let s=(()=>{if(t&5)return 1;if(t&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=(()=>{if(t&1)return 0;if(t&2)return Math.max(0,a.indexOf(r))-1;if(t&4)return Math.max(0,a.indexOf(r))+1;if(t&8)return a.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),l=t&32?{preventScroll:!0}:{},c=0,f=a.length,d;do{if(c>=f||c+f<=0)return 0;let h=u+c;if(t&16)h=(h+f)%f;else{if(h<0)return 3;if(h>=f)return 1}d=a[h],d==null||d.focus(l),c+=s}while(d!==i.activeElement);return t&6&&jA(d)&&d.select(),2}var VA=(e=>(e[e.RegisterOption=0]="RegisterOption",e[e.UnregisterOption=1]="UnregisterOption",e))(VA||{});let HA={0(e,t){let n=[...e.options,{id:t.id,element:t.element,propsRef:t.propsRef}];return{...e,options:Hb(n,r=>r.element.current)}},1(e,t){let n=e.options.slice(),r=e.options.findIndex(o=>o.id===t.id);return r===-1?e:(n.splice(r,1),{...e,options:n})}},Pv=F.createContext(null);Pv.displayName="RadioGroupDataContext";function Av(e){let t=F.useContext(Pv);if(t===null){let n=new Error(`<${e} /> is missing a parent <RadioGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Av),n}return t}let Fv=F.createContext(null);Fv.displayName="RadioGroupActionsContext";function Mv(e){let t=F.useContext(Fv);if(t===null){let n=new Error(`<${e} /> is missing a parent <RadioGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Mv),n}return t}function GA(e,t){return Dv(t.type,HA,e,t)}let KA="div";function qA(e,t){let n=F.useId(),r=Hc(),{id:o=`headlessui-radiogroup-${n}`,value:i,form:a,name:s,onChange:u,by:l,disabled:c=r||!1,defaultValue:f,...d}=e,h=FA(l),[p,m]=F.useReducer(GA,{options:[]}),g=p.options,[v,y]=Vb(),[x,w]=zb(),b=F.useRef(null),C=su(b,t),S=hA(f),[E,k]=dA(i,u,S),_=F.useMemo(()=>g.find(B=>!B.propsRef.current.disabled),[g]),T=F.useMemo(()=>g.some(B=>h(B.propsRef.current.value,E)),[g,E]),D=_r(B=>{var q;if(c||h(B,E))return!1;let Q=(q=g.find(ne=>h(ne.propsRef.current.value,B)))==null?void 0:q.propsRef.current;return Q!=null&&Q.disabled?!1:(k==null||k(B),!0)}),z=_r(B=>{let q=b.current;if(!q)return;let Q=iA(q),ne=g.filter(re=>re.propsRef.current.disabled===!1).map(re=>re.element.current);switch(B.key){case Yo.Enter:pA(B.currentTarget);break;case Yo.ArrowLeft:case Yo.ArrowUp:if(B.preventDefault(),B.stopPropagation(),b0(ne,Za.Previous|Za.WrapAround)===kh.Success){let re=g.find(ve=>ve.element.current===(Q==null?void 0:Q.activeElement));re&&D(re.propsRef.current.value)}break;case Yo.ArrowRight:case Yo.ArrowDown:if(B.preventDefault(),B.stopPropagation(),b0(ne,Za.Next|Za.WrapAround)===kh.Success){let re=g.find(ve=>ve.element.current===(Q==null?void 0:Q.activeElement));re&&D(re.propsRef.current.value)}break;case Yo.Space:{B.preventDefault(),B.stopPropagation();let re=g.find(ve=>ve.element.current===(Q==null?void 0:Q.activeElement));re&&D(re.propsRef.current.value)}break}}),W=_r(B=>(m({type:0,...B}),()=>m({type:1,id:B.id}))),V=F.useMemo(()=>({value:E,firstOption:_,containsCheckedOption:T,disabled:c,compare:h,...p}),[E,_,T,c,h,p]),K=F.useMemo(()=>({registerOption:W,change:D}),[W,D]),G={ref:C,id:o,role:"radiogroup","aria-labelledby":v,"aria-describedby":x,onKeyDown:z},N=F.useMemo(()=>({value:E}),[E]),O=F.useCallback(()=>{if(S!==void 0)return D(S)},[D,S]);return mt.createElement(w,{name:"RadioGroup.Description"},mt.createElement(y,{name:"RadioGroup.Label"},mt.createElement(Fv.Provider,{value:K},mt.createElement(Pv.Provider,{value:V},s!=null&&mt.createElement(xA,{disabled:c,data:{[s]:E||"on"},overrides:{type:"radio",checked:E!=null},form:a,onReset:O}),Ia({ourProps:G,theirProps:d,slot:N,defaultTag:KA,name:"RadioGroup"})))))}let XA="div";function YA(e,t){var n;let r=Av("RadioGroup.Option"),o=Mv("RadioGroup.Option"),i=F.useId(),{id:a=`headlessui-radiogroup-option-${i}`,value:s,disabled:u=r.disabled||!1,autoFocus:l=!1,...c}=e,f=F.useRef(null),d=su(f,t),[h,p]=Vb(),[m,g]=zb(),v=Tv({value:s,disabled:u});au(()=>o.registerOption({id:a,element:f,propsRef:v}),[a,o,f,v]);let y=_r(T=>{var D;if(Wb(T.currentTarget))return T.preventDefault();o.change(s)&&((D=f.current)==null||D.focus())}),x=((n=r.firstOption)==null?void 0:n.id)===a,{isFocusVisible:w,focusProps:b}=Tb({autoFocus:l}),{isHovered:C,hoverProps:S}=Ib({isDisabled:u}),E=r.compare(r.value,s),k=Ab({ref:d,id:a,role:"radio","aria-checked":E?"true":"false","aria-labelledby":h,"aria-describedby":m,"aria-disabled":u?!0:void 0,tabIndex:u?-1:E||!r.containsCheckedOption&&x?0:-1,onClick:u?void 0:y,autoFocus:l},b,S),_=F.useMemo(()=>({checked:E,disabled:u,active:w,hover:C,focus:w,autofocus:l}),[E,u,C,w,l]);return mt.createElement(g,{name:"RadioGroup.Description"},mt.createElement(p,{name:"RadioGroup.Label"},Ia({ourProps:k,theirProps:c,slot:_,defaultTag:XA,name:"RadioGroup.Option"})))}let QA="span";function JA(e,t){var n;let r=Av("Radio"),o=Mv("Radio"),i=F.useId(),a=Bb(),s=Hc(),{id:u=a||`headlessui-radio-${i}`,value:l,disabled:c=r.disabled||s||!1,autoFocus:f=!1,...d}=e,h=F.useRef(null),p=su(h,t),m=jb(),g=_A(),v=Tv({value:l,disabled:c});au(()=>o.registerOption({id:u,element:h,propsRef:v}),[u,o,h,v]);let y=_r(T=>{var D;if(Wb(T.currentTarget))return T.preventDefault();o.change(l)&&((D=h.current)==null||D.focus())}),{isFocusVisible:x,focusProps:w}=Tb({autoFocus:f}),{isHovered:b,hoverProps:C}=Ib({isDisabled:c}),S=((n=r.firstOption)==null?void 0:n.id)===u,E=r.compare(r.value,l),k=Ab({ref:p,id:u,role:"radio","aria-checked":E?"true":"false","aria-labelledby":m,"aria-describedby":g,"aria-disabled":c?!0:void 0,tabIndex:c?-1:E||!r.containsCheckedOption&&S?0:-1,autoFocus:f,onClick:c?void 0:y},w,C),_=F.useMemo(()=>({checked:E,disabled:c,hover:b,focus:x,autofocus:f}),[E,c,b,x,f]);return Ia({ourProps:k,theirProps:d,slot:_,defaultTag:QA,name:"Radio"})}let ZA=Ta(qA),e4=Ta(YA),t4=Ta(JA),n4=PA,r4=IA,ac=Object.assign(ZA,{Option:e4,Radio:t4,Label:n4,Description:r4});function E0({user:e,type:t}){return J.jsx(ac.Option,{value:e,className:({checked:n})=>`${n?"bg-indigo-600 bg-opacity-75 text-white":"bg-white"} relative flex cursor-pointer rounded-lg px-5 py-4 shadow-md focus:outline-none`,children:({checked:n})=>J.jsxs("div",{className:"flex w-full items-center justify-between",children:[J.jsx("div",{className:"flex items-center",children:J.jsx("div",{className:"text-sm",children:J.jsxs(ac.Label,{as:"div",className:`flex items-center gap-x-6 font-medium ${n?"text-white":"text-gray-900"}`,children:[J.jsx("img",{className:"object-cover h-10 w-10 rounded-full",src:t==="CUSTOM"?e.picture:`/temp-accounts/${e.picture}`,alt:e.fullName}),e.fullName]})})}),n&&J.jsx("div",{className:"shrink-0 text-white",children:J.jsx(o4,{className:"h-6 w-6"})})]})},e.id)}function o4(e){return J.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",...e,children:[J.jsx("circle",{cx:12,cy:12,r:12,fill:"#fff",opacity:"0.2"}),J.jsx("path",{d:"M7 13l3 3 7-7",stroke:"#fff",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})]})}const nd=[{id:"374ed1e4-481b-4074-a26e-6137657c6e35",fullName:"Akshit Bhatt",picture:"374ed1e4-481b-4074-a26e-6137657c6e35/1.jpg"},{id:"43332f46-89a4-435c-880e-4d72bb51149a",fullName:"Abhay Kumar",picture:"43332f46-89a4-435c-880e-4d72bb51149a/2.jpg"}];function i4(){const[e,t]=F.useState(nd[0]),[n,r]=F.useState(null),[o,i]=F.useState(null),a=s=>new Promise((u,l)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>{u(c.result)},c.onerror=f=>{l(f)}});return J.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-[24px] w-full max-w-[720px] mx-auto",children:[J.jsx("h1",{className:"text-2xl font-semibold",children:"Select a Dummy User to Log In"}),J.jsx("div",{className:"w-full p-4 text-right",children:J.jsxs("div",{className:"mx-auto w-full max-w-md",children:[J.jsxs(ac,{value:e,onChange:t,children:[J.jsx(ac.Label,{className:"sr-only",children:"Server size"}),J.jsxs("div",{className:"space-y-2",children:[nd.map(s=>J.jsx(E0,{user:s},s.id)),n&&J.jsxs("div",{className:"relative",children:[J.jsx(E0,{user:n,type:"CUSTOM"},n.id),J.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"text-indigo-800 w-6 h-6 absolute top-1/2 -translate-y-1/2 right-[-32px] cursor-pointer",onClick:()=>{r(null),(e==null?void 0:e.type)==="CUSTOM"&&t(nd[0])},children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})]})]}),!n&&J.jsxs("div",{className:"flex flex-col items-center justify-center w-full mt-3",children:[J.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:border-indigo-200 hover:bg-gray-100",children:[J.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[J.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-indigo-500 mb-2",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"})}),J.jsx("p",{className:"font-semibold mb-2 text-sm text-gray-500 dark:text-gray-400",children:"Click to upload referral image"}),J.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG or JPEG"})]}),J.jsx("input",{id:"dropzone-file",type:"file",accept:".png, .jpg, .jpeg",className:"hidden",onChange:async s=>{const u=s.target.files;if(u==null||u.length===0){i("No files wait for import.");return}let l=u[0],c=l.name,f=c.split("."),d=f[f.length-1];if(d!=="png"&&d!=="jpg"&&d!=="jpeg"){i("Only support png jpg or jpeg files.");return}const h=await a(l),p={id:"custom",fullName:c,type:"CUSTOM",picture:h};r(p),t(p)}})]}),o&&J.jsx("p",{className:"text-red-500 text-xs mt-2",children:o})]}),J.jsx(Jd,{to:"/record",state:{account:e},className:"mt-4 inline-flex items-center rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-600",rel:"noopener noreferrer",children:"Record Voice"}),J.jsxs(Jd,{to:"/login",state:{account:e},className:"mt-4 inline-flex items-center rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-600",children:["Continue",J.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"ml-1.5 h-5 w-5",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75"})})]})]})})]})}function a4(){const[e,t]=F.useState(null),n=Ic();return F.useEffect(()=>{localStorage.getItem("faceAuth")||n("/login");const{account:r}=JSON.parse(localStorage.getItem("faceAuth"));t(r)},[]),e?J.jsx("div",{className:"bg-white pt-40 md:pt-60",children:J.jsxs("div",{className:"mx-auto max-w-7xl",children:[J.jsx("h2",{className:"text-center text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl mb-12",children:"You have successfully logged in!"}),J.jsxs("div",{className:"text-center mb-24",children:[J.jsx("img",{className:"mx-auto mb-8 object-cover h-48 w-48 rounded-full",src:(e==null?void 0:e.type)==="CUSTOM"?e.picture:`/temp-accounts/${e.picture}`,alt:e.fullName}),J.jsx("h1",{className:"block text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-800",style:{lineHeight:"1.5"},children:e==null?void 0:e.fullName}),J.jsxs("div",{onClick:()=>{localStorage.removeItem("faceAuth"),n("/")},className:"flex gap-2 mt-12 w-fit mx-auto cursor-pointer z-10 py-3 px-6 rounded-full bg-gradient-to-r from-red-400 to-red-600",children:[J.jsx("span",{className:"text-white",children:"Log Out"}),J.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})})]})]})]})}):null}const s4=()=>{const[e,t]=F.useState(null),[n,r]=F.useState([]),[o,i]=F.useState(!1),[a,s]=F.useState(0),[u,l]=F.useState(null),c=F.useRef(null);F.useEffect(()=>()=>{e&&e.stream.getTracks().forEach(g=>g.stop())},[e]);const f=async()=>{try{const g=await navigator.mediaDevices.getUserMedia({audio:!0}),v=new MediaRecorder(g);v.ondataavailable=y=>{r(x=>[...x,y.data])},v.onstop=()=>{const y=new Blob(n,{type:"audio/wav"}),x=URL.createObjectURL(y);c.current.src=x,r([])},v.start(),t(v),i(!0),h(),setTimeout(d,5e3)}catch(g){console.error("Failed to start recording:",g)}},d=()=>{e&&e.state!=="inactive"&&(e.stop(),i(!1),p())},h=()=>{s(0);const g=setInterval(()=>{s(v=>v+1)},1e3);l(g)},p=()=>{clearInterval(u),l(null),s(0)},m=()=>{const g=new Blob(n,{type:"audio/wav"}),v=window.URL.createObjectURL(g),y=document.createElement("a");y.style.display="none",y.href=v,y.download="recording.wav",document.body.appendChild(y),y.click(),window.URL.revokeObjectURL(v)};return J.jsxs("div",{style:C0.container,children:[J.jsx("h2",{children:"Record Your Voice"}),J.jsx("button",{id:"recordButton",onClick:f,disabled:o,children:o?"Recording...":"Start Recording"}),J.jsx("button",{id:"saveButton",onClick:m,disabled:!n.length,children:"Save Recording"}),J.jsxs("p",{style:C0.timer,children:["Timer: ",a,"s"]}),J.jsx("audio",{ref:c,controls:!0})]})},C0={container:{fontFamily:"Arial, sans-serif",backgroundColor:"#fff",padding:"20px",borderRadius:"10px",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.1)",display:"inline-block",textAlign:"center",marginTop:"50px"},timer:{fontSize:"18px",color:"#666"}},u4=q_(Qd(J.jsxs(J.Fragment,{children:[J.jsx(Go,{path:"/",element:J.jsx(lS,{})}),J.jsx(Go,{path:"user-select",element:J.jsx(i4,{})}),J.jsx(Go,{path:"login",element:J.jsx(WP,{})}),J.jsx(Go,{path:"protected",element:J.jsx(a4,{})}),J.jsx(Go,{path:"record",element:J.jsx(s4,{})})," ",J.jsx(Go,{path:"*",element:J.jsx($_,{to:"/"})})]})),{basename:"/"});function l4(){return J.jsx(J.Fragment,{children:J.jsx(rS,{router:u4})})}B1(document.getElementById("root")).render(J.jsx(F.StrictMode,{children:J.jsx(l4,{})}))});export default c4();
